var PDFFindController={startedTextExtraction:!1,extractTextPromises:[],pendingFindMatches:{},active:!1,pageContents:[],pageMatches:[],selected:{pageIdx:-1,matchIdx:-1},offset:{pageIdx:null,matchIdx:null},resumePageIdx:null,resumeCallback:null,state:null,dirtyMatch:!1,findTimeout:null,pdfPageSource:null,integratedFind:!1,initialize:function(b){if("undefined"===typeof PDFFindBar||null===PDFFindBar)throw"PDFFindController cannot be initialized without a PDFFindController instance";this.pdfPageSource=
b.pdfPageSource;this.integratedFind=b.integratedFind;b=["find","findagain","findhighlightallchange","findcasesensitivitychange"];this.handleEvent=this.handleEvent.bind(this);for(var a=0;a<b.length;a++)window.addEventListener(b[a],this.handleEvent)},calcFindMatch:function(b){var a=this.pageContents[b],c=this.state.query,d=this.state.caseSensitive,f=c.length;if(0!==f){d||(a=a.toLowerCase(),c=c.toLowerCase());for(var d=[],e=-f;;){e=a.indexOf(c,e+f);if(-1===e)break;d.push(e)}this.pageMatches[b]=d;this.updatePage(b);
this.resumePageIdx===b&&(b=this.resumeCallback,this.resumeCallback=this.resumePageIdx=null,b())}},extractText:function(){function b(a){d.pdfPageSource.pages[a].getTextContent().then(function(c){for(var c=c.bidiTexts,g="",h=0;h<c.length;h++)g+=c[h].str;d.pageContents.push(g);d.extractTextPromises[a].resolve(a);a+1<d.pdfPageSource.pages.length&&b(a+1)})}if(!this.startedTextExtraction){this.startedTextExtraction=!0;this.pageContents=[];for(var a=0,c=this.pdfPageSource.pdfDocument.numPages;a<c;a++)this.extractTextPromises.push(new PDFJS.Promise);
var d=this;b(0)}},handleEvent:function(b){if(null===this.state||"findagain"!==b.type)this.dirtyMatch=!0;this.state=b.detail;this.updateUIState(FindStates.FIND_PENDING);this.extractText();clearTimeout(this.findTimeout);"find"===b.type?this.findTimeout=setTimeout(this.nextMatch.bind(this),250):this.nextMatch()},updatePage:function(b){var a=this.pdfPageSource.pages[b];this.selected.pageIdx===b&&a.scrollIntoView();a.textLayer&&a.textLayer.updateMatches()},nextMatch:function(){var b=this.state.findPrevious,
a=this.pdfPageSource.pages.length;this.active=!0;if(this.dirtyMatch){this.dirtyMatch=!1;this.selected.pageIdx=this.selected.matchIdx=-1;this.offset.pageIdx=b?a-1:0;this.offset.matchIdx=null;this.hadMatch=!1;this.resumePageIdx=this.resumeCallback=null;this.pageMatches=[];for(var c=this,d=0;d<a;d++)this.updatePage(d),d in this.pendingFindMatches||(this.pendingFindMatches[d]=!0,this.extractTextPromises[d].then(function(a){delete c.pendingFindMatches[a];c.calcFindMatch(a)}))}if(""===this.state.query)this.updateUIState(FindStates.FIND_FOUND);
else if(!this.resumeCallback){a=this.offset;if(null!==a.matchIdx){d=this.pageMatches[a.pageIdx].length;if(!b&&a.matchIdx+1<d||b&&0<a.matchIdx){this.hadMatch=!0;a.matchIdx=b?a.matchIdx-1:a.matchIdx+1;this.updateMatch(!0);return}this.advanceOffsetPage(b)}this.nextPageMatch()}},nextPageMatch:function(){null!==this.resumePageIdx&&console.error("There can only be one pending page.");var b=function(a){var b=this.offset,a=a.length,c=this.state.findPrevious;if(a)this.hadMatch=!0,b.matchIdx=c?a-1:0,this.updateMatch(!0);
else{this.advanceOffsetPage(c);if(b.wrapped&&(b.matchIdx=null,!this.hadMatch)){this.updateMatch(!1);return}this.nextPageMatch()}}.bind(this),a=this.offset.pageIdx,c=this.pageMatches;c[a]?b(c[a]):(this.resumeCallback=function(){b(c[a])},this.resumePageIdx=a)},advanceOffsetPage:function(b){var a=this.offset,c=this.extractTextPromises.length;a.pageIdx=b?a.pageIdx-1:a.pageIdx+1;a.matchIdx=null;if(a.pageIdx>=c||0>a.pageIdx)a.pageIdx=b?c-1:0,a.wrapped=!0},updateMatch:function(b){var a=FindStates.FIND_NOTFOUND,
c=this.offset.wrapped;this.offset.wrapped=!1;b&&(b=this.selected.pageIdx,this.selected.pageIdx=this.offset.pageIdx,this.selected.matchIdx=this.offset.matchIdx,a=c?FindStates.FIND_WRAPPED:FindStates.FIND_FOUND,-1!==b&&b!==this.selected.pageIdx&&this.updatePage(b));this.updateUIState(a,this.state.findPrevious);-1!==this.selected.pageIdx&&this.updatePage(this.selected.pageIdx,!0)},updateUIState:function(b,a){this.integratedFind?FirefoxCom.request("updateFindControlState",{result:b,findPrevious:a}):PDFFindBar.updateUIState(b,
a)}};
