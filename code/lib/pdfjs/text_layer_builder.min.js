var TextLayerBuilder=function(m){var n=document.createDocumentFragment();this.textLayerDiv=m.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=m.pageIndex;this.matches=[];this.lastScrollSource=m.lastScrollSource;"undefined"===typeof PDFFindController&&(window.PDFFindController=null);"undefined"===typeof this.lastScrollSource&&(this.lastScrollSource=null);this.beginLayout=function(){this.textDivs=[];this.renderingDone=false};this.endLayout=function(){this.layoutDone=true;this.insertDivContent()};
this.renderLayer=function(){var c=this.textDivs,a=this.textLayerDiv,d=document.createElement("canvas").getContext("2d");if(!(c.length>1E5)){for(var e=0,g=c.length;e<g;e++){var b=c[e];if(!("isWhitespace"in b.dataset)){n.appendChild(b);d.font=b.style.fontSize+" "+b.style.fontFamily;var f=d.measureText(b.textContent).width;if(f>0){f="scale("+b.dataset.canvasWidth/f+", 1)";f="rotate("+b.dataset.angle+"deg) "+f;CustomStyle.setProp("transform",b,f);CustomStyle.setProp("transformOrigin",b,"0% 0%");a.appendChild(b)}}}this.renderingDone=
true;this.updateMatches();a.appendChild(n)}};this.setupRenderLayoutTimer=function(){var c=this,a=this.lastScrollSource===null?0:this.lastScrollSource.lastScroll;if(Date.now()-a>200)this.renderLayer();else{this.renderTimer&&clearTimeout(this.renderTimer);this.renderTimer=setTimeout(function(){c.setupRenderLayoutTimer()},200)}};this.appendText=function(c){var a=document.createElement("div"),d=c.fontSize*Math.abs(c.vScale);a.dataset.canvasWidth=c.canvasWidth*Math.abs(c.hScale);a.dataset.fontName=c.fontName;
a.dataset.angle=c.angle*(180/Math.PI);a.style.fontSize=d+"px";a.style.fontFamily=c.fontFamily;a.style.left=c.x+d*Math.sin(c.angle)+"px";a.style.top=c.y-d*Math.cos(c.angle)+"px";this.textDivs.push(a)};this.insertDivContent=function(){if(this.layoutDone&&!this.divContentDone&&this.textContent){this.divContentDone=true;for(var c=this.textDivs,a=this.textContent.bidiTexts,d=0;d<a.length;d++){var e=a[d],g=c[d];if(/\S/.test(e.str)){g.textContent=e.str;g.dir=e.dir}else g.dataset.isWhitespace=true}this.setupRenderLayoutTimer()}};
this.setTextContent=function(c){this.textContent=c;this.insertDivContent()};this.convertMatches=function(c){for(var a=0,d=0,e=this.textContent.bidiTexts,g=e.length-1,b=PDFFindController===null?0:PDFFindController.state.query.length,f=[],l=0;l<c.length;l++){for(var h=c[l];a!==g&&h>=d+e[a].str.length;){d=d+e[a].str.length;a++}a==e.length&&console.error("Could not find matching mapping");for(var i={begin:{divIdx:a,offset:h-d}},h=h+b;a!==g&&h>d+e[a].str.length;){d=d+e[a].str.length;a++}i.end={divIdx:a,
offset:h-d};f.push(i)}return f};this.renderMatches=function(c){function a(a,c){var b=a.divIdx,d=g[b];d.textContent="";var h=e[b].str.substring(0,a.offset),h=document.createTextNode(h);if(c){var b=f&&b===l,i=document.createElement("span");i.className=c+(b?" selected":"");i.appendChild(h);d.appendChild(i)}else d.appendChild(h)}function d(a,b,c){var d=a.divIdx,f=g[d],a=e[d].str.substring(a.offset,b.offset),a=document.createTextNode(a);if(c){b=document.createElement("span");b.className=c;b.appendChild(a);
f.appendChild(b)}else f.appendChild(a)}if(c.length!==0){var e=this.textContent.bidiTexts,g=this.textDivs,b=null,f=PDFFindController===null?false:this.pageIdx===PDFFindController.selected.pageIdx,l=PDFFindController===null?-1:PDFFindController.selected.matchIdx,h={divIdx:-1,offset:void 0},i=l,m=i+1;if(PDFFindController===null?0:PDFFindController.state.highlightAll){i=0;m=c.length}else if(!f)return;for(;i<m;i++){var j=c[i],k=j.begin,j=j.end,n=f&&i===l,o=n?" selected":"";n&&scrollIntoView(g[k.divIdx],
{top:-50});if(!b||k.divIdx!==b.divIdx){b!==null&&d(b,h);a(k)}else d(b,k);if(k.divIdx===j.divIdx)d(k,j,"highlight"+o);else{d(k,h,"highlight begin"+o);for(b=k.divIdx+1;b<j.divIdx;b++)g[b].className="highlight middle"+o;a(j,"highlight end"+o)}b=j}b&&d(b,h)}};this.updateMatches=function(){if(this.renderingDone){for(var c=this.matches,a=this.textDivs,d=this.textContent.bidiTexts,e=-1,g=0;g<c.length;g++){for(var b=c[g],e=Math.max(e,b.begin.divIdx);e<=b.end.divIdx;e++){var f=a[e];f.textContent=d[e].str;
f.className=""}e=b.end.divIdx+1}if(PDFFindController!==null&&PDFFindController.active){this.matches=this.convertMatches(PDFFindController===null?[]:PDFFindController.pageMatches[this.pageIdx]||[]);this.renderMatches(this.matches)}}}};
