var TextLayerBuilder=function(m){var n=document.createDocumentFragment();this.textLayerDiv=m.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=m.pageIndex;this.matches=[];this.lastScrollSource=m.lastScrollSource;"undefined"===typeof PDFFindController&&(window.PDFFindController=null);"undefined"===typeof this.lastScrollSource&&(this.lastScrollSource=null);this.beginLayout=function(){this.textDivs=[];this.renderingDone=false};this.endLayout=function(){this.layoutDone=true;this.insertDivContent()};
this.renderLayer=function(){var c=this.textDivs,a=this.textContent.bidiTexts,b=this.textLayerDiv,e=document.createElement("canvas").getContext("2d");if(!(c.length>1E5)){for(var g=0,d=c.length;g<d;g++){var f=c[g];if(!("isWhitespace"in f.dataset)){n.appendChild(f);e.font=f.style.fontSize+" "+f.style.fontFamily;var i=e.measureText(f.textContent).width;if(i>0){i="scale("+f.dataset.canvasWidth/i+", 1)";a[g].dir==="ttb"&&(i="rotate(90deg) "+i);CustomStyle.setProp("transform",f,i);CustomStyle.setProp("transformOrigin",
f,"0% 0%");b.appendChild(f)}}}this.renderingDone=true;this.updateMatches();b.appendChild(n)}};this.setupRenderLayoutTimer=function(){var c=this,a=this.lastScrollSource===null?0:this.lastScrollSource.lastScroll;if(Date.now()-a>200)this.renderLayer();else{this.renderTimer&&clearTimeout(this.renderTimer);this.renderTimer=setTimeout(function(){c.setupRenderLayoutTimer()},200)}};this.appendText=function(c){var a=document.createElement("div"),b=c.fontSize*Math.abs(c.vScale);a.dataset.canvasWidth=c.canvasWidth*
c.hScale;a.dataset.fontName=c.fontName;a.style.fontSize=b+"px";a.style.fontFamily=c.fontFamily;a.style.left=c.x+"px";a.style.top=c.y-b+"px";this.textDivs.push(a)};this.insertDivContent=function(){if(this.layoutDone&&!this.divContentDone&&this.textContent){this.divContentDone=true;for(var c=this.textDivs,a=this.textContent.bidiTexts,b=0;b<a.length;b++){var e=a[b],g=c[b];if(/\S/.test(e.str)){g.textContent=e.str;g.dir=e.dir==="rtl"?"rtl":"ltr"}else g.dataset.isWhitespace=true}this.setupRenderLayoutTimer()}};
this.setTextContent=function(c){this.textContent=c;this.insertDivContent()};this.convertMatches=function(c){for(var a=0,b=0,e=this.textContent.bidiTexts,g=e.length-1,d=PDFFindController===null?0:PDFFindController.state.query.length,f=[],i=0;i<c.length;i++){for(var h=c[i];a!==g&&h>=b+e[a].str.length;){b=b+e[a].str.length;a++}a==e.length&&console.error("Could not find matching mapping");for(var j={begin:{divIdx:a,offset:h-b}},h=h+d;a!==g&&h>b+e[a].str.length;){b=b+e[a].str.length;a++}j.end={divIdx:a,
offset:h-b};f.push(j)}return f};this.renderMatches=function(c){function a(a,c){var b=a.divIdx,d=g[b];d.textContent="";var h=e[b].str.substring(0,a.offset),h=document.createTextNode(h);if(c){var b=f&&b===i,j=document.createElement("span");j.className=c+(b?" selected":"");j.appendChild(h);d.appendChild(j)}else d.appendChild(h)}function b(a,b,c){var d=a.divIdx,f=g[d],a=e[d].str.substring(a.offset,b.offset),a=document.createTextNode(a);if(c){b=document.createElement("span");b.className=c;b.appendChild(a);
f.appendChild(b)}else f.appendChild(a)}if(c.length!==0){var e=this.textContent.bidiTexts,g=this.textDivs,d=null,f=PDFFindController===null?false:this.pageIdx===PDFFindController.selected.pageIdx,i=PDFFindController===null?-1:PDFFindController.selected.matchIdx,h={divIdx:-1,offset:void 0},j=i,m=j+1;if(PDFFindController===null?0:PDFFindController.state.highlightAll){j=0;m=c.length}else if(!f)return;for(;j<m;j++){var k=c[j],l=k.begin,k=k.end,n=f&&j===i,o=n?" selected":"";n&&scrollIntoView(g[l.divIdx],
{top:-50});if(!d||l.divIdx!==d.divIdx){d!==null&&b(d,h);a(l)}else b(d,l);if(l.divIdx===k.divIdx)b(l,k,"highlight"+o);else{b(l,h,"highlight begin"+o);for(d=l.divIdx+1;d<k.divIdx;d++)g[d].className="highlight middle"+o;a(k,"highlight end"+o)}d=k}d&&b(d,h)}};this.updateMatches=function(){if(this.renderingDone){for(var c=this.matches,a=this.textDivs,b=this.textContent.bidiTexts,e=-1,g=0;g<c.length;g++){for(var d=c[g],e=Math.max(e,d.begin.divIdx);e<=d.end.divIdx;e++){var f=a[e];f.textContent=b[e].str;
f.className=""}e=d.end.divIdx+1}if(PDFFindController!==null&&PDFFindController.active){this.matches=this.convertMatches(PDFFindController===null?[]:PDFFindController.pageMatches[this.pageIdx]||[]);this.renderMatches(this.matches)}}}};
