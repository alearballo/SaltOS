var FIND_SCROLL_OFFSET_TOP=-50,FIND_SCROLL_OFFSET_LEFT=-400,MAX_TEXT_DIVS_TO_RENDER=1E5,RENDER_DELAY=200,TextLayerBuilder=function(){function m(b){this.textLayerDiv=b.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=b.pageIndex;this.matches=[];this.lastScrollSource=b.lastScrollSource||null;this.viewport=b.viewport;this.isViewerInPresentationMode=b.isViewerInPresentationMode;this.textDivs=[];this.findController=window.PDFFindController||null}m.prototype={renderLayer:function(){var b=
document.createDocumentFragment(),e=this.textDivs,d=e.length,c=document.createElement("canvas").getContext("2d");if(!(d>MAX_TEXT_DIVS_TO_RENDER)){for(var f=0;f<d;f++){var a=e[f];if(void 0===a.dataset.isWhitespace){c.font=a.style.fontSize+" "+a.style.fontFamily;var g=c.measureText(a.textContent).width;0<g&&(b.appendChild(a),g="scale("+a.dataset.canvasWidth/g+", 1)",g="rotate("+a.dataset.angle+"deg) "+g,CustomStyle.setProp("transform",a,g),CustomStyle.setProp("transformOrigin",a,"0% 0%"))}}this.textLayerDiv.appendChild(b);
this.renderingDone=!0;this.updateMatches()}},setupRenderLayoutTimer:function(){var b=this,e=null===this.lastScrollSource?0:this.lastScrollSource.lastScroll;Date.now()-e>RENDER_DELAY?this.renderLayer():(this.renderTimer&&clearTimeout(this.renderTimer),this.renderTimer=setTimeout(function(){b.setupRenderLayoutTimer()},RENDER_DELAY))},appendText:function(b,e){var d=e[b.fontName],c=document.createElement("div");this.textDivs.push(c);if(/\S/.test(b.str)){var f=PDFJS.Util.transform(this.viewport.transform,
b.transform),a=Math.atan2(f[1],f[0]);d.vertical&&(a+=Math.PI/2);var g=Math.sqrt(f[2]*f[2]+f[3]*f[3]),i=d.ascent?d.ascent*g:d.descent?(1+d.descent)*g:g;c.style.position="absolute";c.style.left=f[4]+i*Math.sin(a)+"px";c.style.top=f[5]-i*Math.cos(a)+"px";c.style.fontSize=g+"px";c.style.fontFamily=d.fontFamily;c.textContent=b.str;c.dataset.fontName=b.fontName;c.dataset.angle=a*(180/Math.PI);c.dataset.canvasWidth=d.vertical?b.height*this.viewport.scale:b.width*this.viewport.scale}else c.dataset.isWhitespace=
!0},setTextContent:function(b){this.textContent=b;for(var e=b.items,d=0,c=e.length;d<c;d++)this.appendText(e[d],b.styles);this.divContentDone=!0;this.setupRenderLayoutTimer()},convertMatches:function(b){for(var e=0,d=0,c=this.textContent.items,f=c.length-1,a=null===this.findController?0:this.findController.state.query.length,g=[],i=0,j=b.length;i<j;i++){for(var l=b[i];e!==f&&l>=d+c[e].str.length;)d+=c[e].str.length,e++;e===c.length&&console.error("Could not find a matching mapping");for(var k={begin:{divIdx:e,
offset:l-d}},l=l+a;e!==f&&l>d+c[e].str.length;)d+=c[e].str.length,e++;k.end={divIdx:e,offset:l-d};g.push(k)}return g},renderMatches:function(b){function e(a,c){var b=a.divIdx;f[b].textContent="";d(b,0,a.offset,c)}function d(a,b,d,e){var g=f[a],a=c[a].str.substring(b,d),a=document.createTextNode(a);e?(b=document.createElement("span"),b.className=e,b.appendChild(a),g.appendChild(b)):g.appendChild(a)}if(0!==b.length){var c=this.textContent.items,f=this.textDivs,a=null,g=null===this.findController?!1:
this.pageIdx===this.findController.selected.pageIdx,i=null===this.findController?-1:this.findController.selected.matchIdx,j=i,l=j+1;if(null===this.findController?0:this.findController.state.highlightAll)j=0,l=b.length;else if(!g)return;for(;j<l;j++){var k=b[j],h=k.begin,k=k.end,m=g&&j===i,n=m?" selected":"";m&&!this.isViewerInPresentationMode&&scrollIntoView(f[h.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT});!a||h.divIdx!==a.divIdx?(null!==a&&d(a.divIdx,a.offset,void 0),e(h)):
d(a.divIdx,a.offset,h.offset);if(h.divIdx===k.divIdx)d(h.divIdx,h.offset,k.offset,"highlight"+n);else{d(h.divIdx,h.offset,void 0,"highlight begin"+n);a=h.divIdx+1;for(h=k.divIdx;a<h;a++)f[a].className="highlight middle"+n;e(k,"highlight end"+n)}a=k}a&&d(a.divIdx,a.offset,void 0)}},updateMatches:function(){if(this.renderingDone){for(var b=this.matches,e=this.textDivs,d=this.textContent.items,c=-1,f=0,a=b.length;f<a;f++){for(var g=b[f],c=Math.max(c,g.begin.divIdx),i=g.end.divIdx;c<=i;c++){var j=e[c];
j.textContent=d[c].str;j.className=""}c=g.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}};return m}();
