var FIND_SCROLL_OFFSET_TOP=-50,FIND_SCROLL_OFFSET_LEFT=-400,MAX_TEXT_DIVS_TO_RENDER=1E5,RENDER_DELAY=200,TextLayerBuilder=function(){function m(a){this.textLayerDiv=a.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=a.pageIndex;this.matches=[];this.lastScrollSource=a.lastScrollSource||null;this.viewport=a.viewport;this.isViewerInPresentationMode=a.isViewerInPresentationMode;this.textDivs=[];this.findController=a.findController||null}m.prototype={renderLayer:function(){var a=document.createDocumentFragment(),
e=this.textDivs,d=e.length,c=document.createElement("canvas").getContext("2d");if(!(d>MAX_TEXT_DIVS_TO_RENDER)){for(var g,b,j=0;j<d;j++){var f=e[j];if(void 0===f.dataset.isWhitespace){var h=f.style.fontSize,i=f.style.fontFamily;if(h!==g||i!==b)c.font=h+" "+i,g=h,b=i;i=c.measureText(f.textContent).width;0<i&&(a.appendChild(f),h=f.dataset.angle,i="scale("+f.dataset.canvasWidth/i+", 1)",h&&(i="rotate("+h+"deg) "+i),CustomStyle.setProp("transform",f,i),CustomStyle.setProp("transformOrigin",f,"0% 0%"))}}this.textLayerDiv.appendChild(a);
this.renderingDone=!0;this.updateMatches()}},setupRenderLayoutTimer:function(){var a=this,e=null===this.lastScrollSource?0:this.lastScrollSource.lastScroll;Date.now()-e>RENDER_DELAY?this.renderLayer():(this.renderTimer&&clearTimeout(this.renderTimer),this.renderTimer=setTimeout(function(){a.setupRenderLayoutTimer()},RENDER_DELAY))},appendText:function(a,e){var d=e[a.fontName],c=document.createElement("div");this.textDivs.push(c);if(/\S/.test(a.str)){var g=PDFJS.Util.transform(this.viewport.transform,
a.transform),b=Math.atan2(g[1],g[0]);d.vertical&&(b+=Math.PI/2);var j=Math.sqrt(g[2]*g[2]+g[3]*g[3]),f=j;d.ascent?f*=d.ascent:d.descent&&(f*=1+d.descent);var h;0===b?(h=g[4],g=g[5]-f):(h=g[4]+f*Math.sin(b),g=g[5]-f*Math.cos(b));c.style.position="absolute";c.style.left=h+"px";c.style.top=g+"px";c.style.fontSize=j+"px";c.style.fontFamily=d.fontFamily;c.textContent=a.str;c.dataset.fontName=a.fontName;0!==b&&(c.dataset.angle=b*(180/Math.PI));c.dataset.canvasWidth=d.vertical?a.height*this.viewport.scale:
a.width*this.viewport.scale}else c.dataset.isWhitespace=!0},setTextContent:function(a){this.textContent=a;for(var e=a.items,d=0,c=e.length;d<c;d++)this.appendText(e[d],a.styles);this.divContentDone=!0;this.setupRenderLayoutTimer()},convertMatches:function(a){for(var e=0,d=0,c=this.textContent.items,g=c.length-1,b=null===this.findController?0:this.findController.state.query.length,j=[],f=0,h=a.length;f<h;f++){for(var i=a[f];e!==g&&i>=d+c[e].str.length;)d+=c[e].str.length,e++;e===c.length&&console.error("Could not find a matching mapping");
for(var l={begin:{divIdx:e,offset:i-d}},i=i+b;e!==g&&i>d+c[e].str.length;)d+=c[e].str.length,e++;l.end={divIdx:e,offset:i-d};j.push(l)}return j},renderMatches:function(a){function e(a,c){var b=a.divIdx;g[b].textContent="";d(b,0,a.offset,c)}function d(a,b,d,e){var f=g[a],a=c[a].str.substring(b,d),a=document.createTextNode(a);e?(b=document.createElement("span"),b.className=e,b.appendChild(a),f.appendChild(b)):f.appendChild(a)}if(0!==a.length){var c=this.textContent.items,g=this.textDivs,b=null,j=null===
this.findController?!1:this.pageIdx===this.findController.selected.pageIdx,f=null===this.findController?-1:this.findController.selected.matchIdx,h=f,i=h+1;if(null===this.findController?0:this.findController.state.highlightAll)h=0,i=a.length;else if(!j)return;for(;h<i;h++){var l=a[h],k=l.begin,l=l.end,m=j&&h===f,n=m?" selected":"";m&&!this.isViewerInPresentationMode&&scrollIntoView(g[k.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT});!b||k.divIdx!==b.divIdx?(null!==b&&d(b.divIdx,
b.offset,void 0),e(k)):d(b.divIdx,b.offset,k.offset);if(k.divIdx===l.divIdx)d(k.divIdx,k.offset,l.offset,"highlight"+n);else{d(k.divIdx,k.offset,void 0,"highlight begin"+n);b=k.divIdx+1;for(k=l.divIdx;b<k;b++)g[b].className="highlight middle"+n;e(l,"highlight end"+n)}b=l}b&&d(b.divIdx,b.offset,void 0)}},updateMatches:function(){if(this.renderingDone){for(var a=this.matches,e=this.textDivs,d=this.textContent.items,c=-1,g=0,b=a.length;g<b;g++){for(var j=a[g],c=Math.max(c,j.begin.divIdx),f=j.end.divIdx;c<=
f;c++){var h=e[c];h.textContent=d[c].str;h.className=""}c=j.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}};return m}();
