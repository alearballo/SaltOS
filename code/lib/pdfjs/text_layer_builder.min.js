var FIND_SCROLL_OFFSET_TOP=-50,FIND_SCROLL_OFFSET_LEFT=-400,MAX_TEXT_DIVS_TO_RENDER=1E5,RENDER_DELAY=200,NonWhitespaceRegexp=/\S/;function isAllWhitespace(m){return!NonWhitespaceRegexp.test(m)}
var TextLayerBuilder=function(){function m(a){this.textLayerDiv=a.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=a.pageIndex;this.matches=[];this.lastScrollSource=a.lastScrollSource||null;this.viewport=a.viewport;this.isViewerInPresentationMode=a.isViewerInPresentationMode;this.textDivs=[];this.findController=a.findController||null}m.prototype={renderLayer:function(){var a=document.createDocumentFragment(),f=this.textDivs,d=f.length,c=document.createElement("canvas").getContext("2d");
if(!(d>MAX_TEXT_DIVS_TO_RENDER)){for(var g,b,i=0;i<d;i++){var h=f[i];if(void 0===h.dataset.isWhitespace){var e=h.style.fontSize,j=h.style.fontFamily;if(e!==g||j!==b)c.font=e+" "+j,g=e,b=j;e=c.measureText(h.textContent).width;0<e&&(a.appendChild(h),e=void 0!==h.dataset.canvasWidth?"scaleX("+h.dataset.canvasWidth/e+")":"",(j=h.dataset.angle)&&(e="rotate("+j+"deg) "+e),e&&CustomStyle.setProp("transform",h,e))}}this.textLayerDiv.appendChild(a);this.renderingDone=!0;this.updateMatches()}},setupRenderLayoutTimer:function(){var a=
this,f=null===this.lastScrollSource?0:this.lastScrollSource.lastScroll;Date.now()-f>RENDER_DELAY?this.renderLayer():(this.renderTimer&&clearTimeout(this.renderTimer),this.renderTimer=setTimeout(function(){a.setupRenderLayoutTimer()},RENDER_DELAY))},appendText:function(a,f){var d=f[a.fontName],c=document.createElement("div");this.textDivs.push(c);if(isAllWhitespace(a.str))c.dataset.isWhitespace=!0;else{var g=PDFJS.Util.transform(this.viewport.transform,a.transform),b=Math.atan2(g[1],g[0]);d.vertical&&
(b+=Math.PI/2);var i=Math.sqrt(g[2]*g[2]+g[3]*g[3]),h=i;d.ascent?h*=d.ascent:d.descent&&(h*=1+d.descent);var e;0===b?(e=g[4],g=g[5]-h):(e=g[4]+h*Math.sin(b),g=g[5]-h*Math.cos(b));c.style.left=e+"px";c.style.top=g+"px";c.style.fontSize=i+"px";c.style.fontFamily=d.fontFamily;c.textContent=a.str;PDFJS.pdfBug&&(c.dataset.fontName=a.fontName);0!==b&&(c.dataset.angle=b*(180/Math.PI));1<c.textContent.length&&(c.dataset.canvasWidth=d.vertical?a.height*this.viewport.scale:a.width*this.viewport.scale)}},setTextContent:function(a){this.textContent=
a;for(var f=a.items,d=0,c=f.length;d<c;d++)this.appendText(f[d],a.styles);this.divContentDone=!0;this.setupRenderLayoutTimer()},convertMatches:function(a){for(var f=0,d=0,c=this.textContent.items,g=c.length-1,b=null===this.findController?0:this.findController.state.query.length,i=[],h=0,e=a.length;h<e;h++){for(var j=a[h];f!==g&&j>=d+c[f].str.length;)d+=c[f].str.length,f++;f===c.length&&console.error("Could not find a matching mapping");for(var l={begin:{divIdx:f,offset:j-d}},j=j+b;f!==g&&j>d+c[f].str.length;)d+=
c[f].str.length,f++;l.end={divIdx:f,offset:j-d};i.push(l)}return i},renderMatches:function(a){function f(a,c){var b=a.divIdx;g[b].textContent="";d(b,0,a.offset,c)}function d(a,b,d,e){var f=g[a],a=c[a].str.substring(b,d),a=document.createTextNode(a);e?(b=document.createElement("span"),b.className=e,b.appendChild(a),f.appendChild(b)):f.appendChild(a)}if(0!==a.length){var c=this.textContent.items,g=this.textDivs,b=null,i=null===this.findController?!1:this.pageIdx===this.findController.selected.pageIdx,
h=null===this.findController?-1:this.findController.selected.matchIdx,e=h,j=e+1;if(null===this.findController?0:this.findController.state.highlightAll)e=0,j=a.length;else if(!i)return;for(;e<j;e++){var l=a[e],k=l.begin,l=l.end,m=i&&e===h,n=m?" selected":"";m&&!this.isViewerInPresentationMode&&scrollIntoView(g[k.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT});!b||k.divIdx!==b.divIdx?(null!==b&&d(b.divIdx,b.offset,void 0),f(k)):d(b.divIdx,b.offset,k.offset);if(k.divIdx===l.divIdx)d(k.divIdx,
k.offset,l.offset,"highlight"+n);else{d(k.divIdx,k.offset,void 0,"highlight begin"+n);b=k.divIdx+1;for(k=l.divIdx;b<k;b++)g[b].className="highlight middle"+n;f(l,"highlight end"+n)}b=l}b&&d(b.divIdx,b.offset,void 0)}},updateMatches:function(){if(this.renderingDone){for(var a=this.matches,f=this.textDivs,d=this.textContent.items,c=-1,g=0,b=a.length;g<b;g++){for(var i=a[g],c=Math.max(c,i.begin.divIdx),h=i.end.divIdx;c<=h;c++){var e=f[c];e.textContent=d[c].str;e.className=""}c=i.end.divIdx+1}null!==
this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}};return m}();
