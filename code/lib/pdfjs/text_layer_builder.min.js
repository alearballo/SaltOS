var FIND_SCROLL_OFFSET_TOP=-50,FIND_SCROLL_OFFSET_LEFT=-400,TextLayerBuilder=function(j){var o=document.createDocumentFragment();this.textLayerDiv=j.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=j.pageIndex;this.matches=[];this.lastScrollSource=j.lastScrollSource;this.viewport=j.viewport;this.isViewerInPresentationMode=j.isViewerInPresentationMode;this.textDivs=[];"undefined"===typeof PDFFindController&&(window.PDFFindController=null);"undefined"===typeof this.lastScrollSource&&
(this.lastScrollSource=null);this.renderLayer=function(){var b=this.textDivs,e=document.createElement("canvas").getContext("2d");if(!(b.length>1E5)){for(var a=0,c=b.length;a<c;a++){var d=b[a];if(!("isWhitespace"in d.dataset)){e.font=d.style.fontSize+" "+d.style.fontFamily;var g=e.measureText(d.textContent).width;if(g>0){o.appendChild(d);g="scale("+d.dataset.canvasWidth/g+", 1)";g="rotate("+d.dataset.angle+"deg) "+g;CustomStyle.setProp("transform",d,g);CustomStyle.setProp("transformOrigin",d,"0% 0%")}}}this.textLayerDiv.appendChild(o);
this.renderingDone=true;this.updateMatches()}};this.setupRenderLayoutTimer=function(){var b=this,e=this.lastScrollSource===null?0:this.lastScrollSource.lastScroll;if(Date.now()-e>200)this.renderLayer();else{this.renderTimer&&clearTimeout(this.renderTimer);this.renderTimer=setTimeout(function(){b.setupRenderLayoutTimer()},200)}};this.appendText=function(b,e){var a=e[b.fontName],c=document.createElement("div");this.textDivs.push(c);if(/\S/.test(b.str)){var d=PDFJS.Util.transform(this.viewport.transform,
b.transform),g=Math.atan2(d[1],d[0]);a.vertical&&(g=g+Math.PI/2);var f=Math.sqrt(d[2]*d[2]+d[3]*d[3]),h=a.ascent?a.ascent*f:a.descent?(1+a.descent)*f:f;c.style.position="absolute";c.style.left=d[4]+h*Math.sin(g)+"px";c.style.top=d[5]-h*Math.cos(g)+"px";c.style.fontSize=f+"px";c.style.fontFamily=a.fontFamily;c.textContent=b.str;c.dataset.fontName=b.fontName;c.dataset.angle=g*(180/Math.PI);c.dataset.canvasWidth=a.vertical?b.height*this.viewport.scale:b.width*this.viewport.scale}else c.dataset.isWhitespace=
true};this.setTextContent=function(b){this.textContent=b;for(var e=b.items,a=0;a<e.length;a++)this.appendText(e[a],b.styles);this.divContentDone=true;this.setupRenderLayoutTimer()};this.convertMatches=function(b){for(var e=0,a=0,c=this.textContent.items,d=c.length-1,g=PDFFindController===null?0:PDFFindController.state.query.length,f=[],h=0;h<b.length;h++){for(var i=b[h];e!==d&&i>=a+c[e].str.length;){a=a+c[e].str.length;e++}e==c.length&&console.error("Could not find matching mapping");for(var m={begin:{divIdx:e,
offset:i-a}},i=i+g;e!==d&&i>a+c[e].str.length;){a=a+c[e].str.length;e++}m.end={divIdx:e,offset:i-a};f.push(m)}return f};this.renderMatches=function(b){function e(a,b){var d=a.divIdx;g[d].textContent="";c(d,0,a.offset,b)}function a(a,d,b){c(a.divIdx,a.offset,d.offset,b)}function c(a,b,c,e){var f=g[a],a=d[a].str.substring(b,c),a=document.createTextNode(a);if(e){b=document.createElement("span");b.className=e;b.appendChild(a);f.appendChild(b)}else f.appendChild(a)}if(b.length!==0){var d=this.textContent.items,
g=this.textDivs,f=null,h=PDFFindController===null?false:this.pageIdx===PDFFindController.selected.pageIdx,i=PDFFindController===null?-1:PDFFindController.selected.matchIdx,m={divIdx:-1,offset:void 0},n=i,j=n+1;if(PDFFindController===null?0:PDFFindController.state.highlightAll){n=0;j=b.length}else if(!h)return;for(;n<j;n++){var k=b[n],l=k.begin,k=k.end,o=h&&n===i,p=o?" selected":"";o&&!this.isViewerInPresentationMode&&scrollIntoView(g[l.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT});
if(!f||l.divIdx!==f.divIdx){f!==null&&a(f,m);e(l)}else a(f,l);if(l.divIdx===k.divIdx)a(l,k,"highlight"+p);else{a(l,m,"highlight begin"+p);for(f=l.divIdx+1;f<k.divIdx;f++)g[f].className="highlight middle"+p;e(k,"highlight end"+p)}f=k}f&&a(f,m)}};this.updateMatches=function(){if(this.renderingDone){for(var b=this.matches,e=this.textDivs,a=this.textContent.items,c=-1,d=0;d<b.length;d++){for(var g=b[d],c=Math.max(c,g.begin.divIdx);c<=g.end.divIdx;c++){var f=e[c];f.textContent=a[c].str;f.className=""}c=
g.end.divIdx+1}if(PDFFindController!==null&&PDFFindController.active){this.matches=this.convertMatches(PDFFindController===null?[]:PDFFindController.pageMatches[this.pageIdx]||[]);this.renderMatches(this.matches)}}}};
