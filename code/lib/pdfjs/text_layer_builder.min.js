var FIND_SCROLL_OFFSET_TOP=-50,FIND_SCROLL_OFFSET_LEFT=-400,MAX_TEXT_DIVS_TO_RENDER=1E5,RENDER_DELAY=200,NonWhitespaceRegexp=/\S/;function isAllWhitespace(m){return!NonWhitespaceRegexp.test(m)}
var TextLayerBuilder=function(){function m(a){this.textLayerDiv=a.textLayerDiv;this.divContentDone=this.layoutDone=!1;this.pageIdx=a.pageIndex;this.matches=[];this.lastScrollSource=a.lastScrollSource||null;this.viewport=a.viewport;this.isViewerInPresentationMode=a.isViewerInPresentationMode;this.textDivs=[];this.findController=a.findController||null}m.prototype={renderLayer:function(){var a=document.createDocumentFragment(),e=this.textDivs,c=e.length,d=document.createElement("canvas").getContext("2d");
if(!(c>MAX_TEXT_DIVS_TO_RENDER)){for(var g,b,j=0;j<c;j++){var f=e[j];if(void 0===f.dataset.isWhitespace){var h=f.style.fontSize,i=f.style.fontFamily;if(h!==g||i!==b)d.font=h+" "+i,g=h,b=i;i=d.measureText(f.textContent).width;0<i&&(a.appendChild(f),h=f.dataset.angle,i="scale("+f.dataset.canvasWidth/i+", 1)",h&&(i="rotate("+h+"deg) "+i),CustomStyle.setProp("transform",f,i),CustomStyle.setProp("transformOrigin",f,"0% 0%"))}}this.textLayerDiv.appendChild(a);this.renderingDone=!0;this.updateMatches()}},
setupRenderLayoutTimer:function(){var a=this,e=null===this.lastScrollSource?0:this.lastScrollSource.lastScroll;Date.now()-e>RENDER_DELAY?this.renderLayer():(this.renderTimer&&clearTimeout(this.renderTimer),this.renderTimer=setTimeout(function(){a.setupRenderLayoutTimer()},RENDER_DELAY))},appendText:function(a,e){var c=e[a.fontName],d=document.createElement("div");this.textDivs.push(d);if(isAllWhitespace(a.str))d.dataset.isWhitespace=!0;else{var g=PDFJS.Util.transform(this.viewport.transform,a.transform),
b=Math.atan2(g[1],g[0]);c.vertical&&(b+=Math.PI/2);var j=Math.sqrt(g[2]*g[2]+g[3]*g[3]),f=j;c.ascent?f*=c.ascent:c.descent&&(f*=1+c.descent);var h;0===b?(h=g[4],g=g[5]-f):(h=g[4]+f*Math.sin(b),g=g[5]-f*Math.cos(b));d.style.left=h+"px";d.style.top=g+"px";d.style.fontSize=j+"px";d.style.fontFamily=c.fontFamily;d.textContent=a.str;d.dataset.fontName=a.fontName;0!==b&&(d.dataset.angle=b*(180/Math.PI));d.dataset.canvasWidth=c.vertical?a.height*this.viewport.scale:a.width*this.viewport.scale}},setTextContent:function(a){this.textContent=
a;for(var e=a.items,c=0,d=e.length;c<d;c++)this.appendText(e[c],a.styles);this.divContentDone=!0;this.setupRenderLayoutTimer()},convertMatches:function(a){for(var e=0,c=0,d=this.textContent.items,g=d.length-1,b=null===this.findController?0:this.findController.state.query.length,j=[],f=0,h=a.length;f<h;f++){for(var i=a[f];e!==g&&i>=c+d[e].str.length;)c+=d[e].str.length,e++;e===d.length&&console.error("Could not find a matching mapping");for(var l={begin:{divIdx:e,offset:i-c}},i=i+b;e!==g&&i>c+d[e].str.length;)c+=
d[e].str.length,e++;l.end={divIdx:e,offset:i-c};j.push(l)}return j},renderMatches:function(a){function e(a,d){var b=a.divIdx;g[b].textContent="";c(b,0,a.offset,d)}function c(a,b,c,e){var f=g[a],a=d[a].str.substring(b,c),a=document.createTextNode(a);e?(b=document.createElement("span"),b.className=e,b.appendChild(a),f.appendChild(b)):f.appendChild(a)}if(0!==a.length){var d=this.textContent.items,g=this.textDivs,b=null,j=null===this.findController?!1:this.pageIdx===this.findController.selected.pageIdx,
f=null===this.findController?-1:this.findController.selected.matchIdx,h=f,i=h+1;if(null===this.findController?0:this.findController.state.highlightAll)h=0,i=a.length;else if(!j)return;for(;h<i;h++){var l=a[h],k=l.begin,l=l.end,m=j&&h===f,n=m?" selected":"";m&&!this.isViewerInPresentationMode&&scrollIntoView(g[k.divIdx],{top:FIND_SCROLL_OFFSET_TOP,left:FIND_SCROLL_OFFSET_LEFT});!b||k.divIdx!==b.divIdx?(null!==b&&c(b.divIdx,b.offset,void 0),e(k)):c(b.divIdx,b.offset,k.offset);if(k.divIdx===l.divIdx)c(k.divIdx,
k.offset,l.offset,"highlight"+n);else{c(k.divIdx,k.offset,void 0,"highlight begin"+n);b=k.divIdx+1;for(k=l.divIdx;b<k;b++)g[b].className="highlight middle"+n;e(l,"highlight end"+n)}b=l}b&&c(b.divIdx,b.offset,void 0)}},updateMatches:function(){if(this.renderingDone){for(var a=this.matches,e=this.textDivs,c=this.textContent.items,d=-1,g=0,b=a.length;g<b;g++){for(var j=a[g],d=Math.max(d,j.begin.divIdx),f=j.end.divIdx;d<=f;d++){var h=e[d];h.textContent=c[d].str;h.className=""}d=j.end.divIdx+1}null!==
this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}};return m}();
