(function(b){function f(a){b("link[rel$=icon]").replaceWith("");b('<link rel="shortcut icon" type="image/x-icon"/>').appendTo("head").attr("href",a)}var d;b.favicon=function(a,c,e){2==arguments.length&&(e=c);if(e)if(d=d||b("<canvas />")[0],d.getContext){var j=b("<img />")[0];j.onload=function(){b.favicon.unanimate();d.height=d.width=this.width;var a=d.getContext("2d");a.drawImage(this,0,0);e(a);f(d.toDataURL("image/png"))};j.src=a}else f(c||a);else b.favicon.unanimate(),f(a);return this};var a={timer:null,
frames:[],size:16,count:1};b.extend(b.favicon,{animate:function(g,c,e){e=e||{};d=d||b("<canvas />")[0];d.getContext?(c=b("<img />")[0],c.onload=function(){b.favicon.unanimate();a.onStop=e.onStop;a.image=this;d.height=d.width=a.size=this.height;a.count=this.width/this.height;for(var c=[],h=0;h<a.count;++h)c.push(h);a.frames=e.frames||c;var i=d.getContext("2d");e.onStart&&e.onStart();a.timer=setInterval(function(){var b=a.frames.shift();a.frames.push(b);if(b>=a.count)throw clearInterval(a.timer),a.timer=
null,Error("jQuery.favicon.animate: frame #"+b+' do not exists in "'+g+'"');var c=a.size;i.clearRect(0,0,c,c);i.drawImage(a.image,c*b,0,c,c,0,0,c,c);e.onDraw&&e.onDraw(i,b);f(d.toDataURL("image/png"))},e.interval||1E3)},c.src=g):f(c||g)},unanimate:function(){a.timer&&(clearInterval(a.timer),a.timer=null,a.onStop&&a.onStop())}})})(jQuery);
