(function(){function N(d){w.push(d);50<w.length&&w.shift()}function z(d){return w[w.length-(d?Math.min(d,1):1)]||""}function p(){1<w.length&&w.pop();return z()}function L(d,f,g,h,k){null==k&&(k=d.getRange(f,g));h&&H&&H.cm==d&&f.line==H.pos.line&&f.ch==H.pos.ch&&d.isClean(H.gen)?w.length?w[w.length-1]+=k:N(k):N(k);d.replaceRange("",f,g,"+delete");H=h?{cm:d,pos:f,gen:d.changeGeneration()}:null}function v(d,f,g){return d.findPosH(f,g,"char",!0)}function C(d,f,g){return d.findPosH(f,g,"word",!0)}function u(d,
f,g){return d.findPosV(f,g,"line",d.doc.sel.goalColumn)}function t(d,f,g){return d.findPosV(f,g,"page",d.doc.sel.goalColumn)}function J(d,f,g){for(var h=f.line,k=d.getLine(h),f=/\S/.test(0>g?k.slice(0,f.ch):k.slice(f.ch)),m=d.firstLine(),p=d.lastLine();;){h+=g;if(h<m||h>p)return d.clipPos(A(h-g,0>g?0:null));k=d.getLine(h);if(/\S/.test(k))f=!0;else if(f)return A(h,0)}}function x(d,f,g){for(var h=f.line,k=f.ch,f=d.getLine(f.line),m=!1;;){var p=f.charAt(k+(0>g?-1:0));if(p){if(m&&/[!?.]/.test(p))return A(h,
k+(0<g?1:0));m||(m=/\w/.test(p));k+=g}else{if(h==(0>g?d.firstLine():d.lastLine()))return A(h,k);f=d.getLine(h+g);if(!/\S/.test(f))return A(h,k);h+=g;k=0>g?f.length:0}}}function B(d,f,g){var h;if(d.findMatchingBracket&&(h=d.findMatchingBracket(f,!0))&&h.match&&(h.forward?1:-1)==g)return 0<g?A(h.to.line,h.to.ch+1):h.to;for(var k=!0;;k=!1){var m=d.getTokenAt(f);h=A(f.line,0>g?m.start:m.end);if(k&&0<g&&m.end==f.ch||!/\w/.test(m.string)){k=d.findPosH(h,g,"char");if(h.line==k.line&&h.ch==k.ch)return f;
f=k}else return h}}function O(d,f){var g=d.state.emacsPrefix;if(!g)return f?null:1;r(d);return"-"==g?-1:Number(g)}function s(d){var f="string"==typeof d?function(f){f.execCommand(d)}:d;return function(d){var h=O(d);f(d);for(var k=1;k<h;++k)f(d)}}function P(d,f,g){var h=d.getCursor(),k=O(d);0>k&&(g=-g,k=-k);for(var m=0;m<k;++m){var p=f(d,h,g);if(p.line==h.line&&p.ch==h.ch)break;h=p}return h}function m(d,f){var g=function(g){g.extendSelection(P(g,d,f))};g.motion=!0;return g}function K(d,f,g){L(d,d.getCursor(),
P(d,f,g),!0)}function X(d,f){d.state.emacsPrefix?"-"!=f&&(d.state.emacsPrefix+=f):(d.state.emacsPrefix=f,d.on("keyHandled",E),d.on("inputRead",Y))}function E(d,f){!d.state.emacsPrefixMap&&!Q.hasOwnProperty(f)&&r(d)}function r(d){d.state.emacsPrefix=null;d.off("keyHandled",E);d.off("inputRead",Y)}function Y(d,f){var g=O(d);if(1<g&&"+input"==f.origin){for(var h=f.text.join("\n"),k="",m=1;m<g;++m)k+=h;d.replaceSelection(k,"end","+input")}}function y(d,f){"string"==typeof f&&(/^\d$/.test(f)||"Ctrl-U"==
f)||(d.removeKeyMap(S),d.state.emacsPrefixMap=!1,d.off("keyHandled",y),d.off("inputRead",y))}function T(d){d.setCursor(d.getCursor());d.setExtending(!0);d.on("change",function(){d.setExtending(!1)})}function M(d,f,g){d.openDialog?d.openDialog(f+': <input type="text" style="width: 10em"/>',g,{bottom:!0}):g(prompt(f,""))}function F(d,f){var g=d.getCursor(),h=d.findPosH(g,1,"word");d.replaceRange(f(d.getRange(g,h)),g,h);d.setCursor(h)}function R(d){S[d]=function(f){X(f,d)};Z["Ctrl-"+d]=function(f){X(f,
d)};Q["Ctrl-"+d]=!0}var A=CodeMirror.Pos,w=[],H=null,Q={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0},Z=CodeMirror.keyMap.emacs={"Ctrl-W":function(d){L(d,d.getCursor("start"),d.getCursor("end"))},"Ctrl-K":s(function(d){var f=d.getCursor(),g=d.clipPos(A(f.line)),h=d.getRange(f,g);/\S/.test(h)||(h+="\n",g=A(f.line+1,0));L(d,f,g,!0,h)}),"Alt-W":function(d){N(d.getSelection());d.setExtending(!1);d.setCursor(d.getCursor())},"Ctrl-Y":function(d){var f=d.getCursor();d.replaceRange(z(O(d)),f,f,"paste");
d.setSelection(f,d.getCursor())},"Alt-Y":function(d){d.replaceSelection(p())},"Ctrl-Space":T,"Ctrl-Shift-2":T,"Ctrl-F":m(v,1),"Ctrl-B":m(v,-1),Right:m(v,1),Left:m(v,-1),"Ctrl-D":function(d){K(d,v,1)},Delete:function(d){K(d,v,1)},"Ctrl-H":function(d){K(d,v,-1)},Backspace:function(d){K(d,v,-1)},"Alt-F":m(C,1),"Alt-B":m(C,-1),"Alt-D":function(d){K(d,C,1)},"Alt-Backspace":function(d){K(d,C,-1)},"Ctrl-N":m(u,1),"Ctrl-P":m(u,-1),Down:m(u,1),Up:m(u,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",
Home:"goLineStart","Alt-V":m(t,-1),"Ctrl-V":m(t,1),PageUp:m(t,-1),PageDown:m(t,1),"Ctrl-Up":m(J,-1),"Ctrl-Down":m(J,1),"Alt-A":m(x,-1),"Alt-E":m(x,1),"Alt-K":function(d){K(d,x,1)},"Ctrl-Alt-K":function(d){K(d,B,1)},"Ctrl-Alt-Backspace":function(d){K(d,B,-1)},"Ctrl-Alt-F":m(B,1),"Ctrl-Alt-B":m(B,-1),"Shift-Ctrl-Alt-2":function(d){d.setSelection(P(d,B,1),d.getCursor())},"Ctrl-Alt-T":function(d){var f=B(d,d.getCursor(),-1),g=B(d,f,1),h=B(d,g,1),k=B(d,h,-1);d.replaceRange(d.getRange(k,h)+d.getRange(g,
k)+d.getRange(f,g),f,h)},"Ctrl-Alt-U":s(function(d){for(var f=d.getCursor(),g=f.line,f=f.ch,h=[];g>=d.firstLine();){for(var k=d.getLine(g),m=null==f?k.length:f;0<m;)if(f=k.charAt(--m),")"==f)h.push("(");else if("]"==f)h.push("[");else if("}"==f)h.push("{");else if(/[\(\{\[]/.test(f)&&(!h.length||h.pop()!=f))return d.extendSelection(A(g,m));--g;f=null}}),"Alt-Space":function(d){for(var f=d.getCursor(),g=f.ch,h=f.ch,k=d.getLine(f.line);g&&/\s/.test(k.charAt(g-1));)--g;for(;h<k.length&&/\s/.test(k.charAt(h));)++h;
d.replaceRange(" ",A(f.line,g),A(f.line,h))},"Ctrl-O":s(function(d){d.replaceSelection("\n","start")}),"Ctrl-T":s(function(d){var f=d.getCursor();f.ch<d.getLine(f.line).length&&(f=A(f.line,f.ch+1));var g=d.findPosH(f,-2,"char"),h=d.getRange(g,f);2==h.length&&(d.setSelection(g,f),d.replaceSelection(h.charAt(1)+h.charAt(0),"end"))}),"Alt-C":s(function(d){F(d,function(d){var g=d.search(/\w/);return-1==g?d:d.slice(0,g)+d.charAt(g).toUpperCase()+d.slice(g+1).toLowerCase()})}),"Alt-U":s(function(d){F(d,
function(d){return d.toUpperCase()})}),"Alt-L":s(function(d){F(d,function(d){return d.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":s("undo"),"Shift-Ctrl--":s("undo"),"Ctrl-Z":s("undo"),"Cmd-Z":s("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":function(d){d.execCommand("clearSearch");d.setExtending(!1);d.setCursor(d.getCursor())},"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G":function(d){d.setOption("keyMap",
"emacs-Alt-G")},"Ctrl-X":function(d){d.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(d){d.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":function(d){d.state.emacsPrefixMap=!0;d.addKeyMap(S);d.on("keyHandled",y);d.on("inputRead",y)}};CodeMirror.keyMap["emacs-Ctrl-X"]={Tab:function(d){d.indentSelection(O(d,!0)||d.getOption("indentUnit"))},"Ctrl-X":function(d){d.setSelection(d.getCursor("head"),d.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:s("undo"),K:"close",Delete:function(d){L(d,
d.getCursor(),x(d,d.getCursor(),1),!0)},auto:"emacs",nofallthrough:!0,disableInput:!0};CodeMirror.keyMap["emacs-Alt-G"]={G:function(d){var f=O(d,!0);if(null!=f&&0<f)return d.setCursor(f-1);M(d,"Goto line",function(f){var h;f&&(!isNaN(h=Number(f))&&h==h|0&&0<h)&&d.setCursor(h-1)})},auto:"emacs",nofallthrough:!0,disableInput:!0};CodeMirror.keyMap["emacs-Ctrl-Q"]={Tab:s("insertTab"),auto:"emacs",nofallthrough:!0};for(var S={"Ctrl-G":r},G=0;10>G;++G)R(""+G);R("-")})();
(function(){function N(p,L){var v=p.getCursor("head"),C=p.getCursor("anchor");p.operation(function(){var u;var t=Math.min(v.line,C.line),J=Math.max(v.line,C.line);if(!L||t>J)u=0;else{u=p.clipPos(z(t,0));var x=p.clipPos(z(J)),J=p.getRange(u,x);t<=p.firstLine()?p.replaceRange("",u,z(x.line+1,0)):p.replaceRange("",z(u.line-1),x);t=u.line+L;t<=p.firstLine()?(p.replaceRange(J+"\n",z(t,0)),u=p.firstLine()-u.line):(t=p.clipPos(z(t-1)),p.replaceRange("\n"+J,t),u=t.line+1-u.line)}p.setSelection(z(C.line+u,
C.ch),z(v.line+u,v.ch))})}var z=CodeMirror.Pos;CodeMirror.commands.moveLinesUp=function(p){N(p,-1)};CodeMirror.commands.moveLinesDown=function(p){N(p,1)};CodeMirror.keyMap["default"]["Alt-Up"]="moveLinesUp";CodeMirror.keyMap["default"]["Alt-Down"]="moveLinesDown"})();
(function(){var N=[{keys:["<Left>"],type:"keyToKey",toKeys:["h"]},{keys:["<Right>"],type:"keyToKey",toKeys:["l"]},{keys:["<Up>"],type:"keyToKey",toKeys:["k"]},{keys:["<Down>"],type:"keyToKey",toKeys:["j"]},{keys:["<Space>"],type:"keyToKey",toKeys:["l"]},{keys:["<BS>"],type:"keyToKey",toKeys:["h"]},{keys:["<C-Space>"],type:"keyToKey",toKeys:["W"]},{keys:["<C-BS>"],type:"keyToKey",toKeys:["B"]},{keys:["<S-Space>"],type:"keyToKey",toKeys:["w"]},{keys:["<S-BS>"],type:"keyToKey",toKeys:["b"]},{keys:["<C-n>"],
type:"keyToKey",toKeys:["j"]},{keys:["<C-p>"],type:"keyToKey",toKeys:["k"]},{keys:["<C-[>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["<C-c>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"],context:"normal"},{keys:["s"],type:"keyToKey",toKeys:["x","i"],context:"visual"},{keys:["S"],type:"keyToKey",toKeys:["c","c"],context:"normal"},{keys:["S"],type:"keyToKey",toKeys:["d","c","c"],context:"visual"},{keys:["<Home>"],type:"keyToKey",toKeys:["0"]},{keys:["<End>"],type:"keyToKey",
toKeys:["$"]},{keys:["<PageUp>"],type:"keyToKey",toKeys:["<C-b>"]},{keys:["<PageDown>"],type:"keyToKey",toKeys:["<C-f>"]},{keys:["<CR>"],type:"keyToKey",toKeys:["j","^"],context:"normal"},{keys:["H"],type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["M"],type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["L"],type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["h"],type:"motion",motion:"moveByCharacters",
motionArgs:{forward:!1}},{keys:["l"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:["j"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:["g","j"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:["g","k"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,
wordEnd:!1}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:["e"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:["g","e"],
type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:["g","E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["{"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:["}"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:["<C-f>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:["<C-b>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},
{keys:["<C-d>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:["<C-u>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},
{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["+"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:["-"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:["_"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},
{keys:["f","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["F","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:[";"],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:[","],type:"motion",motion:"repeatLastCharacterSearch",
motionArgs:{forward:!1}},{keys:["'","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:["`","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:["]","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:["[","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:["]","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:["[","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,
linewise:!0}},{keys:["]","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:["[","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["d"],type:"operator",operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change"},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:["<"],
type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:["N"],type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:["x"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},
operatorMotionArgs:{visualLine:!0}},{keys:["D"],type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["C"],type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["~"],type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:!0},
motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:["<C-i>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:["<C-o>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:["<C-e>"],type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:["<C-y>"],type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:["a"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",
isEdit:!0,actionArgs:{insertAt:"eol"}},{keys:["i"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"}},{keys:["I"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"}},{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1}},{keys:["v"],type:"action",action:"toggleVisualMode"},
{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:["J"],type:"action",action:"joinLines",isEdit:!0},{keys:["p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:["P"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:["r","character"],type:"action",action:"replace",isEdit:!0},{keys:["@","character"],type:"action",action:"replayMacro"},{keys:["q","character"],type:"action",action:"enterMacroRecordMode"},{keys:["R"],
type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:["u"],type:"action",action:"undo"},{keys:["<C-r>"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},{keys:['"',"character"],type:"action",action:"setRegister"},{keys:["z","z"],type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:["z","."],type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z",
"t"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:["z","<CR>"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","-"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:["z","b"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["."],type:"action",action:"repeatLastEdit"},{keys:["<C-a>"],type:"action",action:"incrementNumberToken",
isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:["<C-x>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:["a","character"],type:"motion",motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:["/"],type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:["?"],type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:["*"],
type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:["#"],type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:[":"],type:"ex"}],z=function(){function p(a,b){var c=a.state.vim;!c.insertMode&&!c.exMode&&(c=b.head,c.ch&&c.ch==a.doc.getLine(c.line).length&&c.ch--)}function L(a){var b=a.state.vim;b.onPasteFn||(b.onPasteFn=function(){b.insertMode||(a.setCursor(m(a.getCursor(),0,1)),$.enterInsertMode(a,{},b))});return b.onPasteFn}function v(a,
b){for(var c=[],e=a;e<a+b;e++)c.push(String.fromCharCode(e));return c}function C(a){return/^[A-Z]$/.test(a)}function u(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function t(a){a.state.vim||(a.state.vim={inputState:new x,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1});return a.state.vim}function J(){q={searchQuery:null,searchIsReversed:!1,jumpList:wa(),macroModeState:xa(),
lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new O({})}}function x(){this.prefixRepeat=[];this.motionRepeat=[];this.motionArgs=this.motion=this.operatorArgs=this.operator=null;this.keyBuffer=[];this.registerName=null}function B(a,b){this.clear();a&&this.set(a,b)}function O(a){this.registers=a;this.unamedRegister=a['"']=new B}function s(a,b,c){var e=Math.min(Math.max(a.firstLine(),b.line),a.lastLine()),a=y(a,e)-1,b=Math.min(Math.max(0,b.ch),c?a+1:a);return{line:e,
ch:b}}function P(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function m(a,b,c){return{line:a.line+b,ch:a.ch+c}}function K(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c]&&"character"!=b[c])return!1;return!0}function X(a,b,c){return function(){for(var e=0;e<c;e++)b(a)}}function E(a,b){return a.ch==b.ch&&a.line==b.line}function r(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch?!0:!1}function Y(a,b,c){a=r(a,b);b=r(b,c);return a&&b}function y(a,b){return a.getLine(b).length}
function T(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function M(a){a.off("mousedown",M);var b=a.state.vim;b.visualMode=!1;b.visualLine=!1;var b=a.getCursor("anchor"),c=a.getCursor("head");E(b,c)||a.setCursor(s(a,c));CodeMirror.signal(a,"vim-mode-change",{mode:"normal"})}function F(a){if(!a)return 0;var b=a.search(/\S/);return-1==b?a.length:b}function R(a,b,c,e,j){var c=a.getCursor(),a=a.getLine(c.line),d=c.ch,i=a.substring(d),j=j?i.search(/\w/):i.search(/\S/);if(-1==j)return null;var d=
d+j,i=a.substring(d),j=a.substring(0,d),o;o=e?/^\S+/:/\w/.test(a.charAt(d))?/^\w+/:/^[^\w\s]+/;i=o.exec(i);e=d;d+=i[0].length;j=j.split("").reverse().join("");(o=o.exec(j))&&(e-=o[0].length);b&&(b=a.substring(d).match(/^\s*/)[0].length,0<b?d+=b:(b=j.substring(j.length-e).match(/^\s*/)[0].length,e-=b));return{start:{line:c.line,ch:e},end:{line:c.line,ch:d}}}function A(a,b){q.lastChararacterSearch.increment=a;q.lastChararacterSearch.forward=b.forward;q.lastChararacterSearch.selectedCharacter=b.selectedCharacter}
function w(a,b,c,e){for(var j=a.getCursor(),d=j.ch,i,o=0;o<b;o++){i=a.getLine(j.line);var l=e,f=void 0;i=f=c?i.indexOf(l,d+1):i.lastIndexOf(l,d-1);if(-1==i)return null;d=i}return{line:a.getCursor().line,ch:i}}function H(a,b,c,e){u(c,za)&&(b.marks[c]&&b.marks[c].clear(),b.marks[c]=a.setBookmark(e))}function Q(a){return"string"===a||"comment"===a?1:0}function Z(a,b,c){var e=b.line,j=b.ch,c=c?c:a.getLine(e).charAt(j),d=a.getTokenAt({line:e,ch:j+1}).type,d=Q(d),i={"(":")",")":"(","[":"]","]":"[","{":"}",
"}":"{"}[c];if(!i)return b;for(var o={"(":1,"{":1,"[":1}[c]||-1,l=1===o?a.lineCount():-1,f=1,g=c,h=j,j=a.getLine(e);e!==l&&0<f;){h+=o;g=j.charAt(h);g||(e+=o,j=a.getLine(e)||"",0<o?h=0:(g=j.length,h=0<g?g-1:0),g=j.charAt(h));var n=a.getTokenAt({line:e,ch:h+1}).type,n=Q(n);d>=n&&(g===c?f++:g===i&&f--)}return g?{line:e,ch:h}:b}function S(){}function G(a){a=a.state.vim;return a.searchState_||(a.searchState_=new S)}function d(a){for(var b=!1,c=[],e=0;e<a.length;e++){var j=a.charAt(e);!b&&"/"==j&&c.push(e);
b=!b&&"\\"==j}return c}function f(a,b){for(var c=!1,e=[],j=-1;j<a.length;j++){for(var d=a.charAt(j)||"",i=a.charAt(j+1)||"",o=!1,l=0;l<b.length;l++)if(i===b[l]){o=!0;break}c?"\\"!==d||!o?(e.push(d),c=!1):c=!0:"\\"===d?(c=!0,o||e.push("\\")):(e.push(d),o&&"\\"!==i&&e.push("\\"))}return e.join("")}function g(a,b){a.openNotification?a.openNotification('<span style="color: red">'+b+"</span>",{bottom:!0,duration:5E3}):alert(b)}function h(a,b){var c=(b.prefix||"")+" "+(b.desc||""),e=b.prefix,j=b.desc,d=
"";e&&(d+='<span style="font-family: monospace">'+e+"</span>");d+='<input type="text"/> <span style="color: #888">';j&&(d=d+'<span style="color: #888">'+j+"</span>");e=b.onClose;a.openDialog?a.openDialog(d,e,{bottom:!0,value:b.value,onKeyDown:b.onKeyDown,onKeyUp:b.onKeyUp}):e(prompt(c,""))}function k(a,b,c,e){if(b){var j=G(a);c=!!c;e=!!e;if(!(b instanceof RegExp)){var ea=d(b),i,o;ea.length?(i=b.substring(0,ea[0]),o=-1!=b.substring(ea[0]).indexOf("i")):i=b;i?(i=f(i,["|","(",")"]),e&&(c=/^[^A-Z]*$/.test(i)),
b=RegExp(i,c||o?"i":void 0)):b=null}if(b){ka(a,b);a:if(a=j.getQuery(),b instanceof RegExp&&a instanceof RegExp){o=["global","multiline","ignoreCase","source"];for(c=0;c<o.length;c++)if(e=o[c],b[e]!==a[e]){a=!1;break a}a=!0}else a=!1;if(a)return b;j.setQuery(b);return b}}}function va(a){if("^"==a.source.charAt(0))var b=!0;return{token:function(c){if(b&&!c.sol())c.skipToEnd();else{var e=c.match(a,!1);if(e){if(0==e[0].length)return c.next(),"searching";if(!c.sol()&&(c.backUp(1),!a.exec(c.next()+e[0])))return c.next(),
null;c.match(a);return"searching"}for(;!c.eol()&&!(c.next(),c.match(a,!1)););}},query:a}}function ka(a,b){var c=G(a).getOverlay();if(!c||b!=c.query)c&&a.removeOverlay(c),c=va(b),a.addOverlay(c),G(a).setOverlay(c)}function la(a,b,c,e){void 0===e&&(e=1);return a.operation(function(){for(var j=a.getCursor(),d=a.getSearchCursor(c,j),i=0;i<e;i++){var o=d.find(b);0==i&&(o&&E(d.from(),j))&&(o=d.find(b));if(!o&&(d=a.getSearchCursor(c,b?{line:a.lastLine()}:{line:a.firstLine(),ch:0}),!d.find(b)))return}return d.from()})}
function ga(a){a.removeOverlay(G(a).getOverlay());G(a).setOverlay(null)}function ha(a){var b=a.getScrollInfo(),c=a.coordsChar({left:0,top:6+b.top},"local"),a=a.coordsChar({left:0,top:b.clientHeight-10+b.top},"local");return{top:c.line,bottom:a.line}}function aa(a){for(var b,c,e=[];a;){c=/<\w+-.+?>|<\w+>|./.exec(a);if(null===c)break;b=c[0];a=a.substring(c.index+b.length);e.push(b)}return e}function Aa(a,b,c,e,j,d,i){function o(){a.operation(function(){for(;!n;)l(),f();fa()})}function l(){var b=a.getRange(j.from(),
j.to()).replace(d,i);j.replace(b)}function f(){if(j.findNext()){var b;b=j.from();var d=c,i=e;"number"!=typeof b&&(b=b.line);b=d instanceof Array?u(b,d):i?b>=d&&b<=i:b==d;b?(a.scrollIntoView(j.from(),30),a.setSelection(j.from(),j.to()),m=j.from(),n=!1):n=!0}else n=!0}function fa(b){b&&b();a.focus();m&&(a.setCursor(m),b=a.state.vim,b.exMode=!1,b.lastHPos=b.lastHSPos=m.ch)}function k(b,c,e){CodeMirror.e_stop(b);switch(CodeMirror.keyName(b)){case "Y":l();f();break;case "N":f();break;case "A":a.operation(o);
break;case "L":l();case "Q":case "Esc":case "Ctrl-C":case "Ctrl-[":fa(e)}n&&fa(e)}a.state.vim.exMode=!0;var n=!1,m=j.from();f();n?g(a,"No matches for "+d.source):b?h(a,{prefix:"replace with <strong>"+i+"</strong> (y/n/a/q/l)",onKeyDown:k}):o()}function ba(a){var b=a.state.vim,c=q.macroModeState.inReplay;c||(a.off("change",ma),a.off("cursorActivity",na),CodeMirror.off(a.getInputField(),"keydown",oa));!c&&1<b.insertModeRepeat&&(pa(a,b,b.insertModeRepeat-1,!0),b.lastEditInputState.repeatOverride=b.insertModeRepeat);
delete b.insertModeRepeat;a.setCursor(a.getCursor().line,a.getCursor().ch-1,!0);b.insertMode=!1;a.setOption("keyMap","vim");a.setOption("disableInput",!0);a.toggleOverwrite(!1);CodeMirror.signal(a,"vim-mode-change",{mode:"normal"})}function ma(a,b){for(var c=q.macroModeState.lastInsertModeChanges;b;){c.expectCursorActivityForChange=!0;if("+input"==b.origin||"paste"==b.origin||void 0===b.origin){var e=b.text.join("\n");c.changes.push(e)}b=b.next}}function na(){var a=q.macroModeState.lastInsertModeChanges;
a.expectCursorActivityForChange?a.expectCursorActivityForChange=!1:a.changes=[]}function ia(a){this.keyName=a}function oa(a){function b(){c.changes.push(new ia(e));return!0}var c=q.macroModeState.lastInsertModeChanges,e=CodeMirror.keyName(a);(-1!=e.indexOf("Delete")||-1!=e.indexOf("Backspace"))&&CodeMirror.lookupKey(e,["vim-insert"],b)}function pa(a,b,c,e){function j(){o?U.processAction(a,b,b.lastEditActionCommand):U.evalInput(a,b)}function d(c){0<i.lastInsertModeChanges.changes.length&&(c=!b.lastEditActionCommand?
1:c,Ba(a,c,i))}var i=q.macroModeState;i.inReplay=!0;var o=!!b.lastEditActionCommand,l=b.inputState;b.inputState=b.lastEditInputState;if(o&&b.lastEditActionCommand.interlaceInsertRepeat)for(var f=0;f<c;f++)j(),d(1);else e||j(),d(c);b.inputState=l;b.insertMode&&!e&&ba(a);i.inReplay=!1}function Ba(a,b,c){function e(b){if("string"==typeof b)CodeMirror.commands[b](a);else b(a);return!0}for(var c=c.lastInsertModeChanges,j=0;j<b;j++)for(var d=0;d<c.changes.length;d++){var i=c.changes[d];if(i instanceof ia)CodeMirror.lookupKey(i.keyName,
["vim-insert"],e);else{var o=a.getCursor();a.replaceRange(i,o,o)}}}CodeMirror.defineOption("vimMode",!1,function(a,b){if(b){a.setOption("keyMap","vim");a.setOption("disableInput",true);CodeMirror.signal(a,"vim-mode-change",{mode:"normal"});a.on("beforeSelectionChange",p);t(a);CodeMirror.on(a.getInputField(),"paste",L(a))}else if(a.state.vim){a.setOption("keyMap","default");a.setOption("disableInput",false);a.off("beforeSelectionChange",p);CodeMirror.off(a.getInputField(),"paste",L(a));a.state.vim=
null}});var Ca=/[\d]/,Da=[/\w/,/[^\w\s]/],Ea=[/\S/],ca=v(65,26),ja=v(97,26),da=v(48,10),qa="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'".split(""),ra="Left Right Up Down Space Backspace Esc Home End PageUp PageDown Enter".split(" "),za=[].concat(ca,ja,da,["<",">"]),Fa=[].concat(ca,ja,da,["-",'"']),wa=function(){var a=100,b=-1,c=0,e=0,j=Array(a);return{cachedCursor:void 0,add:function(d,i,o){function f(c){var e=++b%a,i=j[e];i&&i.clear();j[e]=d.setBookmark(c)}var g=j[b%a];g?(g=g.find())&&!E(g,i)&&f(i):f(i);
f(o);c=b;e=b-a+1;0>e&&(e=0)},move:function(d,i){b+=i;b>c?b=c:b<e&&(b=e);var o=j[(a+b)%a];if(o&&!o.find()){var f=0<i?1:-1,g,h=d.getCursor();do if(b+=f,(o=j[(a+b)%a])&&(g=o.find())&&!E(h,g))break;while(b<c&&b>e)}return o}}},xa=function(){return{macroKeyBuffer:[],latestRegister:void 0,inReplay:!1,lastInsertModeChanges:{changes:[],expectCursorActivityForChange:!1},enteredMacroMode:void 0,isMacroPlaying:!1,toggle:function(a,b){this.enteredMacroMode?(this.enteredMacroMode(),this.enteredMacroMode=void 0):
(this.latestRegister=b,this.enteredMacroMode=a.openDialog("(recording)["+b+"]",null,{bottom:!0}))}}},q,Ga={buildKeyMap:function(){},getRegisterController:function(){return q.registerController},resetVimGlobalState_:J,getVimGlobalState_:function(){return q},maybeInitVimState_:t,InsertModeKey:ia,map:function(a,b,c){V.map(a,b,c)},defineEx:function(a,b,c){if(0!==a.indexOf(b))throw Error('(Vim.defineEx) "'+b+'" is not a prefix of "'+a+'", command not registered');sa[a]=c;V.commandMap_[b]={name:a,shortName:b,
type:"api"}},handleKey:function(a,b){var c,e=t(a),j=q.macroModeState;if(j.enteredMacroMode&&"q"==b)$.exitMacroRecordMode(),e.inputState=new x;else if("<Esc>"==b)e.inputState=new x,e.visualMode&&M(a);else{!e.visualMode&&!E(a.getCursor("head"),a.getCursor("anchor"))&&(e.visualMode=!0,e.visualLine=!1,CodeMirror.signal(a,"vim-mode-change",{mode:"visual"}),a.on("mousedown",M));if("0"!=b||"0"==b&&0===e.inputState.getRepeat())c=U.matchCommand(b,N,e);if(c)if("keyToKey"==c.type)for(e=0;e<c.toKeys.length;e++)this.handleKey(a,
c.toKeys[e]);else j.enteredMacroMode&&(j.isMacroPlaying||j.macroKeyBuffer.push(b)),U.processCommand(a,e,c);else Ca.test(b)&&e.inputState.pushRepeatDigit(b)}},handleEx:function(a,b){V.processCommand(a,b)}};x.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)};x.prototype.getRepeat=function(){var a=0;if(0<this.prefixRepeat.length||0<this.motionRepeat.length)a=1,0<this.prefixRepeat.length&&(a*=parseInt(this.prefixRepeat.join(""),
10)),0<this.motionRepeat.length&&(a*=parseInt(this.motionRepeat.join(""),10));return a};B.prototype={set:function(a,b){this.text=a;this.linewise=!!b},append:function(a,b){b||this.linewise?(this.text+="\n"+a,this.linewise=!0):this.text+=a},clear:function(){this.text="";this.linewise=!1},toString:function(){return this.text}};O.prototype={pushText:function(a,b,c,e){e&&"\n"==c.charAt(0)&&(c=c.slice(1)+"\n");e&&"\n"!==c.charAt(c.length-1)&&(c+="\n");var j=this.isValidRegister(a)?this.getRegister(a):null;
if(j)C(a)?(j.append(c,e),this.unamedRegister.append(c,e)):(j.set(c,e),this.unamedRegister.set(c,e));else{switch(b){case "yank":this.registers["0"]=new B(c,e);break;case "delete":case "change":-1==c.indexOf("\n")?this.registers["-"]=new B(c,e):(this.shiftNumericRegisters_(),this.registers["1"]=new B(c,e))}this.unamedRegister.set(c,e)}},setRegisterText:function(a,b,c){this.getRegister(a).set(b,c)},getRegister:function(a){if(!this.isValidRegister(a))return this.unamedRegister;a=a.toLowerCase();this.registers[a]||
(this.registers[a]=new B);return this.registers[a]},isValidRegister:function(a){return a&&u(a,Fa)},shiftNumericRegisters_:function(){for(var a=9;2<=a;a--)this.registers[a]=this.getRegister(""+(a-1))}};var U={matchCommand:function(a,b,c){function e(b){if(d.length<b.keys.length)return j.keyBuffer.push(a),null;"character"==b.keys[d.length-1]&&(j.selectedCharacter=f);j.keyBuffer=[];return b}for(var j=c.inputState,d=j.keyBuffer.concat(a),i=[],f,l=0;l<b.length;l++){var g=b[l];if(K(d,g.keys)&&!(j.operator&&
"action"==g.type)){if("character"==g.keys[d.length-1]&&(f=d[d.length-1],1<f.length))switch(f){case "<CR>":f="\n";break;case "<Space>":f=" ";break;default:continue}i.push(g)}}if(i.length){if(1==i.length)return e(i[0]);for(var b=c.visualMode?"visual":"normal",h,l=0;l<i.length;l++)if(c=i[l],c.context==b){h=c;break}else!h&&!c.context&&(h=c);return e(h)}j.keyBuffer=[];return null},processCommand:function(a,b,c){b.inputState.repeatOverride=c.repeatOverride;switch(c.type){case "motion":this.processMotion(a,
b,c);break;case "operator":this.processOperator(a,b,c);break;case "operatorMotion":this.processOperatorMotion(a,b,c);break;case "action":this.processAction(a,b,c);break;case "search":this.processSearch(a,b,c);break;case "ex":case "keyToEx":this.processEx(a,b,c)}},processMotion:function(a,b,c){b.inputState.motion=c.motion;b.inputState.motionArgs=P(c.motionArgs);this.evalInput(a,b)},processOperator:function(a,b,c){var e=b.inputState;if(e.operator){if(e.operator==c.operator){e.motion="expandToLine";
e.motionArgs={linewise:!0};this.evalInput(a,b);return}b.inputState=new x}e.operator=c.operator;e.operatorArgs=P(c.operatorArgs);b.visualMode&&this.evalInput(a,b)},processOperatorMotion:function(a,b,c){var e=b.visualMode,j=P(c.operatorMotionArgs);j&&(e&&j.visualLine)&&(b.visualLine=!0);this.processOperator(a,b,c);e||this.processMotion(a,b,c)},processAction:function(a,b,c){var e=b.inputState,j=e.getRepeat(),d=!!j,i=P(c.actionArgs)||{};e.selectedCharacter&&(i.selectedCharacter=e.selectedCharacter);c.operator&&
this.processOperator(a,b,c);c.motion&&this.processMotion(a,b,c);(c.motion||c.operator)&&this.evalInput(a,b);i.repeat=j||1;i.repeatIsExplicit=d;i.registerName=e.registerName;b.inputState=new x;b.lastMotion=null;c.isEdit&&this.recordLastEdit(b,e,c);$[c.action](a,i,b)},processSearch:function(a,b,c){function e(e,j,d){try{k(a,e,j,d)}catch(i){g(a,"Invalid regex: "+e);return}U.processMotion(a,b,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:c.searchArgs.toJumplist}})}function j(b){a.scrollTo(m.left,
m.top);e(b,!0,!0)}function d(b,c){var e;try{e=k(a,c,!0,!0)}catch(j){}e?a.scrollIntoView(la(a,!f,e),30):(ga(a),a.scrollTo(m.left,m.top))}function i(b,c,e){c=CodeMirror.keyName(b);if("Esc"==c||"Ctrl-C"==c||"Ctrl-["==c)k(a,ya),ga(a),a.scrollTo(m.left,m.top),CodeMirror.e_stop(b),e(),a.focus()}if(a.getSearchCursor){var f=c.searchArgs.forward;G(a).setReversed(!f);var l=f?"/":"?",ya=G(a).getQuery(),m=a.getScrollInfo();switch(c.searchArgs.querySrc){case "prompt":h(a,{onClose:j,prefix:l,desc:Ha,onKeyUp:d,
onKeyDown:i});break;case "wordUnderCursor":var l=R(a,!1,!0,!1,!0),p=!0;l||(l=R(a,!1,!0,!1,!1),p=!1);if(!l)break;var n=a.getLine(l.start.line).substring(l.start.ch,l.end.ch),n=p?"\\b"+n+"\\b":n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1");q.jumpList.cachedCursor=a.getCursor();a.setCursor(l.start);e(n,!0,!1)}}},processEx:function(a,b,c){function e(b){V.processCommand(a,b)}function j(b,c,e){c=CodeMirror.keyName(b);if("Esc"==c||"Ctrl-C"==c||"Ctrl-["==c)CodeMirror.e_stop(b),e(),a.focus()}"keyToEx"==c.type?
V.processCommand(a,c.exArgs.input):b.visualMode?h(a,{onClose:e,prefix:":",value:"'<,'>",onKeyDown:j}):h(a,{onClose:e,prefix:":",onKeyDown:j})},evalInput:function(a,b){var c=b.inputState,e=c.motion,j=c.motionArgs||{},d=c.operator,i=c.operatorArgs||{},f=c.registerName,l=a.getCursor("head"),g=a.getCursor("anchor"),h={line:l.line,ch:l.ch},m={line:h.line,ch:h.ch},n,k;d&&this.recordLastEdit(b,c);k=void 0!==c.repeatOverride?c.repeatOverride:c.getRepeat();if(0<k&&j.explicitRepeat)j.repeatIsExplicit=!0;else if(j.noRepeat||
!j.explicitRepeat&&0===k)k=1,j.repeatIsExplicit=!1;c.selectedCharacter&&(j.selectedCharacter=i.selectedCharacter=c.selectedCharacter);j.repeat=k;b.inputState=new x;if(e){n=W[e](a,j,b);b.lastMotion=W[e];if(!n)return;j.toJumplist&&(e=q.jumpList,(c=e.cachedCursor)?(E(c,n)||q.jumpList.add(a,c,n),delete e.cachedCursor):E(m,n)||q.jumpList.add(a,m,n));n instanceof Array&&(h=n[0],n=n[1]);n||(n={ch:h.ch,line:h.line});if(b.visualMode){if(r(g,l)&&(E(g,n)||r(n,g)))g.ch+=1;else if(r(l,g)&&(E(g,n)||r(g,n)))g.ch-=
1;l=n;b.visualLine&&(r(g,l)?(g.ch=0,e=a.lastLine(),l.line>e&&(l.line=e),l.ch=y(a,l.line)):(l.ch=0,g.ch=y(a,g.line)));a.setSelection(g,l);H(a,b,"<",r(g,l)?g:l);H(a,b,">",r(g,l)?l:g)}else d||(n=s(a,n),a.setCursor(n.line,n.ch))}if(d){e=!1;b.lastMotion=null;i.repeat=k;b.visualMode&&(h=g,n=l,j.inclusive=!0);r(n,h)&&(l=h,h=n,n=l,e=!0);j.inclusive&&(!b.visualMode||!e)&&n.ch++;if(l=j.linewise||b.visualMode&&b.visualLine)j=n,h.ch=0,j.ch=0,j.line++;else if(j.forward&&(j=n,g=a.getRange(h,j),/\n\s*$/.test(g))){g=
g.split("\n");g.pop();for(k=g.pop();0<g.length&&k&&/^\s*$/.test(k);k=g.pop())j.line--,j.ch=0;k?(j.line--,j.ch=y(a,j.line)):j.ch=0}i.registerName=f;i.linewise=l;Ia[d](a,i,b,h,n,m);b.visualMode&&M(a)}},recordLastEdit:function(a,b,c){var e=q.macroModeState;e.inReplay||(a.lastEditInputState=b,a.lastEditActionCommand=c,e.lastInsertModeChanges.changes=[],e.lastInsertModeChanges.expectCursorActivityForChange=!1)}},W={moveToTopLine:function(a,b){var c=ha(a).top+b.repeat-1;return{line:c,ch:F(a.getLine(c))}},
moveToMiddleLine:function(a){var b=ha(a),b=Math.floor(0.5*(b.top+b.bottom));return{line:b,ch:F(a.getLine(b))}},moveToBottomLine:function(a,b){var c=ha(a).bottom-b.repeat+1;return{line:c,ch:F(a.getLine(c))}},expandToLine:function(a,b){return{line:a.getCursor().line+b.repeat-1,ch:Infinity}},findNext:function(a,b){var c=G(a),e=c.getQuery();if(e){var j=!b.forward,j=c.isReversed()?!j:j;ka(a,e);return la(a,j,e,b.repeat)}},goToMark:function(a,b,c){return(a=c.marks[b.selectedCharacter])?a.find():null},jumpToMark:function(a,
b,c){for(var e=a.getCursor(),j=0;j<b.repeat;j++){var d=e,i;for(i in c.marks)if(/^[a-z]$/.test(i)){var f=c.marks[i].find();if(!(b.forward?r(f,d):r(d,f))&&!(b.linewise&&f.line==d.line)){var g=E(d,e),h=b.forward?Y(d,f,e):Y(e,f,d);if(g||h)e=f}}}b.linewise&&(e.ch=F(a.getLine(e.line)));return e},moveByCharacters:function(a,b){var c=a.getCursor(),e=b.repeat;return{line:c.line,ch:b.forward?c.ch+e:c.ch-e}},moveByLines:function(a,b,c){var e=a.getCursor(),j=e.ch;switch(c.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:j=
c.lastHPos;break;default:c.lastHPos=j}var d=b.repeat+(b.repeatOffset||0),d=b.forward?e.line+d:e.line-d,i=a.firstLine(),f=a.lastLine();if(!(d<i&&e.line==i||d>f&&e.line==f))return b.toFirstChar&&(j=F(a.getLine(d)),c.lastHPos=j),c.lastHSPos=a.charCoords({line:d,ch:j},"div").left,{line:d,ch:j}},moveByDisplayLines:function(a,b,c){var e=a.getCursor();switch(c.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:c.lastHSPos=
a.charCoords(e,"div").left}var d=b.repeat,e=a.findPosV(e,b.forward?d:-d,"line",c.lastHSPos);e.hitSide&&(b.forward?b={top:a.charCoords(e,"div").top+8,left:c.lastHSPos}:(b=a.charCoords({line:a.firstLine(),ch:0},"div"),b.left=c.lastHSPos),e=a.coordsChar(b,"div"));c.lastHPos=e.ch;return e},moveByPage:function(a,b){var c=a.getCursor(),e=b.repeat;a.moveV(b.forward?e:-e,"page");e=a.getCursor();a.setCursor(c);return e},moveByParagraph:function(a,b){for(var c=a.getCursor().line,e=b.repeat,d=b.forward?1:-1,
f=0;f<e&&!(!b.forward&&c===a.firstLine()||b.forward&&c==a.lastLine());f++)for(c+=d;c!==a.firstLine()&&c!=a.lastLine()&&a.getLine(c);)c+=d;return{line:c,ch:0}},moveByScroll:function(a,b,c){var e=a.getScrollInfo(),d=null;(d=b.repeat)||(d=e.clientHeight/(2*a.defaultTextHeight()));var f=a.charCoords(a.getCursor(),"local");b.repeat=d;d=W.moveByDisplayLines(a,b,c);if(!d)return null;b=a.charCoords(d,"local");a.scrollTo(null,e.top+b.top-f.top);return d},moveByWords:function(a,b){var c;var e=b.repeat;c=!!b.forward;
var d=!!b.wordEnd,f=!!b.bigWord,i=a.getCursor(),g=i.line,l=i.ch,h=[];(c&&!d||!c&&d)&&e++;for(var k=!(c&&d),m=0;m<e;m++){var n;b:{n=a;var p=c,q=f,u=k,D=i.line,I=i.ch,s=n.getLine(D),r=p?1:-1,q=q?Ea:Da;if(u&&""==s){D+=r;s=n.getLine(D);if(!(D>=n.firstLine()&&D<=n.lastLine())){n=null;break b}I=p?0:s.length}for(;;){if(u&&""==s){n={from:0,to:0,line:D};break b}for(var t=p=0<r?s.length:-1,v=p;I!=p;){for(var x=!1,w=0;w<q.length&&!x;++w)if(q[w].test(s.charAt(I))){for(t=I;I!=p&&q[w].test(s.charAt(I));)I+=r;v=
I;x=t!=v;if(!(t==i.ch&&D==i.line&&v==t+r)){n={from:Math.min(t,v+1),to:Math.max(t,v),line:D};break b}}x||(I+=r)}D+=r;if(!(D>=n.firstLine()&&D<=n.lastLine())){n=null;break b}s=n.getLine(D);I=0<r?0:s.length}throw Error("The impossible happened.");}if(!n){f=y(a,a.lastLine());h.push(c?{line:a.lastLine(),from:f,to:f}:{line:0,from:0,to:0});break}h.push(n);i={line:n.line,ch:c?n.to-1:n.from}}e=h.length!=e;f=h[0];k=h.pop();if(c&&!d){if(!e&&(f.from!=l||f.line!=g))k=h.pop();c={line:k.line,ch:k.from}}else if(c&&
d)c={line:k.line,ch:k.to-1};else if(!c&&d){if(!e&&(f.to!=l||f.line!=g))k=h.pop();c={line:k.line,ch:k.to}}else c={line:k.line,ch:k.from};return c},moveTillCharacter:function(a,b){var c=w(a,b.repeat,b.forward,b.selectedCharacter),e=b.forward?-1:1;A(e,b);if(!c)return null;c.ch+=e;return c},moveToCharacter:function(a,b){var c=b.repeat;A(0,b);return w(a,c,b.forward,b.selectedCharacter)||a.getCursor()},moveToSymbol:function(a,b){var c;c=b.repeat;var e=b.forward,d=b.selectedCharacter,f=a.getCursor(),i=e?
1:-1,g=e?a.lineCount():-1,l=f.ch,h=f.line,k=a.getLine(h),e={lineText:k,nextCh:k.charAt(l),lastCh:null,index:l,symb:d,reverseSymb:(e?{")":"(","}":"{"}:{"(":")","{":"}"})[d],forward:e,depth:0,curMoveThrough:!1};if(l=Ja[d]){d=ta[l].init;l=ta[l].isComplete;for(d&&d(e);h!==g&&c;)if(e.index+=i,e.nextCh=e.lineText.charAt(e.index),e.nextCh||(h+=i,e.lineText=a.getLine(h)||"",0<i?e.index=0:(d=e.lineText.length,e.index=0<d?d-1:0),e.nextCh=e.lineText.charAt(e.index)),l(e))f.line=h,f.ch=e.index,c--;c=e.nextCh||
e.curMoveThrough?{line:h,ch:e.index}:f}else c=f;return c||a.getCursor()},moveToColumn:function(a,b,c){b=b.repeat;c.lastHPos=b-1;c.lastHSPos=a.charCoords(a.getCursor(),"div").left;c=a.getCursor().line;return s(a,{line:c,ch:b-1})},moveToEol:function(a,b,c){var e=a.getCursor();c.lastHPos=Infinity;b={line:e.line+b.repeat-1,ch:Infinity};e=a.clipPos(b);e.ch--;c.lastHSPos=a.charCoords(e,"div").left;return b},moveToFirstNonWhiteSpaceCharacter:function(a){var b=a.getCursor();return{line:b.line,ch:F(a.getLine(b.line))}},
moveToMatchedSymbol:function(a){var b=a.getCursor(),c=b.line,e=b.ch,d=a.getLine(c),f;f=a.getTokenAt(b).type;var i=Q(f);do if((f=d.charAt(e++))&&-1!="()[]{}".indexOf(f)){var g=a.getTokenAt({line:c,ch:e}).type,g=Q(g);if(i>=g)break}while(f);return f?Z(a,{line:c,ch:e-1},f):b},moveToStartOfLine:function(a){return{line:a.getCursor().line,ch:0}},moveToLineOrEdgeOfDocument:function(a,b){var c=b.forward?a.lastLine():a.firstLine();b.repeatIsExplicit&&(c=b.repeat-a.getOption("firstLineNumber"));return{line:c,
ch:F(a.getLine(c))}},textObjectManipulation:function(a,b){var c={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["},e={"'":!0,'"':!0},d=b.selectedCharacter,f=!b.textObjectInner;if(c[d]){var d=c[d],i=a.getCursor(),d=Z(a,i,d),i=Z(a,d);if(i.line==d.line&&i.ch>d.ch||i.line>d.line)var g=i,i=d,d=g;f?d.ch+=1:i.ch+=1;f={start:i,end:d}}else if(e[d]){var c=a.getCursor(),e=a.getLine(c.line).split(""),h,k;h=e.indexOf(d);c.ch<h?c.ch=h:h<c.ch&&e[c.ch]==d&&(g=c.ch,--c.ch);if(e[c.ch]==d&&!g)i=c.ch+1;else for(h=c.ch;-1<
h&&!i;h--)e[h]==d&&(i=h+1);if(i&&!g){h=i;for(k=e.length;h<k&&!g;h++)e[h]==d&&(g=h)}!i||!g?f={start:c,end:c}:(f&&(--i,++g),f={start:{line:c.line,ch:i},end:{line:c.line,ch:g}})}else if("W"===d)f=R(a,f,!0,!0);else if("w"===d)f=R(a,f,!0,!1);else return null;return[f.start,f.end]},repeatLastCharacterSearch:function(a,b){var c=q.lastChararacterSearch,e=b.repeat,d=b.forward===c.forward,f=(c.increment?1:0)*(d?-1:1);a.moveH(-f,"char");b.inclusive=d?!0:!1;c=w(a,e,d,c.selectedCharacter);if(!c)return a.moveH(f,
"char"),a.getCursor();c.ch+=f;return c}},Ia={change:function(a,b,c,e,d){q.registerController.pushText(b.registerName,"change",a.getRange(e,d),b.linewise);b.linewise?(b=d.line>a.lastLine()?"":"\n",a.replaceRange(b,e,d),a.indentLine(e.line,"smart"),e.ch=null):(b=a.getRange(e,d),/^\s*$/.test(b)||(b=/\s+$/.exec(b))&&(d=m(d,0,-b[0].length)),a.replaceRange("",e,d));$.enterInsertMode(a,{},a.state.vim);a.setCursor(e)},"delete":function(a,b,c,e,d){b.linewise&&(d.line>a.lastLine()&&e.line>a.firstLine())&&(e.line--,
e.ch=y(a,e.line));q.registerController.pushText(b.registerName,"delete",a.getRange(e,d),b.linewise);a.replaceRange("",e,d);b.linewise?a.setCursor(W.moveToFirstNonWhiteSpaceCharacter(a)):a.setCursor(e)},indent:function(a,b,c,e,d){var f=e.line,d=d.line,c=c.visualMode?b.repeat:1;for(b.linewise&&d--;f<=d;f++)for(var i=0;i<c;i++)a.indentLine(f,b.indentRight);a.setCursor(e);a.setCursor(W.moveToFirstNonWhiteSpaceCharacter(a))},swapcase:function(a,b,c,e,d,f){for(var c=a.getRange(e,d),i="",g=0;g<c.length;g++)var h=
c.charAt(g),i=i+(C(h)?h.toLowerCase():h.toUpperCase());a.replaceRange(i,e,d);b.shouldMoveCursor||a.setCursor(f)},yank:function(a,b,c,e,d,f){q.registerController.pushText(b.registerName,"yank",a.getRange(e,d),b.linewise);a.setCursor(f)}},$={jumpListWalk:function(a,b,c){c.visualMode||(c=b.repeat,b=(b=(b=q.jumpList.move(a,b.forward?c:-c))?b.find():void 0)?b:a.getCursor(),a.setCursor(b))},scroll:function(a,b,c){if(!c.visualMode){var e=b.repeat||1,c=a.defaultTextHeight(),d=a.getScrollInfo().top,e=c*e,
d=b.forward?d+e:d-e,e=a.getCursor(),f=a.charCoords(e,"local");b.forward?d>f.top?(e.line+=(d-f.top)/c,e.line=Math.ceil(e.line),a.setCursor(e),f=a.charCoords(e,"local"),a.scrollTo(null,f.top)):a.scrollTo(null,d):(b=d+a.getScrollInfo().clientHeight,b<f.bottom?(e.line-=(f.bottom-b)/c,e.line=Math.floor(e.line),a.setCursor(e),f=a.charCoords(e,"local"),a.scrollTo(null,f.bottom-a.getScrollInfo().clientHeight)):a.scrollTo(null,d))}},scrollToCursor:function(a,b){var c=a.getCursor().line,e=a.charCoords({line:c,
ch:0},"local"),c=a.getScrollInfo().clientHeight,d=e.top,e=e.bottom-d;switch(b.position){case "center":d=d-c/2+e;break;case "bottom":d=d-c+1.4*e;break;case "top":d+=0.4*e}a.scrollTo(null,d)},replayMacro:function(a,b){var c=b.selectedCharacter,e=b.repeat,d=q.macroModeState;"@"==c&&(c=d.latestRegister);var f,i,g=q.registerController.getRegister(c).toString(),c=d.macroKeyBuffer;d.isMacroPlaying||(d.macroKeyBuffer.length=0);do{f=/<\w+-.+?>|<\w+>|./.exec(g);if(null===f)break;i=f[0];g=g.substring(f.index+
i.length);c.push(i)}while(g);for(;e--;){f=a;i=d;g=c;i.isMacroPlaying=!0;for(var h=0,k=g.length;h<k;h++)CodeMirror.Vim.handleKey(f,g[h]);i.isMacroPlaying=!1}},exitMacroRecordMode:function(){var a=q.macroModeState;a.toggle();var b=a.latestRegister,a=a.macroKeyBuffer.join("");q.registerController.setRegisterText(b,a)},enterMacroRecordMode:function(a,b){var c=q.macroModeState;c.toggle(a,b.selectedCharacter);c.isMacroPlaying||(c.macroKeyBuffer.length=0)},enterInsertMode:function(a,b,c){if(!a.getOption("readOnly")&&
(c.insertMode=!0,c.insertModeRepeat=b&&b.repeat||1,c=b?b.insertAt:null,"eol"==c?(c=a.getCursor(),c={line:c.line,ch:y(a,c.line)},a.setCursor(c)):"charAfter"==c?a.setCursor(m(a.getCursor(),0,1)):"firstNonBlank"==c&&a.setCursor(W.moveToFirstNonWhiteSpaceCharacter(a)),a.setOption("keyMap","vim-insert"),a.setOption("disableInput",!1),b&&b.replace?(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),CodeMirror.signal(a,"vim-mode-change",{mode:"replace"})):(a.setOption("keyMap","vim-insert"),CodeMirror.signal(a,
"vim-mode-change",{mode:"insert"})),!q.macroModeState.inReplay))a.on("change",ma),a.on("cursorActivity",na),CodeMirror.on(a.getInputField(),"keydown",oa)},toggleVisualMode:function(a,b,c){var d=b.repeat,f=a.getCursor();c.visualMode?(f=a.getCursor("anchor"),d=a.getCursor("head"),!c.visualLine&&b.linewise?(c.visualLine=!0,f.ch=r(f,d)?0:y(a,f.line),d.ch=r(f,d)?y(a,d.line):0,a.setSelection(f,d),CodeMirror.signal(a,"vim-mode-change",{mode:"visual",subMode:"linewise"})):c.visualLine&&!b.linewise?(c.visualLine=
!1,CodeMirror.signal(a,"vim-mode-change",{mode:"visual"})):M(a)):(a.on("mousedown",M),c.visualMode=!0,c.visualLine=!!b.linewise,c.visualLine?(f.ch=0,d=s(a,{line:f.line+d-1,ch:y(a,f.line)},!0)):d=s(a,{line:f.line,ch:f.ch+d},!0),!b.repeatIsExplicit&&!c.visualLine?(a.setCursor(d),a.setSelection(d,f)):a.setSelection(f,d),CodeMirror.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":""}));H(a,c,"<",r(f,d)?f:d);H(a,c,">",r(f,d)?d:f)},joinLines:function(a,b,c){var d,f;c.visualMode?
(d=a.getCursor("anchor"),f=a.getCursor("head"),f.ch=y(a,f.line)-1):(b=Math.max(b.repeat,2),d=a.getCursor(),f=s(a,{line:d.line+b-1,ch:Infinity}));var g=0;a.operation(function(){for(var b=d.line;b<f.line;b++){g=y(a,d.line);var c={line:d.line+1,ch:y(a,d.line+1)},h=a.getRange(d,c),h=h.replace(/\n\s*/g," ");a.replaceRange(h,d,c)}a.setCursor({line:d.line,ch:g})})},newLineAndEnterInsertMode:function(a,b,c){c.insertMode=!0;var d=a.getCursor();d.line===a.firstLine()&&!b.after?(a.replaceRange("\n",{line:a.firstLine(),
ch:0}),a.setCursor(a.firstLine(),0)):(d.line=b.after?d.line:d.line-1,d.ch=y(a,d.line),a.setCursor(d),(CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent)(a));this.enterInsertMode(a,{repeat:b.repeat},c)},paste:function(a,b){var c=a.getCursor(),d=q.registerController.getRegister(b.registerName);if(d.text){for(var f="",g=0;g<b.repeat;g++)f+=d.text;(d=d.linewise)?b.after?(f="\n"+f.slice(0,f.length-1),c.ch=y(a,c.line)):c.ch=0:c.ch+=b.after?1:0;a.replaceRange(f,c);
d&&b.after?f={line:c.line+1,ch:F(a.getLine(c.line+1))}:d&&!b.after?f={line:c.line,ch:F(a.getLine(c.line))}:!d&&b.after?(c=a.indexFromPos(c),f=a.posFromIndex(c+f.length-1)):(c=a.indexFromPos(c),f=a.posFromIndex(c+f.length));a.setCursor(f)}},undo:function(a,b){a.operation(function(){X(a,CodeMirror.commands.undo,b.repeat)();a.setCursor(a.getCursor("anchor"))})},redo:function(a,b){X(a,CodeMirror.commands.redo,b.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,
b,c){H(a,c,b.selectedCharacter,a.getCursor())},replace:function(a,b,c){var d=b.selectedCharacter,f=a.getCursor(),g;c.visualMode?(f=a.getCursor("start"),g=a.getCursor("end"),g=a.clipPos({line:g.line,ch:g.ch+1})):(g=a.getLine(f.line),b=f.ch+b.repeat,b>g.length&&(b=g.length),g={line:f.line,ch:b});"\n"==d?(c.visualMode||a.replaceRange("",f,g),(CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent)(a)):(b=a.getRange(f,g),b=b.replace(/[^\n]/g,d),a.replaceRange(b,f,g),
c.visualMode?(a.setCursor(f),M(a)):a.setCursor(m(g,0,-1)))},incrementNumberToken:function(a,b){for(var c=a.getCursor(),d=a.getLine(c.line),f=/-?\d+/g,g,i,h,l;null!==(g=f.exec(d))&&!(l=g[0],i=g.index,h=i+l.length,c.ch<h););if((b.backtrack||!(h<=c.ch))&&l)d=b.increase?1:-1,d=parseInt(l)+d*b.repeat,l={ch:i,line:c.line},h={ch:h,line:c.line},d=d.toString(),a.replaceRange(d,l,h),a.setCursor({line:c.line,ch:i+d.length-1})},repeatLastEdit:function(a,b,c){if(c.lastEditInputState){var d=b.repeat;d&&b.repeatIsExplicit?
c.lastEditInputState.repeatOverride=d:d=c.lastEditInputState.repeatOverride||d;pa(a,c,d,!1)}}},Ja={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},ta={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,1<=a.depth)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=!0;a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return 0===
a.index&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b="*"===a.lastCh&&"/"===a.nextCh;a.lastCh=a.nextCh;return b}},method:{init:function(a){a.symb="m"===a.symb?"{":"}";a.reverseSymb="{"===a.symb?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if("#"===a.nextCh){var b=a.lineText.match(/#(\w+)/)[1];if("endif"===b){if(a.forward&&0===a.depth)return!0;a.depth++}else if("if"===b){if(!a.forward&&0===a.depth)return!0;
a.depth--}if("else"===b&&0===a.depth)return!0}return!1}}};S.prototype={getQuery:function(){return q.query},setQuery:function(a){q.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return q.isReversed},setReversed:function(a){q.isReversed=a}};var Ha="(Javascript regexp)",ua=[{name:"map"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},
{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s"},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"}];z.ExCommandDispatcher=function(){this.buildCommandMap_()};z.ExCommandDispatcher.prototype={processCommand:function(a,b){a.state.vim.visualMode&&M(a);var c=new CodeMirror.StringStream(b),d={};d.input=b;try{this.parseInput_(a,c,d)}catch(f){g(a,f);return}var h;if(d.commandName){var i=this.matchCommand_(d.commandName);if(i){h=i.name;this.parseCommandArgs_(c,d,i);if("exToKey"==
i.type){for(c=0;c<i.toKeys.length;c++)CodeMirror.Vim.handleKey(a,i.toKeys[c]);return}if("exToEx"==i.type){this.processCommand(a,i.toInput);return}}}else void 0!==d.line&&(h="move");if(h)try{sa[h](a,d)}catch(k){throw g(a,k),k;}else g(a,'Not an editor command ":'+b+'"')},parseInput_:function(a,b,c){b.eatWhile(":");b.eat("%")?(c.line=a.firstLine(),c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,b),void 0!==c.line&&b.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,b)));a=b.match(/^(\w+)/);c.commandName=
a?a[1]:b.match(/.*/)[0];return c},parseLineSpec_:function(a,b){var c=b.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(b.next()){case ".":return a.getCursor().line;case "$":return a.lastLine();case "'":if((c=a.state.vim.marks[b.next()])&&c.find())return c.find().line;throw Error("Mark not set");default:b.backUp(1)}},parseCommandArgs_:function(a,b,c){a.eol()||(b.argString=a.match(/.*/)[0],a=c.argDelimiter||/\s+/,a=T(b.argString).split(a),a.length&&a[0]&&(b.args=a))},matchCommand_:function(a){for(var b=
a.length;0<b;b--){var c=a.substring(0,b);if(this.commandMap_[c]&&(c=this.commandMap_[c],0===c.name.indexOf(a)))return c}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<ua.length;a++){var b=ua[a];this.commandMap_[b.shortName||b.name]=b}},map:function(a,b,c){if(":"!=a&&":"==a.charAt(0)){if(c)throw Error("Mode not supported for ex mappings");c=a.substring(1);this.commandMap_[c]=":"!=b&&":"==b.charAt(0)?{name:c,type:"exToEx",toInput:b.substring(1)}:{name:c,type:"exToKey",toKeys:aa(b)}}else b=
":"!=b&&":"==b.charAt(0)?{keys:aa(a),type:"keyToEx",exArgs:{input:b.substring(1)}}:{keys:aa(a),type:"keyToKey",toKeys:aa(b)},c&&(b.context=c),N.unshift(b)}};var sa={map:function(a,b,c){var d=b.args;!d||2>d.length?a&&g(a,"Invalid mapping: "+b.input):V.map(d[0],d[1],c)},nmap:function(a,b){this.map(a,b,"normal")},vmap:function(a,b){this.map(a,b,"visual")},move:function(a,b){U.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},
repeatOverride:b.line+1})},sort:function(a,b){function c(a,b){if(d){var c;c=a;a=b;b=c}f&&(a=a.toLowerCase(),b=b.toLowerCase());c=i&&p.exec(a);var g=i&&p.exec(b);if(!c)return a<b?-1:1;c=parseInt((c[1]+c[2]).toLowerCase(),q);g=parseInt((g[1]+g[2]).toLowerCase(),q);return c-g}var d,f,h,i,k=function(){if(b.argString){var a=new CodeMirror.StringStream(b.argString);a.eat("!")&&(d=!0);if(!a.eol()){if(!a.eatSpace())return"Invalid arguments";var c=a.match(/[a-z]+/);if(c){c=c[0];f=-1!=c.indexOf("i");h=-1!=
c.indexOf("u");var g=-1!=c.indexOf("d")&&1,k=-1!=c.indexOf("x")&&1,c=-1!=c.indexOf("o")&&1;if(1<g+k+c)return"Invalid arguments";i=g&&"decimal"||k&&"hex"||c&&"octal"}a.eatSpace()&&a.match(/\/.*\//)&&"patterns not supported"}}}();if(k)g(a,k+": "+b.argString);else{var k=b.line||a.firstLine(),l=b.lineEnd||b.line||a.lastLine();if(k!=l){var k={line:k,ch:0},l={line:l,ch:y(a,l)},m=a.getRange(k,l).split("\n"),p="decimal"==i?/(-?)([\d]+)/:"hex"==i?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==i?/([0-7]+)/:null,q="decimal"==
i?10:"hex"==i?16:"octal"==i?8:null,n=[],s=[];if(i)for(var r=0;r<m.length;r++)p.exec(m[r])?n.push(m[r]):s.push(m[r]);else s=m;n.sort(c);s.sort(c);m=!d?s.concat(n):n.concat(s);if(h)for(var n=m,t,m=[],r=0;r<n.length;r++)n[r]!=t&&m.push(n[r]),t=n[r];a.replaceRange(m.join("\n"),k,l)}}},substitute:function(a,b){if(!a.getSearchCursor)throw Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var c=b.argString,e=d(c);if(0!==e[0])g(a,"Substitutions should be of the form :s/pattern/replace/");
else{var h=c.substring(e[0]+1,e[1]),m="",i,o,l=!1;e[1]&&(m=c.substring(e[1]+1,e[2]),m=f(m,["\\","/"]));e[2]&&(o=c.substring(e[2]+1).split(" "),i=o[0],o=parseInt(o[1]));i&&(-1!=i.indexOf("c")&&(l=!0,i.replace("c","")),h=h+"/"+i);if(h)try{k(a,h,!0,!0)}catch(p){g(a,"Invalid regex: "+h);return}h=G(a).getQuery();i=void 0!==b.line?b.line:a.getCursor().line;c=b.lineEnd||i;o&&(i=c,c=i+o-1);o=s(a,{line:i,ch:0});o=a.getSearchCursor(h,o);Aa(a,l,i,c,o,h,m)}},redo:CodeMirror.commands.redo,undo:CodeMirror.commands.undo,
write:function(a){CodeMirror.commands.save?CodeMirror.commands.save(a):a.save()},nohlsearch:function(a){ga(a)},delmarks:function(a,b){if(!b.argString||!T(b.argString))g(a,"Argument required");else for(var c=a.state.vim,d=new CodeMirror.StringStream(T(b.argString));!d.eol();){d.eatSpace();var f=d.pos;if(!d.match(/[a-zA-Z]/,!1)){g(a,"Invalid argument: "+b.argString.substring(f));break}var h=d.next();if(d.match("-",!0)){if(!d.match(/[a-zA-Z]/,!1)){g(a,"Invalid argument: "+b.argString.substring(f));break}var i=
d.next();if(/^[a-z]$/.test(h)&&/^[a-z]$/.test(i)||C(h)&&C(i)){h=h.charCodeAt(0);i=i.charCodeAt(0);if(h>=i){g(a,"Invalid argument: "+b.argString.substring(f));break}for(f=0;f<=i-h;f++){var k=String.fromCharCode(h+f);delete c.marks[k]}}else{g(a,"Invalid argument: "+h+"-");break}}else delete c.marks[h]}}},V=new z.ExCommandDispatcher;CodeMirror.keyMap.vim=function(){function a(a){return function(b){CodeMirror.Vim.handleKey(b,a)}}function b(b,d){for(var f=0;f<b.length;f++){var g=b[f];!d&&1==g.length&&
(g="'"+g+"'");var h=d,k=b[f];C(k)&&"Ctrl"==h&&(k=k.toLowerCase());h&&(k=h.charAt(0)+"-"+k);k=(h={Enter:"CR",Backspace:"BS",Delete:"Del"}[k])?h:k;k=1<k.length?"<"+k+">":k;c[d?d+"-"+g:g]=a(k)}}var c={nofallthrough:!0,style:"fat-cursor"};b(ca);b(ja);b(ca,"Ctrl");b(qa);b(qa,"Ctrl");b(da);b(da,"Ctrl");b(ra);b(ra,"Ctrl");return c}();CodeMirror.keyMap["vim-insert"]={Esc:ba,"Ctrl-[":ba,"Ctrl-C":ba,"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(a){(CodeMirror.commands.newlineAndIndentContinueComment||
CodeMirror.commands.newlineAndIndent)(a)},fallthrough:["default"]};CodeMirror.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"]};J();return Ga};CodeMirror.Vim=z()})();
