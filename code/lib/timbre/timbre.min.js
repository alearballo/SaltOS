(function(h){var i=Array.prototype.slice,g=Array.isArray,j=function(a){return"object"===typeof a&&a.constructor===Object},e=0,b=null,d={},c={},a="undefined"!==typeof module&&module.exports?"node":"undefined"!==typeof window?"browser":"unknown",f;f="browser"===a&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent)?!0:!1;var k=!1,l={},o=function(){var a=i.call(arguments),f=a[0],b;switch(typeof f){case "string":d[f]?b=new d[f](a.slice(1)):c[f]?b=c[f](a.slice(1)):console.warn('T("'+f+'") is not defined.');
break;case "number":b=new C(a);break;case "boolean":b=new H(a);break;case "function":b=new I(a);break;case "object":if(null!==f){if(f instanceof x)return f;if(f.context instanceof x)return f.context;f.constructor===Object?b=new J(a):g(f)&&(b=new E(a))}}b===h?(b=new C([0]),b._.isUndefined=!0):b._.isUndefined=!1;b._.originkey=f;for(var a=b._,f=b._.meta,l,k,e=b;null!==e&&e.constructor!==Object;){l=Object.getOwnPropertyNames(e);for(var o=0,s=l.length;o<s;++o)if(!f[l[o]])if(/^(constructor$|process$|_)/.test(l[o]))f[l[o]]=
"ignore";else if(k=Object.getOwnPropertyDescriptor(e,l[o]),"function"===typeof k.value)f[l[o]]="function";else if(k.get||k.set)f[l[o]]="property";e=Object.getPrototypeOf(e)}a.meta=f;b._.emit("init");return b},s=function(){return o.apply(null,arguments)},p=s.fn={},r=s.modules={};p.SignalArray=Float32Array;p.currentTimeIncr=0;p.emptycell=null;(function(){var a={};r.ready=function(c,f){a[c]=f};r.ready.done=function(c,f){var b=a[c];b&&b(f);delete a[c]}})();Object.defineProperties(s,{version:{get:function(){return"WORKING"}},
envtype:{get:function(){return a}},envmobile:{get:function(){return f}},env:{get:function(){return b.impl.env}},samplerate:{get:function(){return b.samplerate}},channels:{get:function(){return b.channels}},cellsize:{get:function(){return b.cellsize}},currentTime:{get:function(){return b.currentTime}},isPlaying:{get:function(){return 1===b.status}},isRecording:{get:function(){return 2===b.status}},amp:{set:function(a){"number"===typeof a&&(b.amp=a)},get:function(){return b.amp}}});s.bind=function(a,
c){b.bind(a,c);return s};s.setup=function(a){b.setup(a);return s};s.play=function(){b.play();return s};s.pause=function(){b.pause();return s};s.reset=function(){b.reset();b.events.emit("reset");return s};s.on=function(a,c){b.on(a,c);return s};s.addListener=s.on;s.once=function(a,c){b.once(a,c);return s};s.off=function(a,c){b.removeListener(a,c);return s};s.removeListener=s.off;s.removeAllListeners=function(a){b.removeAllListeners(a);return s};s.listeners=function(a){return b.listeners(a)};s.rec=function(){return b.rec.apply(b,
arguments)};s.use=function(a){g(l[a])&&l[a].forEach(function(a){a()});return this};s.timevalue=function(a){var c;if(c=/^(\d+(?:\.\d+)?)Hz$/i.exec(a))return 0===+c[1]?0:1E3/+c[1];if(c=/^bpm(\d+(?:\.\d+)?)?\s*(?:l(\d+))?(\.*)$/i.exec(a)){a=c[1];if(a===h)a=120;else if(a=+c[1],5>a||300<a)a=120;var f=c[2]?c[2]|0:4;return 0===a||0===f?0:c=1E3*(60/a*(4/f))*([1,1.5,1.75,1.875][(c[3]||"").length]||1)}if(c=/^bpm(\d+(?:\.\d+)?)?\s*(\d+)\.(\d+)\.(\d+)$/i.exec(a)){a=c[1];if(a===h)a=120;else if(a=+c[1],5>a||300<
a)a=120;c=1920*(c[2]|0)+480*(c[3]|0)+(c[4]|0);return 1E3*60/a*(c/480)}if(c=/^(\d+(?:\.\d+)?)secs?$/i.exec(a))return 1E3*+c[1];if(c=/^(\d+(?:\.\d+)?)mins?$/i.exec(a))return 6E4*+c[1];if(c=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(a))return a=3600*(c[1]|0)+60*(c[2]|0)+(c[3]|0),a=1E3*a+(((c[4]||"")+"00").substr(0,3)|0);if(c=/^bpm(\d+(?:\.\d+)?)?\s*(?:(\d+)ticks)?$/i.exec(a)){a=c[1];if(a===h)a=120;else if(a=+c[1],5>a||300<a)a=120;c=c[2]?c[2]|0:480;return 0===a?
0:1E3*60/a*(c/480)}return(c=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(a))?(a=c[2]?c[2]|0:s.samplerate,0===a?0:1E3*((c[1]|0)/a)):(c=/^(\d+)(?:ms)?$/i.exec(a))?c[1]|0:0};p.use=function(a,c){g(l[a])?l[a].push(c):l[a]=[c]};p.isDictionary=j;var n=function(){return this};p.nop=n;var m=function(a,c){function f(){this.constructor=a}var c=c||x,b;for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);f.prototype=c.prototype;a.prototype=new f;a.__super__=c.prototype;return a};p.extend=m;var q=function(a,c){for(var f=a&&a.prototype;f;){if(f===
c.prototype)return!0;f=Object.getPrototypeOf(f)}return!1};p.constructorof=q;p.register=function(a,f){q(f,x)?d[a]=f:c[a]=f};p.alias=function(a,f){d[f]?d[a]=d[f]:c[f]&&(c[a]=c[f])};p.getClass=function(a){return d[a]};p.nextTick=function(a){b.nextTick(a);return s};var u=function(a){a._.ar=!0;a._.aronly=!0};p.fixAR=u;var t=function(a){a._.ar=!1;a._.kronly=!0};p.fixKR=t;var v=function(){var a=this._,a=a.value*a.mul+a.add;isNaN(a)&&(a=0);for(var c=this.cells[0],f=0,b=c.length;f<b;++f)c[f]=a};Object.defineProperty(v,
"unremovable",{value:!0,writable:!1});p.changeWithValue=v;var A=function(){var a=function(a){return function(){-1===b.timers.indexOf(a)&&(b.timers.push(a),b.events.emit("addObject"),a._.emit("start"))}},c=function(a){return function(){var c=b.timers.indexOf(a);-1!==c&&(b.timers.splice(c,1),a._.emit("stop"),b.events.emit("removeObject"))}};return function(f){var d=a(f),l=c(f);f.start=function(){b.nextTick(d);return f};f.stop=function(){b.nextTick(l);return f};return f}}();p.timer=A;A=function(){var a=
function(a){return function(){-1===b.listeners.indexOf(a)&&(b.listeners.push(a),b.events.emit("addObject"),a._.emit("listen"))}},c=function(a){return function(){var c=b.listeners.indexOf(a);-1!==c&&(b.listeners.splice(c,1),a._.emit("unlisten"),b.events.emit("removeObject"))}};return function(f){var d=a(f),l=c(f);f.listen=function(){arguments.length&&f.append.apply(f,arguments);f.nodes.length&&b.nextTick(d);return f};f.unlisten=function(){arguments.length&&f.remove.apply(f,arguments);f.nodes.length||
b.nextTick(l);return f};return f}}();p.listener=A;p.make_onended=function(a,c){return function(){if("number"===typeof c)for(var f=a.cells[0],b=a.cells[1],d=a.cells[2],l=0,k=b.length;l<k;++l)f[0]=b[l]=d[l]=c;a._.isEnded=!0;a._.emit("ended")}};p.inputSignalAR=function(a){var c=a.cells[0],f=a.cells[1],b=a.cells[2],d=a.nodes,l=d.length,k,e=c.length,o=a.tickID,g;if(2===a.numChannels){for(k=e;k;)k-=8,f[k]=f[k+1]=f[k+2]=f[k+3]=f[k+4]=f[k+5]=f[k+6]=f[k+7]=b[k]=b[k+1]=b[k+2]=b[k+3]=b[k+4]=b[k+5]=b[k+6]=b[k+
7]=0;for(a=0;a<l;++a){d[a].process(o);c=d[a].cells[1];g=d[a].cells[2];for(k=e;k;)k-=8,f[k]+=c[k],b[k]+=g[k],f[k+1]+=c[k+1],b[k+1]+=g[k+1],f[k+2]+=c[k+2],b[k+2]+=g[k+2],f[k+3]+=c[k+3],b[k+3]+=g[k+3],f[k+4]+=c[k+4],b[k+4]+=g[k+4],f[k+5]+=c[k+5],b[k+5]+=g[k+5],f[k+6]+=c[k+6],b[k+6]+=g[k+6],f[k+7]+=c[k+7],b[k+7]+=g[k+7]}}else{for(k=e;k;)k-=8,c[k]=c[k+1]=c[k+2]=c[k+3]=c[k+4]=c[k+5]=c[k+6]=c[k+7]=0;for(a=0;a<l;++a){f=d[a].process(o).cells[0];for(k=e;k;)k-=8,c[k]+=f[k],c[k+1]+=f[k+1],c[k+2]+=f[k+2],c[k+
3]+=f[k+3],c[k+4]+=f[k+4],c[k+5]+=f[k+5],c[k+6]+=f[k+6],c[k+7]+=f[k+7]}}};p.inputSignalKR=function(a){for(var c=a.nodes,f=c.length,b=a.tickID,d=0,a=0;a<f;++a)d+=c[a].process(b).cells[0][0];return d};p.outputSignalAR=function(a){var c=a.cells[0],f=a.cells[1],b=a.cells[2],d=a._.mul,k=a._.add;if(2===a.numChannels)for(a=c.length;a;)a-=8,f[a]=f[a]*d+k,b[a]=b[a]*d+k,f[a+1]=f[a+1]*d+k,b[a+1]=b[a+1]*d+k,f[a+2]=f[a+2]*d+k,b[a+2]=b[a+2]*d+k,f[a+3]=f[a+3]*d+k,b[a+3]=b[a+3]*d+k,f[a+4]=f[a+4]*d+k,b[a+4]=b[a+4]*
d+k,f[a+5]=f[a+5]*d+k,b[a+5]=b[a+5]*d+k,f[a+6]=f[a+6]*d+k,b[a+6]=b[a+6]*d+k,f[a+7]=f[a+7]*d+k,b[a+7]=b[a+7]*d+k,c[a]=0.5*(f[a]+b[a]),c[a+1]=0.5*(f[a+1]+b[a+1]),c[a+2]=0.5*(f[a+2]+b[a+2]),c[a+3]=0.5*(f[a+3]+b[a+3]),c[a+4]=0.5*(f[a+4]+b[a+4]),c[a+5]=0.5*(f[a+5]+b[a+5]),c[a+6]=0.5*(f[a+6]+b[a+6]),c[a+7]=0.5*(f[a+7]+b[a+7]);else if(1!==d||0!==k)for(a=c.length;a;)a-=8,c[a]=c[a]*d+k,c[a+1]=c[a+1]*d+k,c[a+2]=c[a+2]*d+k,c[a+3]=c[a+3]*d+k,c[a+4]=c[a+4]*d+k,c[a+5]=c[a+5]*d+k,c[a+6]=c[a+6]*d+k,c[a+7]=c[a+7]*
d+k};p.outputSignalKR=function(a){var c=a.cells[0],f=a.cells[1],b=a.cells[2],d=c[0]*a._.mul+a._.add;if(2===a.numChannels)for(a=c.length;a;)a-=8,c[a]=c[a+1]=c[a+2]=c[a+3]=c[a+4]=c[a+5]=c[a+6]=c[a+7]=f[a]=f[a+1]=f[a+2]=f[a+3]=f[a+4]=f[a+5]=f[a+6]=f[a+7]=b[a]=b[a+1]=b[a+2]=b[a+3]=b[a+4]=b[a+5]=b[a+6]=b[a+7]=d;else for(a=c.length;a;)a-=8,c[a]=c[a+1]=c[a+2]=c[a+3]=c[a+4]=c[a+5]=c[a+6]=c[a+7]=d};p.fix_iOS6_1_problem=function(a){b.fix_iOS6_1_problem(a)};var x=function(){function c(a,f){this._={};var d=this._.events=
new r.EventEmitter(this);this._.emit=function(){return d.emit.apply(d,arguments)};if(j(f[0])){var k=f.shift();this.once("init",function(){this.set(k)})}this.tickID=-1;this.nodes=f.map(s);this.cells=[];this.numChannels=a;switch(a){case 0:this.L=this.R=new D(null);this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new D(this);this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new D(this),this.R=new D(this),this.cells[0]=new p.SignalArray(b.cellsize),
this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this._.ar=!0;this._.mul=1;this._.add=0;this._.dac=null;this._.bypassed=!1;this._.meta={}}var f=c.prototype;Object.defineProperties(f,{isUndefined:{get:function(){return this._.isUndefined}},isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},mul:{set:function(a){"number"===typeof a&&(this._.mul=a,this._.emit("setMul",a))},get:function(){return this._.mul}},add:{set:function(a){"number"===
typeof a&&(this._.add=a,this._.emit("setAdd",a))},get:function(){return this._.add}},dac:{set:function(a){var c=this._;a instanceof F&&c.dac!==a&&(c.dac&&c.dac.remove(this),a.append(this))},get:function(){return this._.dac}}});f.toString=function(){return this.constructor.name};f.valueOf=function(){b.tickID!==this.tickID&&this.process(b.tickID);return this.cells[0][0]};f.append=function(){if(0<arguments.length){var a=i.call(arguments).map(s);this.nodes=this.nodes.concat(a);this._.emit("append",a)}return this};
f.appendTo=function(a){a.append(this);return this};f.remove=function(){if(0<arguments.length){for(var a,c=this.nodes,f=[],b=0,d=arguments.length;b<d;++b)if(-1!==(a=c.indexOf(arguments[b])))f.push(c[a]),c.splice(a,1);0<f.length&&this._.emit("remove",f)}return this};f.removeFrom=function(a){a.remove(this);return this};f.removeAll=function(){var a=this.nodes.slice();this.nodes=[];0<a.length&&this._.emit("remove",a);return this};f.removeAtIndex=function(a){var c=this.nodes[a];c&&(this.nodes.splice(a,
1),this._.emit("remove",[c]));return this};f.on=f.addListener=function(a,c){this._.events.on(a,c);return this};f.once=function(a,c){this._.events.once(a,c);return this};f.off=f.removeListener=function(a,c){this._.events.removeListener(a,c);return this};f.removeAllListeners=function(a){this._.events.removeAllListeners(a);return this};f.listeners=function(a){return this._.events.listeners(a)};f.set=function(a,c){var f,b,d=this._.meta;switch(typeof a){case "string":switch(d[a]){case "property":this[a]=
c;break;case "function":this[a](c);break;default:for(f=this;null!==f;){if(b=Object.getOwnPropertyDescriptor(f,a))if("function"===typeof b.value)d[a]="function",this[a](c);else if(b.get||b.set)d[a]="property",this[a]=c;f=Object.getPrototypeOf(f)}}break;case "object":for(f in a)this.set(f,a[f])}return this};f.get=function(a){if("property"===this._.meta[a])return this[a]};f.bang=function(){this._.emit.apply(this,["bang"].concat(i.call(arguments)));return this};f.process=n;f.bypass=function(){this._.bypassed=
0===arguments.length?!0:!!arguments[0];return this};f.play=function(){var a=this._.dac,c=!1;null===a?(a=this._.dac=new F(this),c=!0):-1===a.nodes.indexOf(this)&&(a.append(this),c=!0);a.play();c&&this._.emit.apply(this,["play"].concat(i.call(arguments)));return this};f.pause=function(){var a=this._.dac;a&&(-1!==a.nodes.indexOf(this)&&(this._.dac=null,a.remove(this),this._.emit("pause")),0===a.nodes.length&&a.pause());return this};f.start=f.stop=f.listen=f.unlisten=function(){return this};f.ar=function(){0===
arguments.length||arguments[0]?this._.kronly||(this._.ar=!0,this._.emit("ar",!0)):this.kr(!0);return this};f.kr=function(){0===arguments.length||arguments[0]?this._.aronly||(this._.ar=!1,this._.emit("ar",!1)):this.ar(!0);return this};f.plot="browser"===a?function(a){var c=this._,f=a.target;if(!f)return this;var b=a.width||f.width||320,d=a.height||f.height||240,k=(a.x||0)+0.5,l=a.y||0,f=f.getContext("2d"),e;e=a.foreground!==h?a.foreground:c.plotForeground||"rgb(  0, 128, 255)";var o;o=a.background!==
h?a.background:c.plotBackground||"rgb(255, 255, 255)";var g=a.lineWidth||c.plotLineWidth||1,s=!!c.plotCyclic,p=c.plotData||this.cells[0],j=a.range||c.plotRange||[-1.2,1.2],i=j[0],j=d/(j[1]-i),r=b/p.length,n,m=p.length;f.save();f.rect(k,l,b,d);null!==o&&(f.fillStyle=o,f.fillRect(k,l,b,d));c.plotBefore&&c.plotBefore.call(this,f,k,l,b,d);if(c.plotBarStyle){f.fillStyle=e;for(o=e=0;o<m;++o)s=(p[o]-i)*j,n=d-s,f.fillRect(e+k,n+l,r,s),e+=r}else{f.strokeStyle=e;f.lineWidth=g;f.beginPath();e=0;g=d-(p[0]-i)*
j;f.moveTo(e+k,g+l);for(o=1;o<m;++o)e+=r,n=d-(p[o]-i)*j,f.lineTo(e+k,n+l);s?f.lineTo(e+r+k,g+l):f.lineTo(e+r+k,n+l);f.stroke()}c.plotAfter&&c.plotAfter.call(this,f,k,l,b,d);if(a=a.border||c.plotBorder)f.strokeStyle="string"===typeof a?a:"#000",f.lineWidth=1,f.strokeRect(k,l,b,d);f.restore();return this}:n;return c}();s.Object=x;var D=function(){function a(c){s.Object.call(this,-1,[]);u(this);this._.parent=c;this.cell=new p.SignalArray(b.cellsize);this.L=this.R=this;this.cells[0]=this.cells[1]=this.cells[2]=
this.cell;this.numChannels=1}m(a);a.prototype.process=function(a){this.tickID!==a&&(this.tickID=a,this._.parent&&this._.parent.process(a));return this};return a}();s.ChannelObject=D;var C=function(){function a(c){x.call(this,1,[]);t(this);this.value=c[0];if(j(c[1])){var f=c[1];this.once("init",function(){this.set(f)})}this.on("setAdd",v);this.on("setMul",v)}m(a);Object.defineProperties(a.prototype,{value:{set:function(a){"number"===typeof a&&(this._.value=isNaN(a)?0:a,v.call(this))},get:function(){return this._.value}}});
return a}(),H=function(){function a(c){x.call(this,1,[]);t(this);this.value=c[0];if(j(c[1])){var f=c[1];this.once("init",function(){this.set(f)})}this.on("setAdd",v);this.on("setMul",v)}m(a);Object.defineProperties(a.prototype,{value:{set:function(a){this._.value=a?1:0;v.call(this)},get:function(){return!!this._.value}}});return a}(),I=function(){function a(c){x.call(this,1,[]);t(this);this.func=c[0];this._.value=0;if(j(c[1])){var f=c[1];this.once("init",function(){this.set(f)})}this.on("setAdd",
v);this.on("setMul",v)}m(a);var c=a.prototype;Object.defineProperties(c,{func:{set:function(a){"function"===typeof a&&(this._.func=a)},get:function(){return this._.func}},args:{set:function(a){this._.args=g(a)?a:[a]},get:function(){return this._.args}}});c.bang=function(){var a=this._,c=i.call(arguments).concat(a.args),c=a.func.apply(this,c);"number"===typeof c&&(a.value=c,v.call(this));this._.emit("bang");return this};return a}(),E=function(){function a(c){x.call(this,1,[]);t(this);if(j(c[1])){var f=
c[1];this.once("init",function(){this.set(f)})}}m(a);Object.defineProperties(a.prototype,{});return a}(),J=function(){function a(c){x.call(this,1,[]);t(this);if(j(c[1])){var f=c[1];this.once("init",function(){this.set(f)})}}m(a);Object.defineProperties(a.prototype,{});return a}(),F=function(){function a(b){x.call(this,2,[]);b instanceof x&&this.nodes.push(b);b=this._;b.isPlaying=!1;b.onplay=c(this);b.onpause=f(this);this.on("append",d)}m(a);var c=function(a){return function(){-1===b.inlets.indexOf(a)&&
(b.inlets.push(a),b.events.emit("addObject"),a._.isPlaying=!0,a._.emit("play"))}},f=function(a){return function(){var c=b.inlets.indexOf(a);-1!==c&&(b.inlets.splice(c,1),a._.isPlaying=!1,a._.emit("pause"),b.events.emit("removeObject"))}},d=function(a){for(var c=0,f=a.length;c<f;++c)a[c]._.dac=this};Object.defineProperty(d,"unremovable",{value:!0,writable:!1});var k=a.prototype;Object.defineProperties(k,{dac:{get:n},isPlaying:{get:function(){return this._.isPlaying}}});k.play=function(){b.nextTick(this._.onplay);
return this};k.pause=function(){b.nextTick(this._.onpause);return this};k.process=function(a){var c=this._,f=this.cells[1],b=this.cells[2],d=this.nodes,k=d.length,l,e=f.length,o=c.add,g=c.mul,s,p;if(this.tickID!==a){this.tickID=a;for(l=0;l<e;++l)f[l]=b[l]=0;for(c=0;c<k;++c){l=d[c];l.process(a);s=l.cells[1];p=l.cells[2];for(l=0;l<e;++l)f[l]+=s[l],b[l]+=p[l]}for(l=0;l<e;++l)f[l]=f[l]*g+o,b[l]=b[l]*g+o}return this};return a}(),A=function(){function a(){this._={};this.context=this;this.tickID=0;this.impl=
null;this.amp=0.8;this.status=e;this.samplerate=44100;this.channels=2;this.cellsize=128;this.streammsec=20;this.currentTime=this.streamsize=0;this.nextTicks=[];this.inlets=[];this.timers=[];this.listeners=[];this._.deferred=null;this.recStart=0;this.recBuffers=null;this.delayProcess=c(this);p.currentTimeIncr=1E3*this.cellsize/this.samplerate;p.emptycell=new p.SignalArray(this.cellsize);var f=this;r.ready("events",function(){f.events=new r.EventEmitter(f);f.reset()})}var c=function(a){return function(){a.recStart=
+new Date;a.process()}},f=[8E3,11025,12E3,16E3,22050,24E3,32E3,44100,48E3],b=[32,64,128,256],d=a.prototype;d.bind=function(a,c){if("function"===typeof a){var f=new a(this,c);"function"===typeof f.play&&"function"===typeof f.pause&&(this.impl=f,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate))}return this};d.setup=function(a){if("object"===typeof a&&(-1!==f.indexOf(a.samplerate)&&(this.samplerate=a.samplerate<=this.impl.maxSamplerate?a.samplerate:this.impl.maxSamplerate),
-1!==b.indexOf(a.cellsize)&&(this.cellsize=a.cellsize),"undefined"!==typeof a.f64))k=!!a.f64,p.SignalArray=k?Float64Array:Float32Array;p.currentTimeIncr=1E3*this.cellsize/this.samplerate;p.emptycell=new p.SignalArray(this.cellsize);return this};d.getAdjustSamples=function(a){a=a||this.samplerate;a=Math.ceil(Math.log(this.streammsec/1E3*a)*Math.LOG2E);return 1<<(8>a?8:14<a?14:a)};d.play=function(){this.status===e&&(this.status=1,this.streamsize=this.getAdjustSamples(),this.strmL=new p.SignalArray(this.streamsize),
this.strmR=new p.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play"));return this};d.pause=function(){1===this.status&&(this.status=e,this.impl.pause(),this.events.emit("pause"));return this};d.reset=function(a){a&&(this._.events=null);this.currentTime=0;this.nextTicks=[];this.inlets=[];this.timers=[];this.listeners=[];this.events.on("addObject",function(){this.status===e&&(this.inlets.length>0||this.timers.length>0||this.listeners.length>0)&&this.play()});this.events.on("removeObject",
function(){this.status===1&&this.inlets.length===0&&(this.timers.length===0&&this.listeners.length===0)&&this.pause()});return this};d.process=function(){var a=this.tickID,c=this.strmL,f=this.strmR,b=this.amp,d,k,l,e=this.streamsize,o=0,g,s,h,j=this.cellsize,i=this.streamsize/this.cellsize,r=this.timers,n=this.inlets,m=this.listeners,t=p.currentTimeIncr;for(l=0;l<e;++l)c[l]=f[l]=0;for(;i--;){++a;g=0;for(s=r.length;g<s;++g)r[g].process(a);g=0;for(s=n.length;g<s;++g){d=n[g];d.process(a);k=d.cells[1];
d=d.cells[2];h=0;for(l=o;h<j;++h,++l)c[l]+=k[h],f[l]+=d[h]}o=l;g=0;for(s=m.length;g<s;++g)m[g].process(a);this.currentTime+=t;k=this.nextTicks.splice(0);g=0;for(s=k.length;g<s;++g)k[g].call(null)}for(l=0;l<e;++l)d=c[l]*b,d=-1>d?-1:1<d?1:d,c[l]=d,d=f[l]*b,d=-1>d?-1:1<d?1:d,f[l]=d;this.tickID=a;a=this.currentTime;if(2===this.status){if(2===this.recCh)this.recBuffers.push(new p.SignalArray(c)),this.recBuffers.push(new p.SignalArray(f));else{b=new p.SignalArray(c.length);l=0;for(e=b.length;l<e;++l)b[l]=
0.5*(c[l]+f[l]);this.recBuffers.push(b)}a>=this.maxDuration?this._.deferred.sub.reject():a>=this.recDuration?this._.deferred.sub.resolve():20<+new Date-this.recStart?setTimeout(this.delayProcess,10):this.process()}};d.nextTick=function(a){this.status===e?a():this.nextTicks.push(a)};d.rec=function(){p.fix_iOS6_1_problem(!0);var a=new r.Deferred(this);if(this._.deferred)return console.warn("rec deferred is exists??"),a.reject().promise();if(this.status!==e)return console.log("status is not none",this.status),
a.reject().promise();var c=0,f=arguments,b=j(f[c])?f[c++]:{},c=f[c];if("function"!==typeof c)return console.warn("no function"),a.reject().promise();this._.deferred=a;this.status=2;this.reset();var d=new F,k=new r.Deferred(this),o=this;k.then(l,function(){p.fix_iOS6_1_problem(!1);l.call(o,!0)});this._.deferred.sub=k;this.savedSamplerate=this.samplerate;this.samplerate=b.samplerate||this.samplerate;this.recDuration=b.recDuration||Infinity;this.maxDuration=b.maxDuration||6E5;this.recCh=b.ch||1;2!==
this.recCh&&(this.recCh=1);this.recBuffers=[];this.streamsize=this.getAdjustSamples();this.strmL=new p.SignalArray(this.streamsize);this.strmR=new p.SignalArray(this.streamsize);this.inlets.push(d);c({done:function(){k.resolve.apply(k,i.call(arguments))},send:function(){d.append.apply(d,arguments)}});setTimeout(this.delayProcess,10);return a.promise()};var l=function(){this.status=e;this.reset();var a=this.recBuffers,c=this.samplerate,f=this.streamsize,b;this.samplerate=this.savedSamplerate;b=Infinity!==
this.recDuration?0.001*this.recDuration*c|0:(a.length>>this.recCh-1)*f;var d=b/f|0,k=0,l=0,o=b;if(2===this.recCh){var g=new p.SignalArray(b),s=new p.SignalArray(b);for(b=0;b<d;++b)if(g.set(a[k++],l),s.set(a[k++],l),l+=f,o-=f,0<o&&o<f){g.set(a[k++].subarray(0,o),l);s.set(a[k++].subarray(0,o),l);break}a={L:{buffer:g,samplerate:c},R:{buffer:s,samplerate:c},samplerate:c}}else{g=new p.SignalArray(b);for(b=0;b<d;++b)if(g.set(a[k++],l),l+=f,o-=f,0<o&&o<f){g.set(a[k++].subarray(0,o),l);break}a={buffer:g,
samplerate:c}}this._.deferred.resolve.apply(this._.deferred,[].concat.apply([a],arguments));this._.deferred=null};d.on=function(a,c){this.events.on(a,c)};d.addListener=d.on;d.once=function(a,c){this.events.once(a,c)};d.removeListener=function(a,c){this.events.removeListener(a,c)};d.removeAllListeners=function(a){this.events.removeListeners(a)};d.listeners=function(a){return this.events.listeners(a)};d.fix_iOS6_1_problem=function(a){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(a)};return a}(),
G=null,G="undefined"!==typeof webkitAudioContext?function(a){var c=new webkitAudioContext,b,d;p._audioContext=c;this.defaultSamplerate=this.maxSamplerate=c.sampleRate;this.env="webkit";var k=navigator.userAgent;k.match(/linux/i)?a.streammsec*=8:k.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(a.streammsec*=4);this.play=function(){var f,k=a.getAdjustSamples(c.sampleRate),l,e,o;if(a.samplerate===c.sampleRate)f=function(c){var f=a.strmL,b=a.strmR,d=c.outputBuffer.getChannelData(0),c=c.outputBuffer.getChannelData(1),
k=d.length;for(a.process();k--;){d[k]=f[k];c[k]=b[k]}};else{e=l=a.streamsize;o=a.samplerate/c.sampleRate;f=function(c){var f=a.strmL,b=a.strmR,d=c.outputBuffer.getChannelData(0),c=c.outputBuffer.getChannelData(1),k,g=d.length;for(k=0;k<g;++k){if(e>=l){a.process();e=e-l}d[k]=f[e|0];c[k]=b[e|0];e=e+o}}}b=c.createBufferSource();d=c.createJavaScriptNode(k,2,a.channels);d.onaudioprocess=f;b.noteOn(0);b.connect(d);d.connect(c.destination)};this.pause=function(){b.disconnect();d.disconnect()};if(f){var l=
0,e=c.createBufferSource();this.fix_iOS6_1_problem=function(a){l=l+(a?1:-1);if(l===1){e.noteOn(0);e.connect(c.destination)}else l===0&&e.disconnect()}}}:"function"===typeof Audio&&"function"===typeof(new Audio).mozSetup?function(a){var c=function(){var a=new Blob(["var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};"],{type:"text/javascript"}),a=URL.createObjectURL(a);return new Worker(a)}();this.maxSamplerate=
48E3;this.defaultSamplerate=44100;this.env="moz";this.play=function(){var f=new Audio,b=new Float32Array(a.streamsize*a.channels),d=a.streammsec,k=0,l=1E3*(a.streamsize/a.samplerate),e=Date.now();f.mozSetup(a.channels,a.samplerate);c.onmessage=function(){if(!(k>Date.now()-e)){var c=a.strmL,d=a.strmR,o=b.length,g=c.length;for(a.process();g--;)b[--o]=d[g],b[--o]=c[g];f.mozWriteAudio(b);k+=l}};c.postMessage(d)};this.pause=function(){c.postMessage(0)}}:function(){this.maxSamplerate=48E3;this.defaultSamplerate=
8E3;this.env="nop";this.pause=this.play=n},b=(new A).bind(G),y=s;"node"===a?module.exports=global.timbre=y:"browser"===a&&(y.noConflict=function(){var a=window.timbre,c=window.T;return function(f){window.T===y&&(window.T=c);f&&window.timbre===y&&(window.timbre=a);return y}}(),window.timbre=window.T=y)})();
(function(h){function i(e){this.samplerate=e||44100;this.frequency=340;this.Q=1;this.b0=this.b1=this.b2=this.a1=this.a2=this.x1=this.x2=this.y1=this.y2=this.gain=0;this.setType("lpf")}var g=i.prototype;g.process=function(e){for(var b,d,c=this.x1,a=this.x2,f=this.y1,k=this.y2,l=this.b0,o=this.b1,g=this.b2,p=this.a1,h=this.a2,j=0,i=e.length;j<i;++j)b=e[j],d=l*b+o*c+g*a-p*f-h*k,e[j]=d,a=c,c=b,k=f,f=d;this.x1=c;this.x2=a;this.y1=f;this.y2=k};g.setType=function(e){var b;if(b=j[e])this.type=e,b.call(this,
this.frequency,this.Q,this.gain)};g.setParams=function(e,b,d){this.frequency=e;this.Q=b;this.gain=d;var c=j[this.type];c&&c.call(this,e,b,d);return this};var j={lowpass:function(e,b){e/=0.5*this.samplerate;if(1<=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{var d=Math.pow(10,0.05*(0>b?0:b)),c=Math.sqrt(0.5*(4-Math.sqrt(16-16/(d*d)))),d=Math.PI*e,c=0.5*c*Math.sin(d),c=0.5*(1-c)/(1+c),d=(0.5+c)*Math.cos(d),a=0.25*(0.5+c-d);this.b0=2*a;this.b1=
4*a;this.b2=this.b0;this.a1=2*-d;this.a2=2*c}},highpass:function(e,b){e/=0.5*this.samplerate;if(1<=e)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var d=Math.pow(10,0.05*(0>b?0:b)),c=Math.sqrt((4-Math.sqrt(16-16/(d*d)))/2),d=Math.PI*e,c=0.5*c*Math.sin(d),c=0.5*(1-c)/(1+c),d=(0.5+c)*Math.cos(d),a=0.25*(0.5+c+d);this.b0=2*a;this.b1=-4*a;this.b2=this.b0;this.a1=2*-d;this.a2=2*c}},bandpass:function(e,b){e/=0.5*this.samplerate;if(0<e&&1>e)if(0<
b){var d=Math.PI*e,c=Math.sin(d)/(2*b),d=Math.cos(d),a=1/(1+c);this.b0=c*a;this.b1=0;this.b2=-c*a;this.a1=-2*d*a;this.a2=(1-c)*a}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(e,b,d){e/=0.5*this.samplerate;b=Math.pow(10,d/40);if(1<=e)this.b0=b*b,this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var e=Math.PI*e,d=0.5*Math.sin(e)*Math.sqrt(0*(b+1/b)+2),e=Math.cos(e),d=2*Math.sqrt(b)*d,c=b+
1,a=b-1,f=1/(c+a*e+d);this.b0=b*(c-a*e+d)*f;this.b1=2*b*(a-c*e)*f;this.b2=b*(c-a*e-d)*f;this.a1=-2*(a+c*e)*f;this.a2=(c+a*e-d)*f}},highshelf:function(e,b,d){e/=0.5*this.samplerate;b=Math.pow(10,d/40);if(1<=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=b*b,this.b1=this.b2=this.a1=this.a2=0;else{var e=Math.PI*e,d=0.5*Math.sin(e)*Math.sqrt(0*(b+1/b)+2),e=Math.cos(e),d=2*Math.sqrt(b)*d,c=b+1,a=b-1,f=1/(c-a*e+d);this.b0=b*(c+a*e+d)*f;this.b1=-2*b*(a+c*e)*f;this.b2=b*(c+a*e-d)*f;this.a1=
2*(a-c*e)*f;this.a2=(c-a*e-d)*f}},peaking:function(e,b,d){e/=0.5*this.samplerate;if(0<e&&1>e)if(d=Math.pow(10,d/40),0<b){var e=Math.PI*e,b=Math.sin(e)/(2*b),e=Math.cos(e),c=1/(1+b/d);this.b0=(1+b*d)*c;this.b1=-2*e*c;this.b2=(1-b*d)*c;this.a1=this.b1;this.a2=(1-b/d)*c}else this.b0=d*d,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(e,b){e/=0.5*this.samplerate;if(0<e&&1>e)if(0<b){var d=Math.PI*e,c=Math.sin(d)/(2*b),d=Math.cos(d),a=1/(1+c);this.b0=a;
this.b1=-2*d*a;this.b2=a;this.a1=this.b1;this.a2=(1-c)*a}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(e,b){e/=0.5*this.samplerate;if(0<e&&1>e)if(0<b){var d=Math.PI*e,c=Math.sin(d)/(2*b),d=Math.cos(d),a=1/(1+c);this.b0=(1-c)*a;this.b1=-2*d*a;this.b2=(1+c)*a;this.a1=this.b1;this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};j.lpf=j.lowpass;j.hpf=j.highpass;j.bpf=j.bandpass;
j.bef=j.notch;j.brf=j.notch;j.apf=j.allpass;h.modules.Biquad=i})(timbre);
(function(h){function i(e){this.samplerate=e;this.buffersize=1<<Math.round(Math.log(0.1*e)*Math.LOG2E);this.buffer=new h.fn.SignalArray(this.buffersize+1);this._wave=this.wave=null;this.writeIndex=this.buffersize>>1;this.readIndex=0;this.delayTime=20;this.rate=4;this.depth=20;this.feedback=0.2;this.wet=0.5;this.phaseIncr=this.phase=0;this.phaseStep=4;this.setWaveType("sin");this.setDelayTime(this.delayTime);this.setRate(this.rate)}var g=i.prototype,j=[];j[0]=function(){for(var e=new Float32Array(512),
b=0;512>b;++b)e[b]=Math.sin(2*Math.PI*(b/512));return e}();j[1]=function(){for(var e=new Float32Array(512),b,d=0;512>d;++d)b=d/512-0.25,e[d]=1-4*Math.abs(Math.round(b)-b);return e}();g.setWaveType=function(e){"sin"===e?(this.wave=e,this._wave=j[0]):"tri"===e&&(this.wave=e,this._wave=j[1])};g.setDelayTime=function(e){this.delayTime=e;for(e=this.writeIndex-(0.001*e*this.samplerate|0);0>e;)e+=this.buffersize;this.readIndex=e};g.setRate=function(e){this.rate=e;this.phaseIncr=512*this.rate/this.samplerate*
this.phaseStep};g.process=function(e){var b=this.buffer,d=this.buffersize,c=d-1,a=this._wave,f=this.phase,k=this.phaseIncr,l=this.writeIndex,o=this.readIndex,g=this.depth,p=this.feedback,h,j,i=this.wet,q=1-i,u,t=e.length,v,A=this.phaseStep;for(u=0;u<t;){j=a[f|0]*g;for(f+=k;512<f;)f-=512;for(v=0;v<A;++v,++u)h=o+d+j&c,h=0.5*(b[h]+b[h+1]),b[l]=e[u]-h*p,e[u]=e[u]*q+h*i,l=l+1&c,o=o+1&c}this.phase=f;this.writeIndex=l;this.readIndex=o;return e};h.modules.Chorus=i})(timbre);
(function(h){function i(b){this.samplerate=b||44100;this.preDelayReadIndex=this.lastPreDelayFrames=0;this.preDelayWriteIndex=e;this.K=this.ykneeThresholdDb=this.kneeThresholdDb=this.kneeThreshold=this.dbKnee=this.dbThreshold=this.linearThreshold=this.slope=this.ratio=-1;this.attackTime=0.003;this.releaseTime=0.25;this.preDelayTime=0.006;this.dbPostGain=0;this.effectBlend=1;this.releaseZone1=0.09;this.releaseZone2=0.16;this.releaseZone3=0.42;this.releaseZone4=0.98;this.detectorAverage=0;this.meteringGain=
this.compressorGain=1;this.preDelayBuffer=new h.fn.SignalArray(g);this.preDelayReadIndex=0;this.preDelayWriteIndex=e;this.maxAttackCompressionDiffDb=-1;this.meteringReleaseK=1-Math.exp(-1/(0.325*this.samplerate));this.setAttackTime(this.attackTime);this.setReleaseTime(this.releaseTime);this.setParams(-24,30,12)}var g=1024,j=g-1,e=256,b=i.prototype;b.setAttackTime=function(b){this.attackTime=Math.max(0.001,b);this._attackFrames=this.attackTime*this.samplerate};b.setReleaseTime=function(b){this.releaseTime=
Math.max(0.001,b);var c=this.releaseTime*this.samplerate;this._satReleaseFrames=0.0025*this.samplerate;var b=c*this.releaseZone1,a=c*this.releaseZone2,f=c*this.releaseZone3,c=c*this.releaseZone4;this._kA=0.9999999999999998*b+1.8432219684323923E-16*a-1.9373394351676423E-16*f+8.824516011816245E-18*c;this._kB=-1.5788320352845888*b+2.3305837032074286*a-0.9141194204840429*f+0.1623677525612032*c;this._kC=0.5334142869106424*b-1.272736789213631*a+0.9258856042207512*f-0.18656310191776226*c;this._kD=0.08783463138207234*
b-0.1694162967925622*a+0.08588057951595272*f-0.00429891410546283*c;this._kE=-0.042416883008123074*b+0.1115693827987602*a-0.09764676325265872*f+0.028494263462021576*c};b.setPreDelayTime=function(b){b*=this.samplerate;b>g-1&&(b=g-1);if(this.lastPreDelayFrames!==b){this.lastPreDelayFrames=b;for(var c=0,a=this.preDelayBuffer.length;c<a;++c)this.preDelayBuffer[c]=0;this.preDelayReadIndex=0;this.preDelayWriteIndex=b}};b.setParams=function(b,c,a){this._k=this.updateStaticCurveParameters(b,c,a);b=1/this.saturate(1,
this._k);b=Math.pow(b,0.6);this._masterLinearGain=Math.pow(10,0.05*this.dbPostGain)*b};b.kneeCurve=function(b,c){return b<this.linearThreshold?b:this.linearThreshold+(1-Math.exp(-c*(b-this.linearThreshold)))/c};b.saturate=function(b,c){var a;b<this.kneeThreshold?a=this.kneeCurve(b,c):(a=this.ykneeThresholdDb+this.slope*((b?20*Math.log(b)*Math.LOG10E:-1E3)-this.kneeThresholdDb),a=Math.pow(10,0.05*a));return a};b.slopeAt=function(b,c){if(b<this.linearThreshold)return 1;var a=1.001*b,f=b?20*Math.log(b)*
Math.LOG10E:-1E3,k=a?20*Math.log(a)*Math.LOG10E:-1E3,l=this.kneeCurve(b,c),a=this.kneeCurve(a,c),l=l?20*Math.log(l)*Math.LOG10E:-1E3;return((a?20*Math.log(a)*Math.LOG10E:-1E3)-l)/(k-f)};b.kAtSlope=function(b){for(var c=Math.pow(10,0.05*(this.dbThreshold+this.dbKnee)),a=0.1,f=1E4,k=0;15>k;++k)this.slopeAt(c,5)<b?f=5:a=5;return Math.sqrt(a*f)};b.updateStaticCurveParameters=function(b,c,a){this.dbThreshold=b;this.linearThreshold=Math.pow(10,0.05*b);this.dbKnee=c;this.ratio=a;this.slope=1/this.ratio;
a=this.kAtSlope(1/this.ratio);this.kneeThresholdDb=b+c;this.kneeThreshold=Math.pow(10,0.05*this.kneeThresholdDb);this.ykneeThresholdDb=(b=this.kneeCurve(this.kneeThreshold,a))?20*Math.log(b)*Math.LOG10E:-1E3;return this.K=a};b.process=function(b){for(var c=1-this.effectBlend,a=this.effectBlend,f=this._k,k=this._masterLinearGain,l=this._satReleaseFrame,e=this._kA,g=this._kB,p=this._kC,h=this._kD,i=this._kE,m=b.length/64,q=0,u=this.detectorAverage,t=this.compressorGain,v=this.maxAttackCompressionDiffDb,
A=1/this._attackFrames,x=this.preDelayReadIndex,D=this.preDelayWriteIndex,C=this.detectorAverage,H=this.preDelayBuffer,I=this.preDelayBuffer,E=this.meteringGain,J=this.meteringReleaseK,F=0;F<m;++F){var G=Math.asin(u)/(0.5*Math.PI),y;y=G>t;var z=t/G,z=z?20*Math.log(z)*Math.LOG10E:-1E3;if(y)v=-1,z=-12>z?0:0<z?3:0.25*(z+12),y=z*z,y=Math.pow(10,0.05*(5/(e+g*z+p*y+h*y*z+i*y*y)));else{if(-1===v||v<z)v=z;z=0.25/Math.max(0.5,v);y=1-Math.pow(z,A)}for(z=64;z--;){var B=0,w=b[q];H[D]=w;0>w&&(w*=-1);B<w&&(B=w);
0>B&&(B*=-1);w=this.saturate(B,f);w=(B=1.0E-4>=B?1:w/B)?-20*Math.log(B)*Math.LOG10E:1E3;2>w&&(w=2);w=Math.pow(10,0.05*(w/l))-1;C+=(B-C)*(B>C?w:1);1<C&&(C=1);1>y?t+=(G-t)*y:(t*=y,1<t&&(t=1));w=Math.sin(0.5*Math.PI*t);B=c+a*k*w;w=20*Math.log(w)*Math.LOG10E;E=w<E?w:E+(w-E)*J;b[q]=I[x]*B;q++;x=x+1&j;D=D+1&j}1.0E-6>C&&(C=1.0E-6);1.0E-6>t&&(t=1.0E-6)}this.preDelayReadIndex=x;this.preDelayWriteIndex=D;this.detectorAverage=C;this.compressorGain=t;this.maxAttackCompressionDiffDb=v;this.meteringGain=E};b.reset=
function(){this.detectorAverage=0;this.meteringGain=this.compressorGain=1;for(var b=0,c=this.preDelayBuffer.length;b<c;++b)this.preDelayBuffer[b]=0;this.preDelayReadIndex=0;this.preDelayWriteIndex=e;this.maxAttackCompressionDiffDb=-1};h.modules.Compressor=i})(timbre);
(function(h){function i(){}i.prototype.decode=function(g,h,e){if("string"===typeof g){if(/\.wav$/.test(g))return i.wav_decode(g,h,e);if(i.ogg_decode&&/\.ogg$/.test(g))return i.ogg_decode(g,h,e);if(i.mp3_decode&&/\.mp3$/.test(g))return i.mp3_decode(g,h,e)}if(i.webkit_decode)return i.webkit_decode(g,h,e);if(i.moz_decode)return i.moz_decode(g,h,e);h(!1)};h.modules.Decoder=i;i.getBinaryWithPath="browser"===h.envtype?function(g,j){h.fn.fix_iOS6_1_problem(!0);var e=new XMLHttpRequest;e.open("GET",g,!0);
e.responseType="arraybuffer";e.onload=function(){if(200===e.status)if(e.response)j(new Uint8Array(e.response));else{if(void 0!==e.responseBody){var b=VBArray(e.responseBody).toArray(),d,c=b.length,a=Array(c);for(d=0;d<c;++d)a[d]=b[d];j(new Uint8Array(a))}}else j(e.status+" "+e.statusText);h.fn.fix_iOS6_1_problem(!1)};e.send()}:function(g,h){h("no support")};i.wav_decode=function(g,h,e){i.getBinaryWithPath(g,function(b){if(82!==b[0]||(73!==b[1]||70!==b[2]||70!==b[3])||b[4]+(b[5]<<8)+(b[6]<<16)+(b[7]<<
24)+8!==b.length||87!==b[8]||65!==b[9]||86!==b[10]||69!==b[11]||102!==b[12]||109!==b[13]||116!==b[14]||32!==b[15])return h(!1);var d=b[22]+(b[23]<<8),c=b[24]+(b[25]<<8)+(b[26]<<16)+(b[27]<<24),a=b[34]+(b[35]<<8);if(100!==b[36]||97!==b[37]||116!==b[38]||97!==b[39])return h(!1);var f=b[40]+(b[41]<<8)+(b[42]<<16)+(b[43]<<24),k=(f/d>>1)/c;if(f>b.length-44)return h(!1);f=new Float32Array(k*c|0);h({samplerate:c,buffer:f,duration:k});if(8===a)b=new Int8Array(b.buffer,44);else if(16===a)b=new Int16Array(b.buffer,
44);else if(32===a)b=new Int32Array(b.buffer,44);else if(24===a){for(var b=new Uint8Array(b.buffer,44),l,o,g,c=new Int32Array(b.length/3),k=0,p=b.length,i=0;k<p;)l=b[k++],o=b[k++],g=b[k++],l=l+(o<<8)+(g<<16),l=l&8388608?-((l^16777215)+1):l,c[i++]=l;b=c}if(2===d){d=b;b=new d.constructor(d.length>>1);p=b.length;for(c=k=0;k<p;++k,c+=2)b[k]=0.5*(d[c]+d[c+1])}a=1/((1<<a-1)-1);d=0;for(c=f.length;d<c;++d)f[d]=b[d]*a;e()})};i.webkit_decode=function(){if("undefined"!==typeof webkitAudioContext){var g=h.fn._audioContext,
j=function(e,b,d){var c;if("string"===typeof e)return d(!1);try{c=g.createBuffer(e.buffer,!0)}catch(a){return b(!1)}e=g.sampleRate;c=c.getChannelData(0);b({samplerate:e,buffer:c,duration:c.length/e});d()};return function(e,b,d){if(e instanceof File){var c=new FileReader;c.onload=function(a){j(new Uint8Array(a.target.result),b,d)};c.readAsArrayBuffer(e)}else i.getBinaryWithPath(e,function(a){j(a,b,d)})}}}();i.moz_decode=function(){if("function"===typeof Audio&&"function"===typeof(new Audio).mozSetup)return function(g,
h,e){var b,d,c,a=0,f=new Audio(g);f.volume=0;f.speed=4;f.addEventListener("loadedmetadata",function(){b=f.mozSampleRate;d=f.duration;c=new Float32Array(f.duration*b|0);2===f.mozChannels?f.addEventListener("MozAudioAvailable",function(f){for(var f=f.frameBuffer,b=0,d=f.length;b<d;b+=2)c[a++]=0.5*(f[b]+f[b+1])},!1):f.addEventListener("MozAudioAvailable",function(f){for(var f=f.frameBuffer,b=0,d=f.length;b<d;++b)c[a++]=f[b]},!1);f.play();setTimeout(function(){h({samplerate:b,buffer:c,duration:d})},1E3)},
!1);f.addEventListener("ended",function(){e()},!1);f.load()}}()})(timbre);
(function(h){function i(c){this.context=c.context;this.then=c.then;this.done=function(){c.done.apply(c,arguments);return this};this.fail=function(){c.fail.apply(c,arguments);return this};this.pipe=function(){return c.pipe.apply(c,arguments)};this.always=function(){c.always.apply(c,arguments);return this};this.promise=function(){return this};this.isResolved=function(){return c.isResolved()};this.isRejected=function(){return c.isRejected()}}function g(c){this.context=c||this;this._state="pending";this._doneList=
[];this._failList=[];this._promise=new i(this)}var j=[].slice,e=function(c){return c&&"function"===typeof c.promise},b=g.prototype,d=function(c,a,f,b){if("pending"===this._state){this._state=c;for(var c=0,d=a.length;c<d;++c)a[c].apply(f,b);this._doneList=this._failList=null}};b.resolve=function(){var c=j.call(arguments,0);d.call(this,"resolved",this._doneList,this.context||this,c);return this};b.resolveWith=function(c){var a=j.call(arguments,1);d.call(this,"resolved",this._doneList,c,a);return this};
b.reject=function(){var c=j.call(arguments,0);d.call(this,"rejected",this._failList,this.context||this,c);return this};b.rejectWith=function(c){var a=j.call(arguments,1);d.call(this,"rejected",this._failList,c,a);return this};b.promise=function(){return this._promise};b.done=function(){for(var c=j.call(arguments),a="resolved"===this._state,f="pending"===this._state,b=this._doneList,d=0,e=c.length;d<e;++d)if("function"===typeof c[d])if(a)c[d]();else f&&b.push(c[d]);return this};b.fail=function(){for(var c=
j.call(arguments),a="rejected"===this._state,f="pending"===this._state,b=this._failList,d=0,e=c.length;d<e;++d)if("function"===typeof c[d])if(a)c[d]();else f&&b.push(c[d]);return this};b.always=function(){this.done.apply(this,arguments);this.fail.apply(this,arguments);return this};b.then=function(c,a){return this.done(c).fail(a)};b.pipe=function(c,a){var f=this,b=new g(this.context);this.done(function(){var a=c.apply(f.context,arguments);e(a)?a.then(function(){var c=j.call(arguments);b.resolveWith.apply(b,
[a].concat(c))}):b.resolveWith(f,a)});this.fail(function(){if("function"===typeof a){var c=a.apply(f.context,arguments);e(c)&&c.fail(function(){var a=j.call(arguments);b.rejectWith.apply(b,[c].concat(a))})}else b.reject.apply(b,arguments)});return b.promise()};b.isResolved=function(){return"resolved"===this._state};b.isRejected=function(){return"rejected"===this._state};b.state=function(){return this._state};g.when=function(c){var a=0,f=j.call(arguments),b=f.length,d=b;1===b&&!e(c)&&(d=0);var o=1===
d?c:new g,s=function(a,c){return function(f){c[a]=1<arguments.length?j.call(arguments):f;--d||o.resolve.apply(o,c)}};if(1<b)for(var p=Array(b),h=function(){o.reject()};a<b;++a)f[a]&&e(f[a])?f[a].promise().done(s(a,p)).fail(h):(p[a]=f[a],--d);d||o.resolve.apply(o,f);return o.promise()};h.modules.Deferred=g})(timbre);
(function(h){function i(a){this.samplerate=a||44100;this.value=j;this.status=o;this.curve="linear";this.step=1;this.emit=this.loopNode=this.releaseNode=null;this._envValue=new g(a);this._table=[];this._initValue=j;this._curveValue=0;this._defaultCurveType=b;this._counter=this._index=0}function g(a){this.samplerate=a;this.value=j;this.step=1;this._curveType=b;this._y2=this._y1=this._b1=this._a2=this._grow=this._curveValue=0}var j=i.ZERO=1.0E-6,e=i.CurveTypeSet=0,b=i.CurveTypeLin=1,d=i.CurveTypeExp=
2,c=i.CurveTypeSin=3,a=i.CurveTypeWel=4,f=i.CurveTypeCurve=5,k=i.CurveTypeSqr=6,l=i.CurveTypeCub=7,o=i.StatusWait=0,s=i.StatusGate=1,p=i.StatusSustain=2,r=i.StatusRelease=3,n=i.StatusEnd=4,m={set:e,lin:b,linear:b,exp:d,exponential:d,sin:c,sine:c,wel:a,welch:a,sqr:k,squared:k,cub:l,cubed:l};i.CurveTypeDict=m;var q=i.prototype;q.clone=function(){var a=new i(this.samplerate);a._table=this._table;a._initValue=this._initValue;a.setCurve(this.curve);null!==this.releaseNode&&a.setReleaseNode(this.releaseNode+
1);null!==this.loopNode&&a.setLoopNode(this.loopNode+1);a.setStep(this.step);a.reset();return a};q.setTable=function(a){this._initValue=a[0];this._table=a.slice(1);this.value=this._envValue.value=this._initValue;this._counter=this._index=0;this.status=o};q.setCurve=function(a){"number"===typeof a?(this._defaultCurveType=f,this._curveValue=a):this._defaultCurveType=m[a]||null;this.curve=a};q.setReleaseNode=function(a){"number"===typeof a&&0<a&&(this.releaseNode=a-1)};q.setLoopNode=function(a){"number"===
typeof a&&0<a&&(this.loopNode=a-1)};q.setStep=function(a){this.step=this._envValue.step=a};q.reset=function(){this.value=this._envValue.value=this._initValue;this._counter=this._index=0;this.status=o};q.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=r)};q.getInfo=function(a){var c=this._table,f,b,d=0,k=Infinity,l=Infinity,e=!1;f=0;for(b=c.length;f<b;++f){this.loopNode===f&&(k=d);this.releaseNode===f&&(l=d=d<a?d+a:a);var o=c[f];Array.isArray(o)&&(d+=o[1])}Infinity!==k&&Infinity===
l&&(d+=a,e=!0);return{totalDuration:d,loopBeginTime:k,releaseBeginTime:l,isEndlessLoop:e}};q.calcStatus=function(){var a=this.status,c=this._table,d=this._index,k=this._counter,l=this._curveValue,e=this._defaultCurveType,o=this.loopNode,g=this.releaseNode,h=this._envValue,j,i,m=null;switch(a){case s:case r:for(;0>=k;)d>=c.length?a===s&&null!==o?d=o:(a=n,k=Infinity,m="ended"):a===s&&d===g?null!==o&&o<g?d=o:(a=p,k=Infinity,m="sustained"):(j=c[d++],k=j[0],i=null===j[2]?e:j[2],i===f&&(l=j[3],0.001>Math.abs(l)&&
(i=b)),j=j[1],k=h.setNext(k,j,i,l))}this.status=a;this.emit=m;this._index=d;this._counter=k;return a};q.next=function(){this.calcStatus()&1&&(this.value=this._envValue.next()||j);this._counter-=1;return this.value};q.process=function(a){var c=this._envValue,f,b=a.length;if(this.calcStatus()&1)for(f=0;f<b;++f)a[f]=c.next()||j;else{c=this.value||j;for(f=0;f<b;++f)a[f]=c}this.value=a[b-1];this._counter-=a.length};g.prototype.setNext=function(o,g,s,p){var h=this.value,j,i,r,n,m,g=0.001*g*this.samplerate/
this.step|0;1>g&&(g=1,s=e);switch(s){case e:this.value=o;break;case b:j=(o-h)/g;break;case d:j=0!==h?Math.pow(o/h,1/g):0;break;case c:p=Math.PI/g;i=0.5*(o+h);r=2*Math.cos(p);n=0.5*(o-h);m=n*Math.sin(0.5*Math.PI-p);break;case a:p=0.5*Math.PI/g;r=2*Math.cos(p);o>=h?(i=h,n=0,m=-Math.sin(p)*(o-h)):(i=o,n=h-o,m=Math.cos(p)*(h-o));break;case f:o=(o-h)/(1-Math.exp(p));i=h+o;r=o;j=Math.exp(p/g);break;case k:n=Math.sqrt(h);m=Math.sqrt(o);j=(m-n)/g;break;case l:n=Math.pow(h,0.33333333),m=Math.pow(o,0.33333333),
j=(m-n)/g}this.next=u[s];this._grow=j;this._a2=i;this._b1=r;this._y1=n;this._y2=m;return g};var u=[];u[e]=function(){return this.value};u[b]=function(){return this.value+=this._grow};u[d]=function(){return this.value*=this._grow};u[c]=function(){var a=this._b1*this._y1-this._y2;this.value=this._a2-a;this._y2=this._y1;this._y1=a;return this.value};u[a]=function(){var a=this._b1*this._y1-this._y2;this.value=this._a2+a;this._y2=this._y1;this._y1=a;return this.value};u[f]=function(){this._b1*=this._grow;
return this.value=this._a2-this._b1};u[k]=function(){this._y1+=this._grow;return this.value=this._y1*this._y1};u[l]=function(){this._y1+=this._grow;return this.value=this._y1*this._y1*this._y1};g.prototype.next=u[e];h.modules.Envelope=i;h.modules.EnvelopeValue=g})(timbre);
(function(h){function i(b){this.context=b;this._||(this._={})}var g=Array.isArray,j=[].slice,e=i.prototype;e.emit=function(b){var d=this._;if(!d.events)return!1;var c=d.events[b];if(!c)return!1;if("function"===typeof c){switch(arguments.length){case 1:c.call(this.context);break;case 2:c.call(this.context,arguments[1]);break;case 3:c.call(this.context,arguments[1],arguments[2]);break;default:d=j.call(arguments,1),c.apply(this.context,d)}return!0}if(g(c)){for(var d=j.call(arguments,1),c=c.slice(),a=
0,f=c.length;a<f;++a)c[a]instanceof h.Object?c[a].bang.apply(c[a],d):c[a].apply(this.context,d);return!0}if(c instanceof h.Object)d=j.call(arguments,1),c.bang.apply(c,d);else return!1};e.addListener=function(b,d){if("function"!==typeof d&&!(d instanceof h.Object))throw Error("addListener takes instances of Function or timbre.Object");var c=this._;c.events||(c.events={});c.events[b]?g(c.events[b])?c.events[b].push(d):c.events[b]=[c.events[b],d]:c.events[b]=d;return this};e.on=e.addListener;e.once=
function(b,d){var c=this,a;if("function"===typeof d)a=function(){c.removeListener(b,a);d.apply(c.context,arguments)};else if(d instanceof h.Object)a=function(){c.removeListener(b,a);d.bang.apply(d,arguments)};else throw Error("once takes instances of Function or timbre.Object");a.listener=d;c.on(b,a);return this};e.removeListener=function(b,d){if("function"!==typeof d&&!(d instanceof h.Object))throw Error("removeListener takes instances of Function or timbre.Object");var c=this._;if(!c.events||!c.events[b])return this;
var a=c.events[b];if(g(a)){for(var f=-1,k=0,l=a.length;k<l;++k)if(a[k]===d||a[k].listener&&a[k].listener===d){f=k;break}if(0>f)return this;a.splice(f,1);0===a.length&&(c.events[b]=null)}else if(a===d||a.listener&&a.listener===d)c.events[b]=null;return this};e.removeAllListeners=function(b){var d=this._;if(!d.events)return this;var c=!1,a=d.events[b];if(g(a))for(var f=a.length;f--;){var k=a[f];k.unremovable?c=!0:this.removeListener(b,k)}else a&&(a.unremovable?c=!0:this.removeListener(b,a));c||(d.events[b]=
null);return this};e.listeners=function(b){var d=this._;if(!d.events||!d.events[b])return[];d=d.events[b];if(!g(d))return d.unremovable?[]:[d];for(var d=d.slice(),b=[],c=0,a=d.length;c<a;++c)d[c].unremovable||b.push(d[c]);return b};h.modules.EventEmitter=i;h.modules.ready.done("events")})(timbre);
(function(h){function i(b){this.length=b=1<<Math.ceil(Math.log("number"===typeof b?b:512)*Math.LOG2E);this.buffer=new h.fn.SignalArray(b);this.real=new h.fn.SignalArray(b);this.imag=new h.fn.SignalArray(b);this._real=new h.fn.SignalArray(b);this._imag=new h.fn.SignalArray(b);this.mag=new h.fn.SignalArray(b>>1);this.minDecibels=-30;this.maxDecibels=-100;b=j.get(b);this._bitrev=b.bitrev;this._sintable=b.sintable;this._costable=b.costable}var g=i.prototype;g.setWindow=function(b){if("string"===typeof b){var d=
/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(b);if(null!==d){var c=d[1].toLowerCase(),d=void 0!==d[2]?+d[2]:0.25;if(c=e[c]){this._window||(this._window=new h.fn.SignalArray(this.length));for(var a=this._window,f=0,k=this.length,d=0>d?0:1<d?1:d;f<k;++f)a[f]=c(f,k,d);this.windowName=b}}}};g.forward=function(b){var d=this.buffer,c=this.real,a=this.imag,f=this._window,k=this._bitrev,l=this._sintable,e=this._costable,g=d.length,h,j,i,m,q,u,t;if(f)for(h=0;h<g;++h)d[h]=b[h]*f[h];else d.set(b);for(h=0;h<g;++h)c[h]=
d[k[h]],a[h]=0;for(d=1;d<g;d=f){k=0;f=d+d;j=g/f;for(b=0;b<d;b++){i=e[k];m=l[k];for(h=b;h<g;h+=f)q=h+d,u=m*a[q]+i*c[q],t=i*a[q]-m*c[q],c[q]=c[h]-u,c[h]+=u,a[q]=a[h]-t,a[h]+=t;k+=j}}l=this.mag;for(h=0;h<g;++h)e=c[h],b=a[h],l[h]=Math.sqrt(e*e+b*b);return{real:c,imag:a}};g.inverse=function(b,d){var c=this.buffer,a=this._real,f=this._imag,k=this._bitrev,l=this._sintable,e=this._costable,g=c.length,h,j,i,m,q,u,t,v,A,x;for(h=0;h<g;++h)j=k[h],a[h]=+b[j],f[h]=-d[j];for(k=1;k<g;k=i){m=0;i=k+k;q=g/i;for(j=0;j<
k;j++){u=e[m];t=l[m];for(h=j;h<g;h+=i)v=h+k,A=t*f[v]+u*a[v],x=u*f[v]-t*a[v],a[v]=a[h]-A,a[h]+=A,f[v]=f[h]-x,f[h]+=x;m+=q}}for(h=0;h<g;++h)c[h]=a[h]/g;return c};g.getFrequencyData=function(b){var d=this.minDecibels,c,a=Math.min(this.mag.length,b.length);if(a){var f,k=this.mag,l=0;for(c=0;c<a;++c)f=k[c],b[c]=!f?d:20*Math.log(f)*Math.LOG10E,l<b[c]&&(l=b[c])}return b};var j={get:function(b){var d;if(!(d=j[b])){var c,a,f,k;d=new Int16Array(b);k=b>>1;for(c=a=0;;){d[c]=a;if(++c>=b)break;for(f=k;f<=a;)a-=
f,f>>=1;a+=f}a=Math.floor(Math.log(b)/Math.LN2);c=new h.fn.SignalArray((1<<a)-1);k=new h.fn.SignalArray((1<<a)-1);var l=2*Math.PI;a=0;for(f=c.length;a<f;++a)c[a]=Math.sin(l*(a/b)),k[a]=Math.cos(l*(a/b));d=j[b]={bitrev:d,sintable:c,costable:k}}return d}},e=function(){var b=Math.PI,d=2*Math.PI,c=Math.abs,a=Math.pow,f=Math.cos,k=Math.sin,l=Math.E;return{rectangular:function(){return 1},hann:function(a,c){return 0.5*(1-f(d*a/(c-1)))},hamming:function(a,c){return 0.54-0.46*f(d*a/(c-1))},tukery:function(a,
c,d){return a<d*(c-1)/2?0.5*(1+f(b*(2*a/(d*(c-1))-1))):(c-1)*(1-d/2)<a?0.5*(1+f(b*(2*a/(d*(c-1))-2/d+1))):1},cosine:function(a,c){return k(b*a/(c-1))},lanczos:function(a,c){return k(b*(2*a/(c-1)-1))/(b*(2*a/(c-1)-1))},triangular:function(a,f){return 2/(f+1)*((f+1)/2-c(a-(f-1)/2))},bartlett:function(a,f){return 2/(f-1)*((f-1)/2-c(a-(f-1)/2))},gaussian:function(c,f,b){return a(l,-0.5*a((c-(f-1)/2)/(b*(f-1)/2),2))},bartlettHann:function(a,b){return 0.62-0.48*c(a/(b-1)-0.5)-0.38*f(d*a/(b-1))},blackman:function(a,
c,k){var l=k/2;return(1-k)/2-0.5*f(d*a/(c-1))+l*f(4*b*a/(c-1))}}}();h.modules.FFT=i})(timbre);
(function(h){function i(c){this.samplerate=c||44100;this.wave=null;this.step=1;this.phase=this.value=this.frequency=0;this.feedback=!1;this._lastouts=this._x=0;this._coeff=g/this.samplerate;this._radtoinc=g/(2*Math.PI)}var g=1024,j=g-1,e=i.prototype;e.setWave=function(c){var a,f,d=this.wave;this.wave||(this.wave=new Float32Array(g+1));if("function"===typeof c)for(a=0;a<g;++a)d[a]=c(a/g);else if(c instanceof Float32Array)if(c.length===d.length)d.set(c);else{f=c.length/g;for(a=0;a<g;++a)d[a]=c[a*f|
0]}else"string"===typeof c&&void 0!==(f=b(c))&&this.wave.set(f);this.wave[g]=this.wave[0]};e.reset=function(){this._x=0};e.next=function(){var c=this._x;this.value=this.wave[(c+this.phase*this._radtoinc|0)&j];c+=this.frequency*this._coeff*this.step;c>g&&(c-=g);this._x=c;return this.value};e.process=function(c){var a=this.wave,f=this._radtoinc,b,d=this._x,e,h,p=this.frequency*this._coeff,i,n=this.step;if(this.feedback){e=this._lastouts;f*=this.phase;for(i=0;i<n;++i)b=d+e*f,e=b|0,b-=e,e&=j,h=a[e],e=
a[e+1],c[i]=e=h+b*(e-h),d+=p;this._lastouts=e}else{f*=this.phase;for(i=0;i<n;++i)b=d+f,e=b|0,b-=e,e&=j,h=a[e],e=a[e+1],c[i]=h+b*(e-h),d+=p}d>g&&(d-=g);this._x=d;this.value=c[c.length-1]};e.processWithFreqArray=function(c,a){var f=this.wave,b=this._radtoinc,d,e=this._x,h,p,i=this._coeff,n,m=this.step;if(this.feedback){h=this._lastouts;b*=this.phase;for(n=0;n<m;++n)d=e+h*b,h=d|0,d-=h,h&=j,p=f[h],h=f[h+1],c[n]=h=p+d*(h-p),e+=a[n]*i;this._lastouts=h}else{b=this.phase*this._radtoinc;for(n=0;n<m;++n)d=
e+b,h=d|0,d-=h,h&=j,p=f[h],h=f[h+1],c[n]=p+d*(h-p),e+=a[n]*i}e>g&&(e-=g);this._x=e;this.value=c[c.length-1]};e.processWithPhaseArray=function(c,a){var f=this.wave,b=this._radtoinc,d,e=this._x,h,i,r=this.frequency*this._coeff,n,m=this.step;if(this.feedback){h=this._lastouts;b*=this.phase;for(n=0;n<m;++n)d=e+h*b,h=d|0,d-=h,h&=j,i=f[h],h=f[h+1],c[n]=h=i+d*(h-i),e+=r;this._lastouts=h}else for(n=0;n<m;++n)d=e+a[n]*b,h=d|0,d-=h,h&=j,i=f[h],h=f[h+1],c[n]=i+d*(h-i),e+=r;e>g&&(e-=g);this._x=e;this.value=c[c.length-
1]};e.processWithFreqAndPhaseArray=function(c,a,f){var b=this.wave,d=this._radtoinc,e,h=this._x,i,r,n=this._coeff,m,q=this.step;if(this.feedback){f=this._lastouts;d*=this.phase;for(m=0;m<q;++m)e=h+f*d,i=e|0,e-=i,i&=j,r=b[i],i=b[i+1],c[m]=f=r+e*(i-r),h+=a[m]*n;this._lastouts=f}else for(m=0;m<q;++m)e=h+f[m]*g,i=e|0,e-=i,i&=j,r=b[i],i=b[i+1],c[m]=r+e*(i-r),h+=a[m]*n;h>g&&(h-=g);this._x=h;this.value=c[c.length-1]};var b=function(c){var a=d[c];if(void 0!==a)return"function"===typeof a&&(a=a()),a;var f;
f=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(c);if(null!==f){var a=f[1],b=f[3],l=f[4];f=d[f[2]];var e,g;if(void 0===f)a=void 0;else{"function"===typeof f&&(f=f());switch(b){case "@1":for(e=512;1024>e;++e)f[e]=0;break;case "@2":for(e=512;1024>e;++e)f[e]=Math.abs(f[e]);break;case "@3":for(e=256;512>e;++e)f[e]=0;for(e=512;768>e;++e)f[e]=Math.abs(f[e]);for(e=768;1024>e;++e)f[e]=0;break;case "@4":b=new Float32Array(1024);for(e=0;512>e;++e)b[e]=f[e<<1];f=b;break;case "@5":b=new Float32Array(1024);
for(e=0;512>e;++e)b[e]=Math.abs(f[e<<1]);f=b}if(void 0!==l&&50!==l){l*=0.01;l=0>l?0:1<l?1:l;b=new Float32Array(1024);l=1024*l|0;for(e=0;e<l;++e)b[e]=f[512*(e/l)|0];g=1024-l;for(l=0;1024>e;++e,++l)b[e]=f[512*(l/g)+512|0];f=b}if("+"===a)for(e=0;1024>e;++e)f[e]=0.5*f[e]+0.5;else if("-"===a)for(e=0;1024>e;++e)f[e]*=-1;a=f}if(void 0!==a)return d[c]=a}f=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(c);if(null!==f){c=f[1];a=new Float32Array(1024);f=c.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(f))for(e=
b=0;b<f;++b){l=parseInt(c.substr(2*b,2),16);l=l&128?(l-256)/128:l/127;g=0;for(var h=1024/f;g<h;++g)a[e++]=l}return a}f=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(c);if(null!==f){a=f[1];c=new Float32Array(1024);if(8===a.length){b=parseInt(a,16);f=new Float32Array(8);f[0]=1;for(a=0;7>a;++a)f[a+1]=0.0625*(b&15),b>>=4;for(a=0;8>a;++a){e=0;l=(a+1)/1024;for(b=0;1024>b;++b)c[b]+=Math.sin(2*Math.PI*e)*f[a],e+=l}for(a=f=0;1024>a;++a)if(f<(b=Math.abs(c[a])))f=b;if(0<f)for(a=0;1024>a;++a)c[a]/=f}return c}};i.getWavetable=
b;i.setWavetable=function(c,a){var f,b=new Float32Array(1024),e;if("function"===typeof a)for(e=0;1024>e;++e)b[e]=a(e/1024);else if(a instanceof Float32Array)if(a.length===b.length)b.set(a);else{f=a.length/1024;for(e=0;1024>e;++e)b[e]=a[e*f|0]}d[c]=b};var d={sin:function(){for(var c=new Float32Array(1024),a=0;1024>a;++a)c[a]=Math.sin(2*Math.PI*(a/1024));return c},cos:function(){for(var c=new Float32Array(1024),a=0;1024>a;++a)c[a]=Math.cos(2*Math.PI*(a/1024));return c},pulse:function(){for(var c=new Float32Array(1024),
a=0;1024>a;++a)c[a]=512>a?1:-1;return c},tri:function(){for(var c=new Float32Array(1024),a,f=0;1024>f;++f)a=f/1024-0.25,c[f]=1-4*Math.abs(Math.round(a)-a);return c},saw:function(){for(var c=new Float32Array(1024),a,f=0;1024>f;++f)a=f/1024,c[f]=2*(a-Math.round(a));return c},fami:function(){for(var c=[0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,0.875,0.75,0.625,0.5,0.375,0.25,0.125,0,-0.125,-0.25,-0.375,-0.5,-0.625,-0.75,-0.875,-1,-1,-0.875,-0.75,-0.625,-0.5,-0.375,-0.25,-0.125],a=new Float32Array(1024),
f=0;1024>f;++f)a[f]=c[f/1024*c.length|0];return a},konami:function(){for(var c=[-0.625,-0.875,-0.125,0.75,0.5,0.125,0.5,0.75,0.25,-0.125,0.5,0.875,0.625,0,0.25,0.375,-0.125,-0.75,0,0.625,0.125,-0.5,-0.375,-0.125,-0.75,-1,-0.625,0,-0.375,-0.875,-0.625,-0.25],a=new Float32Array(1024),f=0;1024>f;++f)a[f]=c[f/1024*c.length|0];return a}};h.modules.Oscillator=i})(timbre);
(function(h){function i(c,a){this.samplerate=c;var f,d,l=c/44100;d=e.length;this.comb=Array(d);this.combout=Array(d);for(f=0;f<d;++f)this.comb[f]=new g(e[f]*l),this.combout[f]=new h.fn.SignalArray(a);d=b.length;this.allpass=Array(d);for(f=0;f<d;++f)this.allpass[f]=new j(b[f]*l);this.output=new h.fn.SignalArray(a);this.damp=0;this.wet=0.33;this.setRoomSize(0.5);this.setDamp(0.5)}function g(c){this.buffer=new h.fn.SignalArray(c|0);this.buffersize=this.buffer.length;this.damp=this.filterstore=this.feedback=
this.bufidx=0}function j(c){this.buffer=new h.fn.SignalArray(c|0);this.buffersize=this.buffer.length;this.bufidx=0}var e=[1116,1188,1277,1356,1422,1491,1557,1617],b=[225,556,441,341],d=i.prototype;d.setRoomSize=function(c){var a=this.comb;this.roomsize=c;a[0].feedback=a[1].feedback=a[2].feedback=a[3].feedback=a[4].feedback=a[5].feedback=a[6].feedback=a[7].feedback=0.28*c+0.7};d.setDamp=function(c){var a=this.comb;this.damp=c;a[0].damp=a[1].damp=a[2].damp=a[3].damp=a[4].damp=a[5].damp=a[6].damp=a[7].damp=
0.4*c};d.process=function(c){var a=this.comb,f=this.combout,b=this.allpass,d=this.output,e=this.wet,g=1-e,h=c.length;a[0].process(c,f[0]);a[1].process(c,f[1]);a[2].process(c,f[2]);a[3].process(c,f[3]);a[4].process(c,f[4]);a[5].process(c,f[5]);a[6].process(c,f[6]);a[7].process(c,f[7]);for(a=0;a<h;++a)d[a]=f[0][a]+f[1][a]+f[2][a]+f[3][a]+f[4][a]+f[5][a]+f[6][a]+f[7][a];b[0].process(d,d);b[1].process(d,d);b[2].process(d,d);b[3].process(d,d);for(a=0;a<h;++a)c[a]=d[a]*e+c[a]*g};g.prototype.process=function(c,
a){var f,b,d=this.buffer,e=this.buffersize,g=this.bufidx,h=this.filterstore,i=this.feedback,j=this.damp,m=1-j,q,u=c.length;for(q=0;q<u;++q)f=0.015*c[q],b=d[g],h=b*m+h*j,d[g]=f+h*i,++g>=e&&(g=0),a[q]=b;this.bufidx=g;this.filterstore=h};j.prototype.process=function(c,a){var f,b,d,e=this.buffer,g=this.buffersize,h=this.bufidx,i,j=c.length;for(i=0;i<j;++i)f=c[i],d=e[h],b=-f+d,e[h]=f+0.5*d,++h>=g&&(h=0),a[i]=b;this.bufidx=h};h.modules.Reverb=i})(timbre);
(function(h){function i(c){return new g(c)}function g(c){this.fragments=[];c&&this.fragments.push(new j(c,0,c.buffer.length/(c.samplerate||44100)))}function j(c,a,f,b,e,g,h){c||(c=d);this.buffer=c.buffer;this.samplerate=c.samplerate||44100;this.start=a;this._duration=f;this.reverse=b||!1;this.pitch=e||100;this.stretch=g||!1;this.pan=h||50}function e(c,a){this.tape=c;this.fragments=c.fragments;this.samplerate=a||44100;this.isEnded=!1;this.buffer=null;this.bufferEndIndex=this.bufferBeginIndex=this.bufferIndexIncr=
this.bufferIndex=0;this.fragment=null;this.fragmentIndex=0;this.panR=this.panL=0.7071067811865475}var b=new Float32Array(60),d={buffer:b,samplerate:1};i.silence=function(c){return(new i(d)).slice(0,1).fill(c)};i.join=function(c){for(var a=new g,f=0;f<c.length;f++)c[f]instanceof g&&a.add_fragments(c[f].fragments);return a};i.Tape=g;g.prototype.add_fragment=function(c){this.fragments.push(c);return this};g.prototype.add_fragments=function(c){for(var a=0;a<c.length;a++)this.fragments.push(c[a]);return this};
g.prototype.duration=function(){for(var c=0,a=0;a<this.fragments.length;a++)c+=this.fragments[a].duration();return c};g.prototype.slice=function(c,a){var f=this.duration();c+a>f&&(a=f-c);for(var f=new g,b=c,d=a,e=0;e<this.fragments.length;e++){var d=this.fragments[e].create(b,d),h=d[0],b=d[1],d=d[2];h&&f.add_fragment(h);if(0===d)break}return f};g.prototype.cut=g.prototype.slice;g.prototype.concat=function(c){var a=new g;a.add_fragments(this.fragments);a.add_fragments(c.fragments);return a};g.prototype.loop=
function(c){var a,f=[];for(a=0;a<this.fragments.length;a++)f.push(this.fragments[a].clone());var b=new g;for(a=0;a<c;a++)b.add_fragments(f);return b};g.prototype.times=g.prototype.loop;g.prototype.split=function(c){for(var a=this.duration()/c,f=[],b=0;b<c;b++)f.push(this.slice(b*a,a));return f};g.prototype.fill=function(c){var a=this.duration();if(0===a)throw"EmptyFragment";var f=c%a;return this.loop(c/a|0).plus(this.slice(0,f))};g.prototype.replace=function(c,a,f){var b=new g,a=c+a,b=b.plus(this.slice(0,
c)),d=b.duration();d<c&&(b=b.plus(i.silence(c-d)));b=b.plus(f);c=this.duration();c>a&&(b=b.plus(this.slice(a,c-a)));return b};g.prototype.reverse=function(){for(var c=new g,a=this.fragments.length;a--;){var b=this.fragments[a].clone();b.reverse=!b.isReversed();c.add_fragment(b)}return c};g.prototype.pitch=function(c,a){for(var b=new g,a=a||!1,d=0;d<this.fragments.length;d++){var e=this.fragments[d].clone();e.pitch*=0.01*c;e.stretch=a;b.add_fragment(e)}return b};g.prototype.stretch=function(c){return this.pitch(100*
(1/(0.01*c)),!0)};g.prototype.pan=function(c){for(var a=new g,b=0;b<this.fragments.length;b++){var d=this.fragments[b].clone();d.pan=c;a.add_fragment(d)}return a};g.prototype.silence=function(){return i.silence(this.duration())};g.prototype.join=function(c){for(var a=new g,b=0;b<c.length;b++)c[b]instanceof g&&a.add_fragments(c[b].fragments);return a};j.prototype.duration=function(){return this._duration*(100/this.pitch)};j.prototype.original_duration=function(){return this._duration};j.prototype.isReversed=
function(){return this.reverse};j.prototype.isStretched=function(){return this.stretched};j.prototype.create=function(c,a){var b=this.duration();if(c>=b)return[null,c-b,a];c+a>=b?(b-=c,a-=b):(b=a,a=0);var d=this.clone();d.start=this.start+0.01*c*this.pitch;d._duration=0.01*b*this.pitch;d.reverse=!1;return[d,0,a]};j.prototype.clone=function(){var c=new j;c.buffer=this.buffer;c.samplerate=this.samplerate;c.start=this.start;c._duration=this._duration;c.reverse=this.reverse;c.pitch=this.pitch;c.stretch=
this.stretch;c.pan=this.pan;return c};i.Fragment=j;i.TapeStream=e;e.prototype.reset=function(){this.isEnded=!1;this.buffer=null;this.bufferEndIndex=this.bufferBeginIndex=this.bufferIndexIncr=this.bufferIndex=0;this.fragment=null;this.fragmentIndex=0;this.panR=this.panL=0.7071067811865475;this.isLooped=!1;return this};e.prototype.fetch=function(c){var a=new h.fn.SignalArray(c),f=new h.fn.SignalArray(c),d=this.fragments;if(0===d.length)return[a,f];for(var e=100*this.samplerate,g=this.buffer,i=this.bufferIndex,
j=this.bufferIndexIncr,r=this.bufferBeginIndex,n=this.bufferEndIndex,m=this.fragment,q=this.fragmentIndex,u=this.panL,t=this.panR,v=0;v<c;v++){for(;!g||i<r||i>=n;)if(!m||q<d.length)m=d[q++],g=m.buffer,j=m.samplerate/e*m.pitch,r=m.start*m.samplerate,n=r+m.original_duration()*m.samplerate,u=Math.cos(0.005*Math.PI*m.pan),t=Math.sin(0.005*Math.PI*m.pan),m.reverse?(j*=-1,i=n+j):i=r;else if(this.isLooped)g=null,n=r=j=i=0,m=null,q=0;else{this.isEnded=!0;g=b;i=j=0;break}a[v]=g[i|0]*u;f[v]=g[i|0]*t;i+=j}this.buffer=
g;this.bufferIndex=i;this.bufferIndexIncr=j;this.bufferBeginIndex=r;this.bufferEndIndex=n;this.fragment=m;this.fragmentIndex=q;this.panL=u;this.panR=t;return[a,f]};h.modules.Scissor=i})(timbre);
(function(h){function i(g){this.samplerate=g;this.buffersize=1<<Math.ceil(Math.log(1.5*g)*Math.LOG2E);this.buffermask=this.buffersize-1;this.writeBufferL=new h.fn.SignalArray(this.buffersize);this.writeBufferR=new h.fn.SignalArray(this.buffersize);this.readBufferL=this.writeBufferL;this.readBufferR=this.writeBufferR;this.mix=this.cross=this.feedback=this.delaytime=null;this.writeIndex=this.readIndex=this.prevR=this.prevL=0;this.setParams(125,0.25,!1,0.45)}var g=i.prototype;g.setParams=function(g,
e,b,d){this.delaytime!==g&&(this.delaytime=g,g=0.001*g*this.samplerate|0,g>this.buffermask&&(g=this.buffermask),this.writeIndex=this.readIndex+g&this.buffermask);this.feedback!==e&&(this.feedback=e);this.cross!==b&&((this.cross=b)?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR));this.mix!==d&&(this.mix=d)};g.process=function(g,e){var b=this.readBufferL,d=this.readBufferR,c=this.writeBufferL,a=this.writeBufferR,
f=this.readIndex,k=this.writeIndex,l=this.buffermask,h=this.feedback,i=this.mix,p=1-i,r=this.prevL,n=this.prevR,m,q,u=g.length;for(q=0;q<u;++q)m=b[f],c[k]=g[q]-m*h,g[q]=r=0.5*(g[q]*p+m*i+r),m=d[f],a[k]=e[q]-m*h,e[q]=n=0.5*(e[q]*p+m*i+n),f+=1,k=k+1&l;this.readIndex=f&this.buffermask;this.writeIndex=k;this.prevL=r;this.prevR=n};h.modules.StereoDelay=i})(timbre);
(function(h){function i(g){h.Object.call(this,2,g)}var g=h.fn;g.extend(i);i.prototype.process=function(h){var e=this._;this.tickID!==h&&(this.tickID=h,e.ar?(g.inputSignalAR(this),g.outputSignalAR(this)):(this.cells[0][0]=g.inputSignalKR(this),g.outputSignalKR(this)));return this};g.register("+",i)})(timbre);
(function(h){var i=h.fn,g=h.modules;i.register("audio",function(b){b=new (i.getClass("buffer"))(b);b._.isLoaded=!1;b._.isEnded=!0;Object.defineProperties(b,{isLoaded:{get:function(){return this._.isLoaded}}});b.load=j;b.loadthis=e;return b});var j=function(b){var d=this,c=this._,a=new g.Deferred(this),f=arguments,e=1;a.done(function(){d._.emit("done")});"function"===typeof f[e]&&(a.done(f[e++]),"function"===typeof f[e]&&a.fail(f[e++]));c.loadedTime=0;(new g.Decoder).decode(b,function(c,b){var f=d._;
if(c){f.samplerate=c.samplerate;f.buffer=c.buffer;f.phase=0;f.phaseIncr=c.samplerate/h.samplerate;f.duration=c.duration*1E3;f.isEnded=false;f.currentTime=0;if(f.isReversed){f.phaseIncr=f.phaseIncr*-1;f.phase=c.buffer.length+f.phaseIncr}d._.emit("loadedmetadata")}else a.reject(b)},function(){d._.isLoaded=true;d._.plotFlush=true;d._.emit("loadeddata");a.resolveWith(d)});return a.promise()},e=function(){j.apply(this,arguments);return this}})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);g.fixAR(this);a=this._;a.biquad=new e(h.samplerate);a.freq=h(340);a.band=h(1);a.gain=h(0);a.plotBefore=b;a.plotRange=[-18,18];a.plotFlush=!0}var g=h.fn,j=h.modules.FFT,e=h.modules.Biquad;g.extend(i);var b=function(a,c,b,d,e){a.lineWidth=1;a.strokeStyle="rgb(192, 192, 192)";for(var g=0.5*h.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var m=i*Math.pow(10,j);20>=m||g<=m||(a.beginPath(),m=Math.log(m/20)/Math.log(g/20),m=(m*d+c|0)+0.5,a.moveTo(m,b),
a.lineTo(m,b+e),a.stroke())}e/=6;for(i=1;6>i;i++)a.beginPath(),g=(b+i*e|0)+0.5,a.moveTo(c,g),a.lineTo(c+d,g),a.stroke()},d=i.prototype;Object.defineProperties(d,{type:{set:function(a){var c=this._;a!==c.biquad.type&&(c.biquad.setType(a),c.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(a){this._.freq=h(a)},get:function(){return this._.freq}},cutoff:{set:function(a){this._.freq=h(a)},get:function(){return this._.freq}},res:{set:function(a){this._.band=h(a)},get:function(){return this._.band}},
Q:{set:function(a){this._.band=h(a)},get:function(){return this._.band}},band:{set:function(a){this._.band=h(a)},get:function(){return this._.band}},gain:{set:function(a){this._.gain=h(a)},get:function(){return this._.gain}}});d.process=function(a){var c=this._,b=this.cells[0];if(this.tickID!==a){this.tickID=a;g.inputSignalAR(this);var d=!1,e=c.freq.process(a).cells[0][0];c.prevFreq!==e&&(c.prevFreq=e,d=!0);var h=c.band.process(a).cells[0][0];c.prevband!==h&&(c.prevband=h,d=!0);a=c.gain.process(a).cells[0][0];
c.prevGain!==a&&(c.prevGain=a,d=!0);d&&(c.biquad.setParams(e,h,a),c.plotFlush=!0);c.bypassed||c.biquad.process(b);g.outputSignalAR(this)}return this};var c=new j(2048),a=h.Object.prototype.plot;d.plot=function(b){if(this._.plotFlush){var d=new e(h.samplerate);d.setType(this.type);d.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var l=new Float32Array(c.length);l[0]=1;d.process(l);c.forward(l);var d=new Float32Array(512),l=0.5*h.samplerate,g=new Float32Array(512),i,j,r,n;c.getFrequencyData(g);
for(i=0;512>i;++i)r=20*Math.pow(l/20,i/512),j=r/(l/g.length),r=j|0,j-=r,0===r?r=g[r]:(n=g[r-1],r=g[r],r=(1-j)*n+j*r),d[i]=r;this._.plotData=d;this._.plotFlush=null}return a.call(this,b)};g.register("biquad",i);g.register("lowpass",function(a){return(new i(a)).set("type","lowpass")});g.register("highpass",function(a){return(new i(a)).set("type","highpass")});g.register("bandpass",function(a){return(new i(a)).set("type","bandpass")});g.register("lowshelf",function(a){return(new i(a)).set("type","lowshelf")});
g.register("highshelf",function(a){return(new i(a)).set("type","highshelf")});g.register("peaking",function(a){return(new i(a)).set("type","peaking")});g.register("notch",function(a){return(new i(a)).set("type","notch")});g.register("allpass",function(a){return(new i(a)).set("type","allpass")});g.alias("lpf","lowpass");g.alias("hpf","highpass");g.alias("bpf","bandpass");g.alias("bef","notch");g.alias("brf","notch");g.alias("apf","allpass")})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);g.fixAR(this);c=this._;c.pitch=h(1);c.buffer=new Float32Array(0);c.isLooped=!1;c.isReversed=!1;c.duration=0;c.currentTime=0;c.samplerate=44100;c.phase=0;c.phaseIncr=0;c.onended=g.make_onended(this,0);c.onlooped=j(this)}var g=h.fn;g.extend(i);var j=function(c){return function(){var a=c._;a.phase>=a.buffer.length?a.phase=0:0>a.phase&&(a.phase=a.buffer.length+a.phaseIncr);c._.emit("looped")}},e=i.prototype,b=function(c){var a=this._;if("object"===typeof c){var b,
d;if(c instanceof Float32Array||c instanceof Float64Array)b=c;else if(c.buffer instanceof Float32Array||c.buffer instanceof Float64Array)b=c.buffer,"number"===typeof c.samplerate&&(d=c.samplerate);b&&(0<d&&(a.samplerate=c.samplerate),a.buffer=b,a.phase=0,a.phaseIncr=a.samplerate/h.samplerate,a.duration=1E3*a.buffer.length/a.samplerate,a.currentTime=0,a.plotFlush=!0,this.reverse(a.isReversed))}};Object.defineProperties(e,{buffer:{set:b,get:function(){return this._.buffer}},pitch:{set:function(c){this._.pitch=
h(c)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},isEnded:{get:function(){return this._.isEnded}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(c){if("number"===typeof c){var a=this._;0<=c&&c<=a.duration&&(a.phase=c/1E3*a.samplerate,a.currentTime=c)}},get:function(){return this._.currentTime}}});e.clone=function(){var c=
this._,a=h("buffer");c.buffer&&b.call(a,{buffer:c.buffer,samplerate:c.samplerate});a.loop(c.isLooped);a.reverse(c.isReversed);return a};e.slice=function(c,a){var f=this._,d=h(f.originkey),c="number"===typeof c?0.001*c*f.samplerate|0:0,a="number"===typeof a?0.001*a*f.samplerate|0:f.buffer.length;if(c>a)var e=c,c=a,a=e;f.buffer&&(b.call(d,{buffer:f.buffer.subarray(c,a),samplerate:f.samplerate}),d._.isEnded=!1);d.loop(f.isLooped);d.reverse(f.isReversed);return d};e.reverse=function(c){var a=this._;a.isReversed=
!!c;if(a.isReversed){if(0<a.phaseIncr&&(a.phaseIncr*=-1),0===a.phase&&a.buffer)a.phase=a.buffer.length+a.phaseIncr}else 0>a.phaseIncr&&(a.phaseIncr*=-1);return this};e.loop=function(c){this._.isLooped=!!c;return this};e.bang=function(c){this._.phase=0;this._.isEnded=!1===c;this._.emit("bang");return this};e.process=function(c){var a=this._,b=this.cells[0];if(a.isEnded||!a.buffer)return this;if(this.tickID!==c){this.tickID=c;var d=a.buffer,e=a.phase,h=a.mul,i=a.add,j=b.length;if(this.nodes.length){g.inputSignalAR(this);
for(var r,n=0.001*a.samplerate,c=0;c<j;++c)r=b[c],e=r*n,b[c]=(d[e|0]||0)*h+i;a.phase=e;a.currentTime=r}else{c=a.pitch.process(c).cells[0][0];r=a.phaseIncr*c;for(c=0;c<j;++c)b[c]=(d[e|0]||0)*h+i,e+=r;e>=d.length?a.isLooped?g.nextTick(a.onlooped):g.nextTick(a.onended):0>e&&(a.isLooped?g.nextTick(a.onlooped):g.nextTick(a.onended));a.phase=e;a.currentTime+=g.currentTimeIncr}}return this};var d=h.Object.prototype.plot;e.plot=function(c){var a=this._,b=a.buffer;if(a.plotFlush){for(var e=new Float32Array(2048),
l=0,g=b.length/2048,h=0;2048>h;h++)e[h]=b[l|0],l+=g;a.plotData=e;a.plotFlush=null}return d.call(this,c)};g.register("buffer",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);b=new j(h.samplerate);b.setDelayTime(20);b.setRate(4);b.depth=20;b.feedback=0.2;b.mix=0.33;this._.chorus=b}var g=h.fn,j=h.modules.Chorus;g.extend(i);var e=i.prototype;Object.defineProperties(e,{type:{set:function(b){this._.chorus.setDelayTime(b)},get:function(){return this._.chorus.wave}},delay:{set:function(b){0.5<=b&&80>=b&&this._.chorus.setDelayTime(b)},get:function(){return this._.chorus.delayTime}},rate:{set:function(b){"number"===
typeof b&&0<b&&this._.chorus.setRate(b)},get:function(){return this._.chorus.rate}},depth:{set:function(b){"number"===typeof b&&(0<=b&&100>=b)&&(b*=h.samplerate/44100,this._.chorus.depth=b)},get:function(){return this._.chorus.depth}},fb:{set:function(b){"number"===typeof b&&(-1<=b&&1>=b)&&(this._.chorus.feedback=0.99996*b)},get:function(){return this._.chorus.feedback}},mix:{set:function(b){this._.mix=h(b)},get:function(){return this._.mix}}});e.process=function(b){var d=this._,c=this.cells[0];this.tickID!==
b&&(this.tickID=b,g.inputSignalAR(this),d.bypassed||d.chorus.process(c),g.outputSignalAR(this));return this};g.register("chorus",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);e=this._;e.min=-0.8;e.max=0.8}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{minmax:{set:function(e){var b=this._;"number"===typeof e&&(b.min=-Math.abs(e),b.max=-b.min)},get:function(){return this._.max}},min:{set:function(e){var b=this._;"number"===typeof e&&(b.max<e?b.max=e:b.min=e)},get:function(){return this._.min}},max:{set:function(e){var b=this._;"number"===typeof e&&(e<b.min?b.min=e:b.max=e)},get:function(){return this._.max}}});
j.process=function(e){var b=this.cells[0],d=this._;if(this.tickID!==e){this.tickID=e;var c=this.nodes,a=d.mul,f=d.add,k=c.length,l,g=b.length,h=d.min,i=d.max,j;for(l=0;l<g;++l)b[l]=0;if(d.ar){for(d=0;d<k;++d){j=c[d].process(e).cells[0];for(l=0;l<g;++l)b[l]+=j[l]}for(l=0;l<g;++l)e=b[l],e=e<h?h:e>i?i:e,b[l]=e;if(1!==a||0!==f)for(l=0;l<g;++l)b[l]=b[l]*a+f}else{for(d=j=0;d<k;++d)j+=c[d].process(e).cells[0][0];j=(j<h?h:j>i?i:j)*a+f;for(l=0;l<g;++l)b[l]=j}}return this};g.register("clip",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);b=this._;b.thresh=h(-24);b.knee=h(30);b.ratio=h(12);b.postGain=6;b.reduction=0;b.comp=new e(h.samplerate);b.comp.dbPostGain=b.postGain;b.comp.setAttackTime(0.003);b.comp.setReleaseTime(0.25)}var g=h.fn,j=h.timevalue,e=h.modules.Compressor;g.extend(i);var b=i.prototype;Object.defineProperties(b,{thresh:{set:function(b){this._.thresh=h(b)},get:function(){return this._.thresh}},knee:{set:function(b){this._.kne=h(b)},get:function(){return this._.knee}},
ratio:{set:function(b){this._.ratio=h(b)},get:function(){return this._.ratio}},gain:{set:function(b){"number"===typeof b&&(this._.postGain=b,this._.comp.dbPostGain=b)},get:function(){return this._.postGain}},attack:{set:function(b){"string"===typeof b&&(b=j(b));"number"===typeof b&&(b=0>b?0:1E3<b?1E3:b,this._.attack=b,this._.comp.setAttackTime(0.001*b))},get:function(){return this._.comp.attackTime}},release:{set:function(b){"string"===typeof b&&(b=j(b),0>=b&&(b=0));"number"===typeof b&&(b=0>b?0:
1E3<b?1E3:b,this._.release=b,this._.comp.releaseTime=0.001*b)},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}});b.process=function(b){var c=this._,a=this.cells[0];if(this.tickID!==b){this.tickID=b;g.inputSignalAR(this);var f=c.thresh.process(b).cells[0][0],e=c.knee.process(b).cells[0][0],b=c.ratio.process(b).cells[0][0];if(c.prevThresh!==f||c.prevKnee!==e||c.prevRatio!==b)c.prevThresh=f,c.prevKnee=e,c.prevRatio=b,c.comp.setParams(f,e,b);c.bypassed||(c.comp.process(a),
c.reduction=c.comp.meteringGain);g.outputSignalAR(this)}return this};g.register("comp",i);g.alias("compressor","comp")})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);b=this._;b.freq=h(440);b.osc1=new j(h.samplerate);b.osc2=new j(h.samplerate);b.osc1.step=h.cellsize;b.osc2.step=h.cellsize;b.tmp=new g.SignalArray(h.cellsize);b.beats=0.5;this.once("init",e)}var g=h.fn,j=h.modules.Oscillator;g.extend(i);var e=function(){this.wave||(this.wave="sin")},b=i.prototype;Object.defineProperties(b,{wave:{set:function(b){this._.osc1.setWave(b);this._.osc2.setWave(b)},get:function(){return this._.osc1.wave}},freq:{set:function(b){this._.freq=
h(b)},get:function(){return this._.freq}},beats:{set:function(b){"number"===typeof b&&0<b&&(this._.beats=b)},get:function(){return this._.beats}}});b.bang=function(){this._.osc1.reset();this._.osc2.reset();this._.emit("bang");return this};b.process=function(b){var c=this._,a=this.cells[0];if(this.tickID!==b){this.tickID=b;var f,e=a.length,b=c.freq.process(b).cells[0][0];f=c.osc1;var l=c.osc2,h=c.tmp;f.frequency=b-0.5*c.beats;f.process(h);for(f=0;f<e;++f)a[f]=0.5*h[f];l.frequency=b+0.5*c.beats;l.process(h);
for(f=0;f<e;++f)a[f]+=0.5*h[f];g.outputSignalAR(this)}return this};g.register("cosc",i)})(timbre);
(function(h){function i(b){h.Object.call(this,2,b);g.fixAR(this);b=this._;b.time=h(100);b.fb=h(0.2);b.cross=h(!1);b.mix=0.33;b.delay=new e(h.samplerate)}var g=h.fn,j=h.timevalue,e=h.modules.StereoDelay;g.extend(i);var b=i.prototype;Object.defineProperties(b,{time:{set:function(b){"string"===typeof b&&(b=j(b));this._.time=h(b)},get:function(){return this._.time}},fb:{set:function(b){this._.fb=h(b)},get:function(){return this._.fb}},cross:{set:function(b){this._.cross=h(b)},get:function(){return this._.cross}},
mix:{set:function(b){"number"===typeof b&&(this._.mix=1<b?1:0>b?0:b)},get:function(){return this._.mix}}});b.process=function(b){var c=this._;if(this.tickID!==b){this.tickID=b;var a=c.time.process(b).cells[0][0],f=c.fb.process(b).cells[0][0],b=0!==c.cross.process(b).cells[0][0],e=c.mix;if(c.prevTime!==a||c.prevFb!==f||c.prevCross!==b||c.prevMix!==e)c.prevTime=a,c.prevFb=f,c.prevCross=b,c.prevMix=e,c.delay.setParams(a,f,b,e);g.inputSignalAR(this);c.bypassed||c.delay.process(this.cells[1],this.cells[2]);
g.outputSignalAR(this)}return this};g.register("delay",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);g.fixAR(this);e=this._;e.pre=h(60);e.post=h(-18);e.samplerate=h.samplerate;e.x1=e.x2=e.y1=e.y2=0;e.b0=e.b1=e.b2=e.a1=e.a2=0;e.cutoff=0}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{cutoff:{set:function(e){"number"===typeof e&&0<e&&(this._.cutoff=e)},get:function(){return this._.cutoff}},pre:{set:function(e){this._.pre=h(e)},get:function(){return this._.pre}},post:{set:function(e){this._.post=h(e)},get:function(){return this._.post}}});
j.process=function(e){var b=this._,d=this.cells[0];if(this.tickID!==e){this.tickID=e;g.inputSignalAR(this);var c=-b.pre.process(e).cells[0][0],e=-b.post.process(e).cells[0][0];if(b.prevPreGain!==c||b.prevPostGain!==e)b.prevPreGain=c,b.prevPostGain=e,e=Math.pow(2,0.166666666*-e),b.preScale=Math.pow(2,0.166666666*-c)*e,b.limit=e;if(b.bypassed)g.outputSignalAR(this);else{var c=b.preScale,e=b.limit,a=b.mul,f=b.add,k,l,h,i;if(b.cutoff){b.prevCutoff!==b.cutoff&&(b.prevCutoff=b.cutoff,k=b.cutoff/(0.5*b.samplerate),
1<=k?(b.b0=1,b.b1=b.b2=b.a1=b.a2=0):0>=k?b.b0=b.b1=b.b2=b.a1=b.a2=0:(l=Math.pow(10,0.05),l=Math.sqrt(0.5*(4-Math.sqrt(16-16/(l*l)))),k*=Math.PI,l=0.5*l*Math.sin(k),l=0.5*(1-l)/(1+l),k=(0.5+l)*Math.cos(k),h=0.25*(0.5+l-k),b.b0=2*h,b.b1=4*h,b.b2=b.b0,b.a1=2*-k,b.a2=2*l));var j=b.x1,r=b.x2,n=b.y1,m=b.y2,q=b.b0,u=b.b1,t=b.b2,v=b.a1,A=b.a2;k=0;for(l=d.length;k<l;++k)h=d[k]*c,i=q*h+u*j+t*r-v*n-A*m,i=i>e?e:i<-e?-e:i,d[k]=i*a+f,r=j,j=h,m=n,n=i;if(0<j&&1.0E-4>j||0>j&&-1.0E-4<j)j=0;if(0<n&&1.0E-4>n||0>n&&-1.0E-4<
n)n=0;b.x1=j;b.x2=r;b.y1=n;b.y2=m}else{k=0;for(l=d.length;k<l;++k)h=d[k]*c,h=h>e?e:h<-e?-e:h,d[k]=h*a+f}}}return this};g.register("distortion",i);g.alias("dist","distortion")})(timbre);
(function(h){function i(g){h.Object.call(this,2,g);this._.ar=!1}var g=h.fn;g.extend(i);i.prototype.process=function(h){var e=this._;if(this.tickID!==h){this.tickID=h;var b=this.nodes,d=this.cells[0],c=this.cells[1],a=this.cells[2],f,k=b.length,l=d.length,i,s;if(e.ar){if(0<b.length){b[0].process(h);i=b[0].cells[1];s=b[0].cells[2];c.set(i);a.set(s);for(f=1;f<k;++f){b[f].process(h);i=b[f].cells[1];s=b[f].cells[2];for(d=0;d<l;++d)e=i[d],c[d]=0===e?0:c[d]/e,e=s[d],a[d]=0===e?0:a[d]/e}}else for(d=0;d<l;++d)c[d]=
a[f]=0;g.outputSignalAR(this)}else{if(0<b.length){c=b[0].process(h).cells[0][0];for(f=1;f<k;++f)e=b[f].process(h).cells[0][0],c=0===e?0:c/e}else c=0;d[0]=c;g.outputSignalKR(this)}}return this};g.register("/",i)})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);a=this._;a.env=new b(h.samplerate);a.env.setStep(h.cellsize);a.tmp=new j.SignalArray(h.cellsize);a.ar=!1;a.plotFlush=!0;a.onended=j.make_onended(this);this.on("ar",c)}function g(a,c,b,f,d,e){"number"===typeof a[f]?b=a[f]:"number"===typeof a[d]?b=a[d]:e&&("string"===typeof a[f]?b=e(a[f]):"string"===typeof a[d]&&(b=e(a[d])));b<c&&(b=c);return b}var j=h.fn,e=h.timevalue,b=h.modules.Envelope,d=j.isDictionary;j.extend(i);var c=function(a){this._.env.setStep(a?
1:h.cellsize)},a=i.prototype;Object.defineProperties(a,{table:{set:function(a){if(Array.isArray(a)){for(var c=this._.env,f=[a[0]||k],d,g,h,i,j=1,u=a.length;j<u;++j)d=a[j][0]||k,g=a[j][1],h=a[j][2],"number"!==typeof g&&(g="string"===typeof g?e(g):10),10>g&&(g=10),"number"===typeof h?(i=h,h=b.CurveTypeCurve):(h=b.CurveTypeDict[h]||null,i=0),f.push([d,g,h,i]);c.setTable(f);this._.plotFlush=!0}},get:function(){return this._.env.table}},curve:{set:function(a){this._.env.setCurve(a)},get:function(){return this._.env.curve}},
releaseNode:{set:function(a){this._.env.setReleaseNode(a);this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(a){this._.env.setLoopNode(a);this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}});a.clone=function(){var a=new i([]);a._.env=this._.env.clone();a._.ar=this._.ar;return a};a.reset=function(){this._.env.reset();return this};a.release=function(){var a=this._;a.env.release();a.emit("released");return this};a.bang=function(){var a=this._;
a.env.reset();a.env.status=b.StatusGate;a.emit("bang");return this};a.process=function(a){var c=this._,b=this.cells[0];if(this.tickID!==a){this.tickID=a;var f,a=b.length,d=c.mul,e=c.add;if(this.nodes.length)j.inputSignalAR(this);else for(f=0;f<a;++f)b[f]=1;var g;f=null;if(c.ar){g=c.tmp;c.env.process(g);for(f=0;f<a;++f)b[f]=b[f]*g[f]*d+e}else{g=c.env.next();for(f=0;f<a;++f)b[f]=b[f]*g*d+e}(f=c.env.emit)&&("ended"===f?j.nextTick(c.onended):this._.emit(f,c.value))}return this};var f=h.Object.prototype.plot;
a.plot=function(a){if(this._.plotFlush){var c=this._.env.clone(),d=c.getInfo(1E3),e=d.totalDuration,g=d.loopBeginTime,k=d.releaseBeginTime,d=new Float32Array(256),i=0,j=e/d.length,u=!1,t=0.001*e*h.samplerate|0,v,t=t/d.length;c.setStep(t);c.status=b.StatusGate;t=0;for(v=d.length;t<v;++t)d[t]=c.next(),i+=j,!u&&i>=k&&(c.release(),u=!0);this._.plotData=d;this._.plotBefore=function(a,c,b,f,d){var l;Infinity!==g&&Infinity!==k&&(b=c+f*(g/e),l=c+f*(k/e),a.fillStyle="rgba(224, 224, 224, 0.8)",a.fillRect(b,
0,l-b,d));Infinity!==k&&(b=c+f*(k/e),a.fillStyle="rgba(212, 212, 212, 0.8)",a.fillRect(b,0,f-b,d))};c=Infinity;i=-Infinity;for(t=0;t<v;++t)d[t]<c?c=d[t]:d[t]>i&&(i=d[t]);1>i&&(i=1);this._.plotRange=[c,i];this._.plotData=d;this._.plotFlush=null}return f.call(this,a)};j.register("env",i);var k=b.ZERO;j.register("perc",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,10,"a","attackTime",e),f=g(c,10,1E3,"r","decayTime",e),h=g(c,k,1,"lv","level");c.table=[k,[h,b],[k,f]];return new i(a)});j.register("adsr",
function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,10,"a","attackTime",e),f=g(c,10,300,"d","decayTime",e),h=g(c,k,0.5,"s","sustainLevel"),j=g(c,10,1E3,"r","decayTime",e),m=g(c,k,1,"lv","level");c.table=[k,[m,b],[h,f],[k,j]];c.releaseNode=3;return new i(a)});j.register("adshr",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,10,"a","attackTime",e),f=g(c,10,300,"d","decayTime",e),h=g(c,k,0.5,"s","sustainLevel"),j=g(c,10,500,"h","holdTime",e),m=g(c,10,1E3,"r","decayTime",e),q=g(c,k,1,"lv",
"level");c.table=[k,[q,b],[h,f],[h,j],[k,m]];return new i(a)});j.register("asr",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,10,"a","attackTime",e),f=g(c,k,0.5,"s","sustainLevel"),h=g(c,10,1E3,"r","releaseTime",e);c.table=[k,[f,b],[k,h]];c.releaseNode=2;return new i(a)});j.register("dadsr",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,100,"dl","delayTime",e),f=g(c,10,10,"a","attackTime",e),h=g(c,10,300,"d","decayTime",e),j=g(c,k,0.5,"s","sustainLevel"),m=g(c,10,1E3,"r","relaseTime",
e),q=g(c,k,1,"lv","level");c.table=[k,[k,b],[q,f],[j,h],[k,m]];c.releaseNode=4;return new i(a)});j.register("ahdsfr",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,10,"a","attackTime",e),f=g(c,10,10,"h","holdTime",e),h=g(c,10,300,"d","decayTime",e),j=g(c,k,0.5,"s","sustainLevel"),m=g(c,10,5E3,"f","fadeTime",e),q=g(c,10,1E3,"r","relaseTime",e),u=g(c,k,1,"lv","level");c.table=[k,[u,b],[u,f],[j,h],[k,m],[k,q]];c.releaseNode=5;return new i(a)});j.register("linen",function(a){d(a[0])||a.unshift({});
var c=a[0],b=g(c,10,10,"a","attackTime",e),f=g(c,10,1E3,"s","sustainTime",e),h=g(c,10,1E3,"r","releaseTime",e),j=g(c,k,1,"lv","level");c.table=[k,[j,b],[j,f],[k,h]];return new i(a)});j.register("env.tri",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,20,1E3,"dur","duration",e),f=g(c,k,1,"lv","level"),b=0.5*b;c.table=[k,[f,b],[k,b]];return new i(a)});j.register("env.cutoff",function(a){d(a[0])||a.unshift({});var c=a[0],b=g(c,10,100,"r","relaseTime",e),f=g(c,k,1,"lv","level");c.table=[f,[k,b]];
return new i(a)})})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);g.fixAR(this);a=this._;a.biquads=Array(7);a.plotBefore=d;a.plotRange=[-18,18];a.plotFlush=!0}var g=h.fn,j=h.modules.FFT,e=h.modules.Biquad,b={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};g.extend(i);var d=function(a,c,b,f,d){a.lineWidth=1;a.strokeStyle="rgb(192, 192, 192)";for(var e=0.5*h.samplerate,g=1;10>=g;++g)for(var i=1;4>=i;i++){var j=g*Math.pow(10,i);20>=j||e<=j||(a.beginPath(),j=Math.log(j/20)/Math.log(e/20),j=(j*f+c|0)+0.5,a.moveTo(j,b),a.lineTo(j,
b+d),a.stroke())}d/=6;for(g=1;6>g;g++)a.beginPath(),e=(b+g*d|0)+0.5,a.moveTo(c,e),a.lineTo(c+f,e),a.stroke()},c=i.prototype;Object.defineProperties(c,{params:{set:function(a){if("object"===typeof a)for(var c=Object.keys(a),b=0,f=c.length;b<f;++b){var d=a[c[b]];Array.isArray(d)?this.setParams(c[b],d[0],d[1],d[2]):this.setParams(c[b])}}}});c.setParams=function(a,c,f,d){var g=this._;"string"===typeof a&&(a=b[a]);if(0<=a&&a<g.biquads.length){a|=0;if("number"===typeof c&&"number"===typeof f){"number"!==
typeof d&&(d=0);var i=g.biquads[a];if(!i)switch(i=g.biquads[a]=new e(h.samplerate),a){case 0:i.setType("highpass");break;case g.biquads.length-1:i.setType("lowpass");break;default:i.setType("peaking")}i.setParams(c,f,d)}else g.biquads[a]=void 0;g.plotFlush=!0}return this};c.getParams=function(a){if(a=this._.biquads[a|0])return{freq:a.frequency,Q:a.Q,gain:a.gain}};c.process=function(a){var c=this._,b=this.cells[0];if(this.tickID!==a){this.tickID=a;g.inputSignalAR(this);if(!c.bypassed)for(var a=c.biquads,
c=0,f=a.length;c<f;++c)a[c]&&a[c].process(b);g.outputSignalAR(this)}return this};var a=new j(2048),f=h.Object.prototype.plot;c.plot=function(c){if(this._.plotFlush){var b=this._,d=new Float32Array(a.length);d[0]=1;for(var g=0,b=b.biquads.length;g<b;++g){var i=this.getParams(g);if(i){var j=new e(h.samplerate);0===g?j.setType("highpass"):g===b-1?j.setType("lowpass"):j.setType("peaking");j.setParams(i.freq,i.Q,i.gain);j.process(d)}}a.forward(d);var d=new Float32Array(512),b=0.5*h.samplerate,i=new Float32Array(512),
n,m;a.getFrequencyData(i);for(g=0;512>g;++g)j=20*Math.pow(b/20,g/512),n=j/(b/i.length),j=n|0,n-=j,0===j?j=i[j]:(m=i[j-1],j=i[j],j=(1-n)*m+n*j),d[g]=j;this._.plotData=d;this._.plotFlush=null}return f.call(this,c)};g.register("eq",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.listener(this);g.fixAR(this);this.real=this.L;this.imag=this.R;b=this._;b.fft=new j(2*h.cellsize);b.fftCell=new g.SignalArray(b.fft.length);b.prevCell=new g.SignalArray(h.cellsize);b.freqs=new g.SignalArray(b.fft.length>>1);b.plotFlush=!0;b.plotRange=[0,32];b.plotBarStyle=!0}var g=h.fn,j=h.modules.FFT;g.extend(i);var e=i.prototype;Object.defineProperties(e,{window:{set:function(b){this._.fft.setWindow(b)},get:function(){return this._.fft.windowName}},
spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}});e.process=function(b){var c=this._;if(this.tickID!==b){this.tickID=b;g.inputSignalAR(this);var a=this.cells[0];c.fftCell.set(c.prevCell);c.fftCell.set(a,a.length);c.fft.forward(c.fftCell);c.prevCell.set(a);for(var b=this.cells[1],f=this.cells[2],e=c.fft.real,c=c.fft.imag,h=0,a=a.length;h<a;++h)b[h]=e[h],f[h]=c[h];this._.plotFlush=!0}return this};var b=h.Object.prototype.plot;e.plot=function(d){this._.plotFlush&&(this._.plotData=
this.spectrum,this._.plotFlush=null);return b.call(this,d)};g.register("fft",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);g.fixAR(this);e=this._;e.freq=h(440);e.samplerate=h.samplerate;e.reg=32768;e.shortFlag=!1;e.phase=0;e.lastValue=0}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{shortFlag:{set:function(e){this._.shortFlag=!!e},get:function(){return this._.shortFlag}},freq:{set:function(e){this._.freq=h(e)},get:function(){return this._.freq}}});j.process=function(e){var b=this._,d=this.cells[0];if(this.tickID!==e){this.tickID=e;var c=b.lastValue,
a=b.phase,e=b.freq.process(e).cells[0][0]/b.samplerate,f=b.reg,g=b.mul,h=b.add,i,j;if(b.shortFlag){i=0;for(j=d.length;i<j;++i)1<=a&&(f>>=1,f|=((f^f>>6)&1)<<15,c=(f&1)-0.5,a-=1),d[i]=c*g+h,a+=e}else{i=0;for(j=d.length;i<j;++i)1<=a&&(f>>=1,f|=((f^f>>1)&1)<<15,c=(f&1)-0.5,a-=1),d[i]=c*g+h,a+=e}b.reg=f;b.phase=a;b.lastValue=c}return this};g.register("fnoise",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);this._.selected=0;this._.outputs=[]}var g=h.fn,j=h.ChannelObject;g.extend(i);var e=i.prototype;Object.defineProperties(e,{selected:{set:function(b){var d=this._;if("number"===typeof b){d.selected=b;for(var b=d.outputs,d=0,c=b.length;d<c;++d)b[d]&&b[d].cell.set(g.emptycell)}},get:function(){return this._.selected}}});e.at=function(b){var d=this._,c=d.outputs[b];c||(d.outputs[b]=c=new j(this));return c};e.process=function(b){var d=this._;
this.tickID!==b&&(this.tickID=b,g.inputSignalAR(this),g.outputSignalAR(this),d.outputs[d.selected]&&d.outputs[d.selected].cell.set(this.cells[0]));return this};g.register("gate",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);b=this._;b.fft=new j(2*h.cellsize);b.fftCell=new g.SignalArray(this._.fft.length);b.realBuffer=new g.SignalArray(this._.fft.length);b.imagBuffer=new g.SignalArray(this._.fft.length)}var g=h.fn,j=h.modules.FFT;g.extend(i);var e=i.prototype;Object.defineProperties(e,{real:{set:function(b){this._.real=h(b)},get:function(){return this._.real}},imag:{set:function(b){this._.imag=h(b)},get:function(){return this._.imag}}});e.process=function(b){var d=
this._,c=this.cells[0];if(this.tickID!==b&&(this.tickID=b,d.real&&d.imag)){var a=d.realBuffer,f=d.imagBuffer,e=d.real.process(b).cells[0],b=d.imag.process(b).cells[0];a.set(e);f.set(b);c.set(d.fft.inverse(a,f).subarray(0,c.length));g.outputSignalAR(this)}return this};g.register("ifft",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.timer(this);g.fixKR(this);b=this._;b.interval=h(1E3);b.count=0;b.delay=0;b.timeout=Infinity;b.currentTime=0;b.delaySamples=0;b.countSamples=0;b.isEnded=!1;b.onended=g.make_onended(this);this.on("start",e)}var g=h.fn,j=h.timevalue;g.extend(i);var e=function(){var b=this._;b.delaySamples=h.samplerate*0.001*b.delay|0;b.countSamples=b.count=b.currentTime=0;b.isEnded=!1};Object.defineProperty(e,"unremovable",{value:!0,writable:!1});var b=i.prototype;
Object.defineProperties(b,{interval:{set:function(b){"string"===typeof b&&(b=j(b),0>=b&&(b=0));this._.interval=h(b)},get:function(){return this._.interval}},delay:{set:function(b){"string"===typeof b&&(b=j(b));"number"===typeof b&&0<=b&&(this._.delay=b,this._.delaySamples=h.samplerate*0.001*b|0)},get:function(){return this._.delay}},count:{set:function(b){"number"===typeof b&&(this._.count=b)},get:function(){return this._.count}},timeout:{set:function(b){"string"===typeof b&&(b=j(b));"number"===typeof b&&
0<=b&&(this._.timeout=b)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}});b.bang=function(){var b=this._;b.delaySamples=h.samplerate*0.001*b.delay|0;b.countSamples=b.count=b.currentTime=0;b.isEnded=!1;b.emit("bang");return this};b.process=function(b){var c=this.cells[0],a=this._;if(a.isEnded)return this;if(this.tickID!==b){this.tickID=b;0<a.delaySamples&&(a.delaySamples-=c.length);b=a.interval.process(b).cells[0][0];if(0>=a.delaySamples&&(a.countSamples-=
c.length,0>=a.countSamples)){a.countSamples+=0.001*h.samplerate*b|0;for(var b=this.nodes,f=a.count,e=f*a.mul+a.add,l=0,i=c.length;l<i;++l)c[l]=e;c=0;for(e=b.length;c<e;++c)b[c].bang(f);a.count+=1}a.currentTime+=g.currentTimeIncr;a.currentTime>=a.timeout&&g.nextTick(a.onended)}return this};g.register("interval",i)})(timbre);
(function(h){function i(a){if(j)return j;j=this;h.Object.call(this,1,a);g.fixKR(this)}if("browser"===h.envtype){var g=h.fn,j=null;g.extend(i);var e={},b=!1,d=!1,c=!1,a=function(a){for(var f=j._,g=j.cell,f=a.keyCode*f.mul+f.add,h=0,k=g.length;h<k;++h)g[h]=f;b=a.shiftKey;d=a.ctrlKey;c=a.altKey;e[a.keyCode]||(e[a.keyCode]=!0,j._.emit("keydown",a))},f=function(a){delete e[a.keyCode];j._.emit("keyup",a)},k=i.prototype;Object.defineProperties(k,{shiftKey:{get:function(){return b}},ctrlKey:{get:function(){return d}},
altKey:{get:function(){return c}}});k.start=function(){window.addEventListener("keydown",a,!0);window.addEventListener("keyup",f,!0);return this};k.stop=function(){window.removeEventListener("keydown",a,!0);window.removeEventListener("keyup",f,!0);return this};k.play=k.pause=function(){return this};g.register("keyboard",i)}})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);var b=Math.ceil(Math.log(h.samplerate)*Math.LOG2E),d=this._;d.buffersize=1<<b;d.buffermask=d.buffersize-1;d.buffer=new g.SignalArray(d.buffersize);d.time=0;d.readIndex=0;d.writeIndex=0}var g=h.fn,j=h.timevalue;g.extend(i);var e=i.prototype;Object.defineProperties(e,{time:{set:function(b){"string"===typeof b&&(b=j(b));if("number"===typeof b&&0<b){var d=this._;d.time=b;b=0.001*b*h.samplerate|0;b>d.buffermask&&(b=d.buffermask);d.writeIndex=
d.readIndex+b&d.buffermask}},get:function(){return this._.time}}});e.process=function(b){var d=this._;if(this.tickID!==b){this.tickID=b;g.inputSignalAR(this);var b=this.cells[0],c=d.buffer,a=d.buffermask,f=d.readIndex,e=d.writeIndex,h,i=b.length;for(h=0;h<i;++h)c[e]=b[h],b[h]=c[f],f+=1,e=e+1&a;d.readIndex=f&a;d.writeIndex=e;g.outputSignalAR(this)}return this};g.register("lag",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);b=this._;b.input=0;b.value=0;b.prev=null;b.ar=!1;b.map=j}var g=h.fn;g.extend(i);var j=function(b){return b},e=i.prototype;Object.defineProperties(e,{input:{set:function(b){"number"===typeof b&&(this._.input=b)},get:function(){return this._.input}},map:{set:function(b){"function"===typeof b&&(this._.map=b)},get:function(){return this._.map}}});e.bang=function(){this._.prev=null;this._.emit("bang");return this};e.at=function(b){return this._.map?this._.map(b):
0};e.process=function(b){var d=this.cells[0],c=this._;if(this.tickID!==b){this.tickID=b;var a=this.nodes.length,b=d.length;if(c.ar&&a){g.inputSignalAR(this);var f=c.map;if(f)for(a=0;a<b;++a)d[a]=f(d[a]);c.value=d[b-1];g.outputSignalAR(this)}else{a=a?g.inputSignalKR(this):c.input;c.map&&c.prev!==a&&(c.prev=a,c.value=c.map(a));c=c.value*c.mul+c.add;for(a=0;a<b;++a)d[a]=c}}return this};g.register("map",i)})(timbre);
(function(h){function i(g){h.Object.call(this,1,g)}var g=h.fn;g.extend(i);i.prototype.process=function(h){var e=this.cells[0],b=this._;if(this.tickID!==h){this.tickID=h;var d=this.nodes,c=d.length,a,f=e.length,k,l;if(b.ar){if(0<d.length){k=d[0].process(h).cells[0];e.set(k);for(b=1;b<c;++b){k=d[b].process(h).cells[0];for(a=0;a<f;++a)l=k[a],e[a]<l&&(e[a]=l)}}else for(a=0;a<f;++a)e[a]=0;g.outputSignalAR(this)}else{if(0<d.length){k=d[0].process(h).cells[0][0];for(b=1;b<c;++b)l=d[b].process(h).cells[0][0],
k<l&&(k=l)}else k=0;e[0]=k;g.outputSignalKR(this)}}return this};g.register("max",i)})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);g.fixAR(this);a=this._;a.src=a.func=null;a.bufferL=new g.SignalArray(j);a.bufferR=new g.SignalArray(j);a.readIndex=0;a.writeIndex=0;a.totalRead=0;a.totalWrite=0}if("browser"===h.envtype){var g=h.fn,j=4096,e=j-1;g.extend(i);var b=i.prototype;b.listen=function(a){var b=d[h.env];b&&(b.set.call(this,a),b.listen.call(this))};b.unlisten=function(){var a=d[h.env];a&&a.unlisten.call(this);for(var b=this.cells[0],c=this.cells[1],e=this.cells[2],g=b.length,
a=0;a<g;++a)b[a]=c[a]=e[a]=0;a=this._;b=a.bufferL;c=a.bufferR;a=0;for(g=b.length;a<g;++a)b[a]=c[a]=0};b.process=function(a){var b=this._;if(null===b.src)return this;if(this.tickID!==a){this.tickID=a;var a=b.bufferL,c=b.bufferR,d=this.cells[1],h=this.cells[2],i,j=d.length;if(b.totalWrite>b.totalRead+d.length){var r=b.readIndex;for(i=0;i<j;++i,++r)d[i]=a[r],h[i]=c[r];b.readIndex=r&e;b.totalRead+=d.length}g.outputSignalAR(this)}return this};var d={webkit:{set:function(a){var b=this._;a instanceof HTMLMediaElement&&
(b.src=g._audioContext.createMediaElementSource(a))},listen:function(){var a=this._,b=g._audioContext;a.gain=b.createGainNode();a.gain.gain.value=0;a.node=b.createJavaScriptNode(1024,2,1);a.node.onaudioprocess=c(this);a.src.connect(a.node);a.node.connect(a.gain);a.gain.connect(b.destination)},unlisten:function(){var a=this._;a.src&&a.src.disconnect();a.gain&&a.gain.disconnect();a.node&&a.node.disconnect()}}},c=function(a){return function(b){var c=a._,d=b.inputBuffer.getChannelData(0),b=b.inputBuffer.getChannelData(1),
g=c.bufferL,h=c.bufferR,i=c.writeIndex,j,n=d.length;for(j=0;j<n;++j,++i)g[i]=d[j],h[i]=b[j];c.writeIndex=i&e;c.totalWrite+=d.length}};d.moz={set:function(a){var b=this._;a instanceof HTMLAudioElement&&(b.src=a,b.istep=h.samplerate/a.mozSampleRate)},listen:function(){var a=this._,b=a.bufferL,c=a.bufferR,d=0,g=0;2===a.src.mozChannels?(a.x=0,a.func=function(h){var i=a.writeIndex,j=a.totalWrite,h=h.frameBuffer,n,m=a.istep,q,u=h.length;n=a.x;for(q=0;q<u;q+=2)for(n+=m;0<n;)b[i]=0.5*(h[q]+d),c[i]=0.5*(h[q+
1]+g),d=h[q],g=h[q+1],i=i+1&e,++j,n-=1;a.x=n;a.writeIndex=i;a.totalWrite=j}):(a.x=0,a.func=function(d){var g=a.writeIndex,h=a.totalWrite,d=d.frameBuffer,i,l=a.istep,j,o=d.length;i=a.x;for(j=0;j<o;++j)for(i+=l;0<=i;)b[g]=c[g]=d[j],g=g+1&e,++h,i-=1;a.x=i;a.writeIndex=g;a.totalWrite=h});a.src.addEventListener("MozAudioAvailable",a.func)},unlisten:function(){var a=this._;a.func&&(a.src.removeEventListener("MozAudioAvailable",a.func),a.func=null)}};g.register("mediastream",i)}})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);e=this._;e.midi=0;e.value=0;e.prev=null;e.a4=440;e.ar=!1}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{midi:{set:function(e){"number"===typeof e&&(this._.midi=e)},get:function(){return this._.midi}},a4:{set:function(e){"number"===typeof e&&(this._.a4=e,this._.prev=null)},get:function(){return this._.a4}}});j.bang=function(){this._.prev=null;this._.emit("bang");return this};j.at=function(e){return this._.a4*Math.pow(2,(e-69)/
12)};j.process=function(e){var b=this.cells[0],d=this._;if(this.tickID!==e){this.tickID=e;var c=this.nodes.length,e=b.length;if(d.ar&&c){g.inputSignalAR(this);for(var a=d.a4,c=0;c<e;++c)b[c]=a*Math.pow(2,(b[c]-69)/12);d.value=b[e-1];g.outputSignalAR(this)}else{c=this.nodes.length?g.inputSignalKR(this):d.midi;d.prev!==c&&(d.prev=c,d.value=d.a4*Math.pow(2,(c-69)/12));d=d.value*d.mul+d.add;for(c=0;c<e;++c)b[c]=d}}return this};g.register("midicps",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);e=this._;e.midi=0;e.value=0;e.prev=null;e.range=12;e.ar=!1}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{midi:{set:function(e){"number"===typeof e&&(this._.midi=e)},get:function(){return this._.midi}},range:{set:function(e){"number"===typeof e&&0<e&&(this._.range=e)},get:function(){return this._.range}}});j.bang=function(){this._.prev=null;this._.emit("bang");return this};j.at=function(e){return Math.pow(2,e/this._.range)};j.process=
function(e){var b=this.cells[0],d=this._;if(this.tickID!==e){this.tickID=e;var c=this.nodes.length,e=b.length;if(d.ar&&c){g.inputSignalAR(this);for(var a=d.range,c=0;c<e;++c)b[c]=Math.pow(2,b[c]/a);d.value=b[e-1];g.outputSignalAR(this)}else{c=this.nodes.length?g.inputSignalKR(this):d.midi;d.prev!==c&&(d.prev=c,d.value=Math.pow(2,c/d.range));d=d.value*d.mul+d.add;for(c=0;c<e;++c)b[c]=d}}return this};g.register("midiratio",i)})(timbre);
(function(h){function i(g){h.Object.call(this,1,g)}var g=h.fn;g.extend(i);i.prototype.process=function(h){var e=this.cells[0],b=this._;if(this.tickID!==h){this.tickID=h;var d=this.nodes,c=d.length,a,f=e.length,k,i;if(b.ar){if(0<d.length){k=d[0].process(h).cells[0];e.set(k);for(b=1;b<c;++b){k=d[b].process(h).cells[0];for(a=0;a<f;++a)i=k[a],e[a]>i&&(e[a]=i)}}else for(a=0;a<f;++a)e[a]=0;g.outputSignalAR(this)}else{if(0<d.length){k=d[0].process(h).cells[0][0];for(b=1;b<c;++b)i=d[b].process(h).cells[0][0],
k>i&&(k=i)}else k=0;e[0]=k;g.outputSignalKR(this)}}return this};g.register("min",i)})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);g.timer(this);g.fixKR(this);a=this._;a.mml="";a.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1};a.commands=[];a.index=0;a.queue=[];a.currentTime=0;a.queueTime=0;a.segnoIndex=-1;a.loopStack=[];a.prevNote=0;a.isEnded=!1;a.remain=Infinity;a.onended=g.make_onended(this);this.on("start",j)}var g=h.fn;g.extend(i);var j=function(){var a=this._;a.commands=d(a.mml);a.index=0;a.queue=[];a.currentTime=0;a.queueTime=0;a.segnoIndex=-1;a.loopStack=[];a.prevNote=0;
a.isEnded=!1;a.remain=Infinity;b(this)};Object.defineProperty(j,"unremoved",{value:!0,writable:!1});var e=i.prototype;Object.defineProperties(e,{mml:{set:function(a){var b=this._;"string"===typeof a&&(b.mml=a)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}},isEnded:{get:function(){return this._.isEnded}}});e.process=function(a){var c=this._;if(c.isEnded)return this;if(this.tickID!==a){this.tickID=a;var a=this.nodes,d=c.queue,e,h,i;if(d.length)for(;d[0][0]<=
c.currentTime;){var j=c.queue.shift();if(j[1]){h=0;for(i=a.length;h<i;++h)e=a[h],e.noteOn?e.noteOn(j[1],j[3]):e.bang();c.remain=j[4];c.emit("mml","noteOn",{noteNum:j[1],velocity:j[3]});b(this)}else{h=0;for(i=a.length;h<i;++h)e=a[h],e.noteOff?e.noteOff(j[2],j[3]):e.release&&e.release();c.emit("mml","noteOff",{noteNum:j[2],velocity:j[3]})}if(0===d.length)break}c.remain-=g.currentTimeIncr;0===d.length&&0>=c.remain&&g.nextTick(c.onended);c.currentTime+=g.currentTimeIncr}return this};var b=function(a){a=
a._;if(!a.isEnded){var b,c=a.commands,d=a.queue,e=a.index,g=a.status,h=a.queueTime,i=a.loopStack,j,m,q,u,t;u=[];a:for(;;){if(c.length<=e)if(0<=a.segnoIndex)e=a.segnoIndex;else break;b=c[e++];switch(b.name){case "n":j=g.t||120;null!==b.len?(m=b.len,q=b.dot||0):(m=g.l,q=b.dot||g.dot);j=1E3*60/j*(4/m);j*=[1,1.5,1.75,1.875][q]||1;q=g.v<<3;if(g.tie){for(b=d.length;b--;)if(d[b][2]){d.splice(b,1);break}b=a.prevNote}else b=a.prevNote=b.val+12*(g.o+1),d.push([h,b,null,q,j]);if(0<m){m=g.q/8;if(1>m){m=h+j*m;
d.push([m,null,b,q]);b=0;for(t=u.length;b<t;++b)d.push([m,null,u[b],q])}u=[];h+=j;if(!g.tie)break a}else u.push(b);g.tie=!1;break;case "r":j=g.t||120;null!==b.len?(m=b.len,q=b.dot||0):(m=g.l,q=b.dot||g.dot);0<m&&(j=1E3*60/j*(4/m),j*=[1,1.5,1.75,1.875][q]||1,h+=j);break;case "l":g.l=b.val;g.dot=b.dot;break;case "o":g.o=b.val;break;case "<":9>g.o&&(g.o+=1);break;case ">":0<g.o&&(g.o-=1);break;case "v":g.v=b.val;break;case "(":15>g.v&&(g.v+=1);break;case ")":0<g.v&&(g.v-=1);break;case "q":g.q=b.val;
break;case "&":g.tie=!0;break;case "$":a.segnoIndex=e;break;case "[":i.push([e,null,null]);break;case "|":if((j=i[i.length-1])&&1===j[1])i.pop(),e=j[2];break;case "]":if(j=i[i.length-1])null===j[1]&&(j[1]=b.count,j[2]=e),j[1]-=1,0===j[1]?i.pop():e=j[0];break;case "t":g.t=null===b.val?120:b.val}}a.index=e;a.queueTime=h}},d=function(a){var b,d,e,g,h,i,j,n=Array(a.length),m=[];h=0;for(i=c.length;h<i;++h){b=c[h];for(d=b.re;e=d.exec(a);){if(!n[e.index]){g=0;for(j=e[0].length;g<j;++g)n[e.index+g]=!0;if(g=
b.func?b.func(e):{name:e[0]})g.index=e.index,g.origin=e[0],m.push(g)}for(;d.lastIndex<a.length&&n[d.lastIndex];)++d.lastIndex}}m.sort(function(a,b){return a.index-b.index});return m},c=[{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(a){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[a[1]]+({"-":-1,"+":1}[a[2]]||0),len:""===a[3]?null:Math.min(a[3]|0,64),dot:a[4].length}}},{re:/r(\d*)(\.*)/g,func:function(a){return{name:"r",len:""===a[1]?null:Math.max(1,Math.min(a[1]|0,64)),dot:a[2].length}}},
{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(a){return{name:"l",val:""===a[1]?4:Math.min(a[1]|0,64),dot:a[2].length}}},{re:/o([0-9])/g,func:function(a){return{name:"o",val:""===a[1]?4:a[1]|0}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(a){return{name:"v",val:""===a[1]?12:Math.min(a[1]|0,15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(a){return{name:"q",val:""===a[1]?6:Math.min(a[1]|0,8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(a){return{name:"]",count:a[1]|0||2}}},{re:/t(\d*)/g,func:function(a){return{name:"t",
val:""===a[1]?null:Math.max(5,Math.min(a[1]|0,300))}}},{re:/\$/g}];g.register("mml",i)})(timbre);
(function(h){function i(a){if(e)return e;e=this;h.Object.call(this,2,a);this.X=this.L;this.Y=this.R;j.fixKR(this)}function g(a){h.Object.call(this,1,a);e||(e=new i([]));j.fixKR(this)}if("browser"===h.envtype){var j=h.fn,e=null;j.extend(i);var b=function(a){e._.emit("click",a)},d=function(a){e._.emit("mousedown",a)},c=function(a){for(var b=a.clientX/window.innerWidth,a=a.clientY/window.innerHeight,c=e.cells[1],f=e.cells[2],d=0,g=c.length;d<g;++d)c[d]=b,f[d]=a},a=function(a){e._.emit("mouseup",a)},
f=i.prototype;f.start=function(){window.addEventListener("click",b,!0);window.addEventListener("mousedown",d,!0);window.addEventListener("mousemove",c,!0);window.addEventListener("mouseup",a,!0);return this};f.stop=function(){window.removeEventListener("click",b,!0);window.removeEventListener("mousedown",d,!0);window.removeEventListener("mousemove",c,!0);window.removeEventListener("mouseup",a,!0);return this};f.play=f.pause=function(){return this};j.register("mouse",i);j.extend(g);Object.defineProperties(g.prototype,
{min:{set:function(a){var b=this._;b.min=a;b.delta=b.max-b.min;b.map.bang()},get:function(){return this._.min}},max:{set:function(a){var b=this._;b.max=a;b.delta=b.max-b.min;b.map.bang()},get:function(){return this._.max}},curve:{set:function(a){var b=this._;if(k[a]){var c=k[a];b.map.map=function(a){return c(b,a)};b.map.bang();b.curveName=a}},get:function(){return this._.curveName}}});g.prototype.start=function(){e.start();return this};g.prototype.stop=function(){e.stop();return this};g.prototype.process=
function(a){this._.map.process(a);return this};var k={lin:function(a,b){return b*a.delta+a.min},exp:function(a,b){var c=0>a.min?1.0E-6:a.min;return Math.pow(a.max/c,b)*c},sqr:function(a,b){return b*b*a.delta+a.min},cub:function(a,b){return b*b*b*a.delta+a.min}};j.register("mouse.x",function(a){var a=new g(a),b=a._;b.min=0;b.max=1;b.delta=1;b.curveName="lin";var c=k.lin;b.map=h("map",{map:function(a){return c(b,a)}},e.X);a.cells[0]=b.map.cells[0];return a});j.register("mouse.y",function(a){var a=new g(a),
b=a._;b.min=0;b.max=1;b.delta=1;b.curveName="lin";var c=k.lin;b.map=h("map",{map:function(a){return c(b,a)}},e.Y);a.cells[0]=b.map.cells[0];return a})}})(timbre);
(function(h){function i(g){h.Object.call(this,2,g)}var g=h.fn;g.extend(i);i.prototype.process=function(h){var e=this._;if(this.tickID!==h){this.tickID=h;var b=this.nodes,d=this.cells[0],c=this.cells[1],a=this.cells[2],f=b.length,k=d.length,i,o;if(e.ar){if(0<b.length){b[0].process(h);i=b[0].cells[1];o=b[0].cells[2];c.set(i);a.set(o);for(e=1;e<f;++e){b[e].process(h);i=b[e].cells[1];o=b[e].cells[2];for(d=0;d<k;++d)c[d]*=i[d],a[d]*=o[d]}}else for(d=0;d<k;++d)c[d]=a[d]=0;g.outputSignalAR(this)}else{if(0<
b.length){c=b[0].process(h).cells[0][0];for(e=1;e<f;++e)c*=b[e].process(h).cells[0][0]}else c=0;d[0]=c;g.outputSignalKR(this)}}return this};g.register("*",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);b=this._;b.defaultValue=0;b.index=0;b.dict={};b.ar=!1}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{dict:{set:function(b){if("object"===typeof b)this._.dict=b;else if("function"===typeof b){for(var d={},c=0;128>c;++c)d[c]=b(c);this._.dict=d}},get:function(){return this._.dict}},defaultValue:{set:function(b){"number"===typeof b&&(this._.defaultValue=b)},get:function(){return this._.defaultValue}},index:{set:function(b){"number"===
typeof b&&(this._.index=b)},get:function(){return this._.index}}});j.at=function(b){var d=this._;return(d.dict[b|0]||d.defaultValue)*d.mul+d.add};j.clear=function(){this._.dict={};return this};j.process=function(b){var d=this.cells[0],c=this._;if(this.tickID!==b){this.tickID=b;var a=this.nodes.length,f;f=c.dict;var e=c.defaultValue,h=c.mul,i=c.add,b=d.length;if(c.ar&&a){g.inputSignalAR(this);for(c=0;c<b;++c)a=d[c],a=0>a?a-0.5|0:a+0.5|0,d[c]=(f[a]||e)*h+i;g.outputSignalAR(this)}else{a=this.nodes.length?
g.inputSignalKR(this):c.index;f=(f[0>a?a-0.5|0:a+0.5|0]||e)*h+i;for(c=0;c<b;++c)d[c]=f}}return this};g.register("ndict",i);var e={90:48,83:49,88:50,68:51,67:52,86:53,71:54,66:55,72:56,78:57,74:58,77:59,188:60,76:61,190:62,186:63,81:60,50:61,87:62,51:63,69:64,82:65,53:66,84:67,54:68,89:69,55:70,85:71,73:72,57:73,79:74,48:75,80:76};g.register("ndict.key",function(b){b=new i(b);b.dict=e;return b})})(timbre);
(function(h){function i(g){h.Object.call(this,1,g)}var g=h.fn;g.extend(i);i.prototype.process=function(g){var e=this.cells[0],b=this._;if(this.tickID!==g){this.tickID=g;var g=b.mul,d=b.add,c;if(b.ar){b=0;for(c=e.length;b<c;++b)e[b]=(2*Math.random()-1)*g+d}else{g=(2*Math.random()+1)*g+d;b=0;for(c=e.length;b<c;++b)e[b]=g}}return this};g.register("noise",i)})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);a=this._;a.freq=h(440);a.phase=h(0);a.osc=new e(h.samplerate);a.tmp=new g.SignalArray(h.cellsize);a.osc.step=h.cellsize;this.once("init",b)}var g=h.fn,j=h.timevalue,e=h.modules.Oscillator;g.extend(i);var b=function(){var a=this._;this.wave||(this.wave="sin");a.plotData=a.osc.wave;a.plotLineWidth=2;a.plotCyclic=!0;a.plotBefore=c},d=i.prototype;Object.defineProperties(d,{wave:{set:function(a){this._.osc.setWave(a)},get:function(){return this._.osc.wave}},
freq:{set:function(a){"string"===typeof a&&(a=j(a),a=0>=a?0:1E3/a);this._.freq=h(a)},get:function(){return this._.freq}},phase:{set:function(a){this._.phase=h(a);this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(a){this._.phase=h(a);this._.osc.feedback=!0},get:function(){return this._.phase}}});d.bang=function(){this._.osc.reset();this._.emit("bang");return this};d.process=function(a){var b=this._,c=this.cells[0];if(this.tickID!==a){this.tickID=a;var d,e=c.length;if(this.nodes.length)g.inputSignalAR(this);
else for(d=0;d<e;++d)c[d]=1;d=b.osc;var h=b.freq.process(a).cells[0],i=b.phase.process(a).cells[0];d.frequency=h[0];d.phase=i[0];if(b.ar){a=b.tmp;b.freq.isAr?b.phase.isAr?d.processWithFreqAndPhaseArray(a,h,i):d.processWithFreqArray(a,h):b.phase.isAr?d.processWithPhaseArray(a,i):d.process(a);for(d=0;d<e;++d)c[d]*=a[d]}else{b=d.next();for(d=0;d<e;++d)c[d]*=b}g.outputSignalAR(this)}return this};var c;"browser"===h.envtype&&(c=function(a,b,c,d,e){e=(e>>1)+0.5;a.strokeStyle="#ccc";a.lineWidth=1;a.beginPath();
a.moveTo(b,e+c);a.lineTo(b+d,e+c);a.stroke()});g.register("osc",i);g.register("sin",function(a){return(new i(a)).set("wave","sin")});g.register("cos",function(a){return(new i(a)).set("wave","cos")});g.register("pulse",function(a){return(new i(a)).set("wave","pulse")});g.register("tri",function(a){return(new i(a)).set("wave","tri")});g.register("saw",function(a){return(new i(a)).set("wave","saw")});g.register("fami",function(a){return(new i(a)).set("wave","fami")});g.register("konami",function(a){return(new i(a)).set("wave",
"konami")});g.register("+sin",function(a){return(new i(a)).set("wave","+sin").kr()});g.register("+pulse",function(a){return(new i(a)).set("wave","+pulse").kr()});g.register("+tri",function(a){return(new i(a)).set("wave","+tri").kr()});g.register("+saw",function(a){return(new i(a)).set("wave","+saw").kr()});g.alias("square","pulse")})(timbre);
(function(h){function i(e){h.Object.call(this,2,e);g.fixAR(this);e=this._;e.value=h(0);e.panL=0.5;e.panR=0.5}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{pos:{set:function(e){this._.pos=h(e)},get:function(){return this._.pos}}});j.process=function(e){var b=this._;if(this.tickID!==e){this.tickID=e;var d=!1,c=b.pos.process(e).cells[0][0];b.prevPos!==c&&(b.prevPos=c,d=!0);d&&(b.panL=Math.cos(0.5*Math.PI*(0.5*c+0.5)),b.panR=Math.sin(0.5*Math.PI*(0.5*c+0.5)));var a=this.nodes,d=
this.cells[1],c=this.cells[2],f,h=a.length,i,j=d.length,s;for(i=0;i<j;++i)d[i]=c[i]=0;for(f=0;f<h;++f){s=a[f].process(e).cells[0];for(i=0;i<j;++i)d[i]=c[i]+=s[i]}e=b.panL;b=b.panR;for(i=0;i<j;++i)d[i]*=e,c[i]*=b;g.outputSignalAR(this)}return this};g.register("pan",i)})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);a=this._;a.value=0;a.env=new b(h.samplerate);a.env.step=h.cellsize;a.curve="lin";a.counter=0;a.ar=!1;a.onended=g.make_onended(this);this.on("ar",d)}var g=h.fn,j=h.timevalue,e=h.modules.Envelope,b=h.modules.EnvelopeValue;g.extend(i);var d=function(a){this._.env.step=a?1:h.cellsize},c=i.prototype;Object.defineProperties(c,{value:{set:function(a){"number"===typeof a&&(this._.env.value=a)},get:function(){return this._.env.value}}});c.to=function(a,b,
c){var d=this._,g=d.env;"string"===typeof b?b=j(b):"undefined"===typeof b&&(b=0);if("undefined"===typeof c)d.counter=g.setNext(a,b,e.CurveTypeLin),d.curve="lin";else{var h=e.CurveTypeDict[c];d.counter="undefined"===typeof h?g.setNext(a,b,e.CurveTypeCurve,c):g.setNext(a,b,h);d.curve=c}d.plotFlush=!0;return this};c.setAt=function(a,b){var c=this._;this.to(c.env.value,b,"set");c.atValue=a;return this};c.linTo=function(a,b){return this.to(a,b,"lin")};c.expTo=function(a,b){return this.to(a,b,"exp")};c.sinTo=
function(a,b){return this.to(a,b,"sin")};c.welTo=function(a,b){return this.to(a,b,"wel")};c.sqrTo=function(a,b){return this.to(a,b,"sqr")};c.cubTo=function(a,b){return this.to(a,b,"cub")};c.cancel=function(){var a=this._;a.counter=a.env.setNext(a.env.value,0,e.CurveTypeSet);return this};c.process=function(a){var b=this._,c=this.cells[0];if(this.tickID!==a){this.tickID=a;var d=c.length,h=b.mul,i=b.add,j=b.env,n=b.counter;if(this.nodes.length)g.inputSignalAR(this);else for(a=0;a<d;++a)c[a]=1;0<n--&&
(0>=n&&("set"===b.curve?j.setNext(b.atValue,0,e.CurveTypeSet):j.setNext(j.value,0,e.CurveTypeSet),g.nextTick(b.onended)),b.counter=n);var m,n=null;if(b.ar)for(a=0;a<d;++a)m=j.next(),c[a]=c[a]*m*h+i,null===n&&(n=b.env.emit);else{m=j.next();for(a=0;a<d;++a)c[a]=c[a]*m*h+i}b.value=m}return this};var a=h.Object.prototype.plot;c.plot=function(c){var d=this._;if(d.plotFlush){var g=new b(128),h=new Float32Array(128),i,j;if("set"===d.curve){i=100;for(j=h.length;i<j;++i)h[i]=1}else{i=e.CurveTypeDict[d.curve];
"undefined"===typeof i?g.setNext(1,1E3,e.CurveTypeCurve,d.curve):g.setNext(1,1E3,i);i=0;for(j=h.length;i<j;++i)h[i]=g.next()}d.plotData=h;d.plotRange=[0,1];d.plotFlush=null}return a.call(this,c)};g.register("param",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);b=this._;b.buffer=new g.SignalArray(h.cellsize);b.freq=h("sin",{freq:1,add:1E3,mul:250}).kr();b.Q=h(1);b.allpass=[];this.steps=2}var g=h.fn,j=h.modules.Biquad;g.extend(i);var e=i.prototype;Object.defineProperties(e,{freq:{set:function(b){this._.freq=b},get:function(){return this._.freq}},Q:{set:function(b){this._.Q=h(b)},get:function(){return this._.Q}},steps:{set:function(b){if("number"===typeof b){b|=0;if(2===b||4===b||8===b||12===
b){var d=this._.allpass;if(d.length<b)for(var c=d.length;c<b;++c)d[c]=new j(h.samplerate),d[c].setType("allpass")}this._.steps=b}},get:function(){return this._.steps}}});e.process=function(b){var d=this._,c=this.cells[0];if(this.tickID!==b){this.tickID=b;g.inputSignalAR(this);if(!d.bypassed){var a=d.freq.process(b).cells[0][0],f=d.Q.process(b).cells[0][0],e=d.steps;d.buffer.set(c);for(b=0;b<e;b+=2)d.allpass[b].setParams(a,f,0),d.allpass[b].process(d.buffer),d.allpass[b+1].setParams(a,f,0),d.allpass[b+
1].process(d.buffer);b=0;for(a=c.length;b<a;++b)c[b]=0.5*(c[b]+d.buffer[b])}g.outputSignalAR(this)}return this};g.register("phaser",i);g.alias("phaseshift","phaser")})(timbre);
(function(h){function i(i){h.Object.call(this,1,i);g.fixAR(this);for(var i=new Uint8Array(5),e=0;5>e;++e)i[e]=(1073741824*Math.random()|0)%25;this._.whites=i;this._.key=0}var g=h.fn;g.extend(i);i.prototype.process=function(g){var e=this.cells[0],b=this._;if(this.tickID!==g){this.tickID=g;var d,c,a=b.key,f=b.whites,h=b.mul,i=b.add,o,s,g=0;for(d=e.length;g<d;++g){c=a++;31<a&&(a=0);s=c^a;for(c=o=0;5>c;++c)s&1<<c&&(f[c]=(1073741824*Math.random()|0)%25),o+=f[c];e[g]=(0.01666666*o-1)*h+i}b.key=a}return this};
g.register("pink",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);this._.freq=440;this._.buffer=null;this._.readIndex=0;this._.writeIndex=0}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{freq:{set:function(e){"number"===typeof e&&(0>e&&(e=0),this._.freq=e)},get:function(){return this._.freq}}});j.bang=function(){for(var e=this._,b=h.samplerate/e.freq+0.5|0,d=e.buffer=new g.SignalArray(b<<1),c=0;c<b;++c)d[c]=2*Math.random()-1;e.readIndex=0;e.writeIndex=b;e.emit("bang");return this};j.process=
function(e){var b=this.cells[0],d=this._;if(this.tickID!==e&&(this.tickID=e,e=d.buffer)){var c=e.length,a=d.readIndex,f=d.writeIndex,g=d.mul,h=d.add,i,j,p=b.length;for(j=0;j<p;++j)i=e[a++],a>=c&&(a=0),i=0.5*(i+e[a]),e[f++]=i,f>=c&&(f=0),b[j]=i*g+h;d.readIndex=a;d.writeIndex=f}return this};g.register("pluck",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);g.listener(this);g.fixAR(this);c=this._;c.timeout=5E3;c.samplerate=h.samplerate;c.status=e;c.writeIndex=0;c.writeIndexIncr=1;c.currentTime=0;c.currentTimeIncr=1E3/h.samplerate;c.onended=b(this)}var g=h.fn,j=h.timevalue,e=0;g.extend(i);var b=function(b){return function(){var a=b._,d=new g.SignalArray(a.buffer.subarray(0,a.writeIndex|0));a.status=e;a.writeIndex=0;a.currentTime=0;a.emit("ended",{buffer:d,samplerate:a.samplerate})}},d=i.prototype;Object.defineProperties(d,
{timeout:{set:function(b){"string"===typeof b&&(b=j(b));"number"===typeof b&&0<b&&(this._.timeout=b)},get:function(){return this._.timeout}},samplerate:{set:function(b){"number"===typeof b&&(0<b&&b<=h.samplerate)&&(this._.samplerate=b)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}});d.start=function(){var b=this._,a;if(b.status===e){a=0.01*b.timeout*b.samplerate|0;if(!b.buffer||b.buffer.length<a)b.buffer=new g.SignalArray(a);b.writeIndex=0;b.writeIndexIncr=
b.samplerate/h.samplerate;b.currentTime=0;b.status=1;b.emit("start");this.listen()}return this};d.stop=function(){var b=this._;1===b.status&&(b.status=e,b.emit("stop"),g.nextTick(b.onended),this.unlisten());return this};d.bang=function(){this._.status===e?this.srart():1===this._.status&&this.stop();this._.emit("bang");return this};d.process=function(b){var a=this._,d=this.cells[0];if(this.tickID!==b){this.tickID=b;g.inputSignalAR(this);if(1===a.status){for(var e=d.length,h=a.buffer,i=a.timeout,j=
a.writeIndex,p=a.writeIndexIncr,r=a.currentTime,n=a.currentTimeIncr,b=0;b<e;++b)h[j|0]=d[b],j+=p,r+=n,i<=r&&g.nextTick(a.onended);a.writeIndex=j;a.currentTime=r}g.outputSignalAR(this)}return this};g.register("record",i);g.alias("rec","record")})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.fixAR(this);this._.reverb=new j(h.samplerate,h.cellsize)}var g=h.fn,j=h.modules.Reverb;g.extend(i);var e=i.prototype;Object.defineProperties(e,{room:{set:function(b){"number"===typeof b&&this._.reverb.setRoomSize(1<b?1:0>b?0:b)},get:function(){return this._.reverb.roomsize}},damp:{set:function(b){"number"===typeof b&&this._.reverb.setDamp(1<b?1:0>b?0:b)},get:function(){return this._.reverb.damp}},mix:{set:function(b){"number"===typeof b&&(this._.reverb.wet=
1<b?1:0>b?0:b)},get:function(){return this._.reverb.wet}}});e.process=function(b){var d=this._,c=this.cells[0];this.tickID!==b&&(this.tickID=b,g.inputSignalAR(this),d.bypassed||d.reverb.process(c),g.outputSignalAR(this));return this};g.register("reverb",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.timer(this);g.fixKR(this);b=this._;b.queue=[];b.currentTime=0;b.maxRemain=1E3}var g=h.fn,j=h.timevalue;g.extend(i);var e=i.prototype;Object.defineProperties(e,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(b){"number"===typeof b&&0<b&&(this._.maxRemain=b)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}});
e.sched=function(b,d){"string"===typeof b&&(b=j(b));"number"===typeof b&&this.schedAbs(this._.currentTime+b,d);return this};e.schedAbs=function(b,d){"string"===typeof b&&(b=j(b));if("number"===typeof b){var c=this._,a=c.queue;if(a.length>=c.maxRemain)return this;for(c=a.length;c--&&!(a[c][0]<b););a.splice(c+1,0,[b,h(d)])}return this};e.advance=function(b){"string"===typeof b&&(b=j(b));"number"===typeof b&&(this._.currentTime+=b);return this};e.clear=function(){this._.queue.splice(0);return this};
e.process=function(b){var d=this._;if(d.isEnded)return this;if(this.tickID!==b){this.tickID=b;var b=null,c=d.queue;if(c.length)for(;c[0][0]<d.currentTime;)if(d.queue.shift()[1].bang(),b="sched",0===c.length){b="empty";break}d.currentTime+=g.currentTimeIncr;b&&d.emit(b)}return this};g.register("schedule",i);g.alias("sche","schedule")})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);g.listener(this);g.fixAR(this);this._.samples=0;this._.writeIndex=0;this._.plotFlush=!0;this.once("init",e)}var g=h.fn,j=h.timevalue;g.extend(i);var e=function(){this._.buffer||(this.size=1024);this._.interval||(this.interval=1E3)},b=i.prototype;Object.defineProperties(b,{size:{set:function(b){var a=this._;!a.buffer&&"number"===typeof b&&(a.buffer=new g.SignalArray(64>b?64:2048<b?2048:b),a.reservedinterval&&(this.interval=a.reservedinterval,a.reservedinterval=
null))},get:function(){return this._.buffer.length}},interval:{set:function(b){var a=this._;"string"===typeof b&&(b=j(b));"number"===typeof b&&0<b&&(a.buffer?(a.interval=b,a.samplesIncr=0.001*b*h.samplerate/a.buffer.length,1>a.samplesIncr&&(a.samplesIncr=1)):a.reservedinterval=b)},get:function(){return this._.interval}}});b.bang=function(){for(var b=this._,a=b.buffer,d=0,e=a.length;d<e;++d)a[d]=0;b.samples=0;b.writeIndex=0;this._.emit("bang");return this};b.process=function(b){var a=this._,d=this.cells[0];
if(this.tickID!==b){this.tickID=b;g.inputSignalAR(this);for(var e=d.length,h=a.samples,i=a.samplesIncr,j=a.buffer,p=a.writeIndex,r=!1,n=a.mul,m=a.add,q=j.length-1,b=0;b<e;++b)0>=h&&(j[p++]=d[b],p&=q,r=a.plotFlush=!0,h+=i),d[b]=d[b]*n+m,--h;a.samples=h;a.writeIndex=p;r&&this._.emit("data")}return this};var d=h.Object.prototype.plot;b.plot=function(b){var a=this._;if(a.plotFlush){for(var f=a.buffer,e=f.length-1,g=new Float32Array(f.length),h=a.writeIndex,i=0,j=f.length;i<j;i++)g[i]=f[++h&e];a.plotData=
g;a.plotFlush=null}return d.call(this,b)};g.register("scope",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);this._.selected=0;this._.background=!1}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{selected:{set:function(e){if("number"===typeof e){this._.selected=e;for(var e=this.cells[0],b=0,d=e.length;b<d;++b)e[b]=0}},get:function(){return this._.selected}},background:{set:function(e){this._.background=!!e},get:function(){return this._.background}}});j.process=function(e){var b=this._,d=this.cells[0];if(this.tickID!==e){this.tickID=e;
var c=this.nodes,a,f=c.length;if(b.background)for(a=0;a<f;++a)c[a].process(e);(b=c[b.selected])&&d.set(b.process(e).cells[0]);g.outputSignalAR(this)}return this};g.register("selector",i)})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);g.listener(this);g.fixAR(this);a=this._;a.status=0;a.samples=0;a.samplesIncr=0;a.writeIndex=0;a.plotFlush=!0;a.plotRange=[0,32];a.plotBarStyle=!0;this.once("init",b)}var g=h.fn,j=h.timevalue,e=h.modules.FFT;g.extend(i);var b=function(){var a=this._;a.fft||(this.size=512);a.interval||(this.interval=500)},d=i.prototype;Object.defineProperties(d,{size:{set:function(a){var b=this._;if(!b.fft&&"number"===typeof a&&(b.fft=new e(256>a?256:2048<a?2048:a),
b.buffer=new g.SignalArray(b.fft.length),b.freqs=new g.SignalArray(b.fft.length>>1),b.reservedwindow&&(b.fft.setWindow(b.reservedwindow),b.reservedwindow=null),b.reservedinterval))this.interval=b.reservedinterval,b.reservedinterval=null},get:function(){return this._.buffer.length}},window:{set:function(a){this._.fft.setWindow(a)},get:function(){return this._.fft.windowName}},interval:{set:function(a){var b=this._;"string"===typeof a&&(a=j(a));"number"===typeof a&&0<a&&(b.buffer?(b.interval=a,b.samplesIncr=
0.001*a*h.samplerate,b.samplesIncr<b.buffer.length&&(b.samplesIncr=b.buffer.length,b.interval=1E3*b.samplesIncr/h.samplerate)):b.reservedinterval=a)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}});d.bang=function(){this._.samples=0;this._.writeIndex=0;this._.emit("bang");return this};d.process=function(a){var b=this._,c=this.cells[0];if(this.tickID!==
a){this.tickID=a;g.inputSignalAR(this);for(var d=c.length,e=b.status,h=b.samples,i=b.samplesIncr,j=b.writeIndex,n=b.buffer,m=n.length,q=b.mul,u=b.add,t,a=0;a<d;++a)0>=h&&0===e&&(e=1,j=0,h+=i),1===e&&(n[j++]=c[a],m<=j&&(b.fft.forward(n),t=b.plotFlush=!0,e=0)),c[a]=c[a]*q+u,--h;b.samples=h;b.status=e;b.writeIndex=j;t&&this._.emit("data")}return this};var c=h.Object.prototype.plot;d.plot=function(a){this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null);return c.call(this,a)};g.register("spectrum",
i)})(timbre);
(function(h){function i(g){h.Object.call(this,2,g);this._.ar=!1}var g=h.fn;g.extend(i);i.prototype.process=function(h){var e=this._;if(this.tickID!==h){this.tickID=h;var b=this.nodes,d=this.cells[0],c=this.cells[1],a=this.cells[2],f,i=b.length,l=d.length,o;if(e.ar){if(0<b.length){b[0].process(h);e=b[0].cells[1];o=b[0].cells[2];c.set(e);a.set(o);for(f=1;f<i;++f){b[f].process(h);e=b[f].cells[1];o=b[f].cells[2];for(d=0;d<l;++d)c[d]-=e[d],a[d]-=o[d]}}else for(d=0;d<l;++d)c[d]=a[f]=0;g.outputSignalAR(this)}else{if(0<b.length){c=
b[0].process(h).cells[0][0];for(f=1;f<i;++f)c-=b[f].process(h).cells[0][0]}else c=0;d[0]=c;g.outputSignalKR(this)}}return this};g.register("-",i)})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);g.fixAR(this);a=this._;a.poly=4;a.genList=[];a.genDict={};a.synthdef=null;a.isEnded=!0;a.remGen=b(this);a.onended=g.make_onended(this)}var g=h.fn;g.extend(i);var j=i.prototype;Object.defineProperties(j,{def:{set:function(a){"function"===typeof a&&(this._.synthdef=a)},get:function(){return this._.synthdef}},poly:{set:function(a){"number"===typeof a&&(0<a&&64>=a)&&(this._.poly=a)},get:function(){return this._.poly}}});var e=function(a,b){return function(){a._.remGen(b.gen)}},
b=function(a){return function(b){var c=a._,d=c.genList.indexOf(b);-1!==d&&c.genList.splice(d,1);c.genDict[b.noteNum]=null}},d=function(a,b,c,d){c|=0;0>=c?this.noteOff(this,a):127<c&&(c=127);var g=this._,i=g.genList,j=g.genDict,n=j[a];n&&g.remGen(n);b={freq:b,noteNum:a,velocity:c};if(d)for(var m in d)b[m]=d[m];b.doneAction=e(this,b);n=this._.synthdef.call(this,b);n instanceof h.Object&&(n.noteNum=a,i.push(n),j[a]=b.gen=n,g.isEnded=!1,i.length>g.poly&&g.remGen(i[0]))},c=function(){for(var a=new Float32Array(128),
b=0;128>b;++b)a[b]=440*Math.pow(2,1*(b-69)/12);return a}();j.noteOn=function(a,b,e){var g=c[a]||440*Math.pow(2,(a-69)/12);d.call(this,a+0.5|0,g,b,e);return this};j.noteOff=function(a){(a=this._.genDict[a])&&a.release&&a.release();return this};j.noteOnWithFreq=function(a,b,c){var e=0<a?12*Math.log(1*a/440)*Math.LOG2E+69:0;d.call(this,e+0.5|0,a,b,c);return this};j.noteOffWithFreq=function(a){return this.noteOff((0<a?12*Math.log(1*a/440)*Math.LOG2E+69:0)+0.5|0)};j.allNoteOff=function(){for(var a=this._.genList,
b=0,c=a.length;b<c;++b)a[b].release&&a[b].release()};j.allSoundOff=function(){for(var a=this._,b=a.genList,a=a.genDict;b.length;)delete a[b.shift().noteNum]};j.process=function(a){var b=this.cells[0],c=this._;if(this.tickID!==a){this.tickID=a;g.inputSignalAR(this);if(!c.isEnded){var d,e,h,i,j=b.length,m;d=c.genList;e=0;for(h=d.length;e<h;++e){m=d[e].process(a).cells[0];for(i=0;i<j;++i)b[i]+=m[i]}0===h&&g.nextTick(c.onended)}g.outputSignalAR(this)}return this};g.register("SynthDef",i);var a={set:function(a){g.isDictionary(a)?
"string"===typeof a.type&&(this._.env=a):a instanceof h.Object&&(this._.env=a)},get:function(){return this._.env}};g.register("OscGen",function(){var b={set:function(a){"string"===typeof a&&(this._.wave=a)},get:function(){return this._.wave}},c=function(a){var b=this._,c,d;c=b.env||{};d=c.type||"perc";b=h("osc",{wave:b.wave,freq:a.freq,mul:a.velocity/128});c instanceof h.Object?"function"===typeof c.clone&&(b=c.clone().append(b)):b=h(d,c,b);b.on("ended",a.doneAction).bang();return b};return function(d){d=
new i(d);d._.wave="sin";Object.defineProperties(d,{env:a,wave:b});d.def=c;return d}}());g.register("PluckGen",function(){var b=function(a){var b,c,d;c=this._.env||{};d=c.type||"perc";b=h("pluck",{freq:a.freq,mul:a.velocity/128}).bang();c instanceof h.Object?"function"===typeof c.clone&&(b=c.clone().append(b)):b=h(d,c,b);b.on("ended",a.doneAction).bang();return b};return function(c){c=new i(c);Object.defineProperties(c,{env:a});c.def=b;return c}}())})(timbre);
(function(h){function i(b){h.Object.call(this,2,b);g.fixAR(this);b=this._;b.isLooped=!1;b.isEnded=!1;b.onended=g.make_onended(this,0)}var g=h.fn,j=h.modules.Scissor,e=j.Tape,b=j.TapeStream;g.extend(i);var d=i.prototype;Object.defineProperties(d,{tape:{set:function(c){if(c instanceof e)this._.tape=c,this._.tapeStream=new b(c,h.samplerate),this._.isEnded=!1;else if("object"===typeof c&&(c.buffer instanceof Float32Array||c.buffer instanceof Float64Array))this._.tape=new j(c),this._.tapeStream=new b(c,
h.samplerate),this._.isEnded=!1},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},isEnded:{get:function(){return this._.isEnded}}});d.loop=function(b){this._.isLooped=!!b;this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped);return this};d.bang=function(){this._.tapeStream&&this._.tapeStream.reset();this._.isEnded=!1;this._.emit("bang");return this};d.process=function(b){var a=this._;if(this.tickID!==b){this.tickID=b;if(b=a.tapeStream){var d=this.cells[1],
e=this.cells[2],h=b.fetch(d.length);d.set(h[0]);e.set(h[1]);!a.isEnded&&b.isEnded&&g.nextTick(a.onended)}g.outputSignalAR(this)}return this};g.register("tape",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);g.timer(this);g.fixKR(this);c=this._;c.currentTime=0;c.samplesMax=0;c.samples=0;c.isEnded=!0;c.onended=g.make_onended(this);this.once("init",e);this.on("start",b)}var g=h.fn,j=h.timevalue;g.extend(i);var e=function(){this._.timeout||(this.timeout=1E3)},b=function(){this._.isEnded=!1};Object.defineProperty(b,"unremovable",{value:!0,writable:!1});var d=i.prototype;Object.defineProperties(d,{timeout:{set:function(b){var a=this._;"string"===typeof b&&
(b=j(b));"number"===typeof b&&0<=b&&(a.timeout=b,a.samplesMax=h.samplerate*0.001*b|0,a.samples=a.samplesMax,a.isEnded=!1)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}});d.bang=function(){var b=this._;b.samples=b.samplesMax;b.currentTime=0;b.isEnded=!1;b.emit("bang");return this};d.process=function(b){var a=this.cells[0],d=this._;if(d.isEnded)return this;if(this.tickID!==b){this.tickID=b;0<d.samples&&(d.samples-=a.length);if(0>=d.samples){for(var b=
this.nodes,a=0,e=b.length;a<e;++a)b[a].bang();g.nextTick(d.onended)}d.currentTime+=g.currentTimeIncr}return this};g.register("timeout",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);b=this._;b.inMin=0;b.inMax=1;b.outMin=0;b.outMax=1;b.ar=!1;this.once("init",j)}var g=h.fn;g.extend(i);var j=function(){this._.warp||(this.warp="linlin")},e=i.prototype;Object.defineProperties(e,{inMin:{set:function(b){"number"===typeof b&&(this._.inMin=b)},get:function(){return this._.inMin}},inMax:{set:function(b){"number"===typeof b&&(this._.inMax=b)},get:function(){return this._.inMax}},outMin:{set:function(b){"number"===typeof b&&(this._.outMin=
b)},get:function(){return this._.outMin}},outMax:{set:function(b){"number"===typeof b&&(this._.outMax=b)},get:function(){return this._.outMax}},warp:{set:function(d){if("string"===typeof d){var c=b[d];c&&(this._.warp=c,this._.warpName=d)}},get:function(){return this._.warpName}}});e.process=function(b){var c=this._,a=this.cells[0];if(this.tickID!==b){this.tickID=b;var e=c.inMin,h=c.inMax,i=c.outMin,j=c.outMax,s=c.warp,p=this.nodes.length,r=c.mul,n=c.add,b=a.length;if(c.ar&&p){g.inputSignalAR(this);
for(c=0;c<b;++c)a[c]=s(a[c],e,h,i,j)*r+n;g.outputSignalAR(this)}else{c=this.nodes.length?g.inputSignalKR(this):0;e=s(c,e,h,i,j)*r+n;for(c=0;c<b;++c)a[c]=e}}return this};var b={linlin:function(b,c,a,e,g){return b<c?e:b>a?g:a===c?e:(b-c)/(a-c)*(g-e)+e},linexp:function(b,c,a,e,g){return b<c?e:b>a?g:0===e?0:a===c?g:Math.pow(g/e,(b-c)/(a-c))*e},explin:function(b,c,a,e,g){return b<c?e:b>a?g:0===c?g:Math.log(b/c)/Math.log(a/c)*(g-e)+e},expexp:function(b,c,a,e,g){return b<c?e:b>a?g:0===c||0===e?0:Math.pow(g/
e,Math.log(b/c)/Math.log(a/c))*e}};g.register("zmap",i)})(timbre);
