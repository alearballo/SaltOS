(function(h){var i=Array.prototype.slice,f=Array.isArray,k=function(a){return"object"===typeof a&&a.constructor===Object},e=0,c=0,d=1,b=null,a={},g={},l="undefined"!==typeof module&&module.exports?"node":"undefined"!==typeof window?"browser":"unknown",m;m="browser"===l&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent)?!0:!1;var j=!1,r={},u=function(){var b=i.call(arguments),d=b[0],c;switch(typeof d){case "string":a[d]?c=new a[d](b.slice(1)):g[d]?c=g[d](b.slice(1)):console.warn('T("'+d+'") is not defined.');
break;case "number":c=new G(b);break;case "boolean":c=new I(b);break;case "function":c=new F(b);break;case "object":if(null!==d){if(d instanceof y)return d;if(d.context instanceof y)return d.context;d.constructor===Object?c=new J(b):f(d)&&(c=new K(b))}}c===h?(c=new G([0]),c._.isUndefined=!0):c._.isUndefined=!1;c._.originkey=d;for(var b=c._,d=c._.meta,l,m,j=c;null!==j&&j.constructor!==Object;){l=Object.getOwnPropertyNames(j);for(var e=0,r=l.length;e<r;++e)if(!d[l[e]])if(/^(constructor$|process$|_)/.test(l[e]))d[l[e]]=
"ignore";else if(m=Object.getOwnPropertyDescriptor(j,l[e]),"function"===typeof m.value)d[l[e]]="function";else if(m.get||m.set)d[l[e]]="property";j=Object.getPrototypeOf(j)}b.meta=d;c._.emit("init");return c},q=function(){return u.apply(null,arguments)},n=q.fn={},o=q.modules={};n.SignalArray=Float32Array;n.currentTimeIncr=0;n.emptycell=null;n.FINISHED_STATE=c;n.PLAYING_STATE=d;n.UNSCHEDULED_STATE=2;n.SCHEDULED_STATE=3;(function(){var a={};o.ready=function(b,g){a[b]=g};o.ready.done=function(b,g){var d=
a[b];d&&d(g);delete a[b]}})();Object.defineProperties(q,{version:{get:function(){return"WORKING"}},envtype:{get:function(){return l}},envmobile:{get:function(){return m}},env:{get:function(){return b.impl.env}},samplerate:{get:function(){return b.samplerate}},channels:{get:function(){return b.channels}},cellsize:{get:function(){return b.cellsize}},currentTime:{get:function(){return b.currentTime}},isPlaying:{get:function(){return 1===b.status}},isRecording:{get:function(){return 2===b.status}},amp:{set:function(a){"number"===
typeof a&&(b.amp=a)},get:function(){return b.amp}}});q.bind=function(a,g){b.bind(a,g);return q};q.setup=function(a){b.setup(a);return q};q.play=function(){b.play();return q};q.pause=function(){b.pause();return q};q.reset=function(){b.reset();b.events.emit("reset");return q};q.on=function(a,g){b.on(a,g);return q};q.addListener=q.on;q.once=function(a,g){b.once(a,g);return q};q.off=function(a,g){b.removeListener(a,g);return q};q.removeListener=q.off;q.removeAllListeners=function(a){b.removeAllListeners(a);
return q};q.listeners=function(a){return b.listeners(a)};q.rec=function(){return b.rec.apply(b,arguments)};q.use=function(a){f(r[a])&&r[a].forEach(function(a){a()});return this};q.timevalue=function(a){var b;if(b=/^(\d+(?:\.\d+)?)Hz$/i.exec(a))return 0===+b[1]?0:1E3/+b[1];if(b=/^bpm(\d+(?:\.\d+)?)?\s*(?:l(\d+))?(\.*)$/i.exec(a)){a=b[1];if(a===h)a=120;else if(a=+b[1],5>a||300<a)a=120;var g=b[2]?b[2]|0:4;return 0===a||0===g?0:b=1E3*(60/a*(4/g))*([1,1.5,1.75,1.875][(b[3]||"").length]||1)}if(b=/^bpm(\d+(?:\.\d+)?)?\s*(\d+)\.(\d+)\.(\d+)$/i.exec(a)){a=
b[1];if(a===h)a=120;else if(a=+b[1],5>a||300<a)a=120;b=1920*(b[2]|0)+480*(b[3]|0)+(b[4]|0);return 1E3*60/a*(b/480)}if(b=/^(\d+(?:\.\d+)?)secs?$/i.exec(a))return 1E3*+b[1];if(b=/^(\d+(?:\.\d+)?)mins?$/i.exec(a))return 6E4*+b[1];if(b=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(a))return a=3600*(b[1]|0)+60*(b[2]|0)+(b[3]|0),a=1E3*a+(((b[4]||"")+"00").substr(0,3)|0);if(b=/^bpm(\d+(?:\.\d+)?)?\s*(?:(\d+)ticks)?$/i.exec(a)){a=b[1];if(a===h)a=120;else if(a=+b[1],5>
a||300<a)a=120;b=b[2]?b[2]|0:480;return 0===a?0:1E3*60/a*(b/480)}return(b=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(a))?(a=b[2]?b[2]|0:q.samplerate,0===a?0:1E3*((b[1]|0)/a)):(b=/^(\d+)(?:ms)?$/i.exec(a))?b[1]|0:0};n.use=function(a,b){f(r[a])?r[a].push(b):r[a]=[b]};n.isDictionary=k;var p=function(){return this};n.nop=p;var s=function(a,b){function g(){this.constructor=a}var b=b||y,d;for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);g.prototype=b.prototype;a.prototype=new g;a.__super__=b.prototype;return a};n.extend=
s;var w=function(a,b){for(var g=a&&a.prototype;g;){if(g===b.prototype)return!0;g=Object.getPrototypeOf(g)}return!1};n.constructorof=w;n.register=function(b,d){w(d,y)?a[b]=d:g[b]=d};n.alias=function(b,d){a[d]?a[b]=a[d]:g[d]&&(g[b]=g[d])};n.getClass=function(b){return a[b]};n.nextTick=function(a){b.nextTick(a);return q};var t=function(a){a._.ar=!0;a._.aronly=!0};n.fixAR=t;var v=function(a){a._.ar=!1;a._.kronly=!0};n.fixKR=v;var z=function(){var a=this._,a=a.value*a.mul+a.add;isNaN(a)&&(a=0);for(var b=
this.cells[0],g=0,d=b.length;g<d;++g)b[g]=a};Object.defineProperty(z,"unremovable",{value:!0,writable:!1});n.changeWithValue=z;var A=function(){var a=function(a){return function(){-1===b.timers.indexOf(a)&&(b.timers.push(a),b.events.emit("addObject"),a._.emit("start"))}},g=function(a){return function(){var g=b.timers.indexOf(a);-1!==g&&(b.timers.splice(g,1),a._.emit("stop"),b.events.emit("removeObject"))}};return function(d){var c=a(d),l=g(d);d.start=function(){b.nextTick(c);return d};d.stop=function(){b.nextTick(l);
return d};return d}}();n.timer=A;A=function(){var a=function(a){return function(){-1===b.listeners.indexOf(a)&&(b.listeners.push(a),b.events.emit("addObject"),a._.emit("listen"))}},g=function(a){return function(){var g=b.listeners.indexOf(a);-1!==g&&(b.listeners.splice(g,1),a._.emit("unlisten"),b.events.emit("removeObject"))}};return function(d){var c=a(d),l=g(d);d.listen=function(){arguments.length&&d.append.apply(d,arguments);d.nodes.length&&b.nextTick(c);return d};d.unlisten=function(){arguments.length&&
d.remove.apply(d,arguments);d.nodes.length||b.nextTick(l);return d};return d}}();n.listener=A;n.make_onended=function(a,b){return function(){a.playbackState=c;if("number"===typeof b)for(var g=a.cells[0],d=a.cells[1],l=a.cells[2],m=0,j=d.length;m<j;++m)g[0]=d[m]=l[m]=b;a._.emit("ended")}};n.inputSignalAR=function(a){var b=a.cells[0],g=a.cells[1],c=a.cells[2],l=a.nodes,m=l.length,j,e=b.length,r=a.tickID,f,u;if(2===a.numChannels){f=!0;if(0!==m){for(a=0;a<m;++a)if(l[a].playbackState===d){l[a].process(r);
g.set(l[a].cells[1]);c.set(l[a].cells[2]);f=!1;++a;break}for(;a<m;++a)if(l[a].playbackState===d){l[a].process(r);b=l[a].cells[1];u=l[a].cells[2];for(j=e;j;)j-=8,g[j]+=b[j],c[j]+=u[j],g[j+1]+=b[j+1],c[j+1]+=u[j+1],g[j+2]+=b[j+2],c[j+2]+=u[j+2],g[j+3]+=b[j+3],c[j+3]+=u[j+3],g[j+4]+=b[j+4],c[j+4]+=u[j+4],g[j+5]+=b[j+5],c[j+5]+=u[j+5],g[j+6]+=b[j+6],c[j+6]+=u[j+6],g[j+7]+=b[j+7],c[j+7]+=u[j+7]}}f&&(g.set(n.emptycell),c.set(n.emptycell))}else{f=!0;if(0!==m){for(a=0;a<m;++a)if(l[a].playbackState===d){l[a].process(r);
b.set(l[a].cells[1]);f=!1;++a;break}for(;a<m;++a)if(l[a].playbackState===d){g=l[a].process(r).cells[0];for(j=e;j;)j-=8,b[j]+=g[j],b[j+1]+=g[j+1],b[j+2]+=g[j+2],b[j+3]+=g[j+3],b[j+4]+=g[j+4],b[j+5]+=g[j+5],b[j+6]+=g[j+6],b[j+7]+=g[j+7]}}f&&b.set(n.emptycell)}};n.inputSignalKR=function(a){for(var b=a.nodes,g=b.length,c=a.tickID,j=0,a=0;a<g;++a)b[a].playbackState===d&&(j+=b[a].process(c).cells[0][0]);return j};n.outputSignalAR=function(a){var b=a.cells[0],g=a.cells[1],d=a.cells[2],c=a._.mul,j=a._.add;
if(2===a.numChannels)for(a=b.length;a;)a-=8,g[a]=g[a]*c+j,d[a]=d[a]*c+j,g[a+1]=g[a+1]*c+j,d[a+1]=d[a+1]*c+j,g[a+2]=g[a+2]*c+j,d[a+2]=d[a+2]*c+j,g[a+3]=g[a+3]*c+j,d[a+3]=d[a+3]*c+j,g[a+4]=g[a+4]*c+j,d[a+4]=d[a+4]*c+j,g[a+5]=g[a+5]*c+j,d[a+5]=d[a+5]*c+j,g[a+6]=g[a+6]*c+j,d[a+6]=d[a+6]*c+j,g[a+7]=g[a+7]*c+j,d[a+7]=d[a+7]*c+j,b[a]=0.5*(g[a]+d[a]),b[a+1]=0.5*(g[a+1]+d[a+1]),b[a+2]=0.5*(g[a+2]+d[a+2]),b[a+3]=0.5*(g[a+3]+d[a+3]),b[a+4]=0.5*(g[a+4]+d[a+4]),b[a+5]=0.5*(g[a+5]+d[a+5]),b[a+6]=0.5*(g[a+6]+d[a+
6]),b[a+7]=0.5*(g[a+7]+d[a+7]);else if(1!==c||0!==j)for(a=b.length;a;)a-=8,b[a]=b[a]*c+j,b[a+1]=b[a+1]*c+j,b[a+2]=b[a+2]*c+j,b[a+3]=b[a+3]*c+j,b[a+4]=b[a+4]*c+j,b[a+5]=b[a+5]*c+j,b[a+6]=b[a+6]*c+j,b[a+7]=b[a+7]*c+j};n.outputSignalKR=function(a){var b=a.cells[0],g=a.cells[1],d=a.cells[2],c=b[0]*a._.mul+a._.add;if(2===a.numChannels)for(a=b.length;a;)a-=8,b[a]=b[a+1]=b[a+2]=b[a+3]=b[a+4]=b[a+5]=b[a+6]=b[a+7]=g[a]=g[a+1]=g[a+2]=g[a+3]=g[a+4]=g[a+5]=g[a+6]=g[a+7]=d[a]=d[a+1]=d[a+2]=d[a+3]=d[a+4]=d[a+5]=
d[a+6]=d[a+7]=c;else for(a=b.length;a;)a-=8,b[a]=b[a+1]=b[a+2]=b[a+3]=b[a+4]=b[a+5]=b[a+6]=b[a+7]=c};n.fix_iOS6_1_problem=function(a){b.fix_iOS6_1_problem(a)};var y=function(){function a(g,c){this._={};var j=this._.events=new o.EventEmitter(this);this._.emit=function(){return j.emit.apply(j,arguments)};if(k(c[0])){var l=c.shift();this.once("init",function(){this.set(l)})}this.tickID=-1;this.nodes=c.map(q);this.cells=[];this.numChannels=g;switch(g){case 0:this.L=this.R=new C(null);this.cells[0]=this.cells[1]=
this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new C(this);this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new C(this),this.R=new C(this),this.cells[0]=new n.SignalArray(b.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=d;this._.ar=!0;this._.mul=1;this._.add=0;this._.dac=null;this._.bypassed=!1;this._.meta={};this._.cellsize=b.cellsize}var g=a.prototype;Object.defineProperties(g,{isUndefined:{get:function(){return this._.isUndefined}},
isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(this.playbackState&1)}},mul:{set:function(a){"number"===typeof a&&(this._.mul=a,this._.emit("setMul",a))},get:function(){return this._.mul}},add:{set:function(a){"number"===typeof a&&(this._.add=a,this._.emit("setAdd",a))},get:function(){return this._.add}}});g.toString=function(){return this.constructor.name};g.valueOf=function(){b.tickID!==
this.tickID&&this.process(b.tickID);return this.cells[0][0]};g.append=function(){if(0<arguments.length){var a=i.call(arguments).map(q);this.nodes=this.nodes.concat(a);this._.emit("append",a)}return this};g.appendTo=function(a){a.append(this);return this};g.remove=function(){if(0<arguments.length){for(var a,b=this.nodes,g=[],d=0,c=arguments.length;d<c;++d)if(-1!==(a=b.indexOf(arguments[d])))g.push(b[a]),b.splice(a,1);0<g.length&&this._.emit("remove",g)}return this};g.removeFrom=function(a){a.remove(this);
return this};g.removeAll=function(){var a=this.nodes.slice();this.nodes=[];0<a.length&&this._.emit("remove",a);return this};g.removeAtIndex=function(a){var b=this.nodes[a];b&&(this.nodes.splice(a,1),this._.emit("remove",[b]));return this};g.on=g.addListener=function(a,b){this._.events.on(a,b);return this};g.once=function(a,b){this._.events.once(a,b);return this};g.off=g.removeListener=function(a,b){this._.events.removeListener(a,b);return this};g.removeAllListeners=function(a){this._.events.removeAllListeners(a);
return this};g.listeners=function(a){return this._.events.listeners(a)};g.set=function(a,b){var g,d,c=this._.meta;switch(typeof a){case "string":switch(c[a]){case "property":this[a]=b;break;case "function":this[a](b);break;default:for(g=this;null!==g;){if(d=Object.getOwnPropertyDescriptor(g,a))if("function"===typeof d.value)c[a]="function",this[a](b);else if(d.get||d.set)c[a]="property",this[a]=b;g=Object.getPrototypeOf(g)}}break;case "object":for(g in a)this.set(g,a[g])}return this};g.get=function(a){if("property"===
this._.meta[a])return this[a]};g.bang=function(){this._.emit.apply(this,["bang"].concat(i.call(arguments)));return this};g.process=p;g.bypass=function(){this._.bypassed=0===arguments.length?!0:!!arguments[0];return this};g.play=function(){var a=this._.dac;null===a&&(a=this._.dac=new H(this));a.playbackState===c&&(a.play(),this._.emit.apply(this,["play"].concat(i.call(arguments))));return this};g.pause=function(){var a=this._.dac;a&&a.playbackState===d&&(a.pause(),this._.dac=null,this._.emit("pause"));
return this};g.start=g.stop=g.listen=g.unlisten=function(){return this};g.ar=function(){0===arguments.length||arguments[0]?this._.kronly||(this._.ar=!0,this._.emit("ar",!0)):this.kr(!0);return this};g.kr=function(){0===arguments.length||arguments[0]?this._.aronly||(this._.ar=!1,this._.emit("ar",!1)):this.ar(!0);return this};g.plot="browser"===l?function(a){var b=this._,g=a.target;if(!g)return this;var d=a.width||g.width||320,c=a.height||g.height||240,j=(a.x||0)+0.5,l=a.y||0,g=g.getContext("2d"),m;
m=a.foreground!==h?a.foreground:b.plotForeground||"rgb(  0, 128, 255)";var e;e=a.background!==h?a.background:b.plotBackground||"rgb(255, 255, 255)";var r=a.lineWidth||b.plotLineWidth||1,f=!!b.plotCyclic,u=b.plotData||this.cells[0],k=a.range||b.plotRange||[-1.2,1.2],i=k[0],k=c/(k[1]-i),q=d/u.length,n,o=u.length;g.save();g.rect(j,l,d,c);null!==e&&(g.fillStyle=e,g.fillRect(j,l,d,c));b.plotBefore&&b.plotBefore.call(this,g,j,l,d,c);if(b.plotBarStyle){g.fillStyle=m;for(e=m=0;e<o;++e)f=(u[e]-i)*k,n=c-f,
g.fillRect(m+j,n+l,q,f),m+=q}else{g.strokeStyle=m;g.lineWidth=r;g.beginPath();m=0;r=c-(u[0]-i)*k;g.moveTo(m+j,r+l);for(e=1;e<o;++e)m+=q,n=c-(u[e]-i)*k,g.lineTo(m+j,n+l);f?g.lineTo(m+q+j,r+l):g.lineTo(m+q+j,n+l);g.stroke()}b.plotAfter&&b.plotAfter.call(this,g,j,l,d,c);if(a=a.border||b.plotBorder)g.strokeStyle="string"===typeof a?a:"#000",g.lineWidth=1,g.strokeRect(j,l,d,c);g.restore();return this}:p;return a}();q.Object=y;var C=function(){function a(g){q.Object.call(this,-1,[]);t(this);this._.parent=
g;this.cell=new n.SignalArray(b.cellsize);this.L=this.R=this;this.cells[0]=this.cells[1]=this.cells[2]=this.cell;this.numChannels=1}s(a);a.prototype.process=function(a){this.tickID!==a&&(this.tickID=a,this._.parent&&this._.parent.process(a));return this};return a}();q.ChannelObject=C;var G=function(){function a(b){y.call(this,1,[]);v(this);this.value=b[0];if(k(b[1])){var g=b[1];this.once("init",function(){this.set(g)})}this.on("setAdd",z);this.on("setMul",z)}s(a);Object.defineProperties(a.prototype,
{value:{set:function(a){"number"===typeof a&&(this._.value=isNaN(a)?0:a,z.call(this))},get:function(){return this._.value}}});return a}(),I=function(){function a(b){y.call(this,1,[]);v(this);this.value=b[0];if(k(b[1])){var g=b[1];this.once("init",function(){this.set(g)})}this.on("setAdd",z);this.on("setMul",z)}s(a);Object.defineProperties(a.prototype,{value:{set:function(a){this._.value=a?1:0;z.call(this)},get:function(){return!!this._.value}}});return a}(),F=function(){function a(b){y.call(this,
1,[]);v(this);this.func=b[0];this._.value=0;if(k(b[1])){var g=b[1];this.once("init",function(){this.set(g)})}this.on("setAdd",z);this.on("setMul",z)}s(a);var b=a.prototype;Object.defineProperties(b,{func:{set:function(a){"function"===typeof a&&(this._.func=a)},get:function(){return this._.func}},args:{set:function(a){this._.args=f(a)?a:[a]},get:function(){return this._.args}}});b.bang=function(){var a=this._,b=i.call(arguments).concat(a.args),b=a.func.apply(this,b);"number"===typeof b&&(a.value=b,
z.call(this));this._.emit("bang");return this};return a}(),K=function(){function a(b){y.call(this,1,[]);v(this);if(k(b[1])){var g=b[1];this.once("init",function(){this.set(g)})}}s(a);Object.defineProperties(a.prototype,{});return a}(),J=function(){function a(b){y.call(this,1,[]);v(this);if(k(b[1])){var g=b[1];this.once("init",function(){this.set(g)})}}s(a);Object.defineProperties(a.prototype,{});return a}(),H=function(){function a(b){y.call(this,2,[]);this.playbackState=c;var d=this._;d.node=b;d.onplay=
g(this);d.onpause=j(this)}s(a);var g=function(a){return function(){-1===b.inlets.indexOf(a)&&(b.inlets.push(a),b.events.emit("addObject"),a.playbackState=d,a._.emit("play"))}},j=function(a){return function(){var g=b.inlets.indexOf(a);-1!==g&&(b.inlets.splice(g,1),a.playbackState=c,a._.emit("pause"),b.events.emit("removeObject"))}},l=a.prototype;l.play=function(){b.nextTick(this._.onplay);return this};l.pause=function(){b.nextTick(this._.onpause);return this};l.process=function(a){var b=this._.node;
b.playbackState&1?(b.process(a),this.cells[1].set(b.cells[1]),this.cells[2].set(b.cells[2])):(this.cells[1].set(n.emptycell),this.cells[2].set(n.emptycell));return this};return a}(),A=function(){function a(){this._={};this.context=this;this.tickID=0;this.impl=null;this.amp=0.8;this.status=e;this.samplerate=44100;this.channels=2;this.cellsize=64;this.streammsec=20;this.currentTime=this.streamsize=0;this.nextTicks=[];this.inlets=[];this.timers=[];this.listeners=[];this._.deferred=null;this.recStart=
0;this.recBuffers=null;this.delayProcess=b(this);n.currentTimeIncr=1E3*this.cellsize/this.samplerate;n.emptycell=new n.SignalArray(this.cellsize);var g=this;o.ready("events",function(){g.events=new o.EventEmitter(g);g.reset()})}var b=function(a){return function(){a.recStart=Date.now();a.process()}},g=[8E3,11025,12E3,16E3,22050,24E3,32E3,44100,48E3],d=[32,64,128,256],c=a.prototype;c.bind=function(a,b){if("function"===typeof a){var g=new a(this,b);"function"===typeof g.play&&"function"===typeof g.pause&&
(this.impl=g,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate))}return this};c.setup=function(a){if("object"===typeof a&&(-1!==g.indexOf(a.samplerate)&&(this.samplerate=a.samplerate<=this.impl.maxSamplerate?a.samplerate:this.impl.maxSamplerate),-1!==d.indexOf(a.cellsize)&&(this.cellsize=a.cellsize),"undefined"!==typeof a.f64))j=!!a.f64,n.SignalArray=j?Float64Array:Float32Array;n.currentTimeIncr=1E3*this.cellsize/this.samplerate;n.emptycell=new n.SignalArray(this.cellsize);
return this};c.getAdjustSamples=function(a){a=a||this.samplerate;a=Math.ceil(Math.log(this.streammsec/1E3*a)*Math.LOG2E);return 1<<(8>a?8:14<a?14:a)};c.play=function(){this.status===e&&(this.status=1,this.streamsize=this.getAdjustSamples(),this.strmL=new n.SignalArray(this.streamsize),this.strmR=new n.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play"));return this};c.pause=function(){1===this.status&&(this.status=e,this.impl.pause(),this.events.emit("pause"));return this};c.reset=
function(a){a&&(this._.events=null);this.currentTime=0;this.nextTicks=[];this.inlets=[];this.timers=[];this.listeners=[];this.events.on("addObject",function(){this.status===e&&(this.inlets.length>0||this.timers.length>0||this.listeners.length>0)&&this.play()});this.events.on("removeObject",function(){this.status===1&&this.inlets.length===0&&(this.timers.length===0&&this.listeners.length===0)&&this.pause()});return this};c.process=function(){var a=this.tickID,b=this.strmL,g=this.strmR,d=this.amp,c,
j,l,m=this.streamsize,e=0,r,f,u,h=this.cellsize,k=this.streamsize/this.cellsize,i=this.timers,q=this.inlets,o=this.listeners,p=n.currentTimeIncr;for(l=0;l<m;++l)b[l]=g[l]=0;for(;k--;){++a;r=0;for(f=i.length;r<f;++r)i[r].playbackState&1&&i[r].process(a);r=0;for(f=q.length;r<f;++r)if(c=q[r],c.process(a),c.playbackState&1){j=c.cells[1];c=c.cells[2];u=0;for(l=e;u<h;++u,++l)b[l]+=j[u],g[l]+=c[u]}e+=h;r=0;for(f=o.length;r<f;++r)o[r].playbackState&1&&o[r].process(a);this.currentTime+=p;l=this.nextTicks.splice(0);
r=0;for(f=l.length;r<f;++r)l[r].call(null)}for(l=0;l<m;++l)c=b[l]*d,-1>c?c=-1:1<c&&(c=1),b[l]=c,c=g[l]*d,-1>c?c=-1:1<c&&(c=1),g[l]=c;this.tickID=a;a=this.currentTime;if(2===this.status){if(2===this.recCh)this.recBuffers.push(new n.SignalArray(b)),this.recBuffers.push(new n.SignalArray(g));else{d=new n.SignalArray(b.length);l=0;for(m=d.length;l<m;++l)d[l]=0.5*(b[l]+g[l]);this.recBuffers.push(d)}a>=this.maxDuration?this._.deferred.sub.reject():a>=this.recDuration?this._.deferred.sub.resolve():20<Date.now()-
this.recStart?setTimeout(this.delayProcess,10):this.process()}};c.nextTick=function(a){this.status===e?a():this.nextTicks.push(a)};c.rec=function(){n.fix_iOS6_1_problem(!0);var a=new o.Deferred(this);if(this._.deferred)return console.warn("rec deferred is exists??"),a.reject().promise();if(this.status!==e)return console.log("status is not none",this.status),a.reject().promise();var b=0,g=arguments,d=k(g[b])?g[b++]:{},b=g[b];if("function"!==typeof b)return console.warn("no function"),a.reject().promise();
this._.deferred=a;this.status=2;this.reset();var c=new u("+"),j=new o.Deferred(this),m=this;j.then(l,function(){n.fix_iOS6_1_problem(!1);l.call(m,!0)});this._.deferred.sub=j;this.savedSamplerate=this.samplerate;this.samplerate=d.samplerate||this.samplerate;this.recDuration=d.recDuration||Infinity;this.maxDuration=d.maxDuration||6E5;this.recCh=d.ch||1;2!==this.recCh&&(this.recCh=1);this.recBuffers=[];this.streamsize=this.getAdjustSamples();this.strmL=new n.SignalArray(this.streamsize);this.strmR=new n.SignalArray(this.streamsize);
this.inlets.push(c);b({done:function(){j.resolve.apply(j,i.call(arguments))},send:function(){c.append.apply(c,arguments)}});setTimeout(this.delayProcess,10);return a.promise()};var l=function(){this.status=e;this.reset();var a=this.recBuffers,b=this.samplerate,g=this.streamsize,d;this.samplerate=this.savedSamplerate;d=Infinity!==this.recDuration?0.001*this.recDuration*b|0:(a.length>>this.recCh-1)*g;var c,j=d/g|0,l=0,m=0,r=d;if(2===this.recCh){var f=new n.SignalArray(d),u=new n.SignalArray(d),h=new n.SignalArray(d);
for(c=0;c<j;++c)if(f.set(a[l++],m),u.set(a[l++],m),m+=g,r-=g,0<r&&r<g){f.set(a[l++].subarray(0,r),m);u.set(a[l++].subarray(0,r),m);break}c=0;for(j=d;c<j;++c)h[c]=0.5*(f[c]+u[c]);a={samplerate:b,channels:2,buffer:h,bufferL:f,bufferR:u}}else{d=new n.SignalArray(d);for(c=0;c<j;++c)if(d.set(a[l++],m),m+=g,r-=g,0<r&&r<g){d.set(a[l++].subarray(0,r),m);break}a={samplerate:b,channels:1,buffer:d,bufferL:d,bufferR:d}}this._.deferred.resolve.apply(this._.deferred,[].concat.apply([a],arguments));this._.deferred=
null};c.on=function(a,b){this.events.on(a,b)};c.addListener=c.on;c.once=function(a,b){this.events.once(a,b)};c.removeListener=function(a,b){this.events.removeListener(a,b)};c.removeAllListeners=function(a){this.events.removeListeners(a)};c.listeners=function(a){return this.events.listeners(a)};c.fix_iOS6_1_problem=function(a){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(a)};return a}(),E=null,E="undefined"!==typeof webkitAudioContext?function(a){var b=new webkitAudioContext,g,d;n._audioContext=
b;this.defaultSamplerate=this.maxSamplerate=b.sampleRate;this.env="webkit";var c=navigator.userAgent;c.match(/linux/i)?a.streammsec*=8:c.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(a.streammsec*=4);this.play=function(){var c,j=a.getAdjustSamples(b.sampleRate),l=a.streamsize,m,e;if(a.samplerate===b.sampleRate)c=function(b){b=b.outputBuffer;a.process();b.getChannelData(0).set(a.strmL);b.getChannelData(1).set(a.strmR)};else if(a.samplerate*2===b.sampleRate)c=function(b){var g=a.strmL,d=a.strmR,c=b.outputBuffer,
b=c.getChannelData(0),j=c.getChannelData(1),l=c.length,m;a.process();for(c=m=0;c<l;c=c+2,++m){b[c]=g[m];j[c]=d[m];b[c+1]=g[m];j[c+1]=d[m]}};else{m=l;e=a.samplerate/b.sampleRate;c=function(b){for(var g=a.strmL,c=a.strmR,d=b.outputBuffer,b=d.getChannelData(0),j=d.getChannelData(1),r=d.length,d=0;d<r;++d){if(m>=l){a.process();m=m-l}b[d]=g[m|0];j[d]=c[m|0];m=m+e}}}g=b.createBufferSource();d=b.createJavaScriptNode(j,2,a.channels);d.onaudioprocess=c;g.noteOn(0);g.connect(d);d.connect(b.destination)};this.pause=
function(){g.disconnect();d.disconnect()};if(m){var j=0,l=b.createBufferSource();this.fix_iOS6_1_problem=function(a){j=j+(a?1:-1);if(j===1){l.noteOn(0);l.connect(b.destination)}else j===0&&l.disconnect()}}}:"function"===typeof Audio&&"function"===typeof(new Audio).mozSetup?function(a){var b=function(){var a=new Blob(["var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};"],{type:"text/javascript"}),a=URL.createObjectURL(a);
return new Worker(a)}();this.maxSamplerate=48E3;this.defaultSamplerate=44100;this.env="moz";this.play=function(){var g=new Audio,d=new Float32Array(a.streamsize*a.channels),c=a.streammsec,j=0,l=1E3*(a.streamsize/a.samplerate),m=Date.now();g.mozSetup(a.channels,a.samplerate);b.onmessage=function(){if(!(j>Date.now()-m)){var b=a.strmL,c=a.strmR,e=d.length,r=b.length;for(a.process();r--;)d[--e]=c[r],d[--e]=b[r];g.mozWriteAudio(d);j+=l}};b.postMessage(c)};this.pause=function(){b.postMessage(0)}}:function(){this.maxSamplerate=
48E3;this.defaultSamplerate=8E3;this.env="nop";this.pause=this.play=p},b=(new A).bind(E),x=q;"node"===l?module.exports=global.timbre=x:"browser"===l&&(x.noConflict=function(){var a=window.timbre,b=window.T;return function(g){window.T===x&&(window.T=b);g&&window.timbre===x&&(window.timbre=a);return x}}(),window.timbre=window.T=x)})();
(function(h){function i(e,c){this.samplerate=e;this.channels=c;this.frequency=340;this.Q=1;this.b0=this.b1=this.b2=this.a1=this.a2=this.x1R=this.x2R=this.y1R=this.y2R=this.x1L=this.x2L=this.y1L=this.y2L=this.gain=0;this.setType("lpf")}var f=i.prototype;f.process=function(e,c){var d,b,a=this.x1L,g=this.x2L,l=this.y1L,m=this.y2L,j=this.x1R,r=this.x2R,f=this.y1R,h=this.y2R,k=this.b0,i=this.b1,p=this.b2,s=this.a1,w=this.a2,t,v;if(2===this.channels){t=0;for(v=e.length;t<v;++t)d=e[t],b=k*d+i*a+p*g-s*l-
w*m,e[t]=b,g=a,a=d,m=l,l=b,d=c[t],b=k*d+i*j+p*r-s*f-w*h,c[t]=b,r=j,j=d,h=f,f=b;this.x1L=a;this.x2L=g;this.y1L=l;this.y2L=m;this.x1R=j;this.x2R=r;this.y1R=f;this.y2R=h}else{t=0;for(v=e.length;t<v;++t)d=e[t],b=k*d+i*a+p*g-s*l-w*m,e[t]=b,g=a,a=d,m=l,l=b;this.x1L=a;this.x2L=g;this.y1L=l;this.y2L=m}};f.setType=function(e){var c;if(c=k[e])this.type=e,c.call(this,this.frequency,this.Q,this.gain)};f.setParams=function(e,c,d){this.frequency=e;this.Q=c;this.gain=d;var b=k[this.type];b&&b.call(this,e,c,d);return this};
var k={lowpass:function(e,c){e/=0.5*this.samplerate;if(1<=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{var d=Math.pow(10,0.05*(0>c?0:c)),b=Math.sqrt(0.5*(4-Math.sqrt(16-16/(d*d)))),d=Math.PI*e,b=0.5*b*Math.sin(d),b=0.5*(1-b)/(1+b),d=(0.5+b)*Math.cos(d),a=0.25*(0.5+b-d);this.b0=2*a;this.b1=4*a;this.b2=this.b0;this.a1=2*-d;this.a2=2*b}},highpass:function(e,c){e/=0.5*this.samplerate;if(1<=e)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=
e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var d=Math.pow(10,0.05*(0>c?0:c)),b=Math.sqrt((4-Math.sqrt(16-16/(d*d)))/2),d=Math.PI*e,b=0.5*b*Math.sin(d),b=0.5*(1-b)/(1+b),d=(0.5+b)*Math.cos(d),a=0.25*(0.5+b+d);this.b0=2*a;this.b1=-4*a;this.b2=this.b0;this.a1=2*-d;this.a2=2*b}},bandpass:function(e,c){e/=0.5*this.samplerate;if(0<e&&1>e)if(0<c){var d=Math.PI*e,b=Math.sin(d)/(2*c),d=Math.cos(d),a=1/(1+b);this.b0=b*a;this.b1=0;this.b2=-b*a;this.a1=-2*d*a;this.a2=(1-b)*a}else this.b0=this.b1=this.b2=
this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(e,c,d){e/=0.5*this.samplerate;c=Math.pow(10,d/40);if(1<=e)this.b0=c*c,this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var e=Math.PI*e,d=0.5*Math.sin(e)*Math.sqrt(0*(c+1/c)+2),e=Math.cos(e),d=2*Math.sqrt(c)*d,b=c+1,a=c-1,g=1/(b+a*e+d);this.b0=c*(b-a*e+d)*g;this.b1=2*c*(a-b*e)*g;this.b2=c*(b-a*e-d)*g;this.a1=-2*(a+b*e)*g;this.a2=(b+a*e-d)*g}},highshelf:function(e,c,d){e/=
0.5*this.samplerate;c=Math.pow(10,d/40);if(1<=e)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=e)this.b0=c*c,this.b1=this.b2=this.a1=this.a2=0;else{var e=Math.PI*e,d=0.5*Math.sin(e)*Math.sqrt(0*(c+1/c)+2),e=Math.cos(e),d=2*Math.sqrt(c)*d,b=c+1,a=c-1,g=1/(b-a*e+d);this.b0=c*(b+a*e+d)*g;this.b1=-2*c*(a+b*e)*g;this.b2=c*(b+a*e-d)*g;this.a1=2*(a-b*e)*g;this.a2=(b-a*e-d)*g}},peaking:function(e,c,d){e/=0.5*this.samplerate;if(0<e&&1>e)if(d=Math.pow(10,d/40),0<c){var e=Math.PI*e,c=Math.sin(e)/(2*
c),e=Math.cos(e),b=1/(1+c/d);this.b0=(1+c*d)*b;this.b1=-2*e*b;this.b2=(1-c*d)*b;this.a1=this.b1;this.a2=(1-c/d)*b}else this.b0=d*d,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(e,c){e/=0.5*this.samplerate;if(0<e&&1>e)if(0<c){var d=Math.PI*e,b=Math.sin(d)/(2*c),d=Math.cos(d),a=1/(1+b);this.b0=a;this.b1=-2*d*a;this.b2=a;this.a1=this.b1;this.a2=(1-b)*a}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},
allpass:function(e,c){e/=0.5*this.samplerate;if(0<e&&1>e)if(0<c){var d=Math.PI*e,b=Math.sin(d)/(2*c),d=Math.cos(d),a=1/(1+b);this.b0=(1-b)*a;this.b1=-2*d*a;this.b2=(1+b)*a;this.a1=this.b1;this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};k.lpf=k.lowpass;k.hpf=k.highpass;k.bpf=k.bandpass;k.bef=k.notch;k.brf=k.notch;k.apf=k.allpass;h.modules.Biquad=i})(timbre);
(function(h){function i(e,c){this.samplerate=e;this.channels=c;this.buffersize=1<<Math.round(Math.log(0.1*e)*Math.LOG2E);this.bufferL=new h.fn.SignalArray(this.buffersize+1);2===c&&(this.bufferR=new h.fn.SignalArray(this.buffersize+1));this._wave=this.wave=null;this.writeIndex=this.buffersize>>1;this.readIndex=0;this.delayTime=20;this.rate=4;this.depth=20;this.feedback=0.2;this.wet=0.5;this.phaseIncr=this.phase=0;this.phaseStep=4;this.setWaveType("sin");this.setDelayTime(this.delayTime);this.setRate(this.rate)}
var f=i.prototype,k=[];k[0]=function(){for(var e=new Float32Array(512),c=0;512>c;++c)e[c]=Math.sin(2*Math.PI*(c/512));return e}();k[1]=function(){for(var e=new Float32Array(512),c,d=0;512>d;++d)c=d/512-0.25,e[d]=1-4*Math.abs(Math.round(c)-c);return e}();f.setWaveType=function(e){"sin"===e?(this.wave=e,this._wave=k[0]):"tri"===e&&(this.wave=e,this._wave=k[1])};f.setDelayTime=function(e){this.delayTime=e;for(e=this.writeIndex-(0.001*e*this.samplerate|0);0>e;)e+=this.buffersize;this.readIndex=e};f.setRate=
function(e){this.rate=e;this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep};f.process=function(e,c){var d=this.bufferL,b=this.bufferR,a=this.buffersize,g=a-1,l=this._wave,m=this.phase,j=this.phaseIncr,r=this.writeIndex,f=this.readIndex,h=this.depth,k=this.feedback,i,p,s,w=this.wet,t=1-w,v,z=e.length,A,y=this.phaseStep;if(2===this.channels)for(v=0;v<z;){s=l[m|0]*h;for(m+=j;512<m;)m-=512;for(A=0;A<y;++A,++v)p=f+a+s&g,i=0.5*(d[p]+d[p+1]),d[r]=e[v]-i*k,e[v]=e[v]*t+i*w,i=0.5*(b[p]+b[p+1]),b[r]=
c[v]-i*k,c[v]=c[v]*t+i*w,r=r+1&g,f=f+1&g}else for(v=0;v<z;){s=l[m|0]*h;for(m+=j;512<m;)m-=512;for(A=0;A<y;++A,++v)p=f+a+s&g,i=0.5*(d[p]+d[p+1]),d[r]=e[v]-i*k,e[v]=e[v]*t+i*w,r=r+1&g,f=f+1&g}this.phase=m;this.writeIndex=r;this.readIndex=f};h.modules.Chorus=i})(timbre);
(function(h){function i(d,b){this.samplerate=d;this.channels=b;this.preDelayReadIndex=this.lastPreDelayFrames=0;this.preDelayWriteIndex=e;this.K=this.ykneeThresholdDb=this.kneeThresholdDb=this.kneeThreshold=this.dbKnee=this.dbThreshold=this.linearThreshold=this.slope=this.ratio=-1;this.attackTime=0.003;this.releaseTime=0.25;this.preDelayTime=0.006;this.dbPostGain=0;this.effectBlend=1;this.releaseZone1=0.09;this.releaseZone2=0.16;this.releaseZone3=0.42;this.releaseZone4=0.98;this.detectorAverage=0;
this.meteringGain=this.compressorGain=1;this.delayBufferL=new h.fn.SignalArray(f);this.delayBufferR=2===b?new h.fn.SignalArray(f):this.delayBufferL;this.preDelayTime=6;this.preDelayReadIndex=0;this.preDelayWriteIndex=e;this.maxAttackCompressionDiffDb=-1;this.meteringReleaseK=1-Math.exp(-1/(0.325*this.samplerate));this.setAttackTime(this.attackTime);this.setReleaseTime(this.releaseTime);this.setPreDelayTime(this.preDelayTime);this.setParams(-24,30,12)}var f=1024,k=f-1,e=256,c=i.prototype;c.clone=function(){var d=
new i(this.samplerate,this.channels);d.setAttackTime(this.attackTime);d.setReleaseTime(this.releaseTime);d.setPreDelayTime(this.preDelayTime);d.setParams(this.dbThreshold,this.dbKnee,this.ratio);return d};c.setAttackTime=function(d){this.attackTime=Math.max(0.001,d);this._attackFrames=this.attackTime*this.samplerate};c.setReleaseTime=function(d){this.releaseTime=Math.max(0.001,d);var b=this.releaseTime*this.samplerate;this._satReleaseFrames=0.0025*this.samplerate;var d=b*this.releaseZone1,a=b*this.releaseZone2,
g=b*this.releaseZone3,b=b*this.releaseZone4;this._kA=0.9999999999999998*d+1.8432219684323923E-16*a-1.9373394351676423E-16*g+8.824516011816245E-18*b;this._kB=-1.5788320352845888*d+2.3305837032074286*a-0.9141194204840429*g+0.1623677525612032*b;this._kC=0.5334142869106424*d-1.272736789213631*a+0.9258856042207512*g-0.18656310191776226*b;this._kD=0.08783463138207234*d-0.1694162967925622*a+0.08588057951595272*g-0.00429891410546283*b;this._kE=-0.042416883008123074*d+0.1115693827987602*a-0.09764676325265872*
g+0.028494263462021576*b};c.setPreDelayTime=function(d){this.preDelayTime=d;d*=this.samplerate;d>f-1&&(d=f-1);if(this.lastPreDelayFrames!==d){this.lastPreDelayFrames=d;for(var b=0,a=this.delayBufferL.length;b<a;++b)this.delayBufferL[b]=this.delayBufferR[b]=0;this.preDelayReadIndex=0;this.preDelayWriteIndex=d}};c.setParams=function(d,b,a){this._k=this.updateStaticCurveParameters(d,b,a);d=1/this.saturate(1,this._k);d=Math.pow(d,0.6);this._masterLinearGain=Math.pow(10,0.05*this.dbPostGain)*d};c.kneeCurve=
function(d,b){return d<this.linearThreshold?d:this.linearThreshold+(1-Math.exp(-b*(d-this.linearThreshold)))/b};c.saturate=function(d,b){var a;d<this.kneeThreshold?a=this.kneeCurve(d,b):(a=this.ykneeThresholdDb+this.slope*((d?20*Math.log(d)*Math.LOG10E:-1E3)-this.kneeThresholdDb),a=Math.pow(10,0.05*a));return a};c.slopeAt=function(d,b){if(d<this.linearThreshold)return 1;var a=1.001*d,g=d?20*Math.log(d)*Math.LOG10E:-1E3,c=a?20*Math.log(a)*Math.LOG10E:-1E3,m=this.kneeCurve(d,b),a=this.kneeCurve(a,b),
m=m?20*Math.log(m)*Math.LOG10E:-1E3;return((a?20*Math.log(a)*Math.LOG10E:-1E3)-m)/(c-g)};c.kAtSlope=function(d){for(var b=Math.pow(10,0.05*(this.dbThreshold+this.dbKnee)),a=0.1,g=1E4,c=5,m=0;15>m;++m)this.slopeAt(b,c)<d?g=c:a=c,c=Math.sqrt(a*g);return c};c.updateStaticCurveParameters=function(c,b,a){this.dbThreshold=c;this.linearThreshold=Math.pow(10,0.05*c);this.dbKnee=b;this.ratio=a;this.slope=1/this.ratio;this.kneeThresholdDb=c+b;this.kneeThreshold=Math.pow(10,0.05*this.kneeThresholdDb);c=this.kAtSlope(1/
this.ratio);this.ykneeThresholdDb=(b=this.kneeCurve(this.kneeThreshold,c))?20*Math.log(b)*Math.LOG10E:-1E3;return this._k=c};c.process=function(c,b){for(var a=1-this.effectBlend,g=this.effectBlend,l=this._k,m=this._masterLinearGain,j=this._satReleaseFrames,e=this._kA,f=this._kB,h=this._kC,i=this._kD,o=this._kE,p=c.length/64,s=0,w=this.detectorAverage,t=this.compressorGain,v=this.maxAttackCompressionDiffDb,z=1/this._attackFrames,A=this.preDelayReadIndex,y=this.preDelayWriteIndex,C=this.detectorAverage,
G=this.delayBufferL,I=this.delayBufferR,F=this.meteringGain,K=this.meteringReleaseK,J=0;J<p;++J){var H=Math.asin(w)/(0.5*Math.PI),E;E=H>t;var x=t/H,x=x?20*Math.log(x)*Math.LOG10E:-1E3;if(Infinity===x||isNaN(x))x=-1;if(E)v=-1,x=-12>x?0:0<x?3:0.25*(x+12),E=x*x,E=Math.pow(10,0.05*(5/(e+f*x+h*E+i*E*x+o*E*E)));else{if(-1===v||v<x)v=x;x=0.25/Math.max(0.5,v);E=1-Math.pow(x,z)}for(x=64;x--;){var D=0,B=0.5*(c[s]+b[s]);G[y]=c[s];I[y]=b[s];0>B&&(B*=-1);D<B&&(D=B);0>D&&(D*=-1);B=this.saturate(D,l);B=(D=1.0E-4>=
D?1:B/D)?-20*Math.log(D)*Math.LOG10E:1E3;2>B&&(B=2);B=Math.pow(10,0.05*(B/j))-1;C+=(D-C)*(D>C?B:1);1<C&&(C=1);1>E?t+=(H-t)*E:(t*=E,1<t&&(t=1));B=Math.sin(0.5*Math.PI*t);D=a+g*m*B;B=20*Math.log(B)*Math.LOG10E;F=B<F?B:F+(B-F)*K;c[s]=G[A]*D;b[s]=I[A]*D;s++;A=A+1&k;y=y+1&k}1.0E-6>C&&(C=1.0E-6);1.0E-6>t&&(t=1.0E-6)}this.preDelayReadIndex=A;this.preDelayWriteIndex=y;this.detectorAverage=C;this.compressorGain=t;this.maxAttackCompressionDiffDb=v;this.meteringGain=F};c.reset=function(){this.detectorAverage=
0;this.meteringGain=this.compressorGain=1;for(var c=0,b=this.delayBufferL.length;c<b;++c)this.delayBufferL[c]=this.delayBufferR[c]=0;this.preDelayReadIndex=0;this.preDelayWriteIndex=e;this.maxAttackCompressionDiffDb=-1};h.modules.Compressor=i})(timbre);
(function(h){function i(){}i.prototype.decode=function(f,h,e){if("string"===typeof f){if(/\.wav$/.test(f))return i.wav_decode(f,h,e);if(i.ogg_decode&&/\.ogg$/.test(f))return i.ogg_decode(f,h,e);if(i.mp3_decode&&/\.mp3$/.test(f))return i.mp3_decode(f,h,e)}if(i.webkit_decode)return i.webkit_decode(f,h,e);if(i.moz_decode)return i.moz_decode(f,h,e);h(!1)};h.modules.Decoder=i;i.getBinaryWithPath="browser"===h.envtype?function(f,k){h.fn.fix_iOS6_1_problem(!0);var e=new XMLHttpRequest;e.open("GET",f);e.responseType=
"arraybuffer";e.onreadystatechange=function(){if(4===e.readyState){if(e.response)k(new Uint8Array(e.response));else if(void 0!==e.responseBody){var c=VBArray(e.responseBody).toArray(),d,b=c.length,a=Array(b);for(d=0;d<b;++d)a[d]=c[d];k(new Uint8Array(a))}h.fn.fix_iOS6_1_problem(!1)}};e.send()}:function(f,h){h("no support")};i.wav_decode=function(f,h,e){i.getBinaryWithPath(f,function(c){if("RIFF"!==String.fromCharCode(c[0],c[1],c[2],c[3])||c[4]+(c[5]<<8)+(c[6]<<16)+(c[7]<<24)+8!==c.length||"WAVE"!==
String.fromCharCode(c[8],c[9],c[10],c[11])||"fmt "!==String.fromCharCode(c[12],c[13],c[14],c[15]))return h(!1);var d=c[22]+(c[23]<<8),b=c[24]+(c[25]<<8)+(c[26]<<16)+(c[27]<<24),a=c[34]+(c[35]<<8);if("data"!==String.fromCharCode(c[36],c[37],c[38],c[39]))return h(!1);var g=c[40]+(c[41]<<8)+(c[42]<<16)+(c[43]<<24),l=(g/d>>1)/b;if(g>c.length-44)return h(!1);var m,g=new Float32Array(l*b|0);m=2===d?new Float32Array(l*b|0):g;h({samplerate:b,channels:d,bufferL:g,bufferR:m,duration:l});if(8===a)c=new Int8Array(c.buffer,
44);else if(16===a)c=new Int16Array(c.buffer,44);else if(32===a)c=new Int32Array(c.buffer,44);else if(24===a){for(var c=new Uint8Array(c.buffer,44),j,r,f,b=new Int32Array(c.length/3),l=0,i=c.length,n=0;l<i;)j=c[l++],r=c[l++],f=c[l++],j=j+(r<<8)+(f<<16),j=j&8388608?j-16777216:j,b[n++]=j;c=b}a=1/((1<<a-1)-1);if(2===d){d=l=0;for(b=g.length;d<b;++d)g[d]=c[l++]*a,m[d]=c[l++]*a}else{d=0;for(b=g.length;d<b;++d)g[d]=c[d]*a}e()})};i.webkit_decode=function(){if("undefined"!==typeof webkitAudioContext){var f=
h.fn._audioContext,k=function(e,c,d){var b,a,g;if("string"===typeof e)return d(!1);try{g=f.createBuffer(e.buffer,!1)}catch(l){return c(!1)}e=f.sampleRate;b=g.numberOfChannels;2===b?(a=g.getChannelData(0),g=g.getChannelData(1)):a=g=g.getChannelData(0);c({samplerate:e,channels:b,bufferL:a,bufferR:g,duration:a.length/e});d()};return function(e,c,d){if(e instanceof File){var b=new FileReader;b.onload=function(a){k(new Uint8Array(a.target.result),c,d)};b.readAsArrayBuffer(e)}else i.getBinaryWithPath(e,
function(a){k(a,c,d)})}}}();i.moz_decode=function(){if("function"===typeof Audio&&"function"===typeof(new Audio).mozSetup)return function(f,h,e){var c,d,b,a,g,l=0,m=new Audio(f);m.volume=0;m.addEventListener("loadedmetadata",function(){c=m.mozSampleRate;d=m.mozChannels;g=m.duration;b=new Float32Array(m.duration*c|0);a=2===d?new Float32Array(m.duration*c|0):b;2===d?m.addEventListener("MozAudioAvailable",function(g){for(var g=g.frameBuffer,c=0,d=g.length;c<d;c+=2)b[l]=g[c],a[l]=g[c+1],l+=1},!1):m.addEventListener("MozAudioAvailable",
function(g){for(var g=g.frameBuffer,c=0,d=g.length;c<d;++c)b[l]=a[l]=g[c],l+=1},!1);m.play();setTimeout(function(){h({samplerate:c,channels:d,bufferL:b,bufferR:a,duration:g})},1E3)},!1);m.addEventListener("ended",function(){e()},!1);m.load()}}()})(timbre);
(function(h){function i(b){this.context=b.context;this.then=b.then;this.done=function(){b.done.apply(b,arguments);return this};this.fail=function(){b.fail.apply(b,arguments);return this};this.pipe=function(){return b.pipe.apply(b,arguments)};this.always=function(){b.always.apply(b,arguments);return this};this.promise=function(){return this};this.isResolved=function(){return b.isResolved()};this.isRejected=function(){return b.isRejected()}}function f(b){this.context=b||this;this._state="pending";this._doneList=
[];this._failList=[];this._promise=new i(this)}var k=[].slice,e=function(b){return b&&"function"===typeof b.promise},c=f.prototype,d=function(b,a,g,c){if("pending"===this._state){this._state=b;for(var b=0,d=a.length;b<d;++b)a[b].apply(g,c);this._doneList=this._failList=null}};c.resolve=function(){var b=k.call(arguments,0);d.call(this,"resolved",this._doneList,this.context||this,b);return this};c.resolveWith=function(b){var a=k.call(arguments,1);d.call(this,"resolved",this._doneList,b,a);return this};
c.reject=function(){var b=k.call(arguments,0);d.call(this,"rejected",this._failList,this.context||this,b);return this};c.rejectWith=function(b){var a=k.call(arguments,1);d.call(this,"rejected",this._failList,b,a);return this};c.promise=function(){return this._promise};c.done=function(){for(var b=k.call(arguments),a="resolved"===this._state,g="pending"===this._state,c=this._doneList,d=0,j=b.length;d<j;++d)if("function"===typeof b[d])if(a)b[d]();else g&&c.push(b[d]);return this};c.fail=function(){for(var b=
k.call(arguments),a="rejected"===this._state,g="pending"===this._state,c=this._failList,d=0,j=b.length;d<j;++d)if("function"===typeof b[d])if(a)b[d]();else g&&c.push(b[d]);return this};c.always=function(){this.done.apply(this,arguments);this.fail.apply(this,arguments);return this};c.then=function(b,a){return this.done(b).fail(a)};c.pipe=function(b,a){var g=this,c=new f(this.context);this.done(function(){var a=b.apply(g.context,arguments);e(a)?a.then(function(){var b=k.call(arguments);c.resolveWith.apply(c,
[a].concat(b))}):c.resolveWith(g,a)});this.fail(function(){if("function"===typeof a){var b=a.apply(g.context,arguments);e(b)&&b.fail(function(){var a=k.call(arguments);c.rejectWith.apply(c,[b].concat(a))})}else c.reject.apply(c,arguments)});return c.promise()};c.isResolved=function(){return"resolved"===this._state};c.isRejected=function(){return"rejected"===this._state};c.state=function(){return this._state};f.when=function(b){var a=0,g=k.call(arguments),c=g.length,d=c;1===c&&!e(b)&&(d=0);var j=1===
d?b:new f,r=function(a,b){return function(g){b[a]=1<arguments.length?k.call(arguments):g;--d||j.resolve.apply(j,b)}};if(1<c)for(var h=Array(c),i=function(){j.reject()};a<c;++a)g[a]&&e(g[a])?g[a].promise().done(r(a,h)).fail(i):(h[a]=g[a],--d);d||j.resolve.apply(j,g);return j.promise()};h.modules.Deferred=f})(timbre);
(function(h){function i(a){this.samplerate=a||44100;this.value=k;this.status=j;this.curve="linear";this.step=1;this.emit=this.loopNode=this.releaseNode=null;this._envValue=new f(a);this._table=[];this._initValue=k;this._curveValue=0;this._defaultCurveType=c;this._counter=this._index=0}function f(a){this.samplerate=a;this.value=k;this.step=1;this._curveType=c;this._y2=this._y1=this._b1=this._a2=this._grow=this._curveValue=0}var k=i.ZERO=1.0E-6,e=i.CurveTypeSet=0,c=i.CurveTypeLin=1,d=i.CurveTypeExp=
2,b=i.CurveTypeSin=3,a=i.CurveTypeWel=4,g=i.CurveTypeCurve=5,l=i.CurveTypeSqr=6,m=i.CurveTypeCub=7,j=i.StatusWait=0,r=i.StatusGate=1,u=i.StatusSustain=2,q=i.StatusRelease=3,n=i.StatusEnd=4,o={set:e,lin:c,linear:c,exp:d,exponential:d,sin:b,sine:b,wel:a,welch:a,sqr:l,squared:l,cub:m,cubed:m};i.CurveTypeDict=o;var p=i.prototype;p.clone=function(){var a=new i(this.samplerate);a._table=this._table;a._initValue=this._initValue;a.setCurve(this.curve);null!==this.releaseNode&&a.setReleaseNode(this.releaseNode+
1);null!==this.loopNode&&a.setLoopNode(this.loopNode+1);a.setStep(this.step);a.reset();return a};p.setTable=function(a){this._initValue=a[0];this._table=a.slice(1);this.value=this._envValue.value=this._initValue;this._counter=this._index=0;this.status=j};p.setCurve=function(a){"number"===typeof a?(this._defaultCurveType=g,this._curveValue=a):this._defaultCurveType=o[a]||null;this.curve=a};p.setReleaseNode=function(a){"number"===typeof a&&0<a&&(this.releaseNode=a-1)};p.setLoopNode=function(a){"number"===
typeof a&&0<a&&(this.loopNode=a-1)};p.setStep=function(a){this.step=this._envValue.step=a};p.reset=function(){this.value=this._envValue.value=this._initValue;this._counter=this._index=0;this.status=j};p.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=q)};p.getInfo=function(a){var b=this._table,g,c,d=0,j=Infinity,l=Infinity,m=!1;g=0;for(c=b.length;g<c;++g){this.loopNode===g&&(j=d);this.releaseNode===g&&(l=d=d<a?d+a:a);var e=b[g];Array.isArray(e)&&(d+=e[1])}Infinity!==j&&Infinity===
l&&(d+=a,m=!0);return{totalDuration:d,loopBeginTime:j,releaseBeginTime:l,isEndlessLoop:m}};p.calcStatus=function(){var a=this.status,b=this._table,d=this._index,j=this._counter,l=this._curveValue,m=this._defaultCurveType,e=this.loopNode,f=this.releaseNode,h=this._envValue,k,i,o=null;switch(a){case r:case q:for(;0>=j;)d>=b.length?a===r&&null!==e?d=e:(a=n,j=Infinity,o="ended"):a===r&&d===f?null!==e&&e<f?d=e:(a=u,j=Infinity,o="sustained"):(k=b[d++],j=k[0],i=null===k[2]?m:k[2],i===g&&(l=k[3],0.001>Math.abs(l)&&
(i=c)),k=k[1],j=h.setNext(j,k,i,l))}this.status=a;this.emit=o;this._index=d;this._counter=j;return a};p.next=function(){this.calcStatus()&1&&(this.value=this._envValue.next()||k);this._counter-=1;return this.value};p.process=function(a){var b=this._envValue,g,c=a.length;if(this.calcStatus()&1)for(g=0;g<c;++g)a[g]=b.next()||k;else{b=this.value||k;for(g=0;g<c;++g)a[g]=b}this.value=a[c-1];this._counter-=a.length};f.prototype.setNext=function(j,f,r,h){var u=this.value,k,i,q,n,o,f=0.001*f*this.samplerate/
this.step|0;1>f&&(f=1,r=e);switch(r){case e:this.value=j;break;case c:k=(j-u)/f;break;case d:k=0!==u?Math.pow(j/u,1/f):0;break;case b:h=Math.PI/f;i=0.5*(j+u);q=2*Math.cos(h);n=0.5*(j-u);o=n*Math.sin(0.5*Math.PI-h);break;case a:h=0.5*Math.PI/f;q=2*Math.cos(h);j>=u?(i=u,n=0,o=-Math.sin(h)*(j-u)):(i=j,n=u-j,o=Math.cos(h)*(u-j));break;case g:j=(j-u)/(1-Math.exp(h));i=u+j;q=j;k=Math.exp(h/f);break;case l:n=Math.sqrt(u);o=Math.sqrt(j);k=(o-n)/f;break;case m:n=Math.pow(u,0.33333333),o=Math.pow(j,0.33333333),
k=(o-n)/f}this.next=s[r];this._grow=k;this._a2=i;this._b1=q;this._y1=n;this._y2=o;return f};var s=[];s[e]=function(){return this.value};s[c]=function(){return this.value+=this._grow};s[d]=function(){return this.value*=this._grow};s[b]=function(){var a=this._b1*this._y1-this._y2;this.value=this._a2-a;this._y2=this._y1;this._y1=a;return this.value};s[a]=function(){var a=this._b1*this._y1-this._y2;this.value=this._a2+a;this._y2=this._y1;this._y1=a;return this.value};s[g]=function(){this._b1*=this._grow;
return this.value=this._a2-this._b1};s[l]=function(){this._y1+=this._grow;return this.value=this._y1*this._y1};s[m]=function(){this._y1+=this._grow;return this.value=this._y1*this._y1*this._y1};f.prototype.next=s[e];h.modules.Envelope=i;h.modules.EnvelopeValue=f})(timbre);
(function(h){function i(c){this.context=c;this._||(this._={})}var f=Array.isArray,k=[].slice,e=i.prototype;e.emit=function(c){var d=this._;if(!d.events)return!1;var b=d.events[c];if(!b)return!1;if("function"===typeof b){switch(arguments.length){case 1:b.call(this.context);break;case 2:b.call(this.context,arguments[1]);break;case 3:b.call(this.context,arguments[1],arguments[2]);break;default:d=k.call(arguments,1),b.apply(this.context,d)}return!0}if(f(b)){for(var d=k.call(arguments,1),b=b.slice(),a=
0,g=b.length;a<g;++a)b[a]instanceof h.Object?b[a].bang.apply(b[a],d):b[a].apply(this.context,d);return!0}if(b instanceof h.Object)d=k.call(arguments,1),b.bang.apply(b,d);else return!1};e.addListener=function(c,d){if("function"!==typeof d&&!(d instanceof h.Object))throw Error("addListener takes instances of Function or timbre.Object");var b=this._;b.events||(b.events={});b.events[c]?f(b.events[c])?b.events[c].push(d):b.events[c]=[b.events[c],d]:b.events[c]=d;return this};e.on=e.addListener;e.once=
function(c,d){var b=this,a;if("function"===typeof d)a=function(){b.removeListener(c,a);d.apply(b.context,arguments)};else if(d instanceof h.Object)a=function(){b.removeListener(c,a);d.bang.apply(d,arguments)};else throw Error("once takes instances of Function or timbre.Object");a.listener=d;b.on(c,a);return this};e.removeListener=function(c,d){if("function"!==typeof d&&!(d instanceof h.Object))throw Error("removeListener takes instances of Function or timbre.Object");var b=this._;if(!b.events||!b.events[c])return this;
var a=b.events[c];if(f(a)){for(var g=-1,l=0,m=a.length;l<m;++l)if(a[l]===d||a[l].listener&&a[l].listener===d){g=l;break}if(0>g)return this;a.splice(g,1);0===a.length&&(b.events[c]=null)}else if(a===d||a.listener&&a.listener===d)b.events[c]=null;return this};e.removeAllListeners=function(c){var d=this._;if(!d.events)return this;var b=!1,a=d.events[c];if(f(a))for(var g=a.length;g--;){var l=a[g];l.unremovable?b=!0:this.removeListener(c,l)}else a&&(a.unremovable?b=!0:this.removeListener(c,a));b||(d.events[c]=
null);return this};e.listeners=function(c){var d=this._;if(!d.events||!d.events[c])return[];d=d.events[c];if(!f(d))return d.unremovable?[]:[d];for(var d=d.slice(),c=[],b=0,a=d.length;b<a;++b)d[b].unremovable||c.push(d[b]);return c};h.modules.EventEmitter=i;h.modules.ready.done("events")})(timbre);
(function(h){function i(c){this.length=c=1<<Math.ceil(Math.log("number"===typeof c?c:512)*Math.LOG2E);this.buffer=new h.fn.SignalArray(c);this.real=new h.fn.SignalArray(c);this.imag=new h.fn.SignalArray(c);this._real=new h.fn.SignalArray(c);this._imag=new h.fn.SignalArray(c);this.mag=new h.fn.SignalArray(c>>1);this.minDecibels=-30;this.maxDecibels=-100;c=k.get(c);this._bitrev=c.bitrev;this._sintable=c.sintable;this._costable=c.costable}var f=i.prototype;f.setWindow=function(c){if("string"===typeof c){var d=
/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(c);if(null!==d){var b=d[1].toLowerCase(),d=void 0!==d[2]?+d[2]:0.25;if(b=e[b]){this._window||(this._window=new h.fn.SignalArray(this.length));for(var a=this._window,g=0,l=this.length,d=0>d?0:1<d?1:d;g<l;++g)a[g]=b(g,l,d);this.windowName=c}}}};f.forward=function(c){var d=this.buffer,b=this.real,a=this.imag,g=this._window,l=this._bitrev,m=this._sintable,j=this._costable,e=d.length,f,h,k,i,p,s,w;if(g)for(f=0;f<e;++f)d[f]=c[f]*g[f];else d.set(c);for(f=0;f<e;++f)b[f]=
d[l[f]],a[f]=0;for(d=1;d<e;d=g){l=0;g=d+d;h=e/g;for(c=0;c<d;c++){k=j[l];i=m[l];for(f=c;f<e;f+=g)p=f+d,s=i*a[p]+k*b[p],w=k*a[p]-i*b[p],b[p]=b[f]-s,b[f]+=s,a[p]=a[f]-w,a[f]+=w;l+=h}}m=this.mag;for(f=0;f<e;++f)j=b[f],c=a[f],m[f]=Math.sqrt(j*j+c*c);return{real:b,imag:a}};f.inverse=function(c,d){var b=this.buffer,a=this._real,g=this._imag,l=this._bitrev,m=this._sintable,j=this._costable,e=b.length,f,h,k,i,p,s,w,t,v,z;for(f=0;f<e;++f)h=l[f],a[f]=+c[h],g[f]=-d[h];for(l=1;l<e;l=k){i=0;k=l+l;p=e/k;for(h=0;h<
l;h++){s=j[i];w=m[i];for(f=h;f<e;f+=k)t=f+l,v=w*g[t]+s*a[t],z=s*g[t]-w*a[t],a[t]=a[f]-v,a[f]+=v,g[t]=g[f]-z,g[f]+=z;i+=p}}for(f=0;f<e;++f)b[f]=a[f]/e;return b};f.getFrequencyData=function(c){var d=this.minDecibels,b,a=Math.min(this.mag.length,c.length);if(a){var g,l=this.mag,m=0;for(b=0;b<a;++b)g=l[b],c[b]=!g?d:20*Math.log(g)*Math.LOG10E,m<c[b]&&(m=c[b])}return c};var k={get:function(c){var d;if(!(d=k[c])){var b,a,g,l;d=new Int16Array(c);l=c>>1;for(b=a=0;;){d[b]=a;if(++b>=c)break;for(g=l;g<=a;)a-=
g,g>>=1;a+=g}a=Math.floor(Math.log(c)/Math.LN2);b=new h.fn.SignalArray((1<<a)-1);l=new h.fn.SignalArray((1<<a)-1);var m=2*Math.PI;a=0;for(g=b.length;a<g;++a)b[a]=Math.sin(m*(a/c)),l[a]=Math.cos(m*(a/c));d=k[c]={bitrev:d,sintable:b,costable:l}}return d}},e=function(){var c=Math.PI,d=2*Math.PI,b=Math.abs,a=Math.pow,g=Math.cos,l=Math.sin,m=Math.E;return{rectangular:function(){return 1},hann:function(a,b){return 0.5*(1-g(d*a/(b-1)))},hamming:function(a,b){return 0.54-0.46*g(d*a/(b-1))},tukery:function(a,
b,d){return a<d*(b-1)/2?0.5*(1+g(c*(2*a/(d*(b-1))-1))):(b-1)*(1-d/2)<a?0.5*(1+g(c*(2*a/(d*(b-1))-2/d+1))):1},cosine:function(a,b){return l(c*a/(b-1))},lanczos:function(a,b){return l(c*(2*a/(b-1)-1))/(c*(2*a/(b-1)-1))},triangular:function(a,g){return 2/(g+1)*((g+1)/2-b(a-(g-1)/2))},bartlett:function(a,g){return 2/(g-1)*((g-1)/2-b(a-(g-1)/2))},gaussian:function(b,g,c){return a(m,-0.5*a((b-(g-1)/2)/(c*(g-1)/2),2))},bartlettHann:function(a,c){return 0.62-0.48*b(a/(c-1)-0.5)-0.38*g(d*a/(c-1))},blackman:function(a,
b,l){var m=l/2;return(1-l)/2-0.5*g(d*a/(b-1))+m*g(4*c*a/(b-1))}}}();h.modules.FFT=i})(timbre);
(function(h){function i(b){this.samplerate=b||44100;this.wave=null;this.step=1;this.phase=this.value=this.frequency=0;this.feedback=!1;this._lastouts=this._x=0;this._coeff=f/this.samplerate;this._radtoinc=f/(2*Math.PI)}var f=1024,k=f-1,e=i.prototype;e.setWave=function(b){var a,g,d=this.wave;this.wave||(this.wave=new Float32Array(f+1));if("function"===typeof b)for(a=0;a<f;++a)d[a]=b(a/f);else if(b instanceof Float32Array)if(b.length===d.length)d.set(b);else{g=b.length/f;for(a=0;a<f;++a)d[a]=b[a*g|
0]}else"string"===typeof b&&void 0!==(g=c(b))&&this.wave.set(g);this.wave[f]=this.wave[0]};e.reset=function(){this._x=0};e.next=function(){var b=this._x;this.value=this.wave[(b+this.phase*this._radtoinc|0)&k];b+=this.frequency*this._coeff*this.step;b>f&&(b-=f);this._x=b;return this.value};e.process=function(b){var a=this.wave,g=this._radtoinc,c,d=this._x,j,e,h=this.frequency*this._coeff,i,n=this.step;if(this.feedback){j=this._lastouts;g*=this.phase;for(i=0;i<n;++i)c=d+j*g,j=c|0,c-=j,j&=k,e=a[j],j=
a[j+1],b[i]=j=e+c*(j-e),d+=h;this._lastouts=j}else{g*=this.phase;for(i=0;i<n;++i)c=d+g,j=c|0,c-=j,j&=k,e=a[j],j=a[j+1],b[i]=e+c*(j-e),d+=h}d>f&&(d-=f);this._x=d;this.value=b[b.length-1]};e.processWithFreqArray=function(b,a){var g=this.wave,c=this._radtoinc,d,j=this._x,e,h,i=this._coeff,n,o=this.step;if(this.feedback){e=this._lastouts;c*=this.phase;for(n=0;n<o;++n)d=j+e*c,e=d|0,d-=e,e&=k,h=g[e],e=g[e+1],b[n]=e=h+d*(e-h),j+=a[n]*i;this._lastouts=e}else{c=this.phase*this._radtoinc;for(n=0;n<o;++n)d=
j+c,e=d|0,d-=e,e&=k,h=g[e],e=g[e+1],b[n]=h+d*(e-h),j+=a[n]*i}j>f&&(j-=f);this._x=j;this.value=b[b.length-1]};e.processWithPhaseArray=function(b,a){var g=this.wave,c=this._radtoinc,d,j=this._x,e,h,i=this.frequency*this._coeff,n,o=this.step;if(this.feedback){e=this._lastouts;c*=this.phase;for(n=0;n<o;++n)d=j+e*c,e=d|0,d-=e,e&=k,h=g[e],e=g[e+1],b[n]=e=h+d*(e-h),j+=i;this._lastouts=e}else for(n=0;n<o;++n)d=j+a[n]*c,e=d|0,d-=e,e&=k,h=g[e],e=g[e+1],b[n]=h+d*(e-h),j+=i;j>f&&(j-=f);this._x=j;this.value=b[b.length-
1]};e.processWithFreqAndPhaseArray=function(b,a,g){var c=this.wave,d=this._radtoinc,j,e=this._x,h,i,n=this._coeff,o,p=this.step;if(this.feedback){g=this._lastouts;d*=this.phase;for(o=0;o<p;++o)j=e+g*d,h=j|0,j-=h,h&=k,i=c[h],h=c[h+1],b[o]=g=i+j*(h-i),e+=a[o]*n;this._lastouts=g}else for(o=0;o<p;++o)j=e+g[o]*f,h=j|0,j-=h,h&=k,i=c[h],h=c[h+1],b[o]=i+j*(h-i),e+=a[o]*n;e>f&&(e-=f);this._x=e;this.value=b[b.length-1]};var c=function(b){var a=d[b];if(void 0!==a)return"function"===typeof a&&(a=a()),a;var g;
g=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(b);if(null!==g){var a=g[1],c=g[3],e=g[4];g=d[g[2]];var j,f;if(void 0===g)a=void 0;else{"function"===typeof g&&(g=g());switch(c){case "@1":for(j=512;1024>j;++j)g[j]=0;break;case "@2":for(j=512;1024>j;++j)g[j]=Math.abs(g[j]);break;case "@3":for(j=256;512>j;++j)g[j]=0;for(j=512;768>j;++j)g[j]=Math.abs(g[j]);for(j=768;1024>j;++j)g[j]=0;break;case "@4":c=new Float32Array(1024);for(j=0;512>j;++j)c[j]=g[j<<1];g=c;break;case "@5":c=new Float32Array(1024);
for(j=0;512>j;++j)c[j]=Math.abs(g[j<<1]);g=c}if(void 0!==e&&50!==e){e*=0.01;e=0>e?0:1<e?1:e;c=new Float32Array(1024);e=1024*e|0;for(j=0;j<e;++j)c[j]=g[512*(j/e)|0];f=1024-e;for(e=0;1024>j;++j,++e)c[j]=g[512*(e/f)+512|0];g=c}if("+"===a)for(j=0;1024>j;++j)g[j]=0.5*g[j]+0.5;else if("-"===a)for(j=0;1024>j;++j)g[j]*=-1;a=g}if(void 0!==a)return d[b]=a}g=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(b);if(null!==g){b=g[1];a=new Float32Array(1024);g=b.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(g))for(j=
c=0;c<g;++c){e=parseInt(b.substr(2*c,2),16);e=e&128?(e-256)/128:e/127;f=0;for(var h=1024/g;f<h;++f)a[j++]=e}return a}g=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(b);if(null!==g){a=g[1];b=new Float32Array(1024);if(8===a.length){c=parseInt(a,16);g=new Float32Array(8);g[0]=1;for(a=0;7>a;++a)g[a+1]=0.0625*(c&15),c>>=4;for(a=0;8>a;++a){j=0;e=(a+1)/1024;for(c=0;1024>c;++c)b[c]+=Math.sin(2*Math.PI*j)*g[a],j+=e}for(a=g=0;1024>a;++a)if(g<(c=Math.abs(b[a])))g=c;if(0<g)for(a=0;1024>a;++a)b[a]/=g}return b}};i.getWavetable=
c;i.setWavetable=function(b,a){var g,c=new Float32Array(1024),e;if("function"===typeof a)for(e=0;1024>e;++e)c[e]=a(e/1024);else if(a instanceof Float32Array)if(a.length===c.length)c.set(a);else{g=a.length/1024;for(e=0;1024>e;++e)c[e]=a[e*g|0]}d[b]=c};var d={sin:function(){for(var b=new Float32Array(1024),a=0;1024>a;++a)b[a]=Math.sin(2*Math.PI*(a/1024));return b},cos:function(){for(var b=new Float32Array(1024),a=0;1024>a;++a)b[a]=Math.cos(2*Math.PI*(a/1024));return b},pulse:function(){for(var b=new Float32Array(1024),
a=0;1024>a;++a)b[a]=512>a?1:-1;return b},tri:function(){for(var b=new Float32Array(1024),a,g=0;1024>g;++g)a=g/1024-0.25,b[g]=1-4*Math.abs(Math.round(a)-a);return b},saw:function(){for(var b=new Float32Array(1024),a,g=0;1024>g;++g)a=g/1024,b[g]=2*(a-Math.round(a));return b},fami:function(){for(var b=[0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,0.875,0.75,0.625,0.5,0.375,0.25,0.125,0,-0.125,-0.25,-0.375,-0.5,-0.625,-0.75,-0.875,-1,-1,-0.875,-0.75,-0.625,-0.5,-0.375,-0.25,-0.125],a=new Float32Array(1024),
g=0;1024>g;++g)a[g]=b[g/1024*b.length|0];return a},konami:function(){for(var b=[-0.625,-0.875,-0.125,0.75,0.5,0.125,0.5,0.75,0.25,-0.125,0.5,0.875,0.625,0,0.25,0.375,-0.125,-0.75,0,0.625,0.125,-0.5,-0.375,-0.125,-0.75,-1,-0.625,0,-0.375,-0.875,-0.625,-0.25],a=new Float32Array(1024),g=0;1024>g;++g)a[g]=b[g/1024*b.length|0];return a}};h.modules.Oscillator=i})(timbre);
(function(h){function i(b,a,g){this.samplerate=b;this.channels=a;var d,m=b/44100;d=e.length*a;this.comb=Array(d);this.combout=Array(d);for(b=0;b<d;++b)this.comb[b]=new f(e[b%e.length]*m),this.combout[b]=new h.fn.SignalArray(g);d=c.length*a;this.allpass=Array(d);for(b=0;b<d;++b)this.allpass[b]=new k(c[b%c.length]*m);this.outputs=Array(a);this.outputs[0]=new h.fn.SignalArray(g);2===a&&(this.outputs[1]=new h.fn.SignalArray(g));this.damp=0;this.wet=0.33;this.setRoomSize(0.5);this.setDamp(0.5)}function f(b){this.buffer=
new h.fn.SignalArray(b|0);this.buffersize=this.buffer.length;this.damp=this.filterstore=this.feedback=this.bufidx=0}function k(b){this.buffer=new h.fn.SignalArray(b|0);this.buffersize=this.buffer.length;this.bufidx=0}var e=[1116,1188,1277,1356,1422,1491,1557,1617],c=[225,556,441,341],d=i.prototype;d.setRoomSize=function(b){var a=this.comb,g=0.28*b+0.7;this.roomsize=b;a[0].feedback=a[1].feedback=a[2].feedback=a[3].feedback=a[4].feedback=a[5].feedback=a[6].feedback=a[7].feedback=g;2===this.channels&&
(a[8].feedback=a[9].feedback=a[10].feedback=a[11].feedback=a[12].feedback=a[13].feedback=a[14].feedback=a[15].feedback=g)};d.setDamp=function(b){var a=this.comb,g=0.4*b;this.damp=b;a[0].damp=a[1].damp=a[2].damp=a[3].damp=a[4].damp=a[5].damp=a[6].damp=a[7].damp=g;2===this.channels&&(a[8].damp=a[9].damp=a[10].damp=a[11].damp=a[12].damp=a[13].damp=a[14].damp=a[15].damp=g)};d.process=function(b,a){var g=this.channels,c=this.comb,d=this.combout,j=this.allpass,e=this.outputs[0],f=this.outputs[1],h=this.wet,
i=1-h,k,p=b.length;c[0].process(b,d[0]);c[1].process(b,d[1]);c[2].process(b,d[2]);c[3].process(b,d[3]);c[4].process(b,d[4]);c[5].process(b,d[5]);c[6].process(b,d[6]);c[7].process(b,d[7]);for(k=0;k<p;++k)e[k]=d[0][k]+d[1][k]+d[2][k]+d[3][k]+d[4][k]+d[5][k]+d[6][k]+d[7][k];j[0].process(e,e);j[1].process(e,e);j[2].process(e,e);j[3].process(e,e);for(k=0;k<p;++k)b[k]=e[k]*h+b[k]*i;if(2===g){c[8].process(a,d[8]);c[9].process(a,d[9]);c[10].process(a,d[10]);c[11].process(a,d[11]);c[12].process(a,d[12]);c[13].process(a,
d[13]);c[14].process(a,d[14]);c[15].process(a,d[15]);for(k=0;k<p;++k)f[k]=d[8][k]+d[9][k]+d[10][k]+d[11][k]+d[12][k]+d[13][k]+d[14][k]+d[15][k];j[4].process(f,f);j[5].process(f,f);j[6].process(f,f);j[7].process(f,f);for(k=0;k<p;++k)a[k]=f[k]*h+a[k]*i}};f.prototype.process=function(b,a){var g,c,d=this.buffer,j=this.buffersize,e=this.bufidx,f=this.filterstore,h=this.feedback,k=this.damp,i=1-k,p,s=b.length;for(p=0;p<s;++p)g=0.015*b[p],c=d[e],f=c*i+f*k,d[e]=g+f*h,++e>=j&&(e=0),a[p]=c;this.bufidx=e;this.filterstore=
f};k.prototype.process=function(b,a){var g,c,d,j=this.buffer,e=this.buffersize,f=this.bufidx,h,k=b.length;for(h=0;h<k;++h)g=b[h],d=j[f],c=-g+d,j[f]=g+0.5*d,++f>=e&&(f=0),a[h]=c;this.bufidx=f};h.modules.Reverb=i})(timbre);
(function(h){function i(b){return new f(b)}function f(b){this.fragments=[];b&&this.fragments.push(new k(b,0,b.buffer.length/(b.samplerate||44100)))}function k(b,a,g,c,e,j,f){b||(b=d);this.buffer=b.buffer;this.samplerate=b.samplerate||44100;this.start=a;this._duration=g;this.reverse=c||!1;this.pitch=e||100;this.stretch=j||!1;this.pan=f||50}function e(b,a){this.tape=b;this.fragments=b.fragments;this.samplerate=a||44100;this.isEnded=!1;this.buffer=null;this.bufferEndIndex=this.bufferBeginIndex=this.bufferIndexIncr=
this.bufferIndex=0;this.fragment=null;this.fragmentIndex=0;this.panR=this.panL=0.7071067811865475}var c=new Float32Array(60),d={buffer:c,samplerate:1};i.silence=function(b){return(new i(d)).slice(0,1).fill(b)};i.join=function(b){for(var a=new f,g=0;g<b.length;g++)b[g]instanceof f&&a.add_fragments(b[g].fragments);return a};i.Tape=f;f.prototype.add_fragment=function(b){this.fragments.push(b);return this};f.prototype.add_fragments=function(b){for(var a=0;a<b.length;a++)this.fragments.push(b[a]);return this};
f.prototype.duration=function(){for(var b=0,a=0;a<this.fragments.length;a++)b+=this.fragments[a].duration();return b};f.prototype.slice=function(b,a){var g=this.duration();b+a>g&&(a=g-b);for(var g=new f,c=b,d=a,j=0;j<this.fragments.length;j++){var d=this.fragments[j].create(c,d),e=d[0],c=d[1],d=d[2];e&&g.add_fragment(e);if(0===d)break}return g};f.prototype.cut=f.prototype.slice;f.prototype.concat=function(b){var a=new f;a.add_fragments(this.fragments);a.add_fragments(b.fragments);return a};f.prototype.loop=
function(b){var a,g=[];for(a=0;a<this.fragments.length;a++)g.push(this.fragments[a].clone());var c=new f;for(a=0;a<b;a++)c.add_fragments(g);return c};f.prototype.times=f.prototype.loop;f.prototype.split=function(b){for(var a=this.duration()/b,g=[],c=0;c<b;c++)g.push(this.slice(c*a,a));return g};f.prototype.fill=function(b){var a=this.duration();if(0===a)throw"EmptyFragment";var g=b%a;return this.loop(b/a|0).plus(this.slice(0,g))};f.prototype.replace=function(b,a,g){var c=new f,a=b+a,c=c.plus(this.slice(0,
b)),d=c.duration();d<b&&(c=c.plus(i.silence(b-d)));c=c.plus(g);b=this.duration();b>a&&(c=c.plus(this.slice(a,b-a)));return c};f.prototype.reverse=function(){for(var b=new f,a=this.fragments.length;a--;){var g=this.fragments[a].clone();g.reverse=!g.isReversed();b.add_fragment(g)}return b};f.prototype.pitch=function(b,a){for(var g=new f,a=a||!1,c=0;c<this.fragments.length;c++){var d=this.fragments[c].clone();d.pitch*=0.01*b;d.stretch=a;g.add_fragment(d)}return g};f.prototype.stretch=function(b){return this.pitch(100*
(1/(0.01*b)),!0)};f.prototype.pan=function(b){for(var a=new f,g=0;g<this.fragments.length;g++){var c=this.fragments[g].clone();c.pan=b;a.add_fragment(c)}return a};f.prototype.silence=function(){return i.silence(this.duration())};f.prototype.join=function(b){for(var a=new f,g=0;g<b.length;g++)b[g]instanceof f&&a.add_fragments(b[g].fragments);return a};k.prototype.duration=function(){return this._duration*(100/this.pitch)};k.prototype.original_duration=function(){return this._duration};k.prototype.isReversed=
function(){return this.reverse};k.prototype.isStretched=function(){return this.stretched};k.prototype.create=function(b,a){var g=this.duration();if(b>=g)return[null,b-g,a];b+a>=g?(g-=b,a-=g):(g=a,a=0);var c=this.clone();c.start=this.start+0.01*b*this.pitch;c._duration=0.01*g*this.pitch;c.reverse=!1;return[c,0,a]};k.prototype.clone=function(){var b=new k;b.buffer=this.buffer;b.samplerate=this.samplerate;b.start=this.start;b._duration=this._duration;b.reverse=this.reverse;b.pitch=this.pitch;b.stretch=
this.stretch;b.pan=this.pan;return b};i.Fragment=k;i.TapeStream=e;e.prototype.reset=function(){this.isEnded=!1;this.buffer=null;this.bufferEndIndex=this.bufferBeginIndex=this.bufferIndexIncr=this.bufferIndex=0;this.fragment=null;this.fragmentIndex=0;this.panR=this.panL=0.7071067811865475;this.isLooped=!1;return this};e.prototype.fetch=function(b){var a=new h.fn.SignalArray(b),g=new h.fn.SignalArray(b),d=this.fragments;if(0===d.length)return[a,g];for(var e=100*this.samplerate,j=this.buffer,f=this.bufferIndex,
k=this.bufferIndexIncr,i=this.bufferBeginIndex,n=this.bufferEndIndex,o=this.fragment,p=this.fragmentIndex,s=this.panL,w=this.panR,t=0;t<b;t++){for(;!j||f<i||f>=n;)if(!o||p<d.length)o=d[p++],j=o.buffer,k=o.samplerate/e*o.pitch,i=o.start*o.samplerate,n=i+o.original_duration()*o.samplerate,s=Math.cos(0.005*Math.PI*o.pan),w=Math.sin(0.005*Math.PI*o.pan),o.reverse?(k*=-1,f=n+k):f=i;else if(this.isLooped)j=null,n=i=k=f=0,o=null,p=0;else{this.isEnded=!0;j=c;f=k=0;break}a[t]=j[f|0]*s;g[t]=j[f|0]*w;f+=k}this.buffer=
j;this.bufferIndex=f;this.bufferIndexIncr=k;this.bufferBeginIndex=i;this.bufferEndIndex=n;this.fragment=o;this.fragmentIndex=p;this.panL=s;this.panR=w;return[a,g]};h.modules.Scissor=i})(timbre);
(function(h){function i(f){this.samplerate=f;this.buffersize=1<<Math.ceil(Math.log(1.5*f)*Math.LOG2E);this.buffermask=this.buffersize-1;this.writeBufferL=new h.fn.SignalArray(this.buffersize);this.writeBufferR=new h.fn.SignalArray(this.buffersize);this.readBufferL=this.writeBufferL;this.readBufferR=this.writeBufferR;this.mix=this.cross=this.feedback=this.delaytime=null;this.writeIndex=this.readIndex=this.prevR=this.prevL=0;this.setParams(125,0.25,!1,0.45)}var f=i.prototype;f.setParams=function(f,
e,c,d){this.delaytime!==f&&(this.delaytime=f,f=0.001*f*this.samplerate|0,f>this.buffermask&&(f=this.buffermask),this.writeIndex=this.readIndex+f&this.buffermask);this.feedback!==e&&(this.feedback=e);this.cross!==c&&((this.cross=c)?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR));this.mix!==d&&(this.mix=d)};f.process=function(f,e){var c=this.readBufferL,d=this.readBufferR,b=this.writeBufferL,a=this.writeBufferR,
g=this.readIndex,l=this.writeIndex,m=this.buffermask,j=this.feedback,h=this.mix,i=1-h,q=this.prevL,n=this.prevR,o,p,s=f.length;for(p=0;p<s;++p)o=c[g],b[l]=f[p]-o*j,f[p]=q=0.5*(f[p]*i+o*h+q),o=d[g],a[l]=e[p]-o*j,e[p]=n=0.5*(e[p]*i+o*h+n),g+=1,l=l+1&m;this.readIndex=g&this.buffermask;this.writeIndex=l;this.prevL=q;this.prevR=n};h.modules.StereoDelay=i})(timbre);
(function(h){function i(f){h.Object.call(this,2,f)}var f=h.fn;f.extend(i);i.prototype.process=function(h){var e=this._;this.tickID!==h&&(this.tickID=h,e.ar?(f.inputSignalAR(this),f.outputSignalAR(this)):(this.cells[0][0]=f.inputSignalKR(this),f.outputSignalKR(this)));return this};f.register("+",i)})(timbre);
(function(h){var i=h.fn,f=h.modules;i.register("audio",function(c){c=new (i.getClass("buffer"))(c);c.playbackState=i.FINISHED_STATE;c._.isLoaded=!1;Object.defineProperties(c,{isLoaded:{get:function(){return this._.isLoaded}}});c.load=k;c.loadthis=e;return c});var k=function(c){var d=this,b=this._,a=new f.Deferred(this),g=arguments,e=1;a.done(function(){d._.emit("done")});"function"===typeof g[e]&&(a.done(g[e++]),"function"===typeof g[e]&&a.fail(g[e++]));b.loadedTime=0;(new f.Decoder).decode(c,function(b,
g){var c=d._;if(b){d.playbackState=i.PLAYING_STATE;c.samplerate=b.samplerate;c.channels=b.channels;c.bufferMix=null;c.bufferL=b.bufferL;c.bufferR=b.bufferR;c.phase=0;c.phaseIncr=b.samplerate/h.samplerate;c.duration=b.duration*1E3;c.currentTime=0;if(c.isReversed){c.phaseIncr=c.phaseIncr*-1;c.phase=b.bufferL.length+c.phaseIncr}d._.emit("loadedmetadata")}else a.reject(g)},function(){d._.isLoaded=true;d._.plotFlush=true;d._.emit("loadeddata");a.resolveWith(d)});return a.promise()},e=function(){k.apply(this,
arguments);return this}})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);f.fixAR(this);a=this._;a.biquad=new e(h.samplerate,2);a.freq=h(340);a.band=h(1);a.gain=h(0);a.plotBefore=c;a.plotRange=[-18,18];a.plotFlush=!0}var f=h.fn,k=h.modules.FFT,e=h.modules.Biquad;f.extend(i);var c=function(a,b,c,d,e){a.lineWidth=1;a.strokeStyle="rgb(192, 192, 192)";for(var f=0.5*h.samplerate,k=1;10>=k;++k)for(var i=1;4>=i;i++){var o=k*Math.pow(10,i);20>=o||f<=o||(a.beginPath(),o=Math.log(o/20)/Math.log(f/20),o=(o*d+b|0)+0.5,a.moveTo(o,c),
a.lineTo(o,c+e),a.stroke())}e/=6;for(k=1;6>k;k++)a.beginPath(),f=(c+k*e|0)+0.5,a.moveTo(b,f),a.lineTo(b+d,f),a.stroke()},d=i.prototype;Object.defineProperties(d,{type:{set:function(a){var b=this._;a!==b.biquad.type&&(b.biquad.setType(a),b.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(a){this._.freq=h(a)},get:function(){return this._.freq}},cutoff:{set:function(a){this._.freq=h(a)},get:function(){return this._.freq}},res:{set:function(a){this._.band=h(a)},get:function(){return this._.band}},
Q:{set:function(a){this._.band=h(a)},get:function(){return this._.band}},band:{set:function(a){this._.band=h(a)},get:function(){return this._.band}},gain:{set:function(a){this._.gain=h(a)},get:function(){return this._.gain}}});d.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=a;f.inputSignalAR(this);var c=b.freq.process(a).cells[0][0],d=b.band.process(a).cells[0][0],a=b.gain.process(a).cells[0][0];if(b.prevFreq!==c||b.prevband!==d||b.prevGain!==a)b.prevFreq=c,b.prevband=d,b.prevGain=
a,b.biquad.setParams(c,d,a),b.plotFlush=!0;b.bypassed||b.biquad.process(this.cells[1],this.cells[2]);f.outputSignalAR(this)}return this};var b=new k(2048),a=h.Object.prototype.plot;d.plot=function(c){if(this._.plotFlush){var d=new e(h.samplerate,1);d.setType(this.type);d.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var f=new Float32Array(b.length);f[0]=1;d.process(f);b.forward(f);var d=new Float32Array(512),f=0.5*h.samplerate,j=new Float32Array(512),k,i,q,n;b.getFrequencyData(j);
for(k=0;512>k;++k)q=20*Math.pow(f/20,k/512),i=q/(f/j.length),q=i|0,i-=q,0===q?q=j[q]:(n=j[q-1],q=j[q],q=(1-i)*n+i*q),d[k]=q;this._.plotData=d;this._.plotFlush=null}return a.call(this,c)};f.register("biquad",i);f.register("lowpass",function(a){return(new i(a)).set("type","lowpass")});f.register("highpass",function(a){return(new i(a)).set("type","highpass")});f.register("bandpass",function(a){return(new i(a)).set("type","bandpass")});f.register("lowshelf",function(a){return(new i(a)).set("type","lowshelf")});
f.register("highshelf",function(a){return(new i(a)).set("type","highshelf")});f.register("peaking",function(a){return(new i(a)).set("type","peaking")});f.register("notch",function(a){return(new i(a)).set("type","notch")});f.register("allpass",function(a){return(new i(a)).set("type","allpass")});f.alias("lpf","lowpass");f.alias("hpf","highpass");f.alias("bpf","bandpass");f.alias("bef","notch");f.alias("brf","notch");f.alias("apf","allpass")})(timbre);
(function(h){function i(a){h.Object.call(this,1,a);k.fixAR(this);a=this._;a.pitch=h(1);a.samplerate=44100;a.channels=0;a.bufferMix=null;a.bufferL=new Float32Array(0);a.bufferR=a.bufferL;a.isLooped=!1;a.isReversed=!1;a.duration=0;a.currentTime=0;a.currentTimeObj=null;a.phase=0;a.phaseIncr=0;a.onended=k.make_onended(this,0);a.onlooped=e(this)}function f(a){return a instanceof Float32Array||a instanceof Float64Array?!0:!1}var k=h.fn;k.extend(i);var e=function(a){return function(){var b=a._;b.phase>=
b.bufferL.length?b.phase=0:0>b.phase&&(b.phase=b.bufferL.length+b.phaseIncr);a._.emit("looped")}},c=i.prototype,d=function(a){var b=this._;if("object"===typeof a){var c,d,j;f(a)?c=d=a:f(a.buffer)?(c=d=a.buffer,"number"===typeof a.samplerate&&(j=a.samplerate)):f(a.bufferL)&&f(a.bufferR)&&(c=a.bufferL,d=a.bufferR,"number"===typeof a.samplerate&&(j=a.samplerate));c&&d&&(0<j&&(b.samplerate=a.samplerate),b.bufferMix=null,b.bufferL=c,b.bufferR=d,b.phase=0,b.phaseIncr=b.samplerate/h.samplerate,b.duration=
1E3*b.bufferL.length/b.samplerate,b.currentTime=0,b.plotFlush=!0,this.reverse(b.isReversed))}};Object.defineProperties(c,{buffer:{set:d,get:function(){var a=this._;if(2===a.channels){if(!a.bufferMix){for(var b=new Float32Array(a.bufferL),c=a.bufferR,d=0,j=a.bufferMix.length;d<j;d++)b[d]=0.5*(b[d]+c[d]);a.bufferMix=b}return a.bufferMix}return a.bufferL}},bufferL:{get:function(){return this._.bufferL}},bufferR:{get:function(){return this._.bufferR}},pitch:{set:function(a){this._.pitch=h(a)},get:function(){return this._.pitch}},
isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(a){if("number"===typeof a){var b=this._;0<=a&&a<=b.duration&&(b.phase=a/1E3*b.samplerate,b.currentTime=a)}else a instanceof h.Object?this._.currentTimeObj=a:null===a&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}});
c.clone=function(){var a=this._,b=h("buffer");a.bufferL&&(2===a.channels?d.call(b,{bufferL:a.bufferL,bufferR:a.bufferR,samplerate:a.samplerate}):d.call(b,{buffer:a.bufferL,samplerate:a.samplerate}));b.loop(a.isLooped);b.reverse(a.isReversed);return b};c.slice=function(a,b){var c=this._,e=h(c.originkey),a="number"===typeof a?0.001*a*c.samplerate|0:0,b="number"===typeof b?0.001*b*c.samplerate|0:c.bufferL.length;if(a>b)var j=a,a=b,b=j;c.bufferL&&(2===c.channels?d.call(e,{bufferL:c.bufferL.subarray(a,
b),bufferR:c.bufferR.subarray(a,b),samplerate:c.samplerate}):d.call(e,{buffer:c.bufferL.subarray(a,b),samplerate:c.samplerate}),e.playbackState=k.PLAYING_STATE);e.loop(c.isLooped);e.reverse(c.isReversed);return e};c.reverse=function(a){var b=this._;b.isReversed=!!a;if(b.isReversed){if(0<b.phaseIncr&&(b.phaseIncr*=-1),0===b.phase&&b.buffer)b.phase=b.bufferL.length+b.phaseIncr}else 0>b.phaseIncr&&(b.phaseIncr*=-1);return this};c.loop=function(a){this._.isLooped=!!a;return this};c.bang=function(a){this.playbackState=
!1===a?k.FINISHED_STATE:k.PLAYING_STATE;this._.phase=0;this._.emit("bang");return this};c.process=function(a){var b=this._;if(!b.bufferL)return this;if(this.tickID!==a){this.tickID=a;var c=this.cells[1],d=this.cells[2],e=b.bufferL,f=b.bufferR,h=b.phase,i=b.cellsize;if(b.currentTimeObj){for(var n=b.currentTimeObj.process(a).cells[0],o,p=0.001*b.samplerate,a=0;a<i;++a)o=n[a],h=o*p,c[a]=e[h|0]||0,d[a]=f[h|0]||0;b.phase=h;b.currentTime=o}else{a=b.pitch.process(a).cells[0][0];o=b.phaseIncr*a;for(a=0;a<
i;++a)c[a]=e[h|0]||0,d[a]=f[h|0]||0,h+=o;h>=e.length?b.isLooped?k.nextTick(b.onlooped):k.nextTick(b.onended):0>h&&(b.isLooped?k.nextTick(b.onlooped):k.nextTick(b.onended));b.phase=h;b.currentTime+=k.currentTimeIncr}k.outputSignalAR(this)}return this};var b=h.Object.prototype.plot;c.plot=function(a){var c=this._,d=c.bufferL,e=c.bufferR;if(c.plotFlush){for(var j=new Float32Array(2048),f=0,h=d.length/2048,k=0;2048>k;k++)j[k]=0.5*(d[f|0]+e[f|0]),f+=h;c.plotData=j;c.plotFlush=null}return b.call(this,a)};
k.register("buffer",i)})(timbre);
(function(h){function i(c){h.Object.call(this,2,c);f.fixAR(this);c=new k(h.samplerate,2);c.setDelayTime(20);c.setRate(4);c.depth=20;c.feedback=0.2;c.mix=0.33;this._.chorus=c}var f=h.fn,k=h.modules.Chorus;f.extend(i);var e=i.prototype;Object.defineProperties(e,{type:{set:function(c){this._.chorus.setDelayTime(c)},get:function(){return this._.chorus.wave}},delay:{set:function(c){0.5<=c&&80>=c&&this._.chorus.setDelayTime(c)},get:function(){return this._.chorus.delayTime}},rate:{set:function(c){"number"===
typeof c&&0<c&&this._.chorus.setRate(c)},get:function(){return this._.chorus.rate}},depth:{set:function(c){"number"===typeof c&&(0<=c&&100>=c)&&(c*=h.samplerate/44100,this._.chorus.depth=c)},get:function(){return this._.chorus.depth}},fb:{set:function(c){"number"===typeof c&&(-1<=c&&1>=c)&&(this._.chorus.feedback=0.99996*c)},get:function(){return this._.chorus.feedback}},mix:{set:function(c){this._.mix=h(c)},get:function(){return this._.mix}}});e.process=function(c){var d=this._;this.tickID!==c&&
(this.tickID=c,f.inputSignalAR(this),d.bypassed||d.chorus.process(this.cells[1],this.cells[2]),f.outputSignalAR(this));return this};f.register("chorus",i)})(timbre);
(function(h){function i(e){h.Object.call(this,2,e);e=this._;e.min=-0.8;e.max=0.8}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{minmax:{set:function(e){var c=this._;"number"===typeof e&&(c.min=-Math.abs(e),c.max=-c.min)},get:function(){return this._.max}},min:{set:function(e){var c=this._;"number"===typeof e&&(c.max<e?c.max=e:c.min=e)},get:function(){return this._.min}},max:{set:function(e){var c=this._;"number"===typeof e&&(e<c.min?c.min=e:c.max=e)},get:function(){return this._.max}}});
k.process=function(e){var c=this._;if(this.tickID!==e){this.tickID=e;var e=this.cells[1],d=this.cells[2],b=e.length,a=c.min,g=c.max,l;if(c.ar){f.inputSignalAR(this);for(c=0;c<b;++c)l=e[c],l<a?l=a:l>g&&(l=g),e[c]=l,l=d[c],l<a?l=a:l>g&&(l=g),d[c]=l;f.outputSignalAR(this)}else l=f.inputSignalKR(this),l<a?l=a:l>g&&(l=g),this.cells[0][0]=l,f.outputSignalKR(this)}return this};f.register("clip",i)})(timbre);
(function(h){function i(b){h.Object.call(this,2,b);f.fixAR(this);b=this._;b.prevThresh=-24;b.prevKnee=30;b.prevRatio=12;b.thresh=h(b.prevThresh);b.knee=h(b.prevKnee);b.ratio=h(b.prevRatio);b.postGain=6;b.reduction=0;b.comp=new e(h.samplerate,2);b.comp.dbPostGain=b.postGain;b.comp.setAttackTime(0.003);b.comp.setReleaseTime(0.25);b.comp.setPreDelayTime(6);b.comp.setParams(b.prevThresh,b.prevKnee,b.prevRatio)}var f=h.fn,k=h.timevalue,e=h.modules.Compressor;f.extend(i);var c=i.prototype;Object.defineProperties(c,
{thresh:{set:function(b){this._.thresh=h(b)},get:function(){return this._.thresh}},knee:{set:function(b){this._.kne=h(b)},get:function(){return this._.knee}},ratio:{set:function(b){this._.ratio=h(b)},get:function(){return this._.ratio}},gain:{set:function(b){"number"===typeof b&&(this._.postGain=b,this._.comp.dbPostGain=b)},get:function(){return this._.postGain}},attack:{set:function(b){"string"===typeof b&&(b=k(b));"number"===typeof b&&(b=0>b?0:1E3<b?1E3:b,this._.attack=b,this._.comp.setAttackTime(0.001*
b))},get:function(){return this._.comp.attackTime}},release:{set:function(b){"string"===typeof b&&(b=k(b),0>=b&&(b=0));"number"===typeof b&&(b=0>b?0:1E3<b?1E3:b,this._.release=b,this._.comp.releaseTime=0.001*b)},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}});c.process=function(b){var a=this._;if(this.tickID!==b){this.tickID=b;f.inputSignalAR(this);var c=a.thresh.process(b).cells[0][0],d=a.knee.process(b).cells[0][0],b=a.ratio.process(b).cells[0][0];if(a.prevThresh!==
c||a.prevKnee!==d||a.prevRatio!==b)a.prevThresh=c,a.prevKnee=d,a.prevRatio=b,a.comp.setParams(c,d,b);a.bypassed||(a.comp.process(this.cells[1],this.cells[2]),a.reduction=a.comp.meteringGain);f.outputSignalAR(this)}return this};var d=h.Object.prototype.plot;c.plot=function(b){var a=this._.comp.clone();a.setParams(this.thresh.valueOf(),this.knee.valueOf(),this.ratio.valueOf());var c=new f.SignalArray(1024),e=new Float32Array(128),m,j,h;for(j=0;128>j;++j){m=Math.pow(10,0.05*(0.625*j-80));for(h=0;1024>
h;++h)c[h]=m;a.process(c,c);for(h=m=0;32>h;++h)Math.abs(c[h])>m&&(m=Math.abs(c[h]));1.0E-6>m&&(m=1.0E-6);m=20*Math.log(m)*Math.LOG10E;m=80+m;e[j]=m}this._.plotData=e;this._.plotRange=[0,80];this._.plotFlush=null;return d.call(this,b)};f.register("comp",i);f.alias("compressor","comp")})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);f.fixAR(this);c=this._;c.freq=h(440);c.osc1=new k(h.samplerate);c.osc2=new k(h.samplerate);c.osc1.step=h.cellsize;c.osc2.step=h.cellsize;c.tmp=new f.SignalArray(h.cellsize);c.beats=0.5;this.once("init",e)}var f=h.fn,k=h.modules.Oscillator;f.extend(i);var e=function(){this.wave||(this.wave="sin")},c=i.prototype;Object.defineProperties(c,{wave:{set:function(c){this._.osc1.setWave(c);this._.osc2.setWave(c)},get:function(){return this._.osc1.wave}},freq:{set:function(c){this._.freq=
h(c)},get:function(){return this._.freq}},beats:{set:function(c){"number"===typeof c&&0<c&&(this._.beats=c)},get:function(){return this._.beats}}});c.bang=function(){this._.osc1.reset();this._.osc2.reset();this._.emit("bang");return this};c.process=function(c){var b=this._,a=this.cells[0];if(this.tickID!==c){this.tickID=c;var g,e=a.length,c=b.freq.process(c).cells[0][0];g=b.osc1;var m=b.osc2,j=b.tmp;g.frequency=c-0.5*b.beats;g.process(j);for(g=0;g<e;++g)a[g]=0.5*j[g];m.frequency=c+0.5*b.beats;m.process(j);
for(g=0;g<e;++g)a[g]+=0.5*j[g];f.outputSignalAR(this)}return this};f.register("cosc",i)})(timbre);
(function(h){function i(c){h.Object.call(this,2,c);f.fixAR(this);c=this._;c.time=h(100);c.fb=h(0.2);c.cross=h(!1);c.mix=0.33;c.delay=new e(h.samplerate)}var f=h.fn,k=h.timevalue,e=h.modules.StereoDelay;f.extend(i);var c=i.prototype;Object.defineProperties(c,{time:{set:function(c){"string"===typeof c&&(c=k(c));this._.time=h(c)},get:function(){return this._.time}},fb:{set:function(c){this._.fb=h(c)},get:function(){return this._.fb}},cross:{set:function(c){this._.cross=h(c)},get:function(){return this._.cross}},
mix:{set:function(c){"number"===typeof c&&(this._.mix=1<c?1:0>c?0:c)},get:function(){return this._.mix}}});c.process=function(c){var b=this._;if(this.tickID!==c){this.tickID=c;var a=b.time.process(c).cells[0][0],g=b.fb.process(c).cells[0][0],c=0!==b.cross.process(c).cells[0][0],e=b.mix;if(b.prevTime!==a||b.prevFb!==g||b.prevCross!==c||b.prevMix!==e)b.prevTime=a,b.prevFb=g,b.prevCross=c,b.prevMix=e,b.delay.setParams(a,g,c,e);f.inputSignalAR(this);b.bypassed||b.delay.process(this.cells[1],this.cells[2]);
f.outputSignalAR(this)}return this};f.register("delay",i)})(timbre);
(function(h){function i(e){h.Object.call(this,2,e);f.fixAR(this);e=this._;e.pre=h(60);e.post=h(-18);e.samplerate=h.samplerate;e.x1L=e.x2L=e.y1L=e.y2L=0;e.x1R=e.x2R=e.y1R=e.y2R=0;e.b0=e.b1=e.b2=e.a1=e.a2=0;e.cutoff=0;e.Q=1;e.preScale=0;e.postScale=0}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{cutoff:{set:function(e){"number"===typeof e&&0<e&&(this._.cutoff=e)},get:function(){return this._.cutoff}},pre:{set:function(e){this._.pre=h(e)},get:function(){return this._.pre}},post:{set:function(e){this._.post=
h(e)},get:function(){return this._.post}}});k.process=function(e){var c=this._;if(this.tickID!==e){this.tickID=e;f.inputSignalAR(this);var d=-c.pre.process(e).cells[0][0],e=-c.post.process(e).cells[0][0];if(c.prevPreGain!==d||c.prevPostGain!==e)c.prevPreGain=d,c.prevPostGain=e,c.preScale=Math.pow(10,0.05*-d),c.postScale=Math.pow(10,0.05*-e);if(!c.bypassed){var d=this.cells[1],e=this.cells[2],b=c.preScale,a=c.postScale,g,l,m,j,h;if(c.cutoff){c.prevCutoff!==c.cutoff&&(c.prevCutoff=c.cutoff,l=2*Math.PI*
c.cutoff/c.samplerate,g=Math.cos(l),l=Math.sin(l)/(2*c.Q),m=1/(1+l),c.b0=0.5*(1-g)*m,c.b1=1-g*m,c.b2=0.5*(1-g)*m,c.a1=-2*g*m,c.a2=1-l*m);var k=c.x1L,i=c.x2L,n=c.y1L,o=c.y2L,p=c.x1R,s=c.x2R,w=c.y1R,t=c.y2R,v=c.b0,z=c.b1,A=c.b2,y=c.a1,C=c.a2;g=0;for(l=d.length;g<l;++g)j=d[g]*b,h=v*j+z*k+A*i-y*n-C*o,m=h*a,-1>m?m=-1:1<m&&(m=1),d[g]=m,i=k,k=j,o=n,n=h,j=e[g]*b,h=v*j+z*p+A*s-y*w-C*t,m=h*a,-1>m?m=-1:1<m&&(m=1),e[g]=m,s=p,p=j,t=w,w=h;c.x1L=k;c.x2L=i;c.y1L=n;c.y2L=o;c.x1R=p;c.x2R=s;c.y1R=w;c.y2R=t}else{g=0;
for(l=d.length;g<l;++g)m=d[g]*b*a,-1>m?m=-1:1<m&&(m=1),d[g]=m,m=e[g]*b*a,-1>m?m=-1:1<m&&(m=1),e[g]=m}}f.outputSignalAR(this)}return this};f.register("dist",i)})(timbre);
(function(h){function i(f){h.Object.call(this,2,f);this._.ar=!1}var f=h.fn;f.extend(i);i.prototype.process=function(h){var e=this._;if(this.tickID!==h){this.tickID=h;var c=this.nodes,d=this.cells[0],b=this.cells[1],a=this.cells[2],g,l=c.length,m=d.length,j,i;if(e.ar){if(0<c.length){c[0].process(h);j=c[0].cells[1];i=c[0].cells[2];b.set(j);a.set(i);for(g=1;g<l;++g){c[g].process(h);j=c[g].cells[1];i=c[g].cells[2];for(d=0;d<m;++d)e=j[d],b[d]=0===e?0:b[d]/e,e=i[d],a[d]=0===e?0:a[d]/e}}else for(d=0;d<m;++d)b[d]=
a[g]=0;f.outputSignalAR(this)}else{if(0<c.length){b=c[0].process(h).cells[0][0];for(g=1;g<l;++g)e=c[g].process(h).cells[0][0],b=0===e?0:b/e}else b=0;d[0]=b;f.outputSignalKR(this)}}return this};f.register("/",i)})(timbre);
(function(h){function i(d){h.Object.call(this,2,d);d=this._;d.env=new c(h.samplerate);d.env.setStep(d.cellsize);d.tmp=new k.SignalArray(d.cellsize);d.ar=!1;d.plotFlush=!0;d.onended=a(this);this.on("ar",b)}function f(a,b,c,d,g,e){"number"===typeof a[d]?c=a[d]:"number"===typeof a[g]?c=a[g]:e&&("string"===typeof a[d]?c=e(a[d]):"string"===typeof a[g]&&(c=e(a[g])));c<b&&(c=b);return c}var k=h.fn,e=h.timevalue,c=h.modules.Envelope,d=k.isDictionary;k.extend(i);var b=function(a){this._.env.setStep(a?1:this._.cellsize)},
a=function(a){return function(){a._.emit("ended")}},g=i.prototype;Object.defineProperties(g,{table:{set:function(a){if(Array.isArray(a)){for(var b=this._.env,d=[a[0]||m],g,f,l,h,i=1,k=a.length;i<k;++i)g=a[i][0]||m,f=a[i][1],l=a[i][2],"number"!==typeof f&&(f="string"===typeof f?e(f):10),10>f&&(f=10),"number"===typeof l?(h=l,l=c.CurveTypeCurve):(l=c.CurveTypeDict[l]||null,h=0),d.push([g,f,l,h]);b.setTable(d);this._.plotFlush=!0}},get:function(){return this._.env.table}},curve:{set:function(a){this._.env.setCurve(a)},
get:function(){return this._.env.curve}},releaseNode:{set:function(a){this._.env.setReleaseNode(a);this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(a){this._.env.setLoopNode(a);this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}});g.clone=function(){var a=new i([]);a._.env=this._.env.clone();a._.ar=this._.ar;return a};g.reset=function(){this._.env.reset();return this};g.release=function(){var a=this._;a.env.release();a.emit("released");return this};
g.bang=function(){var a=this._;a.env.reset();a.env.status=c.StatusGate;a.emit("bang");return this};g.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=a;var a=this.cells[1],c=this.cells[2],d,g=b.cellsize;if(this.nodes.length)k.inputSignalAR(this);else for(d=0;d<g;++d)a[d]=c[d]=1;var e;d=null;if(b.ar){e=b.tmp;b.env.process(e);for(d=0;d<g;++d)a[d]*=e[d],c[d]*=e[d]}else{e=b.env.next();for(d=0;d<g;++d)a[d]*=e,c[d]*=e}d=b.env.emit;k.outputSignalAR(this);d&&("ended"===d?k.nextTick(b.onended):
this._.emit(d,b.value))}return this};var l=h.Object.prototype.plot;g.plot=function(a){if(this._.plotFlush){var b=this._.env.clone(),d=b.getInfo(1E3),g=d.totalDuration,e=d.loopBeginTime,f=d.releaseBeginTime,d=new Float32Array(256),m=0,i=g/d.length,k=!1,t=0.001*g*h.samplerate|0,v,t=t/d.length;b.setStep(t);b.status=c.StatusGate;t=0;for(v=d.length;t<v;++t)d[t]=b.next(),m+=i,!k&&m>=f&&(b.release(),k=!0);this._.plotData=d;this._.plotBefore=function(a,b,c,d,j){var l;Infinity!==e&&Infinity!==f&&(c=b+d*(e/
g),l=b+d*(f/g),a.fillStyle="rgba(224, 224, 224, 0.8)",a.fillRect(c,0,l-c,j));Infinity!==f&&(c=b+d*(f/g),a.fillStyle="rgba(212, 212, 212, 0.8)",a.fillRect(c,0,d-c,j))};b=Infinity;m=-Infinity;for(t=0;t<v;++t)d[t]<b?b=d[t]:d[t]>m&&(m=d[t]);1>m&&(m=1);this._.plotRange=[b,m];this._.plotData=d;this._.plotFlush=null}return l.call(this,a)};k.register("env",i);var m=c.ZERO;k.register("perc",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,10,"a","attackTime",e),g=f(b,10,1E3,"r","decayTime",e),l=f(b,
m,1,"lv","level");b.table=[m,[l,c],[m,g]];return new i(a)});k.register("adsr",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,10,"a","attackTime",e),g=f(b,10,300,"d","decayTime",e),l=f(b,m,0.5,"s","sustainLevel"),h=f(b,10,1E3,"r","decayTime",e),k=f(b,m,1,"lv","level");b.table=[m,[k,c],[l,g],[m,h]];b.releaseNode=3;return new i(a)});k.register("adshr",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,10,"a","attackTime",e),g=f(b,10,300,"d","decayTime",e),l=f(b,m,0.5,"s","sustainLevel"),
h=f(b,10,500,"h","holdTime",e),k=f(b,10,1E3,"r","decayTime",e),s=f(b,m,1,"lv","level");b.table=[m,[s,c],[l,g],[l,h],[m,k]];return new i(a)});k.register("asr",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,10,"a","attackTime",e),g=f(b,m,0.5,"s","sustainLevel"),l=f(b,10,1E3,"r","releaseTime",e);b.table=[m,[g,c],[m,l]];b.releaseNode=2;return new i(a)});k.register("dadsr",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,100,"dl","delayTime",e),g=f(b,10,10,"a","attackTime",e),l=f(b,10,300,
"d","decayTime",e),h=f(b,m,0.5,"s","sustainLevel"),k=f(b,10,1E3,"r","relaseTime",e),s=f(b,m,1,"lv","level");b.table=[m,[m,c],[s,g],[h,l],[m,k]];b.releaseNode=4;return new i(a)});k.register("ahdsfr",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,10,"a","attackTime",e),g=f(b,10,10,"h","holdTime",e),l=f(b,10,300,"d","decayTime",e),h=f(b,m,0.5,"s","sustainLevel"),k=f(b,10,5E3,"f","fadeTime",e),s=f(b,10,1E3,"r","relaseTime",e),w=f(b,m,1,"lv","level");b.table=[m,[w,c],[w,g],[h,l],[m,k],[m,s]];b.releaseNode=
5;return new i(a)});k.register("linen",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,10,10,"a","attackTime",e),g=f(b,10,1E3,"s","sustainTime",e),l=f(b,10,1E3,"r","releaseTime",e),h=f(b,m,1,"lv","level");b.table=[m,[h,c],[h,g],[m,l]];return new i(a)});k.register("env.tri",function(a){d(a[0])||a.unshift({});var b=a[0],c=f(b,20,1E3,"dur","duration",e),g=f(b,m,1,"lv","level"),c=0.5*c;b.table=[m,[g,c],[m,c]];return new i(a)});k.register("env.cutoff",function(a){d(a[0])||a.unshift({});var b=a[0],
c=f(b,10,100,"r","relaseTime",e),g=f(b,m,1,"lv","level");b.table=[g,[m,c]];return new i(a)})})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);f.fixAR(this);a=this._;a.biquads=Array(7);a.plotBefore=d;a.plotRange=[-18,18];a.plotFlush=!0}var f=h.fn,k=h.modules.FFT,e=h.modules.Biquad,c={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};f.extend(i);var d=function(a,b,c,d,g){a.lineWidth=1;a.strokeStyle="rgb(192, 192, 192)";for(var e=0.5*h.samplerate,f=1;10>=f;++f)for(var k=1;4>=k;k++){var i=f*Math.pow(10,k);20>=i||e<=i||(a.beginPath(),i=Math.log(i/20)/Math.log(e/20),i=(i*d+b|0)+0.5,a.moveTo(i,c),a.lineTo(i,
c+g),a.stroke())}g/=6;for(f=1;6>f;f++)a.beginPath(),e=(c+f*g|0)+0.5,a.moveTo(b,e),a.lineTo(b+d,e),a.stroke()},b=i.prototype;Object.defineProperties(b,{params:{set:function(a){if("object"===typeof a)for(var b=Object.keys(a),c=0,d=b.length;c<d;++c){var g=a[b[c]];Array.isArray(g)?this.setParams(b[c],g[0],g[1],g[2]):this.setParams(b[c])}}}});b.setParams=function(a,b,d,g){var f=this._;"string"===typeof a&&(a=c[a]);if(0<=a&&a<f.biquads.length){a|=0;if("number"===typeof b&&"number"===typeof d){"number"!==
typeof g&&(g=0);var i=f.biquads[a];if(!i)switch(i=f.biquads[a]=new e(h.samplerate,2),a){case 0:i.setType("highpass");break;case f.biquads.length-1:i.setType("lowpass");break;default:i.setType("peaking")}i.setParams(b,d,g)}else f.biquads[a]=void 0;f.plotFlush=!0}return this};b.getParams=function(a){if(a=this._.biquads[a|0])return{freq:a.frequency,Q:a.Q,gain:a.gain}};b.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=a;f.inputSignalAR(this);if(!b.bypassed)for(var a=this.cells[1],c=this.cells[2],
b=b.biquads,d=0,g=b.length;d<g;++d)b[d]&&b[d].process(a,c);f.outputSignalAR(this)}return this};var a=new k(2048),g=h.Object.prototype.plot;b.plot=function(b){if(this._.plotFlush){var c=this._,d=new Float32Array(a.length);d[0]=1;for(var f=0,c=c.biquads.length;f<c;++f){var i=this.getParams(f);if(i){var k=new e(h.samplerate);0===f?k.setType("highpass"):f===c-1?k.setType("lowpass"):k.setType("peaking");k.setParams(i.freq,i.Q,i.gain);k.process(d)}}a.forward(d);var d=new Float32Array(512),c=0.5*h.samplerate,
i=new Float32Array(512),n,o;a.getFrequencyData(i);for(f=0;512>f;++f)k=20*Math.pow(c/20,f/512),n=k/(c/i.length),k=n|0,n-=k,0===k?k=i[k]:(o=i[k-1],k=i[k],k=(1-n)*o+n*k),d[f]=k;this._.plotData=d;this._.plotFlush=null}return g.call(this,b)};f.register("eq",i)})(timbre);
(function(h){function i(c){h.Object.call(this,2,c);f.listener(this);f.fixAR(this);this.real=new h.ChannelObject(this);this.imag=new h.ChannelObject(this);this.cells[3]=this.real.cell;this.cells[4]=this.imag.cell;c=this._;c.fft=new k(2*c.cellsize);c.fftCell=new f.SignalArray(c.fft.length);c.prevCell=new f.SignalArray(c.cellsize);c.freqs=new f.SignalArray(c.fft.length>>1);c.plotFlush=!0;c.plotRange=[0,32];c.plotBarStyle=!0}var f=h.fn,k=h.modules.FFT;f.extend(i);var e=i.prototype;Object.defineProperties(e,
{window:{set:function(c){this._.fft.setWindow(c)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}});e.process=function(c){var b=this._;if(this.tickID!==c){this.tickID=c;f.inputSignalAR(this);f.outputSignalAR(this);var c=this.cells[0],a=b.cellsize;b.fftCell.set(b.prevCell);b.fftCell.set(c,a);b.fft.forward(b.fftCell);b.prevCell.set(c);b.plotFlush=!0;this.cells[3].set(b.fft.real.subarray(0,a));this.cells[4].set(b.fft.imag.subarray(0,
a))}return this};var c=h.Object.prototype.plot;e.plot=function(d){this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null);return c.call(this,d)};f.register("fft",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);f.fixAR(this);e=this._;e.freq=h(440);e.samplerate=h.samplerate;e.reg=32768;e.shortFlag=!1;e.phase=0;e.lastValue=0}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{shortFlag:{set:function(e){this._.shortFlag=!!e},get:function(){return this._.shortFlag}},freq:{set:function(e){this._.freq=h(e)},get:function(){return this._.freq}}});k.process=function(e){var c=this._,d=this.cells[0];if(this.tickID!==e){this.tickID=e;var b=c.lastValue,
a=c.phase,e=c.freq.process(e).cells[0][0]/c.samplerate,g=c.reg,f=c.mul,h=c.add,j,i;if(c.shortFlag){j=0;for(i=d.length;j<i;++j)1<=a&&(g>>=1,g|=((g^g>>6)&1)<<15,b=(g&1)-0.5,a-=1),d[j]=b*f+h,a+=e}else{j=0;for(i=d.length;j<i;++j)1<=a&&(g>>=1,g|=((g^g>>1)&1)<<15,b=(g&1)-0.5,a-=1),d[j]=b*f+h,a+=e}c.reg=g;c.phase=a;c.lastValue=b}return this};f.register("fnoise",i)})(timbre);
(function(h){function i(c){h.Object.call(this,2,c);f.fixAR(this);this._.selected=0;this._.outputs=[]}var f=h.fn,k=function(){function c(c){h.Object.call(this,2,[]);f.fixAR(this);this._.parent=c}f.extend(c);c.prototype.process=function(c){this.tickID!==c&&(this.tickID=c,this._.parent.process(c));return this};return c}();f.extend(i);var e=i.prototype;Object.defineProperties(e,{selected:{set:function(c){var d=this._;if("number"===typeof c){d.selected=c;for(var c=d.outputs,d=0,b=c.length;d<b;++d)c[d]&&
(c[d].cells[0].set(f.emptycell),c[d].cells[1].set(f.emptycell),c[d].cells[2].set(f.emptycell))}},get:function(){return this._.selected}}});e.at=function(c){var d=this._,b=d.outputs[c];b||(d.outputs[c]=b=new k(this));return b};e.process=function(c){var d=this._;if(this.tickID!==c&&(this.tickID=c,f.inputSignalAR(this),f.outputSignalAR(this),c=d.outputs[d.selected]))c.cells[0].set(this.cells[0]),c.cells[1].set(this.cells[1]),c.cells[2].set(this.cells[2]);return this};f.register("gate",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);f.fixAR(this);c=this._;c.fft=new k(2*c.cellsize);c.fftCell=new f.SignalArray(this._.fft.length);c.realBuffer=new f.SignalArray(this._.fft.length);c.imagBuffer=new f.SignalArray(this._.fft.length)}var f=h.fn,k=h.modules.FFT;f.extend(i);var e=i.prototype;Object.defineProperties(e,{real:{set:function(c){this._.real=h(c)},get:function(){return this._.real}},imag:{set:function(c){this._.imag=h(c)},get:function(){return this._.imag}}});e.process=function(c){var d=
this._;if(this.tickID!==c&&(this.tickID=c,d.real&&d.imag)){var b=this.cells[0],a=d.realBuffer,g=d.imagBuffer,e=d.real.process(c).cells[0],c=d.imag.process(c).cells[0];a.set(e);g.set(c);b.set(d.fft.inverse(a,g).subarray(0,d.cellsize));f.outputSignalAR(this)}return this};f.register("ifft",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);f.timer(this);f.fixKR(this);c=this._;c.interval=h(1E3);c.count=0;c.delay=0;c.timeout=Infinity;c.currentTime=0;c.delaySamples=0;c.countSamples=0;c.onended=f.make_onended(this);this.on("start",e)}var f=h.fn,k=h.timevalue;f.extend(i);var e=function(){var c=this._;this.playbackState=f.PLAYING_STATE;c.delaySamples=h.samplerate*0.001*c.delay|0;c.countSamples=c.count=c.currentTime=0};Object.defineProperty(e,"unremovable",{value:!0,writable:!1});var c=i.prototype;
Object.defineProperties(c,{interval:{set:function(c){"string"===typeof c&&(c=k(c),0>=c&&(c=0));this._.interval=h(c)},get:function(){return this._.interval}},delay:{set:function(c){"string"===typeof c&&(c=k(c));"number"===typeof c&&0<=c&&(this._.delay=c,this._.delaySamples=h.samplerate*0.001*c|0)},get:function(){return this._.delay}},count:{set:function(c){"number"===typeof c&&(this._.count=c)},get:function(){return this._.count}},timeout:{set:function(c){"string"===typeof c&&(c=k(c));"number"===typeof c&&
0<=c&&(this._.timeout=c)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}});c.bang=function(){var c=this._;this.playbackState=f.PLAYING_STATE;c.delaySamples=h.samplerate*0.001*c.delay|0;c.countSamples=c.count=c.currentTime=0;c.emit("bang");return this};c.process=function(c){var b=this.cells[0],a=this._;if(this.tickID!==c){this.tickID=c;0<a.delaySamples&&(a.delaySamples-=b.length);c=a.interval.process(c).cells[0][0];if(0>=a.delaySamples&&(a.countSamples-=
b.length,0>=a.countSamples)){a.countSamples+=0.001*h.samplerate*c|0;for(var c=this.nodes,g=a.count,e=g*a.mul+a.add,m=0,j=b.length;m<j;++m)b[m]=e;b=0;for(e=c.length;b<e;++b)c[b].bang(g);a.count+=1}a.currentTime+=f.currentTimeIncr;a.currentTime>=a.timeout&&f.nextTick(a.onended)}return this};f.register("interval",i)})(timbre);
(function(h){function i(a){if(k)return k;k=this;h.Object.call(this,1,a);f.fixKR(this)}if("browser"===h.envtype){var f=h.fn,k=null;f.extend(i);var e={},c=!1,d=!1,b=!1,a=function(a){for(var g=k._,f=k.cell,g=a.keyCode*g.mul+g.add,h=0,l=f.length;h<l;++h)f[h]=g;c=a.shiftKey;d=a.ctrlKey;b=a.altKey;e[a.keyCode]||(e[a.keyCode]=!0,k._.emit("keydown",a))},g=function(a){delete e[a.keyCode];k._.emit("keyup",a)},l=i.prototype;Object.defineProperties(l,{shiftKey:{get:function(){return c}},ctrlKey:{get:function(){return d}},
altKey:{get:function(){return b}}});l.start=function(){window.addEventListener("keydown",a,!0);window.addEventListener("keyup",g,!0);return this};l.stop=function(){window.removeEventListener("keydown",a,!0);window.removeEventListener("keyup",g,!0);return this};l.play=l.pause=function(){return this};f.register("keyboard",i)}})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);f.fixAR(this);var c=Math.ceil(Math.log(h.samplerate)*Math.LOG2E),d=this._;d.buffersize=1<<c;d.buffermask=d.buffersize-1;d.buffer=new f.SignalArray(d.buffersize);d.time=0;d.readIndex=0;d.writeIndex=0}var f=h.fn,k=h.timevalue;f.extend(i);var e=i.prototype;Object.defineProperties(e,{time:{set:function(c){"string"===typeof c&&(c=k(c));if("number"===typeof c&&0<c){var d=this._;d.time=c;c=0.001*c*h.samplerate|0;c>d.buffermask&&(c=d.buffermask);d.writeIndex=
d.readIndex+c&d.buffermask}},get:function(){return this._.time}}});e.process=function(c){var d=this._;if(this.tickID!==c){this.tickID=c;f.inputSignalAR(this);var c=this.cells[0],b=d.buffer,a=d.buffermask,g=d.readIndex,e=d.writeIndex,h,j=c.length;for(h=0;h<j;++h)b[e]=c[h],c[h]=b[g],g+=1,e=e+1&a;d.readIndex=g&a;d.writeIndex=e;f.outputSignalAR(this)}return this};f.register("lag",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);c=this._;c.input=0;c.value=0;c.prev=null;c.ar=!1;c.map=k}var f=h.fn;f.extend(i);var k=function(c){return c},e=i.prototype;Object.defineProperties(e,{input:{set:function(c){"number"===typeof c&&(this._.input=c)},get:function(){return this._.input}},map:{set:function(c){"function"===typeof c&&(this._.map=c)},get:function(){return this._.map}}});e.bang=function(){this._.prev=null;this._.emit("bang");return this};e.at=function(c){return this._.map?this._.map(c):
0};e.process=function(c){var d=this.cells[0],b=this._;if(this.tickID!==c){this.tickID=c;var a=this.nodes.length,c=d.length;if(b.ar&&a){f.inputSignalAR(this);var g=b.map;if(g)for(a=0;a<c;++a)d[a]=g(d[a]);b.value=d[c-1];f.outputSignalAR(this)}else{a=a?f.inputSignalKR(this):b.input;b.map&&b.prev!==a&&(b.prev=a,b.value=b.map(a));b=b.value*b.mul+b.add;for(a=0;a<c;++a)d[a]=b}}return this};f.register("map",i)})(timbre);
(function(h){function i(f){h.Object.call(this,1,f)}var f=h.fn;f.extend(i);i.prototype.process=function(h){var e=this.cells[0],c=this._;if(this.tickID!==h){this.tickID=h;var d=this.nodes,b=d.length,a,g=e.length,l,m;if(c.ar){if(0<d.length){l=d[0].process(h).cells[0];e.set(l);for(c=1;c<b;++c){l=d[c].process(h).cells[0];for(a=0;a<g;++a)m=l[a],e[a]<m&&(e[a]=m)}}else for(a=0;a<g;++a)e[a]=0;f.outputSignalAR(this)}else{if(0<d.length){l=d[0].process(h).cells[0][0];for(c=1;c<b;++c)m=d[c].process(h).cells[0][0],
l<m&&(l=m)}else l=0;e[0]=l;f.outputSignalKR(this)}}return this};f.register("max",i)})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);f.fixAR(this);a=this._;a.src=a.func=null;a.bufferL=new f.SignalArray(k);a.bufferR=new f.SignalArray(k);a.readIndex=0;a.writeIndex=0;a.totalRead=0;a.totalWrite=0}if("browser"===h.envtype){var f=h.fn,k=4096,e=k-1;f.extend(i);var c=i.prototype;c.listen=function(a){var b=d[h.env];b&&(b.set.call(this,a),b.listen.call(this))};c.unlisten=function(){var a=d[h.env];a&&a.unlisten.call(this);this.cells[0].set(f.emptycell);this.cells[1].set(f.emptycell);this.cells[2].set(f.emptycell);
for(var b=this._,a=b.bufferL,b=b.bufferR,c=0,e=a.length;c<e;++c)a[c]=b[c]=0};c.process=function(a){var b=this._;if(null===b.src)return this;if(this.tickID!==a){this.tickID=a;a=b.cellsize;if(b.totalWrite>b.totalRead+a){var c=b.readIndex,d=c+a;this.cells[1].set(b.bufferL.subarray(c,d));this.cells[2].set(b.bufferR.subarray(c,d));b.readIndex=d&e;b.totalRead+=a}f.outputSignalAR(this)}return this};var d={webkit:{set:function(a){var b=this._;a instanceof HTMLMediaElement&&(b.src=f._audioContext.createMediaElementSource(a))},
listen:function(){var a=this._,c=f._audioContext;a.gain=c.createGainNode();a.gain.gain.value=0;a.node=c.createJavaScriptNode(1024,2,2);a.node.onaudioprocess=b(this);a.src.connect(a.node);a.node.connect(a.gain);a.gain.connect(c.destination)},unlisten:function(){var a=this._;a.src&&a.src.disconnect();a.gain&&a.gain.disconnect();a.node&&a.node.disconnect()}}},b=function(a){return function(b){var c=a._,b=b.inputBuffer,d=b.length,f=c.writeIndex;c.bufferL.set(b.getChannelData(0),f);c.bufferR.set(b.getChannelData(1),
f);c.writeIndex=f+d&e;c.totalWrite+=d}};d.moz={set:function(a){var b=this._;a instanceof HTMLAudioElement&&(b.src=a,b.istep=h.samplerate/a.mozSampleRate)},listen:function(){var a=this._,b=a.bufferL,c=a.bufferR,d=0,f=0;2===a.src.mozChannels?(a.x=0,a.func=function(h){var i=a.writeIndex,k=a.totalWrite,h=h.frameBuffer,n,o=a.istep,p,s=h.length;n=a.x;for(p=0;p<s;p+=2){for(n+=o;0<n;)b[i]=0.5*(h[p]+d),c[i]=0.5*(h[p+1]+f),i=i+1&e,++k,n-=1;d=h[p];f=h[p+1]}a.x=n;a.writeIndex=i;a.totalWrite=k}):(a.x=0,a.func=
function(f){var j=a.writeIndex,h=a.totalWrite,f=f.frameBuffer,i,k=a.istep,p,s=f.length;i=a.x;for(p=0;p<s;++p){for(i+=k;0<=i;)b[j]=c[j]=0.5*(f[p]+d),j=j+1&e,++h,i-=1;d=f[p]}a.x=i;a.writeIndex=j;a.totalWrite=h});a.src.addEventListener("MozAudioAvailable",a.func)},unlisten:function(){var a=this._;a.func&&(a.src.removeEventListener("MozAudioAvailable",a.func),a.func=null)}};f.register("mediastream",i)}})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);e=this._;e.midi=0;e.value=0;e.prev=null;e.a4=440;e.ar=!1}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{midi:{set:function(e){"number"===typeof e&&(this._.midi=e)},get:function(){return this._.midi}},a4:{set:function(e){"number"===typeof e&&(this._.a4=e,this._.prev=null)},get:function(){return this._.a4}}});k.bang=function(){this._.prev=null;this._.emit("bang");return this};k.at=function(e){return this._.a4*Math.pow(2,(e-69)/
12)};k.process=function(e){var c=this._;if(this.tickID!==e){this.tickID=e;var e=this.cells[0],d=this.nodes.length,b=e.length;if(c.ar&&d){f.inputSignalAR(this);for(var a=c.a4,d=0;d<b;++d)e[d]=a*Math.pow(2,(e[d]-69)/12);c.value=e[b-1];f.outputSignalAR(this)}else b=d?f.inputSignalKR(this):c.midi,c.prev!==b&&(c.prev=b,c.value=c.a4*Math.pow(2,(b-69)/12)),e[0]=c.value,f.outputSignalKR(this)}return this};f.register("midicps",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);e=this._;e.midi=0;e.value=0;e.prev=null;e.range=12;e.ar=!1}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{midi:{set:function(e){"number"===typeof e&&(this._.midi=e)},get:function(){return this._.midi}},range:{set:function(e){"number"===typeof e&&0<e&&(this._.range=e)},get:function(){return this._.range}}});k.bang=function(){this._.prev=null;this._.emit("bang");return this};k.at=function(e){return Math.pow(2,e/this._.range)};k.process=
function(e){var c=this.cells[0],d=this._;if(this.tickID!==e){this.tickID=e;var b=this.nodes.length,e=c.length;if(d.ar&&b){f.inputSignalAR(this);for(var a=d.range,b=0;b<e;++b)c[b]=Math.pow(2,c[b]/a);d.value=c[e-1];f.outputSignalAR(this)}else{b=this.nodes.length?f.inputSignalKR(this):d.midi;d.prev!==b&&(d.prev=b,d.value=Math.pow(2,b/d.range));d=d.value*d.mul+d.add;for(b=0;b<e;++b)c[b]=d}}return this};f.register("midiratio",i)})(timbre);
(function(h){function i(f){h.Object.call(this,1,f)}var f=h.fn;f.extend(i);i.prototype.process=function(h){var e=this.cells[0],c=this._;if(this.tickID!==h){this.tickID=h;var d=this.nodes,b=d.length,a,g=e.length,l,m;if(c.ar){if(0<d.length){l=d[0].process(h).cells[0];e.set(l);for(c=1;c<b;++c){l=d[c].process(h).cells[0];for(a=0;a<g;++a)m=l[a],e[a]>m&&(e[a]=m)}}else for(a=0;a<g;++a)e[a]=0;f.outputSignalAR(this)}else{if(0<d.length){l=d[0].process(h).cells[0][0];for(c=1;c<b;++c)m=d[c].process(h).cells[0][0],
l>m&&(l=m)}else l=0;e[0]=l;f.outputSignalKR(this)}}return this};f.register("min",i)})(timbre);
(function(h){function i(a){h.Object.call(this,0,a);f.timer(this);f.fixKR(this);a=this._;a.mml="";a.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1};a.commands=[];a.index=0;a.queue=[];a.currentTime=0;a.queueTime=0;a.segnoIndex=-1;a.loopStack=[];a.prevNote=0;a.remain=Infinity;a.onended=f.make_onended(this);this.on("start",k)}var f=h.fn;f.extend(i);var k=function(){var a=this._;this.playbackState=f.PLAYING_STATE;a.commands=d(a.mml);a.index=0;a.queue=[];a.currentTime=0;a.queueTime=0;a.segnoIndex=-1;a.loopStack=
[];a.prevNote=0;a.remain=Infinity;c(this)};Object.defineProperty(k,"unremoved",{value:!0,writable:!1});var e=i.prototype;Object.defineProperties(e,{mml:{set:function(a){var b=this._;"string"===typeof a&&(b.mml=a)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}});e.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=a;var a=this.nodes,d=b.queue,e,j,h;if(d.length)for(;d[0][0]<=b.currentTime;){var i=b.queue.shift();if(i[1]){j=0;for(h=a.length;j<
h;++j)e=a[j],e.noteOn?e.noteOn(i[1],i[3]):e.bang();b.remain=i[4];b.emit("mml","noteOn",{noteNum:i[1],velocity:i[3]});c(this)}else{j=0;for(h=a.length;j<h;++j)e=a[j],e.noteOff?e.noteOff(i[2],i[3]):e.release&&e.release();b.emit("mml","noteOff",{noteNum:i[2],velocity:i[3]})}if(0===d.length)break}b.remain-=f.currentTimeIncr;0===d.length&&0>=b.remain&&f.nextTick(b.onended);b.currentTime+=f.currentTimeIncr}return this};var c=function(a){var a=a._,b,c=a.commands,d=a.queue,e=a.index,f=a.status,h=a.queueTime,
i=a.loopStack,k,o,p,s,w;s=[];a:for(;;){if(c.length<=e)if(0<=a.segnoIndex)e=a.segnoIndex;else break;b=c[e++];switch(b.name){case "n":k=f.t||120;null!==b.len?(o=b.len,p=b.dot||0):(o=f.l,p=b.dot||f.dot);k=1E3*60/k*(4/o);k*=[1,1.5,1.75,1.875][p]||1;p=f.v<<3;if(f.tie){for(b=d.length;b--;)if(d[b][2]){d.splice(b,1);break}b=a.prevNote}else b=a.prevNote=b.val+12*(f.o+1),d.push([h,b,null,p,k]);if(0<o){o=f.q/8;if(1>o){o=h+k*o;d.push([o,null,b,p]);b=0;for(w=s.length;b<w;++b)d.push([o,null,s[b],p])}s=[];h+=k;
if(!f.tie)break a}else s.push(b);f.tie=!1;break;case "r":k=f.t||120;null!==b.len?(o=b.len,p=b.dot||0):(o=f.l,p=b.dot||f.dot);0<o&&(k=1E3*60/k*(4/o),k*=[1,1.5,1.75,1.875][p]||1,h+=k);break;case "l":f.l=b.val;f.dot=b.dot;break;case "o":f.o=b.val;break;case "<":9>f.o&&(f.o+=1);break;case ">":0<f.o&&(f.o-=1);break;case "v":f.v=b.val;break;case "(":15>f.v&&(f.v+=1);break;case ")":0<f.v&&(f.v-=1);break;case "q":f.q=b.val;break;case "&":f.tie=!0;break;case "$":a.segnoIndex=e;break;case "[":i.push([e,null,
null]);break;case "|":if((k=i[i.length-1])&&1===k[1])i.pop(),e=k[2];break;case "]":if(k=i[i.length-1])null===k[1]&&(k[1]=b.count,k[2]=e),k[1]-=1,0===k[1]?i.pop():e=k[0];break;case "t":f.t=null===b.val?120:b.val}}a.index=e;a.queueTime=h},d=function(a){var c,d,e,f,h,i,k,n=Array(a.length),o=[];h=0;for(i=b.length;h<i;++h){c=b[h];for(d=c.re;e=d.exec(a);){if(!n[e.index]){f=0;for(k=e[0].length;f<k;++f)n[e.index+f]=!0;if(f=c.func?c.func(e):{name:e[0]})f.index=e.index,f.origin=e[0],o.push(f)}for(;d.lastIndex<
a.length&&n[d.lastIndex];)++d.lastIndex}}o.sort(function(a,b){return a.index-b.index});return o},b=[{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(a){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[a[1]]+({"-":-1,"+":1}[a[2]]||0),len:""===a[3]?null:Math.min(a[3]|0,64),dot:a[4].length}}},{re:/r(\d*)(\.*)/g,func:function(a){return{name:"r",len:""===a[1]?null:Math.max(1,Math.min(a[1]|0,64)),dot:a[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(a){return{name:"l",val:""===a[1]?4:Math.min(a[1]|
0,64),dot:a[2].length}}},{re:/o([0-9])/g,func:function(a){return{name:"o",val:""===a[1]?4:a[1]|0}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(a){return{name:"v",val:""===a[1]?12:Math.min(a[1]|0,15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(a){return{name:"q",val:""===a[1]?6:Math.min(a[1]|0,8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(a){return{name:"]",count:a[1]|0||2}}},{re:/t(\d*)/g,func:function(a){return{name:"t",val:""===a[1]?null:Math.max(5,Math.min(a[1]|0,300))}}},{re:/\$/g}];
f.register("mml",i)})(timbre);
(function(h){function i(a){if(e)return e;e=this;h.Object.call(this,1,a);this.X=new h.ChannelObject(this);this.Y=new h.ChannelObject(this);this.cells[3]=this.X.cell;this.cells[4]=this.Y.cell;k.fixKR(this)}function f(a){h.Object.call(this,1,a);e||(e=new i([]));k.fixKR(this)}if("browser"===h.envtype){var k=h.fn,e=null;k.extend(i);var c=function(a){e._.emit("click",a)},d=function(a){e._.emit("mousedown",a)},b=function(a){for(var b=a.clientX/window.innerWidth,a=a.clientY/window.innerHeight,c=e.cells[3],
d=e.cells[4],g=0,f=c.length;g<f;++g)c[g]=b,d[g]=a},a=function(a){e._.emit("mouseup",a)},g=i.prototype;g.start=function(){window.addEventListener("click",c,!0);window.addEventListener("mousedown",d,!0);window.addEventListener("mousemove",b,!0);window.addEventListener("mouseup",a,!0);return this};g.stop=function(){window.removeEventListener("click",c,!0);window.removeEventListener("mousedown",d,!0);window.removeEventListener("mousemove",b,!0);window.removeEventListener("mouseup",a,!0);return this};
g.play=g.pause=function(){return this};k.register("mouse",i);k.extend(f);Object.defineProperties(f.prototype,{min:{set:function(a){var b=this._;b.min=a;b.delta=b.max-b.min;b.map.bang()},get:function(){return this._.min}},max:{set:function(a){var b=this._;b.max=a;b.delta=b.max-b.min;b.map.bang()},get:function(){return this._.max}},curve:{set:function(a){var b=this._;if(l[a]){var c=l[a];b.map.map=function(a){return c(b,a)};b.map.bang();b.curveName=a}},get:function(){return this._.curveName}}});f.prototype.start=
function(){e.start();return this};f.prototype.stop=function(){e.stop();return this};f.prototype.process=function(a){this._.map.process(a);return this};var l={lin:function(a,b){return b*a.delta+a.min},exp:function(a,b){var c=0>a.min?1.0E-6:a.min;return Math.pow(a.max/c,b)*c},sqr:function(a,b){return b*b*a.delta+a.min},cub:function(a,b){return b*b*b*a.delta+a.min}};k.register("mouse.x",function(a){var a=new f(a),b=a._;b.min=0;b.max=1;b.delta=1;b.curveName="lin";var c=l.lin;b.map=h("map",{map:function(a){return c(b,
a)}},e.X);a.cells[0]=b.map.cells[3];return a});k.register("mouse.y",function(a){var a=new f(a),b=a._;b.min=0;b.max=1;b.delta=1;b.curveName="lin";var c=l.lin;b.map=h("map",{map:function(a){return c(b,a)}},e.Y);a.cells[0]=b.map.cells[4];return a})}})(timbre);
(function(h){function i(f){h.Object.call(this,2,f)}var f=h.fn;f.extend(i);i.prototype.process=function(h){var e=this._;if(this.tickID!==h){this.tickID=h;var c=this.nodes,d=this.cells[0],b=this.cells[1],a=this.cells[2],g=c.length,i=d.length,m,j;if(e.ar){if(0<c.length){c[0].process(h);m=c[0].cells[1];j=c[0].cells[2];b.set(m);a.set(j);for(e=1;e<g;++e){c[e].process(h);m=c[e].cells[1];j=c[e].cells[2];for(d=0;d<i;++d)b[d]*=m[d],a[d]*=j[d]}}else for(d=0;d<i;++d)b[d]=a[d]=0;f.outputSignalAR(this)}else{if(0<
c.length){b=c[0].process(h).cells[0][0];for(e=1;e<g;++e)b*=c[e].process(h).cells[0][0]}else b=0;d[0]=b;f.outputSignalKR(this)}}return this};f.register("*",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);c=this._;c.defaultValue=0;c.index=0;c.dict={};c.ar=!1}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{dict:{set:function(c){if("object"===typeof c)this._.dict=c;else if("function"===typeof c){for(var d={},b=0;128>b;++b)d[b]=c(b);this._.dict=d}},get:function(){return this._.dict}},defaultValue:{set:function(c){"number"===typeof c&&(this._.defaultValue=c)},get:function(){return this._.defaultValue}},index:{set:function(c){"number"===
typeof c&&(this._.index=c)},get:function(){return this._.index}}});k.at=function(c){var d=this._;return(d.dict[c|0]||d.defaultValue)*d.mul+d.add};k.clear=function(){this._.dict={};return this};k.process=function(c){var d=this.cells[0],b=this._;if(this.tickID!==c){this.tickID=c;var a=this.nodes.length,g;g=b.dict;var e=b.defaultValue,h=b.mul,j=b.add,c=d.length;if(b.ar&&a){f.inputSignalAR(this);for(b=0;b<c;++b)a=d[b],a=0>a?a-0.5|0:a+0.5|0,d[b]=(g[a]||e)*h+j;f.outputSignalAR(this)}else{a=this.nodes.length?
f.inputSignalKR(this):b.index;g=(g[0>a?a-0.5|0:a+0.5|0]||e)*h+j;for(b=0;b<c;++b)d[b]=g}}return this};f.register("ndict",i);var e={90:48,83:49,88:50,68:51,67:52,86:53,71:54,66:55,72:56,78:57,74:58,77:59,188:60,76:61,190:62,186:63,81:60,50:61,87:62,51:63,69:64,82:65,53:66,84:67,54:68,89:69,55:70,85:71,73:72,57:73,79:74,48:75,80:76};f.register("ndict.key",function(c){c=new i(c);c.dict=e;return c})})(timbre);
(function(h){function i(f){h.Object.call(this,1,f)}var f=h.fn;f.extend(i);i.prototype.process=function(f){var e=this.cells[0],c=this._;if(this.tickID!==f){this.tickID=f;var f=c.mul,d=c.add,b;if(c.ar){c=0;for(b=e.length;c<b;++c)e[c]=(2*Math.random()-1)*f+d}else{f=(2*Math.random()+1)*f+d;c=0;for(b=e.length;c<b;++c)e[c]=f}}return this};f.register("noise",i)})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);a=this._;a.freq=h(440);a.phase=h(0);a.osc=new e(h.samplerate);a.tmp=new f.SignalArray(a.cellsize);a.osc.step=a.cellsize;this.once("init",c)}var f=h.fn,k=h.timevalue,e=h.modules.Oscillator;f.extend(i);var c=function(){var a=this._;this.wave||(this.wave="sin");a.plotData=a.osc.wave;a.plotLineWidth=2;a.plotCyclic=!0;a.plotBefore=b},d=i.prototype;Object.defineProperties(d,{wave:{set:function(a){this._.osc.setWave(a)},get:function(){return this._.osc.wave}},
freq:{set:function(a){"string"===typeof a&&(a=k(a),a=0>=a?0:1E3/a);this._.freq=h(a)},get:function(){return this._.freq}},phase:{set:function(a){this._.phase=h(a);this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(a){this._.phase=h(a);this._.osc.feedback=!0},get:function(){return this._.phase}}});d.bang=function(){this._.osc.reset();this._.emit("bang");return this};d.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=a;var c=this.cells[1],d=this.cells[2],e,
h=b.cellsize;if(this.nodes.length)f.inputSignalAR(this);else for(e=0;e<h;++e)c[e]=d[e]=1;e=b.osc;var i=b.freq.process(a).cells[0],k=b.phase.process(a).cells[0];e.frequency=i[0];e.phase=k[0];if(b.ar){a=b.tmp;b.freq.isAr?b.phase.isAr?e.processWithFreqAndPhaseArray(a,i,k):e.processWithFreqArray(a,i):b.phase.isAr?e.processWithPhaseArray(a,k):e.process(a);for(e=0;e<h;++e)c[e]*=a[e],d[e]*=a[e]}else{b=e.next();for(e=0;e<h;++e)c[e]*=b,d[e]*=b}f.outputSignalAR(this)}return this};var b;"browser"===h.envtype&&
(b=function(a,b,c,d,e){e=(e>>1)+0.5;a.strokeStyle="#ccc";a.lineWidth=1;a.beginPath();a.moveTo(b,e+c);a.lineTo(b+d,e+c);a.stroke()});f.register("osc",i);f.register("sin",function(a){return(new i(a)).set("wave","sin")});f.register("cos",function(a){return(new i(a)).set("wave","cos")});f.register("pulse",function(a){return(new i(a)).set("wave","pulse")});f.register("tri",function(a){return(new i(a)).set("wave","tri")});f.register("saw",function(a){return(new i(a)).set("wave","saw")});f.register("fami",
function(a){return(new i(a)).set("wave","fami")});f.register("konami",function(a){return(new i(a)).set("wave","konami")});f.register("+sin",function(a){return(new i(a)).set("wave","+sin").kr()});f.register("+pulse",function(a){return(new i(a)).set("wave","+pulse").kr()});f.register("+tri",function(a){return(new i(a)).set("wave","+tri").kr()});f.register("+saw",function(a){return(new i(a)).set("wave","+saw").kr()});f.alias("square","pulse")})(timbre);
(function(h){function i(e){h.Object.call(this,2,e);f.fixAR(this);e=this._;e.pos=h(0);e.panL=0.5;e.panR=0.5}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{pos:{set:function(e){this._.pos=h(e)},get:function(){return this._.pos}}});k.process=function(e){var c=this._;if(this.tickID!==e){this.tickID=e;var d=c.pos.process(e).cells[0][0];c.prevPos!==d&&(c.prevPos=d,c.panL=Math.cos(0.5*Math.PI*(0.5*d+0.5)),c.panR=Math.sin(0.5*Math.PI*(0.5*d+0.5)));var b=this.nodes,d=this.cells[1],a=this.cells[2],
g,h=b.length,i,j=d.length,k;if(h){k=b[0].process(e).cells[0];for(i=0;i<j;++i)d[i]=a[i]=k[i];for(g=1;g<h;++g){k=b[g].process(e).cells[0];for(i=0;i<j;++i)d[i]=a[i]+=k[i]}e=c.panL;c=c.panR;for(i=0;i<j;++i)d[i]*=e,a[i]*=c}else d.set(f.emptycell),a.set(f.emptycell);f.outputSignalAR(this)}return this};f.register("pan",i)})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);a=this._;a.value=0;a.env=new c(h.samplerate);a.env.step=a.cellsize;a.curve="lin";a.counter=0;a.ar=!1;a.onended=f.make_onended(this);this.on("ar",d)}var f=h.fn,k=h.timevalue,e=h.modules.Envelope,c=h.modules.EnvelopeValue;f.extend(i);var d=function(a){this._.env.step=a?1:this._.cellsize},b=i.prototype;Object.defineProperties(b,{value:{set:function(a){"number"===typeof a&&(this._.env.value=a)},get:function(){return this._.env.value}}});b.to=function(a,
b,c){var d=this._,f=d.env;"string"===typeof b?b=k(b):"undefined"===typeof b&&(b=0);if("undefined"===typeof c)d.counter=f.setNext(a,b,e.CurveTypeLin),d.curve="lin";else{var h=e.CurveTypeDict[c];d.counter="undefined"===typeof h?f.setNext(a,b,e.CurveTypeCurve,c):f.setNext(a,b,h);d.curve=c}d.plotFlush=!0;return this};b.setAt=function(a,b){var c=this._;this.to(c.env.value,b,"set");c.atValue=a;return this};b.linTo=function(a,b){return this.to(a,b,"lin")};b.expTo=function(a,b){return this.to(a,b,"exp")};
b.sinTo=function(a,b){return this.to(a,b,"sin")};b.welTo=function(a,b){return this.to(a,b,"wel")};b.sqrTo=function(a,b){return this.to(a,b,"sqr")};b.cubTo=function(a,b){return this.to(a,b,"cub")};b.cancel=function(){var a=this._;a.counter=a.env.setNext(a.env.value,0,e.CurveTypeSet);return this};b.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=a;var a=this.cells[1],c=this.cells[2],d,h=b.cellsize,i=b.env,k=b.counter,n;if(this.nodes.length)f.inputSignalAR(this);else for(d=0;d<h;++d)a[d]=
c[d]=1;0>=k&&("set"===b.curve?i.setNext(b.atValue,0,e.CurveTypeSet):i.setNext(i.value,0,e.CurveTypeSet),f.nextTick(b.onended),b.counter=Infinity);if(b.ar){for(d=0;d<h;++d)n=i.next(),a[d]*=n,c[d]*=n;b.counter-=b.cellsize}else{n=i.next();for(d=0;d<h;++d)a[d]*=n,c[d]*=n;b.counter-=1}f.outputSignalAR(this);b.value=n}return this};var a=h.Object.prototype.plot;b.plot=function(b){var d=this._;if(d.plotFlush){var f=new c(128),h=new Float32Array(128),i,k;if("set"===d.curve){i=100;for(k=h.length;i<k;++i)h[i]=
1}else{i=e.CurveTypeDict[d.curve];"undefined"===typeof i?f.setNext(1,1E3,e.CurveTypeCurve,d.curve):f.setNext(1,1E3,i);i=0;for(k=h.length;i<k;++i)h[i]=f.next()}d.plotData=h;d.plotRange=[0,1];d.plotFlush=null}return a.call(this,b)};f.register("param",i)})(timbre);
(function(h){function i(c){h.Object.call(this,2,c);f.fixAR(this);c=this._;c.freq=h("sin",{freq:1,add:1E3,mul:250}).kr();c.Q=h(1);c.allpass=[];this.steps=2}var f=h.fn,k=h.modules.Biquad;f.extend(i);var e=i.prototype;Object.defineProperties(e,{freq:{set:function(c){this._.freq=c},get:function(){return this._.freq}},Q:{set:function(c){this._.Q=h(c)},get:function(){return this._.Q}},steps:{set:function(c){if("number"===typeof c){c|=0;if(2===c||4===c||8===c||12===c){var d=this._.allpass;if(d.length<c)for(var b=
d.length;b<c;++b)d[b]=new k(h.samplerate,2),d[b].setType("allpass")}this._.steps=c}},get:function(){return this._.steps}}});e.process=function(c){var d=this._;if(this.tickID!==c){this.tickID=c;f.inputSignalAR(this);if(!d.bypassed){var b=this.cells[1],a=this.cells[2],g=d.freq.process(c).cells[0][0],c=d.Q.process(c).cells[0][0],e=d.steps,h;for(h=0;h<e;h+=2)d.allpass[h].setParams(g,c,0),d.allpass[h].process(b,a),d.allpass[h+1].setParams(g,c,0),d.allpass[h+1].process(b,a)}f.outputSignalAR(this)}return this};
f.register("phaser",i)})(timbre);
(function(h){function i(i){h.Object.call(this,1,i);f.fixAR(this);for(var i=new Uint8Array(5),e=0;5>e;++e)i[e]=(1073741824*Math.random()|0)%25;this._.whites=i;this._.key=0}var f=h.fn;f.extend(i);i.prototype.process=function(f){var e=this.cells[0],c=this._;if(this.tickID!==f){this.tickID=f;var d,b,a=c.key,g=c.whites,h=c.mul,i=c.add,j,r,f=0;for(d=e.length;f<d;++f){b=a++;31<a&&(a=0);r=b^a;for(b=j=0;5>b;++b)r&1<<b&&(g[b]=(1073741824*Math.random()|0)%25),j+=g[b];e[f]=(0.01666666*j-1)*h+i}c.key=a}return this};
f.register("pink",i)})(timbre);
(function(h){function i(e){h.Object.call(this,1,e);this._.freq=440;this._.buffer=null;this._.readIndex=0;this._.writeIndex=0}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{freq:{set:function(e){"number"===typeof e&&(0>e&&(e=0),this._.freq=e)},get:function(){return this._.freq}}});k.bang=function(){for(var e=this._,c=h.samplerate/e.freq+0.5|0,d=e.buffer=new f.SignalArray(c<<1),b=0;b<c;++b)d[b]=2*Math.random()-1;e.readIndex=0;e.writeIndex=c;e.emit("bang");return this};k.process=
function(e){var c=this.cells[0],d=this._;if(this.tickID!==e&&(this.tickID=e,e=d.buffer)){var b=e.length,a=d.readIndex,g=d.writeIndex,f=d.mul,h=d.add,i,k,u=c.length;for(k=0;k<u;++k)i=e[a++],a>=b&&(a=0),i=0.5*(i+e[a]),e[g++]=i,g>=b&&(g=0),c[k]=i*f+h;d.readIndex=a;d.writeIndex=g}return this};f.register("pluck",i)})(timbre);
(function(h){function i(b){h.Object.call(this,1,b);f.listener(this);f.fixAR(this);b=this._;b.timeout=5E3;b.samplerate=h.samplerate;b.status=e;b.writeIndex=0;b.writeIndexIncr=1;b.currentTime=0;b.currentTimeIncr=1E3/h.samplerate;b.onended=c(this)}var f=h.fn,k=h.timevalue,e=0;f.extend(i);var c=function(b){return function(){var a=b._,c=new f.SignalArray(a.buffer.subarray(0,a.writeIndex|0));a.status=e;a.writeIndex=0;a.currentTime=0;a.emit("ended",{buffer:c,samplerate:a.samplerate})}},d=i.prototype;Object.defineProperties(d,
{timeout:{set:function(b){"string"===typeof b&&(b=k(b));"number"===typeof b&&0<b&&(this._.timeout=b)},get:function(){return this._.timeout}},samplerate:{set:function(b){"number"===typeof b&&(0<b&&b<=h.samplerate)&&(this._.samplerate=b)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}});d.start=function(){var b=this._,a;if(b.status===e){a=0.01*b.timeout*b.samplerate|0;if(!b.buffer||b.buffer.length<a)b.buffer=new f.SignalArray(a);b.writeIndex=0;b.writeIndexIncr=
b.samplerate/h.samplerate;b.currentTime=0;b.status=1;b.emit("start");this.listen()}return this};d.stop=function(){var b=this._;1===b.status&&(b.status=e,b.emit("stop"),f.nextTick(b.onended),this.unlisten());return this};d.bang=function(){this._.status===e?this.srart():1===this._.status&&this.stop();this._.emit("bang");return this};d.process=function(b){var a=this._,c=this.cells[0];if(this.tickID!==b){this.tickID=b;f.inputSignalAR(this);if(1===a.status){for(var d=c.length,e=a.buffer,h=a.timeout,i=
a.writeIndex,k=a.writeIndexIncr,q=a.currentTime,n=a.currentTimeIncr,b=0;b<d;++b)e[i|0]=c[b],i+=k,q+=n,h<=q&&f.nextTick(a.onended);a.writeIndex=i;a.currentTime=q}f.outputSignalAR(this)}return this};f.register("record",i);f.alias("rec","record")})(timbre);
(function(h){function i(c){h.Object.call(this,2,c);f.fixAR(this);this._.reverb=new k(h.samplerate,2,h.cellsize)}var f=h.fn,k=h.modules.Reverb;f.extend(i);var e=i.prototype;Object.defineProperties(e,{room:{set:function(c){"number"===typeof c&&this._.reverb.setRoomSize(1<c?1:0>c?0:c)},get:function(){return this._.reverb.roomsize}},damp:{set:function(c){"number"===typeof c&&this._.reverb.setDamp(1<c?1:0>c?0:c)},get:function(){return this._.reverb.damp}},mix:{set:function(c){"number"===typeof c&&(this._.reverb.wet=
1<c?1:0>c?0:c)},get:function(){return this._.reverb.wet}}});e.process=function(c){var d=this._;this.tickID!==c&&(this.tickID=c,f.inputSignalAR(this),d.bypassed||d.reverb.process(this.cells[1],this.cells[2]),f.outputSignalAR(this));return this};f.register("reverb",i)})(timbre);
(function(h){function i(c){h.Object.call(this,0,c);f.timer(this);f.fixKR(this);c=this._;c.queue=[];c.currentTime=0;c.maxRemain=1E3}var f=h.fn,k=h.timevalue;f.extend(i);var e=i.prototype;Object.defineProperties(e,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(c){"number"===typeof c&&0<c&&(this._.maxRemain=c)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}});
e.sched=function(c,d){"string"===typeof c&&(c=k(c));"number"===typeof c&&this.schedAbs(this._.currentTime+c,d);return this};e.schedAbs=function(c,d){"string"===typeof c&&(c=k(c));if("number"===typeof c){var b=this._,a=b.queue;if(a.length>=b.maxRemain)return this;for(b=a.length;b--&&!(a[b][0]<c););a.splice(b+1,0,[c,h(d)])}return this};e.advance=function(c){"string"===typeof c&&(c=k(c));"number"===typeof c&&(this._.currentTime+=c);return this};e.clear=function(){this._.queue.splice(0);return this};
e.process=function(c){var d=this._;if(this.tickID!==c){this.tickID=c;var c=null,b=d.queue;if(b.length)for(;b[0][0]<d.currentTime;)if(d.queue.shift()[1].bang(),c="sched",0===b.length){c="empty";break}d.currentTime+=f.currentTimeIncr;c&&d.emit(c)}return this};f.register("schedule",i);f.alias("sche","schedule")})(timbre);
(function(h){function i(b){h.Object.call(this,2,b);f.listener(this);f.fixAR(this);b=this._;b.samples=0;b.writeIndex=0;b.plotFlush=!0;this.once("init",e)}var f=h.fn,k=h.timevalue;f.extend(i);var e=function(){this._.buffer||(this.size=1024);this._.interval||(this.interval=1E3)},c=i.prototype;Object.defineProperties(c,{size:{set:function(b){var a=this._;!a.buffer&&"number"===typeof b&&(a.buffer=new f.SignalArray(64>b?64:2048<b?2048:b),a.reservedinterval&&(this.interval=a.reservedinterval,a.reservedinterval=
null))},get:function(){return this._.buffer.length}},interval:{set:function(b){var a=this._;"string"===typeof b&&(b=k(b));"number"===typeof b&&0<b&&(a.buffer?(a.interval=b,a.samplesIncr=0.001*b*h.samplerate/a.buffer.length,1>a.samplesIncr&&(a.samplesIncr=1)):a.reservedinterval=b)},get:function(){return this._.interval}}});c.bang=function(){for(var b=this._,a=b.buffer,c=0,d=a.length;c<d;++c)a[c]=0;b.samples=0;b.writeIndex=0;this._.emit("bang");return this};c.process=function(b){var a=this._;if(this.tickID!==
b){this.tickID=b;f.inputSignalAR(this);f.outputSignalAR(this);var b=this.cells[0],c,d=a.cellsize,e=a.samples,h=a.samplesIncr,i=a.buffer,k=a.writeIndex,q=!1,n=i.length;for(c=0;c<d;++c)0>=e&&(i[k++]=b[c],k>=n&&(k=0),q=a.plotFlush=!0,e+=h),--e;a.samples=e;a.writeIndex=k;q&&this._.emit("data")}return this};var d=h.Object.prototype.plot;c.plot=function(b){var a=this._;if(a.plotFlush){for(var c=a.buffer,e=c.length-1,f=new Float32Array(c.length),h=a.writeIndex,i=0,k=c.length;i<k;i++)f[i]=c[++h&e];a.plotData=
f;a.plotFlush=null}return d.call(this,b)};f.register("scope",i)})(timbre);
(function(h){function i(e){h.Object.call(this,2,e);this._.selected=0;this._.background=!1}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{selected:{set:function(e){"number"===typeof e&&(this._.selected=e,this.cells[1].set(f.emptycell),this.cells[2].set(f.emptycell))},get:function(){return this._.selected}},background:{set:function(e){this._.background=!!e},get:function(){return this._.background}}});k.process=function(e){var c=this._;if(this.tickID!==e){this.tickID=e;var d=this.nodes,
b,a=d.length;if(c.background)for(b=0;b<a;++b)d[b].process(e);if(d=d[c.selected])c.background||d.process(e),this.cells[1].set(d.cells[1]),this.cells[2].set(d.cells[2]);f.outputSignalAR(this)}return this};f.register("selector",i)})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);f.listener(this);f.fixAR(this);a=this._;a.status=c;a.samples=0;a.samplesIncr=0;a.writeIndex=0;a.plotFlush=!0;a.plotRange=[0,32];a.plotBarStyle=!0;this.once("init",d)}var f=h.fn,k=h.timevalue,e=h.modules.FFT,c=0;f.extend(i);var d=function(){var a=this._;a.fft||(this.size=512);a.interval||(this.interval=500)},b=i.prototype;Object.defineProperties(b,{size:{set:function(a){var b=this._;if(!b.fft&&"number"===typeof a&&(b.fft=new e(256>a?256:2048<a?2048:
a),b.buffer=new f.SignalArray(b.fft.length),b.freqs=new f.SignalArray(b.fft.length>>1),b.reservedwindow&&(b.fft.setWindow(b.reservedwindow),b.reservedwindow=null),b.reservedinterval))this.interval=b.reservedinterval,b.reservedinterval=null},get:function(){return this._.buffer.length}},window:{set:function(a){this._.fft.setWindow(a)},get:function(){return this._.fft.windowName}},interval:{set:function(a){var b=this._;"string"===typeof a&&(a=k(a));"number"===typeof a&&0<a&&(b.buffer?(b.interval=a,b.samplesIncr=
0.001*a*h.samplerate,b.samplesIncr<b.buffer.length&&(b.samplesIncr=b.buffer.length,b.interval=1E3*b.samplesIncr/h.samplerate)):b.reservedinterval=a)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}});b.bang=function(){this._.samples=0;this._.writeIndex=0;this._.emit("bang");return this};b.process=function(a){var b=this._;if(this.tickID!==a){this.tickID=
a;f.inputSignalAR(this);f.outputSignalAR(this);var a=this.cells[0],d,e=a.length,h=b.status,i=b.samples,k=b.samplesIncr,n=b.writeIndex,o=b.buffer,p=o.length,s;for(d=0;d<e;++d)0>=i&&h===c&&(h=1,n=0,i+=k),1===h&&(o[n++]=a[d],p<=n&&(b.fft.forward(o),s=b.plotFlush=!0,h=c)),--i;b.samples=i;b.status=h;b.writeIndex=n;s&&this._.emit("data")}return this};var a=h.Object.prototype.plot;b.plot=function(b){this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null);return a.call(this,b)};f.register("spectrum",
i)})(timbre);
(function(h){function i(f){h.Object.call(this,2,f);this._.ar=!1}var f=h.fn;f.extend(i);i.prototype.process=function(h){var e=this._;if(this.tickID!==h){this.tickID=h;var c=this.nodes,d=this.cells[0],b=this.cells[1],a=this.cells[2],g,i=c.length,m=d.length,j;if(e.ar){if(0<c.length){c[0].process(h);e=c[0].cells[1];j=c[0].cells[2];b.set(e);a.set(j);for(g=1;g<i;++g){c[g].process(h);e=c[g].cells[1];j=c[g].cells[2];for(d=0;d<m;++d)b[d]-=e[d],a[d]-=j[d]}}else for(d=0;d<m;++d)b[d]=a[g]=0;f.outputSignalAR(this)}else{if(0<c.length){b=
c[0].process(h).cells[0][0];for(g=1;g<i;++g)b-=c[g].process(h).cells[0][0]}else b=0;d[0]=b;f.outputSignalKR(this)}}return this};f.register("-",i)})(timbre);
(function(h){function i(a){h.Object.call(this,2,a);f.fixAR(this);a=this._;this.playbackState=f.FINISHED_STATE;a.poly=4;a.genList=[];a.genDict={};a.synthdef=null;a.remGen=c(this);a.onended=f.make_onended(this)}var f=h.fn;f.extend(i);var k=i.prototype;Object.defineProperties(k,{def:{set:function(a){"function"===typeof a&&(this._.synthdef=a)},get:function(){return this._.synthdef}},poly:{set:function(a){"number"===typeof a&&(0<a&&64>=a)&&(this._.poly=a)},get:function(){return this._.poly}}});var e=function(a,
b){return function(){a._.remGen(b.gen)}},c=function(a){return function(b){var c=a._,d=c.genList.indexOf(b);-1!==d&&c.genList.splice(d,1);c.genDict[b.noteNum]=null}},d=function(a,b,c,d){c|=0;0>=c?this.noteOff(this,a):127<c&&(c=127);var i=this._,k=i.genList,q=i.genDict,n=q[a];n&&i.remGen(n);b={freq:b,noteNum:a,velocity:c};if(d)for(var o in d)b[o]=d[o];b.doneAction=e(this,b);n=this._.synthdef.call(this,b);n instanceof h.Object&&(n.noteNum=a,k.push(n),q[a]=b.gen=n,this.playbackState=f.PLAYING_STATE,k.length>
i.poly&&i.remGen(k[0]))},b=function(){for(var a=new Float32Array(128),b=0;128>b;++b)a[b]=440*Math.pow(2,1*(b-69)/12);return a}();k.noteOn=function(a,c,e){var f=b[a]||440*Math.pow(2,(a-69)/12);d.call(this,a+0.5|0,f,c,e);return this};k.noteOff=function(a){(a=this._.genDict[a])&&a.release&&a.release();return this};k.noteOnWithFreq=function(a,b,c){var e=0<a?12*Math.log(1*a/440)*Math.LOG2E+69:0;d.call(this,e+0.5|0,a,b,c);return this};k.noteOffWithFreq=function(a){return this.noteOff((0<a?12*Math.log(1*
a/440)*Math.LOG2E+69:0)+0.5|0)};k.allNoteOff=function(){for(var a=this._.genList,b=0,c=a.length;b<c;++b)a[b].release&&a[b].release()};k.allSoundOff=function(){for(var a=this._,b=a.genList,a=a.genDict;b.length;)delete a[b.shift().noteNum]};k.process=function(a){var b=this.cells[0],c=this._;if(this.tickID!==a){this.tickID=a;if(this.playbackState===f.PLAYING_STATE){var d=c.genList,e,h=this.cells[1],i=this.cells[2],k,b=b.length,o,p;if(d.length){e=d[0];e.process(a);h.set(e.cells[1]);i.set(e.cells[2]);
c=1;for(k=d.length;c<k;++c){e=d[c];e.process(a);o=e.cells[1];p=e.cells[2];for(e=0;e<b;++e)h[e]+=o[e],i[e]+=p[e]}}else f.nextTick(c.onended)}f.outputSignalAR(this)}return this};f.register("SynthDef",i);var a={set:function(a){f.isDictionary(a)?"string"===typeof a.type&&(this._.env=a):a instanceof h.Object&&(this._.env=a)},get:function(){return this._.env}};f.register("OscGen",function(){var b={set:function(a){"string"===typeof a&&(this._.wave=a)},get:function(){return this._.wave}},c=function(a){var b=
this._,c,d;c=b.env||{};d=c.type||"perc";b=h("osc",{wave:b.wave,freq:a.freq,mul:a.velocity/128});c instanceof h.Object?"function"===typeof c.clone&&(b=c.clone().append(b)):b=h(d,c,b);b.on("ended",a.doneAction).bang();return b};return function(d){d=new i(d);d._.wave="sin";Object.defineProperties(d,{env:a,wave:b});d.def=c;return d}}());f.register("PluckGen",function(){var b=function(a){var b,c,d;c=this._.env||{};d=c.type||"perc";b=h("pluck",{freq:a.freq,mul:a.velocity/128}).bang();c instanceof h.Object?
"function"===typeof c.clone&&(b=c.clone().append(b)):b=h(d,c,b);b.on("ended",a.doneAction).bang();return b};return function(c){c=new i(c);Object.defineProperties(c,{env:a});c.def=b;return c}}())})(timbre);
(function(h){function i(b){h.Object.call(this,2,b);f.fixAR(this);b=this._;b.isLooped=!1;b.onended=f.make_onended(this,0)}var f=h.fn,k=h.modules.Scissor,e=k.Tape,c=k.TapeStream;f.extend(i);var d=i.prototype;Object.defineProperties(d,{tape:{set:function(b){if(b instanceof e)this.playbackState=f.PLAYING_STATE,this._.tape=b,this._.tapeStream=new c(b,h.samplerate);else if("object"===typeof b&&(b.buffer instanceof Float32Array||b.buffer instanceof Float64Array))this.playbackState=f.PLAYING_STATE,this._.tape=
new k(b),this._.tapeStream=new c(b,h.samplerate)},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}}});d.loop=function(b){this._.isLooped=!!b;this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped);return this};d.bang=function(){this.playbackState=f.PLAYING_STATE;this._.tapeStream&&this._.tapeStream.reset();this._.emit("bang");return this};d.process=function(b){var a=this._;if(this.tickID!==b){this.tickID=b;if(b=a.tapeStream){var c=this.cells[1],d=this.cells[2],
e=b.fetch(c.length);c.set(e[0]);d.set(e[1]);this.playbackState===f.PLAYING_STATE&&b.isEnded&&f.nextTick(a.onended)}f.outputSignalAR(this)}return this};f.register("tape",i)})(timbre);
(function(h){function i(b){h.Object.call(this,0,b);f.timer(this);f.fixKR(this);b=this._;this.playbackState=f.FINISHED_STATE;b.currentTime=0;b.samplesMax=0;b.samples=0;b.onended=f.make_onended(this);this.once("init",e);this.on("start",c)}var f=h.fn,k=h.timevalue;f.extend(i);var e=function(){this._.timeout||(this.timeout=1E3)},c=function(){this.playbackState=f.PLAYING_STATE};Object.defineProperty(c,"unremovable",{value:!0,writable:!1});var d=i.prototype;Object.defineProperties(d,{timeout:{set:function(b){var a=
this._;"string"===typeof b&&(b=k(b));"number"===typeof b&&0<=b&&(this.playbackState=f.PLAYING_STATE,a.timeout=b,a.samplesMax=h.samplerate*0.001*b|0,a.samples=a.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}});d.bang=function(){var b=this._;this.playbackState=f.PLAYING_STATE;b.samples=b.samplesMax;b.currentTime=0;b.emit("bang");return this};d.process=function(b){var a=this.cells[0],c=this._;if(this.tickID!==b){this.tickID=b;0<c.samples&&
(c.samples-=a.length);if(0>=c.samples){for(var b=this.nodes,a=0,d=b.length;a<d;++a)b[a].bang();f.nextTick(c.onended)}c.currentTime+=f.currentTimeIncr}return this};f.register("timeout",i)})(timbre);
(function(h){function i(c){h.Object.call(this,1,c);c=this._;c.inMin=0;c.inMax=1;c.outMin=0;c.outMax=1;c.ar=!1;this.once("init",k)}var f=h.fn;f.extend(i);var k=function(){this._.warp||(this.warp="linlin")},e=i.prototype;Object.defineProperties(e,{inMin:{set:function(c){"number"===typeof c&&(this._.inMin=c)},get:function(){return this._.inMin}},inMax:{set:function(c){"number"===typeof c&&(this._.inMax=c)},get:function(){return this._.inMax}},outMin:{set:function(c){"number"===typeof c&&(this._.outMin=
c)},get:function(){return this._.outMin}},outMax:{set:function(c){"number"===typeof c&&(this._.outMax=c)},get:function(){return this._.outMax}},warp:{set:function(d){if("string"===typeof d){var b=c[d];b&&(this._.warp=b,this._.warpName=d)}},get:function(){return this._.warpName}}});e.process=function(c){var b=this._,a=this.cells[0];if(this.tickID!==c){this.tickID=c;var e=b.inMin,h=b.inMax,i=b.outMin,j=b.outMax,k=b.warp,u=this.nodes.length,q=b.mul,n=b.add,c=a.length;if(b.ar&&u){f.inputSignalAR(this);
for(b=0;b<c;++b)a[b]=k(a[b],e,h,i,j)*q+n;f.outputSignalAR(this)}else{b=this.nodes.length?f.inputSignalKR(this):0;e=k(b,e,h,i,j)*q+n;for(b=0;b<c;++b)a[b]=e}}return this};var c={linlin:function(c,b,a,e,f){return c<b?e:c>a?f:a===b?e:(c-b)/(a-b)*(f-e)+e},linexp:function(c,b,a,e,f){return c<b?e:c>a?f:0===e?0:a===b?f:Math.pow(f/e,(c-b)/(a-b))*e},explin:function(c,b,a,e,f){return c<b?e:c>a?f:0===b?f:Math.log(c/b)/Math.log(a/b)*(f-e)+e},expexp:function(c,b,a,e,f){return c<b?e:c>a?f:0===b||0===e?0:Math.pow(f/
e,Math.log(c/b)/Math.log(a/b))*e}};f.register("zmap",i)})(timbre);
