<?xml version="1.0" encoding="UTF-8" ?>
<!--
 ____        _ _    ___  ____
/ ___|  __ _| | |_ / _ \/ ___|
\___ \ / _` | | __| | | \___ \
 ___) | (_| | | |_| |_| |___) |
|____/ \__,_|_|\__|\___/|____/

SaltOS: Framework to develop Rich Internet Applications
Copyright (C) 2012 by Josep Sanz CampderrÃ³s
More information in http://www.saltos.net or info@saltos.net

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<root>
	<list>
		<title lang="true">list</title>
		<actions include="xml/common/actions.xml" replace="true"/>
		<width>100%</width>
		<fields>
			<field>
				<name>id2</name>
				<label lang="true">id</label>
				<sort>true</sort>
				<order>id</order>
			</field>
			<field>
				<name>cif</name>
				<label lang="true">cif</label>
				<sort>true</sort>
			</field>
			<field>
				<name>nombre</name>
				<label lang="true">nombre</label>
				<sort>true</sort>
				<order>nombre2</order>
			</field>
			<field>
				<name>tel_fijo</name>
				<label lang="true">tel_fijo</label>
				<sort>true</sort>
			</field>
			<field>
				<name>tel_movil</name>
				<label lang="true">tel_movil</label>
				<sort>true</sort>
			</field>
			<field>
				<name>email</name>
				<label lang="true">email</label>
				<sort>true</sort>
			</field>
			<field>
				<name>comentarios</name>
				<label lang="true">numc</label>
				<tip lang="true">numctip</tip>
				<sort>false</sort>
			</field>
			<field>
				<name>ficheros</name>
				<label lang="true">numf</label>
				<tip lang="true">numftip</tip>
				<sort>false</sort>
			</field>
		</fields>
		<javascript>
			<javascript include="xml/common/jslist.xml" replace="true"/>
			<function eval="true">"lang_contactos() { return '".LANG_ESCAPE("contactos")."'; }"</function>
			<function eval="true">"lang_incidencias() { return '".LANG_ESCAPE("incidencias")."'; }"</function>
			<function eval="true">"lang_proyectos() { return '".LANG_ESCAPE("proyectos")."'; }"</function>
			<function eval="true">"lang_partes() { return '".LANG_ESCAPE("partes")."'; }"</function>
			<function eval="true">"lang_facturas() { return '".LANG_ESCAPE("facturas")."'; }"</function>
			<function eval="true">"lang_gastos() { return '".LANG_ESCAPE("gastos")."'; }"</function>
			<function eval="true">"lang_agenda() { return '".LANG_ESCAPE("agenda")."'; }"</function>
			<function eval="true">"lang_presupuestos() { return '".LANG_ESCAPE("presupuestos")."'; }"</function>
			<function eval="true">"lang_actas() { return '".LANG_ESCAPE("actas")."'; }"</function>
			<function eval="true">"lang_selectall() { return '".LANG_ESCAPE("selectall")."'; }"</function>
			<function eval="true">"lang_selectnone() { return '".LANG_ESCAPE("selectnone")."'; }"</function>
			<function eval="true">"lang_pdf2filter_title() { return '".LANG_ESCAPE("pdf2filter_title")."'; }"</function>
			<function eval="true">"lang_pdf2filter_message() { return '".LANG_ESCAPE("pdf2filter_message")."'; }"</function>
			<function eval="true">"lang_buttoncontinue() { return '".LANG_ESCAPE("buttoncontinue")."'; }"</function>
			<function eval="true">"lang_view2filter_title() { return '".LANG_ESCAPE("view2filter_title")."'; }"</function>
			<function eval="true">"lang_view2filter_message() { return '".LANG_ESCAPE("view2filter_message")."'; }"</function>
			<function>pdf2filter(id) { pdf2filter_clientes(id); }</function>
			<function>view2filter(id) { view2filter_clientes(id); }</function>
		</javascript>
		<quick>
			<row>
				<field>
					<type>separator</type>
					<width>100%</width>
				</field>
				<field ifeval="check_filter(array('filtro'=>'','id_campanya'=>'','id_importacion'=>''))">
					<type>label</type>
					<label lang="true">usedfilter</label>
					<class>nowrap</class>
					<class2>info</class2>
				</field>
				<field>
					<name>buscar</name>
					<label lang="true">buscar</label>
					<type>text</type>
					<width>240px</width>
					<value global="filtro" eval="true">stripslashes($filtro=getParam("filtro"))</value>
					<onchange>copy_value("filtro","buscar");</onchange>
					<onkeypress>if(is_enterkey(event)) { copy_value("filtro","buscar");buscar(); }</onkeypress>
					<focus>true</focus>
					<speech>true</speech>
					<class3>shortcut_ctrl_f</class3>
				</field>
				<field>
					<type>button</type>
					<value lang="true">buscar</value>
					<tip lang="true">buscartip</tip>
					<onclick>buscar()</onclick>
					<icon>find</icon>
					<class>nowrap</class>
				</field>
				<field>
					<type>button</type>
					<value lang="true">limpiar</value>
					<tip lang="true">limpiartip</tip>
					<onclick>limpiar()</onclick>
					<icon>refresh</icon>
					<class>nowrap contextmenu</class>
				</field>
			</row>
		</quick>
		<form>
			<name>list</name>
			<action>xml.php</action>
			<method>get</method>
			<fields>
				<title lang="true">filter</title>
				<buttons>true</buttons>
				<row>
					<field include="xml/common/hiddenslist.xml" replace="true"/>
					<field>
						<name>id_campanya</name>
						<label lang="true">campanya</label>
						<type>select</type>
						<width>240px</width>
						<query eval="true">make_select_query("campanyas","tbl_campanyas","nombre")." UNION SELECT '' value,'".LANG_ESCAPE("todaslascampanyas")."' label,'-1' pos UNION SELECT '0' value,'".LANG_ESCAPE("sincampanya")."' label,'-1' pos ORDER BY `pos` ASC,`label` ASC,`value` ASC"</query>
						<value global="id_campanya" eval="true">$id_campanya=getParam("id_campanya")</value>
					</field>
					<field>
						<type>separator</type>
						<width>10px</width>
					</field>
					<field>
						<name>id_importacion</name>
						<label lang="true">importacion</label>
						<type>select</type>
						<width>240px</width>
						<query eval="true">make_select_query("importaciones","tbl_importaciones","nombre")." UNION SELECT '' value,'".LANG_ESCAPE("todaslasimportaciones")."' label,'-1' pos UNION SELECT '0' value,'".LANG_ESCAPE("sinimportacion")."' label,'-1' pos ORDER BY `pos` ASC,`label` ASC,`value` ASC"</query>
						<value global="id_importacion" eval="true">$id_importacion=getParam("id_importacion")</value>
					</field>
				</row>
				<row>
					<field>
						<name>filtro</name>
						<label lang="true">filtro</label>
						<type>text</type>
						<width>240px</width>
						<value global="filtro" eval="true">stripslashes($filtro=getParam("filtro"))</value>
						<colspan>2</colspan>
						<onchange>copy_value("buscar","filtro");</onchange>
						<speech>true</speech>
					</field>
					<field>
						<name>contactos</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>incidencias</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>proyectos</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>partes</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>facturas</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>gastos</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>agenda</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>presupuestos</name>
						<type>hidden</type>
						<value>0</value>
					</field>
					<field>
						<name>actas</name>
						<type>hidden</type>
						<value>0</value>
					</field>
				</row>
			</fields>
			<fields include="xml/common/filters.xml" replace="true"/>
			<fields include="xml/common/helplist.xml" replace="true"/>
			<buttons include="xml/common/buttonslist.xml"/>
		</form>
		<pager include="xml/common/pagerlist.xml"/>
		<query global="page,filtro,id_campanya,id_importacion" eval="true">"
		SELECT id2,id,
			cif,
			/*MYSQL CONCAT('link:clientes(',-id,'):',nombre) *//*SQLITE 'link:clientes(' || -id || '):' || nombre */ nombre,
			nombre nombre2,
			/*MYSQL CONCAT('tel:',tel_fijo)*//*SQLITE 'tel:' || tel_fijo*/ tel_fijo,
			/*MYSQL CONCAT('tel:',tel_movil)*//*SQLITE 'tel:' || tel_movil*/ tel_movil,
			/*MYSQL CONCAT('mailto:',email)*//*SQLITE 'mailto:' || email*/ email,
			pais,provincia,poblacion,codpostal,direccion,
			(SELECT COUNT(*) FROM tbl_comentarios WHERE id_aplicacion='".page2id($page)."' AND id_registro=c.id) comentarios,
			(SELECT COUNT(*) FROM tbl_ficheros WHERE id_aplicacion='".page2id($page)."' AND id_registro=c.id) ficheros,
			id action_id,/*MYSQL CONCAT(LPAD(id,5,0),' - ',nombre) *//*SQLITE SUBSTR('00000' || id,-5,5) || ' - ' || nombre */ action_title,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view,
			CASE ".check_sql($page,"edit")." WHEN 1 THEN 'true' ELSE 'false' END action_edit,
			CASE (".check_sql($page,"view")." OR ".check_sql($page,"edit").") WHEN 1 THEN 'true' ELSE 'false' END action_vcard,
			CASE (".check_sql($page,"view")." OR ".check_sql($page,"edit").") WHEN 1 THEN 'true' ELSE 'false' END action_qrcode,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_pdf2filter,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view2filter,
			CASE ".check_sql($page,"delete")." WHEN 1 THEN 'true' ELSE 'false' END action_delete
		FROM (
			SELECT y1.valor tel_fijo,y2.valor tel_movil,y5.valor email,
				/*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id2,
				x.nombre_pais pais,x.nombre_provincia provincia,x.nombre_poblacion poblacion,x.nombre_codpostal codpostal,x.direccion direccion,
				x.id_pais id_pais,x.id_provincia id_provincia,x.id_poblacion id_poblacion,x.id_codpostal id_codpostal,
				a.*,
				".make_extra_query_with_login("b.")." usuario,
				e.`datetime` `datetime`,e.id_usuario id_usuario,b.id_grupo id_grupo
			FROM tbl_clientes a
				LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id($page)."' AND e.id_registro=a.id
				LEFT JOIN tbl_direcciones x ON x.id=(SELECT id FROM tbl_direcciones WHERE id_aplicacion='".page2id($page)."' AND id_registro=a.id ORDER BY seleccion DESC, id ASC LIMIT 1)
				LEFT JOIN tbl_comunicaciones y1 ON y1.id=(SELECT id FROM tbl_comunicaciones WHERE id_direccion=x.id AND id_tipocom=(SELECT id FROM tbl_tiposcom WHERE codigo='phone') ORDER BY seleccion DESC, id ASC LIMIT 1)
				LEFT JOIN tbl_comunicaciones y2 ON y2.id=(SELECT id FROM tbl_comunicaciones WHERE id_direccion=x.id AND id_tipocom=(SELECT id FROM tbl_tiposcom WHERE codigo='movil') ORDER BY seleccion DESC, id ASC LIMIT 1)
				LEFT JOIN tbl_comunicaciones y5 ON y5.id=(SELECT id FROM tbl_comunicaciones WHERE id_direccion=x.id AND id_tipocom=(SELECT id FROM tbl_tiposcom WHERE codigo='email') ORDER BY seleccion DESC, id ASC LIMIT 1)
				LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id
		) c
		WHERE ".make_like_query("id2,usuario,nombre,direccion,codpostal,poblacion,provincia,tel_fijo,tel_movil,cif,email,comentarios",$filtro)." AND ".($id_campanya?"(id_campanya='$id_campanya')":"(1=1)")." AND (id_importacion='$id_importacion' OR ''='$id_importacion') AND ".check_sql($page,"list")</query>
		<order global="order" eval="true">$order</order>
		<limit global="limit" eval="true">$limit</limit>
		<offset global="offset" eval="true">$offset</offset>
	</list>
	<form>
		<views>
			<view>
				<title lang="true">formview</title>
				<query>
					<query include="xml/common/qpermview.xml" replace="true"/>
					<default global="id" eval="true">"SELECT *,nombre1 nombre1_tipo_1,nombre2 nombre2_tipo_1,cif cif_tipo_1,nombre1 nombre1_tipo_2,nombre2 nombre2_tipo_2,cif cif_tipo_2 FROM tbl_clientes WHERE id='".abs($id)."'"</default>
					<direccion_principal include="xml/common/qdireccionpriview.xml" replace="true"/>
					<comunicacion_principal include="xml/common/qcomunicacionpriview.xml" replace="true"/>
					<direccion_secundaria include="xml/common/qdireccionsecview.xml" replace="true"/>
					<comunicacion_secundaria include="xml/common/qcomunicacionsecview.xml" replace="true"/>
					<comments_old include="xml/common/qcommentsold.xml"/>
					<files_old include="xml/common/qfilesold.xml"/>
					<contactos>
						<contactos global="id,page" eval="true">"
SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,
	/*MYSQL CONCAT('link:contactos(',-a.id,'):',a.nombre) *//*SQLITE 'link:contactos(' || -a.id || '):' || a.nombre */ nombre,
	/*MYSQL CONCAT('tel:',y1.valor)*//*SQLITE 'tel:' || y1.valor*/ tel_fijo,
	/*MYSQL CONCAT('tel:',y2.valor)*//*SQLITE 'tel:' || y2.valor*/ tel_movil,
	/*MYSQL CONCAT('mailto:',y5.valor)*//*SQLITE 'mailto:' || y5.valor*/ email,
	/*MYSQL CONCAT('contactos(',-a.id,')') *//*SQLITE 'contactos(' || -a.id || ')' */ link_view,
	/*MYSQL CONCAT('vcardcontactos(',-a.id,')') *//*SQLITE 'vcardcontactos(' || -a.id || ')' */ link_vcard,
	/*MYSQL CONCAT('qrcodecontactos(',-a.id,')') *//*SQLITE 'qrcodecontactos(' || -a.id || ')' */ link_qrcode
FROM tbl_contactos a
	LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("contactos")."' AND e.id_registro=a.id
	LEFT JOIN tbl_direcciones x ON x.id=(SELECT id FROM tbl_direcciones WHERE id_aplicacion='".page2id("contactos")."' AND id_registro=a.id ORDER BY seleccion DESC, id ASC LIMIT 1)
	LEFT JOIN tbl_comunicaciones y1 ON y1.id=(SELECT id FROM tbl_comunicaciones WHERE id_direccion=x.id AND id_tipocom=(SELECT id FROM tbl_tiposcom WHERE codigo='phone') ORDER BY seleccion DESC, id ASC LIMIT 1)
	LEFT JOIN tbl_comunicaciones y2 ON y2.id=(SELECT id FROM tbl_comunicaciones WHERE id_direccion=x.id AND id_tipocom=(SELECT id FROM tbl_tiposcom WHERE codigo='movil') ORDER BY seleccion DESC, id ASC LIMIT 1)
	LEFT JOIN tbl_comunicaciones y5 ON y5.id=(SELECT id FROM tbl_comunicaciones WHERE id_direccion=x.id AND id_tipocom=(SELECT id FROM tbl_tiposcom WHERE codigo='email') ORDER BY seleccion DESC, id ASC LIMIT 1)
	LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id
WHERE ((a.id_registro='".abs($id)."' AND a.id_aplicacion='".page2id("clientes")."') OR (a.id_registro IN (SELECT id FROM tbl_proyectos WHERE id_cliente='".abs($id)."') AND a.id_aplicacion='".page2id("proyectos")."')) AND (".check_sql("contactos","view").") ORDER BY a.nombre ASC"</contactos>
					</contactos>
					<incidenciasopen>
						<incidenciasopen global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login("b.")." usuario,e.`datetime`,/*MYSQL CONCAT('link:incidencias(',-a.id,'):',a.nombre) *//*SQLITE 'link:incidencias(' || -a.id || '):' || a.nombre */ incidencia,CASE id_estado WHEN '0' THEN '".LANG_ESCAPE("sinestado")."' ELSE c.nombre END estado,/*MYSQL CONCAT('incidencias(',-a.id,')') *//*SQLITE 'incidencias(' || -a.id || ')' */ link_view FROM tbl_incidencias a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("incidencias")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id LEFT JOIN tbl_estados c ON a.id_estado=c.id WHERE a.id_cliente=".abs($id)." AND c.activo='1' AND (".check_sql("incidencias","view").") ORDER BY e.`datetime` DESC"</incidenciasopen>
					</incidenciasopen>
					<incidenciasclose>
						<incidenciasclose global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login("b.")." usuario,e.`datetime`,/*MYSQL CONCAT('link:incidencias(',-a.id,'):',a.nombre) *//*SQLITE 'link:incidencias(' || -a.id || '):' || a.nombre */ incidencia,CASE id_estado WHEN '0' THEN '".LANG_ESCAPE("sinestado")."' ELSE c.nombre END estado,/*MYSQL CONCAT('incidencias(',-a.id,')') *//*SQLITE 'incidencias(' || -a.id || ')' */ link_view FROM tbl_incidencias a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("incidencias")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id LEFT JOIN tbl_estados c ON a.id_estado=c.id WHERE a.id_cliente=".abs($id)." AND c.activo='0' AND (".check_sql("incidencias","view").") ORDER BY e.`datetime` DESC"</incidenciasclose>
					</incidenciasclose>
					<proyectosopen>
						<proyectosopen global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login()." usuario,datetime,/*MYSQL CONCAT('link:proyectos(',-a.id,'):',a.nombre) *//*SQLITE 'link:proyectos(' || -a.id || '):' || a.nombre */ proyecto,CASE id_estado WHEN '0' THEN '".LANG_ESCAPE("sinestado")."' ELSE c_nombre END estado,/*MYSQL CONCAT('proyectos(',-a.id,')') *//*SQLITE 'proyectos(' || -a.id || ')' */ link_view FROM (SELECT a2.*,e.id_usuario id_usuario,b.id_grupo id_grupo,b.id_aplicacion id_aplicacion,b.id_registro id_registro,b.login login,e.`datetime` `datetime`,c.nombre c_nombre,c.activo activo FROM tbl_proyectos a2 LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("proyectos")."' AND e.id_registro=a2.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id LEFT JOIN tbl_estados c ON a2.id_estado=c.id) a WHERE a.id_cliente=".abs($id)." AND activo='1' AND (".check_sql("proyectos","view").") ORDER BY `datetime` DESC"</proyectosopen>
					</proyectosopen>
					<proyectosclose>
						<proyectosclose global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login()." usuario,datetime,/*MYSQL CONCAT('link:proyectos(',-a.id,'):',a.nombre) *//*SQLITE 'link:proyectos(' || -a.id || '):' || a.nombre */ proyecto,CASE id_estado WHEN '0' THEN '".LANG_ESCAPE("sinestado")."' ELSE c_nombre END estado,/*MYSQL CONCAT('proyectos(',-a.id,')') *//*SQLITE 'proyectos(' || -a.id || ')' */ link_view FROM (SELECT a2.*,e.id_usuario id_usuario,b.id_grupo id_grupo,b.id_aplicacion id_aplicacion,b.id_registro id_registro,b.login login,e.`datetime` `datetime`,c.nombre c_nombre,c.activo activo FROM tbl_proyectos a2 LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("proyectos")."' AND e.id_registro=a2.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id LEFT JOIN tbl_estados c ON a2.id_estado=c.id) a WHERE a.id_cliente=".abs($id)." AND activo='0' AND (".check_sql("proyectos","view").") ORDER BY `datetime` DESC"</proyectosclose>
					</proyectosclose>
					<partesopen>
						<partesopen global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login("b.")." usuario,fecha,/*MYSQL CONCAT('link:partes(',-a.id,'):',tarea) *//*SQLITE 'link:partes(' || -a.id || '):' || tarea */ tarea,comentarios,horas,precio,total,(CASE liquidado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) liquidado,/*MYSQL CONCAT('partes(',-a.id,')') *//*SQLITE 'partes(' || -a.id || ')' */ link_view,/*MYSQL CONCAT('pdfparte(',a.id,')') *//*SQLITE 'pdfparte(' || a.id || ')' */ link_pdf,/*MYSQL CONCAT('viewparte(',a.id,')') *//*SQLITE 'viewparte(' || a.id || ')' */ link_view2,/*MYSQL CONCAT('mailparte(',a.id,')') *//*SQLITE 'mailparte(' || a.id || ')' */ link_mail FROM tbl_partes a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("partes")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id WHERE a.id_cliente=".abs($id)." AND liquidado='0' AND (".check_sql("partes","view").") ORDER BY e.`datetime` DESC"</partesopen>
					</partesopen>
					<partesclose>
						<partesclose global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login("b.")." usuario,fecha,/*MYSQL CONCAT('link:partes(',-a.id,'):',tarea) *//*SQLITE 'link:partes(' || -a.id || '):' || tarea */ tarea,horas,precio,total,(CASE liquidado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) liquidado,/*MYSQL CONCAT('partes(',-a.id,')') *//*SQLITE 'partes(' || -a.id || ')' */ link_view,/*MYSQL CONCAT('pdfparte(',a.id,')') *//*SQLITE 'pdfparte(' || a.id || ')' */ link_pdf,/*MYSQL CONCAT('viewparte(',a.id,')') *//*SQLITE 'viewparte(' || a.id || ')' */ link_view2,/*MYSQL CONCAT('mailparte(',a.id,')') *//*SQLITE 'mailparte(' || a.id || ')' */ link_mail FROM tbl_partes a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("partes")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id WHERE a.id_cliente=".abs($id)." AND liquidado='1' AND (".check_sql("partes","view").") ORDER BY e.`datetime` DESC"</partesclose>
					</partesclose>
					<documentos>
						<documentos global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login("b.")." usuario,e.`datetime`,/*MYSQL CONCAT('link:documentos(',-a.id,'):',a.nombre) *//*SQLITE 'link:documentos(' || -a.id || '):' || a.nombre */ nombre,(SELECT COUNT(*) FROM tbl_ficheros WHERE id_aplicacion='".page2id("documentos")."' AND id_registro=a.id) ficheros,/*MYSQL CONCAT('documentos(',-a.id,')') *//*SQLITE 'documentos(' || -a.id || ')' */ link_view FROM tbl_documentos a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("documentos")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id WHERE a.id_cliente=".abs($id)." AND (".check_sql("documentos","view").") ORDER BY e.`datetime` DESC"</documentos>
					</documentos>
					<albaranes>
						<albaranes global="id" eval="true">"SELECT id_usuario2 id_usuario,id_grupo2 id_grupo,id,(SELECT nombre FROM tbl_cuentas c WHERE c.id=id_cuenta) cuenta,/*MYSQL CONCAT('link:facturas(',-id,'):',num2) *//*SQLITE 'link:facturas(' || -id || '):' || num2 */ num,fecha,base,ROUND(base+iva2-irpf2,2) total,(CASE cerrado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) cerrado,(CASE cobrado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) cobrado,/*MYSQL CONCAT('facturas(',-id,')') *//*SQLITE 'facturas(' || -id || ')' */ link_view,/*MYSQL CONCAT('pdffactura(',id,')') *//*SQLITE 'pdffactura(' || id || ')' */ link_pdf,/*MYSQL CONCAT('viewfactura(',id,')') *//*SQLITE 'viewfactura(' || id || ')' */ link_view2,/*MYSQL CONCAT('mailfactura(',id,')') *//*SQLITE 'mailfactura(' || id || ')' */ link_mail FROM (SELECT id_usuario id_usuario2,id_grupo id_grupo2,c.*,ROUND(base*iva/100.0,2) iva2,ROUND(base*irpf/100.0,2) irpf2 FROM (SELECT id_usuario,id_grupo,/*MYSQL CONCAT('".LANG_ESCAPE("albaran")." ',LPAD(a.id,5,0)) *//*SQLITE '".LANG_ESCAPE("albaran")." ' || SUBSTR('00000' || a.id,-5,5) */ num2,a.*,ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) base FROM tbl_facturas a LEFT JOIN tbl_facturas_c b ON a.id=b.id_factura LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("facturas")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id GROUP BY a.id) c) d WHERE id_cliente='".abs($id)."' AND cerrado=0 AND (".check_sql("facturas","view").") ORDER BY id DESC"</albaranes>
					</albaranes>
					<facturasopen>
						<facturasopen global="id" eval="true">"SELECT id_usuario2 id_usuario,id_grupo2 id_grupo,id,(SELECT nombre FROM tbl_cuentas c WHERE c.id=id_cuenta) cuenta,/*MYSQL CONCAT('link:facturas(',-id,'):',num2) *//*SQLITE 'link:facturas(' || -id || '):' || num2 */ num,fecha,base,ROUND(base+iva2-irpf2,2) total,(CASE cerrado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) cerrado,(CASE cobrado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) cobrado,/*MYSQL CONCAT('facturas(',-id,')') *//*SQLITE 'facturas(' || -id || ')' */ link_view,/*MYSQL CONCAT('pdffactura(',id,')') *//*SQLITE 'pdffactura(' || id || ')' */ link_pdf,/*MYSQL CONCAT('viewfactura(',id,')') *//*SQLITE 'viewfactura(' || id || ')' */ link_view2,/*MYSQL CONCAT('mailfactura(',id,')') *//*SQLITE 'mailfactura(' || id || ')' */ link_mail FROM (SELECT id_usuario id_usuario2,id_grupo id_grupo2,c.*,ROUND(base*iva/100.0,2) iva2,ROUND(base*irpf/100.0,2) irpf2 FROM (SELECT id_usuario,id_grupo,/*MYSQL CONCAT('".LANG_ESCAPE("factura")." ',num) *//*SQLITE '".LANG_ESCAPE("factura")." ' || num */ num2,a.*,ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) base FROM tbl_facturas a LEFT JOIN tbl_facturas_c b ON a.id=b.id_factura LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("facturas")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id GROUP BY a.id) c) d WHERE id_cliente='".abs($id)."' AND cerrado=1 AND cobrado=0 AND (".check_sql("facturas","view").") ORDER BY fecha DESC"</facturasopen>
					</facturasopen>
					<facturasclose>
						<facturasclose global="id" eval="true">"SELECT id_usuario2 id_usuario,id_grupo2 id_grupo,id,(SELECT nombre FROM tbl_cuentas c WHERE c.id=id_cuenta) cuenta,/*MYSQL CONCAT('link:facturas(',-id,'):',num2) *//*SQLITE 'link:facturas(' || -id || '):' || num2 */ num,fecha,base,ROUND(base+iva2-irpf2,2) total,(CASE cerrado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) cerrado,(CASE cobrado WHEN 1 THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END) cobrado,/*MYSQL CONCAT('facturas(',-id,')') *//*SQLITE 'facturas(' || -id || ')' */ link_view,/*MYSQL CONCAT('pdffactura(',id,')') *//*SQLITE 'pdffactura(' || id || ')' */ link_pdf,/*MYSQL CONCAT('viewfactura(',id,')') *//*SQLITE 'viewfactura(' || id || ')' */ link_view2,/*MYSQL CONCAT('mailfactura(',id,')') *//*SQLITE 'mailfactura(' || id || ')' */ link_mail FROM (SELECT id_usuario id_usuario2,id_grupo id_grupo2,c.*,ROUND(base*iva/100.0,2) iva2,ROUND(base*irpf/100.0,2) irpf2 FROM (SELECT id_usuario,id_grupo,/*MYSQL CONCAT('".LANG_ESCAPE("factura")." ',num) *//*SQLITE '".LANG_ESCAPE("factura")." ' || num */ num2,a.*,ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) base FROM tbl_facturas a LEFT JOIN tbl_facturas_c b ON a.id=b.id_factura LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("facturas")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id GROUP BY a.id) c) d WHERE id_cliente=".abs($id)." AND cerrado=1 AND cobrado=1 AND (".check_sql("facturas","view").") ORDER BY fecha DESC"</facturasclose>
					</facturasclose>
					<gastos>
						<gastos global="id" eval="true">"SELECT id_usuario,id_grupo,(SELECT nombre FROM tbl_cuentas c WHERE c.id=id_cuenta) cuenta,/*MYSQL CONCAT('link:gastos(',-id,'):',LPAD(id,5,0))*//*SQLITE 'link:gastos(' || -id || '):' || SUBSTR('00000' || id,-5,5)*/ id,empresa,fecha,num,base,total,/*MYSQL CONCAT('gastos(',-id,')') *//*SQLITE 'gastos(' || -id || ')' */ link_view FROM (SELECT id_usuario,id_grupo,a.*,b.nombre empresa FROM tbl_gastos a LEFT JOIN tbl_proveedores b ON a.id_proveedor=b.id LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("gastos")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id) c WHERE id_cliente=".abs($id)." AND (".check_sql("gastos","view").") ORDER BY fecha DESC"</gastos>
					</gastos>
					<agenda>
						<agenda global="id" eval="true">"SELECT id_usuario,id_grupo,/*MYSQL LPAD(id,5,0)*//*SQLITE SUBSTR('00000' || id,-5,5)*/ id,dstart,dstop,/*MYSQL CONCAT('link:agenda(',-id,'):',nombre) *//*SQLITE 'link:agenda(' || -id || '):' || nombre */ nombre,CASE id_estado WHEN '0' THEN '".LANG_ESCAPE("sinestado")."' ELSE c_nombre END estado,/*MYSQL CONCAT('agenda(',-id,')') *//*SQLITE 'agenda(' || -id || ')' */ link_view FROM (SELECT id_usuario,id_grupo,a.*,c.nombre c_nombre,x.nombre x_nombre FROM tbl_agenda a LEFT JOIN tbl_estados c ON id_estado=c.id LEFT JOIN tbl_tiposevento x ON x.id=id_tipoevento LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("agenda")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id) z WHERE id_cliente=".abs($id)." AND (".check_sql("agenda","view").") ORDER BY dstart DESC"</agenda>
					</agenda>
					<presupuestos>
						<presupuestos global="page,id" eval="true">"SELECT /*MYSQL LPAD(a.id,5,0)*//*SQLITE SUBSTR('00000' || a.id,-5,5)*/ id,".make_extra_query_with_login("b.")." usuario,e.`datetime`,/*MYSQL CONCAT('link:presupuestos(',-a.id,'):',a.nombre) *//*SQLITE 'link:presupuestos(' || -a.id || '):' || a.nombre */ presupuesto,CASE id_estado WHEN '0' THEN '".LANG_ESCAPE("sinestado")."' ELSE c.nombre END estado,/*MYSQL CONCAT('presupuestos(',-a.id,')') *//*SQLITE 'presupuestos(' || -a.id || ')' */ link_view,/*MYSQL CONCAT('pdfpresupuesto(',a.id,')') *//*SQLITE 'pdfpresupuesto(' || a.id || ')' */ link_pdf,/*MYSQL CONCAT('viewpresupuesto(',a.id,')') *//*SQLITE 'viewpresupuesto(' || a.id || ')' */ link_view2,/*MYSQL CONCAT('mailpresupuesto(',a.id,')') *//*SQLITE 'mailpresupuesto(' || a.id || ')' */ link_mail FROM tbl_presupuestos a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("presupuestos")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios b ON e.id_usuario=b.id LEFT JOIN tbl_estados c ON a.id_estado=c.id WHERE a.id_cliente=".abs($id)." AND (".check_sql("presupuestos","view").") ORDER BY e.`datetime` DESC"</presupuestos>
					</presupuestos>
					<actas>
						<actas global="id" eval="true">"SELECT id_usuario,id_grupo,/*MYSQL LPAD(id,5,0)*//*SQLITE SUBSTR('00000' || id,-5,5)*/ id,dstart,dstop,/*MYSQL CONCAT('link:actas(',-id,'):',nombre) *//*SQLITE 'link:actas(' || -id || '):' || nombre */ nombre,/*MYSQL CONCAT('actas(',-id,')') *//*SQLITE 'actas(' || -id || ')' */ link_view,/*MYSQL CONCAT('pdfacta(',id,')') *//*SQLITE 'pdfacta(' || id || ')' */ link_pdf,/*MYSQL CONCAT('viewacta(',id,')') *//*SQLITE 'viewacta(' || id || ')' */ link_view2,/*MYSQL CONCAT('mailacta(',id,')') *//*SQLITE 'mailacta(' || id || ')' */ link_mail FROM (SELECT id_usuario,id_grupo,a.* FROM tbl_actas a LEFT JOIN tbl_registros_i e ON e.id_aplicacion='".page2id("actas")."' AND e.id_registro=a.id LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id) z WHERE id_cliente=".abs($id)." AND (".check_sql("actas","view").") ORDER BY id DESC"</actas>
					</actas>
					<graficas>SELECT '1' id</graficas>
					<control include="xml/common/qcontrol.xml"/>
					<folders include="xml/common/qfolders.xml"/>
					<help include="xml/common/qhelp.xml" replace="true"/>
				</query>
			</view>
			<insert>
				<title lang="true">forminsert</title>
				<query>
					<query include="xml/common/qpermcreate.xml" replace="true"/>
					<default>SELECT '0' id,'0' diapago,'1' id_tipo,'0' id_campanya,'0' id_importacion</default>
					<direccion_new include="xml/common/qdireccionnew.xml" replace="true"/>
					<comunicacion_new include="xml/common/qcomunicacionnew.xml" replace="true"/>
					<files_new include="xml/common/qfilesnew.xml" replace="true"/>
					<folders include="xml/common/qfolders.xml"/>
					<help include="xml/common/qhelp.xml" replace="true"/>
				</query>
			</insert>
			<update>
				<title lang="true">formupdate</title>
				<query>
					<query include="xml/common/qpermupdate.xml" replace="true"/>
					<default global="id" eval="true">"SELECT *,nombre1 nombre1_tipo_1,nombre2 nombre2_tipo_1,cif cif_tipo_1,nombre1 nombre1_tipo_2,nombre2 nombre2_tipo_2,cif cif_tipo_2 FROM tbl_clientes WHERE id='".abs($id)."'"</default>
					<direccion_principal include="xml/common/qdireccionpriview.xml" replace="true"/>
					<comunicacion_principal include="xml/common/qcomunicacionpriview.xml" replace="true"/>
					<direccion_secundaria include="xml/common/qdireccionsecview.xml" replace="true"/>
					<comunicacion_secundaria include="xml/common/qcomunicacionsecview.xml" replace="true"/>
					<direccion_new include="xml/common/qdireccionnew.xml" replace="true"/>
					<comunicacion_new include="xml/common/qcomunicacionnew.xml" replace="true"/>
					<comments_old include="xml/common/qcommentsold.xml"/>
					<files_old include="xml/common/qfilesold.xml"/>
					<comments_new include="xml/common/qcommentnew.xml" replace="true"/>
					<files_new include="xml/common/qfilesnew.xml" replace="true"/>
					<control include="xml/common/qcontrol.xml"/>
					<folders include="xml/common/qfolders.xml"/>
					<help include="xml/common/qhelp.xml" replace="true"/>
				</query>
			</update>
		</views>
		<name>form</name>
		<action>xml.php</action>
		<method>post</method>
		<hiddens>
			<hiddens include="xml/common/hiddensform.xml" replace="true"/>
			<field>
				<name>id_campanya</name>
				<type>hidden</type>
				<value eval="true">getParam("id_campanya")</value>
			</field>
			<field>
				<name>id_cliente</name>
				<type>hidden</type>
				<value eval="true">getParam("id_cliente")</value>
			</field>
		</hiddens>
		<fields>
			<default>
				<fieldset>
					<title lang="true">defaultdata</title>
					<quick global="id" eval="true">$id>=0?"false":"true"</quick>
					<buttons>true</buttons>
					<row>
						<field>
							<name>id</name>
							<type>hidden</type>
						</field>
						<field>
							<name>id_campanya</name>
							<label lang="true">campanya</label>
							<type>select</type>
							<width>240px</width>
							<query eval="true">make_select_query("campanyas","tbl_campanyas","nombre")." UNION SELECT '0' value,'".LANG_ESCAPE("sincampanya")."' label,'-1' pos ORDER BY `pos` ASC,`label` ASC,`value` ASC"</query>
							<focus global="id" eval="true">$id>=0?"true":"false"</focus>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<link>campanyas(-abs(ID))</link>
							<icon>view</icon>
						</field>
						<field>
							<name>id_importacion</name>
							<label lang="true">importacion</label>
							<type>select</type>
							<width>240px</width>
							<query eval="true">make_select_query("importaciones","tbl_importaciones","nombre")." UNION SELECT '0' value,'".LANG_ESCAPE("sinimportacion")."' label,'-1' pos ORDER BY `pos` ASC,`label` ASC,`value` ASC"</query>
							<focus global="id" eval="true">$id>=0?"true":"false"</focus>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<link>importaciones(-abs(ID))</link>
							<icon>view</icon>
						</field>
					</row>
					<row>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row>
						<field>
							<name>id_tipo</name>
							<label lang="true">tipocliente</label>
							<type>select</type>
							<width>120px</width>
							<query eval="true">"SELECT '1' `value`,'".LANG_ESCAPE("clientejuridico")."' label UNION SELECT '2' `value`,'".LANG_ESCAPE("clientefiscal")."' label ORDER BY label"</query>
							<focus global="id" eval="true">$id>=0?"true":"false"</focus>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<onchange>update_tipo()</onchange>
						</field>
					</row>
					<row>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row>
						<id>linea_1_tipo_1</id>
						<field>
							<name>nombre1_tipo_1</name>
							<label lang="true">nombrecomercial</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<speech>true</speech>
						</field>
					</row>
					<row>
						<id>linea_2_tipo_1</id>
						<field>
							<name>nombre2_tipo_1</name>
							<label lang="true">nombrefiscal</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<speech>true</speech>
						</field>
						<field>
							<name>cif_tipo_1</name>
							<label lang="true">cif</label>
							<type>text</type>
							<width>120px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
						</field>
						<field>
							<type>separator</type>
							<width>100px</width>
						</field>
					</row>
					<row>
						<id>linea_1_tipo_2</id>
						<field>
							<name>nombre1_tipo_2</name>
							<label lang="true">nombre</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<speech>true</speech>
						</field>
					</row>
					<row>
						<id>linea_2_tipo_2</id>
						<field>
							<name>nombre2_tipo_2</name>
							<label lang="true">apellidos</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<speech>true</speech>
						</field>
						<field>
							<name>cif_tipo_2</name>
							<label lang="true">nif</label>
							<type>text</type>
							<width>120px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
						</field>
						<field>
							<type>separator</type>
							<width>100px</width>
						</field>
					</row>
					<row>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row>
						<field>
							<name>nombre</name>
							<label lang="true">mostrarcomo</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<required>true</required>
							<speech>true</speech>
						</field>
					</row>
					<row>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row>
						<field>
							<name>corriente</name>
							<label lang="true">cuentacorriente</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
						</field>
						<field>
							<name>diapago</name>
							<label lang="true">diapago</label>
							<type>select</type>
							<width>75px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<rows include="xml/common/dias.xml" replace="true"/>
						</field>
						<field>
							<type>separator</type>
							<width>100px</width>
						</field>
					</row>
					<row>
						<field>
							<name>contable</name>
							<label lang="true">cuentacontable</label>
							<type>text</type>
							<width>240px</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
						</field>
					</row>
					<row>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row>
						<field>
							<name>comentarios</name>
							<label lang="true">comentarios</label>
							<type>textarea</type>
							<width>600px</width>
							<height>120px</height>
							<colspan>4</colspan>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
						</field>
					</row>
				</fieldset>
			</default>
			<direccion_principal include="xml/common/direccionesold.xml"/>
			<node path="direccion_principal/fieldset/row" before="true">
				<title lang="true">direccionesold</title>
			</node>
			<comunicaciones_principal include="xml/common/comunicacionesold.xml"/>
			<direccion_secundaria include="xml/common/direccionesold.xml"/>
			<comunicaciones_secundaria include="xml/common/comunicacionesold.xml"/>
			<direccion_new include="xml/common/direccionesnew.xml"/>
			<node path="direccion_new/fieldset/row" before="true">
				<title lang="true">direccionesnew</title>
			</node>
			<comunicaciones_new include="xml/common/comunicacionesnew.xml"/>
			<contactos include="xml/common/relatedcontacts.xml" replace="true"/>
			<proyectosopen include="xml/common/proyectosopen.xml" replace="true"/>
			<proyectosclose include="xml/common/proyectosclose.xml" replace="true"/>
			<incidenciasopen include="xml/common/incidenciasopen.xml" replace="true"/>
			<incidenciasclose include="xml/common/incidenciasclose.xml" replace="true"/>
			<partesopen include="xml/common/partesopen.xml" replace="true"/>
			<partesclose include="xml/common/partesclose.xml" replace="true"/>
			<albaranes include="xml/common/relatedalbaranes.xml" replace="true"/>
			<facturasopen include="xml/common/facturasopen.xml" replace="true"/>
			<facturasclose include="xml/common/facturasclose.xml" replace="true"/>
			<gastos include="xml/common/relatedgastos.xml" replace="true"/>
			<documentos include="xml/common/relateddocumentos.xml" replace="true"/>
			<comments_old include="xml/common/commentsold.xml"/>
			<files_old include="xml/common/filesold.xml"/>
			<comments_new include="xml/common/commentnew.xml"/>
			<files_new include="xml/common/filesnew.xml"/>
			<agenda include="xml/common/relatedagenda.xml" replace="true"/>
			<presupuestos include="xml/common/relatedpresupuestos.xml" replace="true"/>
			<actas include="xml/common/relatedactas.xml" replace="true"/>
			<graficas>
				<fieldset>
					<title lang="true">graficas</title>
					<row>
						<field>
							<type>plot</type>
							<width eval="true">CONFIG("plot_form_width")."px"</width>
							<height eval="true">CONFIG("plot_form_height")."px"</height>
							<vars>1</vars>
							<graph>bars</graph>
							<title lang="true">plotseguimiento12meses</title>
							<query global="id" eval="true">"SELECT /*MYSQL CONCAT(SUBSTR((((xx-1)-(xx-1)%12)/12),1,4),'-',SUBSTR(((xx-1)%12+101),2,2)) *//*SQLITE SUBSTR((((xx-1)-(xx-1)%12)/12),1,4) || '-' || SUBSTR(((xx-1)%12+101),2,2) */ y0,CASE WHEN ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) IS NULL THEN 0 ELSE ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) END y1 FROM (SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-0 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-1 xx FROM tbl_facturas UNION	SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-2 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-3 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-4 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-5 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-6 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-7 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-8 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-9 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-10 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-11 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-12 xx FROM tbl_facturas) a LEFT JOIN tbl_facturas b ON xx=SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2) AND id_cliente='".abs($id)."' AND cerrado='1' LEFT JOIN tbl_facturas_c c ON c.id_factura=b.id GROUP BY xx ORDER BY xx ASC"</query>
						</field>
						<field>
							<type>plot</type>
							<width eval="true">CONFIG("plot_form_width")."px"</width>
							<height eval="true">CONFIG("plot_form_height")."px"</height>
							<vars>1</vars>
							<graph>pie</graph>
							<title lang="true">plotseguimiento12meses</title>
							<query global="id" eval="true">"SELECT /*MYSQL CONCAT(SUBSTR((((xx-1)-(xx-1)%12)/12),1,4),'-',SUBSTR(((xx-1)%12+101),2,2)) *//*SQLITE SUBSTR((((xx-1)-(xx-1)%12)/12),1,4) || '-' || SUBSTR(((xx-1)%12+101),2,2) */ y0,CASE WHEN ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) IS NULL THEN 0 ELSE ROUND(SUM(precio*unidades*(100.0-descuento)/100.0),2) END y1 FROM (SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-0 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-1 xx FROM tbl_facturas UNION	SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-2 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-3 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-4 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-5 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-6 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-7 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-8 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-9 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-10 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-11 xx FROM tbl_facturas UNION SELECT MAX(SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2))-12 xx FROM tbl_facturas) a LEFT JOIN tbl_facturas b ON xx=SUBSTR(fecha,1,4)*12+SUBSTR(fecha,6,2) AND id_cliente='".abs($id)."' AND cerrado='1' LEFT JOIN tbl_facturas_c c ON c.id_factura=b.id GROUP BY xx ORDER BY xx ASC"</query>
						</field>
					</row>
				</fieldset>
			</graficas>
			<control include="xml/common/control.xml"/>
			<folders include="xml/common/folders.xml"/>
			<help include="xml/common/helpform.xml"/>
		</fields>
		<quick include="xml/common/quickform.xml"/>
		<buttons include="xml/common/buttonsform.xml"/>
		<node path="buttons/row/field" before="true">
			<field global="id" ifeval="$id&lt;0">
				<type>button</type>
				<value eval="true">LANG("add","contactos")</value>
				<tip eval="true">LANG("add","contactos")</tip>
				<onclick>setParam("page","contactos"); setParam("action","form"); setParam("id_cliente",abs(getParam("id"))); setParam("id","0"); submit1();</onclick>
				<disabled eval="true">check_user("contactos","create")?"false":"true"</disabled>
				<class>nowrap contextmenu</class>
				<icon>create</icon>
			</field>
			<field global="id" ifeval="$id&lt;0">
				<type>button</type>
				<value eval="true">LANG("add","actas")</value>
				<tip eval="true">LANG("add","actas")</tip>
				<onclick>setParam("page","actas"); setParam("action","form"); setParam("id_campanya",getParam("default_"+abs(getParam("id"))+"_id_campanya")); setParam("id_cliente",abs(getParam("id"))); setParam("id","0"); submit1();</onclick>
				<disabled eval="true">check_user("seguimientos","create")?"false":"true"</disabled>
				<class>nowrap contextmenu</class>
				<icon>create</icon>
			</field>
			<field global="id" ifeval="$id&lt;0">
				<type>button</type>
				<value eval="true">LANG("add","agenda")</value>
				<tip eval="true">LANG("add","agenda")</tip>
				<onclick>setParam("page","agenda"); setParam("action","form"); setParam("id_campanya",getParam("default_"+abs(getParam("id"))+"_id_campanya")); setParam("id_cliente",abs(getParam("id"))); setParam("id","0");submit1();</onclick>
				<disabled eval="true">check_user("seguimientos","create")?"false":"true"</disabled>
				<class>nowrap contextmenu</class>
				<icon>create</icon>
			</field>
		</node>
		<javascript>
			<javascript include="xml/common/jsform.xml" replace="true"/>
			<function eval="true">"liquidar1() { dialog(\"".LANG_ESCAPE("confirm")."\",\"".LANG_ESCAPE("msgliquidar")."\",{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','liquidar'); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
			<cache>
				<include>js/updatedireccion.js</include>
			</cache>
		</javascript>
	</form>
	<insert>
		<query include="xml/common/qpermcreate.xml" replace="true"/>
		<query include="xml/common/autonombre.xml" replace="true"/>
		<query match="default" prefix="true" eval="true">setParam("nombre1",stripslashes(getParam("nombre1_tipo_".getParam("id_tipo"))))</query>
		<query match="default" prefix="true" eval="true">setParam("nombre2",stripslashes(getParam("nombre2_tipo_".getParam("id_tipo"))))</query>
		<query match="default" prefix="true" eval="true">setParam("cif",getParam("cif_tipo_".getParam("id_tipo")))</query>
		<query match="default" prefix="true" global="page" preeval="true" eval="true">make_insert_query(page2table($page))</query>
		<query include="xml/common/qcontrolinsert.xml" replace="true"/>
		<query include="xml/common/qdireccionnewinsert.xml" replace="true"/>
		<query include="xml/common/qcomunicacionnewinsert.xml" replace="true"/>
		<query include="xml/common/qfilesinsert.xml" replace="true"/>
		<query include="xml/common/qfoldersinsert.xml" replace="true"/>
	</insert>
	<update>
		<query include="xml/common/qpermupdate.xml" replace="true"/>
		<query match="default" prefix="true" eval="true">setParam("nombre1",stripslashes(getParam("nombre1_tipo_".getParam("id_tipo"))))</query>
		<query match="default" prefix="true" eval="true">setParam("nombre2",stripslashes(getParam("nombre2_tipo_".getParam("id_tipo"))))</query>
		<query match="default" prefix="true" eval="true">setParam("cif",getParam("cif_tipo_".getParam("id_tipo")))</query>
		<query match="default" prefix="true" global="page" preeval="true" eval="true">make_update_query(page2table($page))</query>
        <query include="xml/common/qcontrolupdate.xml" replace="true"/>
        <query include="xml/common/qdireccionpriupdate.xml" replace="true"/>
        <query include="xml/common/qdireccionsecupdate.xml" replace="true"/>
        <query include="xml/common/qcomunicacionpriupdate.xml" replace="true"/>
        <query include="xml/common/qcomunicacionsecupdate.xml" replace="true"/>
        <query include="xml/common/qdireccionnewupdate.xml" replace="true"/>
        <query include="xml/common/qcomunicacionnewupdate.xml" replace="true"/>
		<query include="xml/common/qfilesdelete.xml" replace="true"/>
		<query include="xml/common/qfilesupdate.xml" replace="true"/>
		<query include="xml/common/qcommentsdelete.xml" replace="true"/>
		<query include="xml/common/qcommentsinsert.xml" replace="true"/>
		<query include="xml/common/qfoldersupdate.xml" replace="true"/>
	</update>
	<delete>
		<query include="xml/common/qpermdelete.xml" replace="true"/>
		<query include="xml/common/qdelete.xml" replace="true"/>
		<query include="xml/common/qdirecciondelete.xml" replace="true"/>
		<query include="xml/common/qcomunicaciondelete.xml" replace="true"/>
		<query include="xml/common/qdeletecomments.xml" replace="true"/>
		<query include="xml/common/qdeletefiles.xml" replace="true"/>
		<query include="xml/common/qcontroldelete.xml" replace="true"/>
		<query include="xml/common/qfoldersdelete.xml" replace="true"/>
	</delete>
	<pdf>
		<constructor>"P","mm","A4"</constructor>
		<margins>50,30,30,30</margins>
		<query>"SELECT *,'".LANG("defaultdata")."' title,CASE id_tipo WHEN '1' THEN '".LANG("clientejuridico")."' WHEN '2' THEN '".LANG("clientefiscal")."' END tipocliente,(SELECT nombre FROM tbl_campanyas WHERE id=id_campanya) campanya,'".page2id("clientes")."' id_aplicacion FROM tbl_clientes WHERE id IN (".check_ids(getParam("id")).")"</query>
		<!-- TEMPLATE -->
		<header>
			<!-- LOGO -->
			<margins>0,0,0,0</margins>
			<image>CONFIG("logo_left"),CONFIG("logo_top"),CONFIG("logo_width"),CONFIG("logo_height"),get_directory("dirs/filesdir").CONFIG("logo_file")</image>
			<!-- PONER MARCA DE AGUA -->
			<font>"Helvetica","B",CONFIG("water_clientes_size"),"#eeeeee"</font>
			<text>CONFIG("water_clientes_posx"),CONFIG("water_clientes_posy"),CONFIG("water_clientes_text"),CONFIG("water_clientes_angle")</text>
			<margins>50,30,30,30</margins>
			<setxy>30,50</setxy>
		</header>
		<footer>
			<margins>0,0,0,0</margins>
			<!-- PONER PIE DE PAGINA -->
			<font>"Helvetica","",6,CONFIG("color_text2")</font>
			<pageno>30,279,150,0,"R",LANG("paginaspc"),LANG("spcdespc")</pageno>
			<margins>50,30,30,30</margins>
		</footer>
		<!-- BEGIN -->
		<color>CONFIG("color_line"),"#000000"</color>
		<!-- DATOS CLIENTE -->
		<relatedclientes include="xml/common/relatedclientespdf.xml" replace="true"/>
		<foreach>
			<!-- DIRECCIONES CLIENTE -->
			<direccionespdf include="xml/common/direccionespdf.xml" replace="true"/>
			<!-- COMENTARIOS CLIENTE -->
			<commentspdf include="xml/common/commentspdf.xml" replace="true"/>
			<!-- CONTACTOS CLIENTE -->
			<query>"SELECT *,'".LANG("contactdata")."' title,'".page2id("contactos")."' id_aplicacion FROM tbl_contactos WHERE ((id_aplicacion='".page2id("clientes")."' AND id_registro='".$row["id"]."') OR (id_aplicacion='".page2id("proyectos")."' AND id_registro IN (SELECT id FROM tbl_proyectos WHERE id_cliente='".$row["id"]."'))) AND '".getParam("contactos")."'='1' ORDER BY nombre ASC"</query>
			<relatedcontacts include="xml/common/relatedcontactspdf.xml" replace="true"/>
			<!-- INCIDENCIAS ABIERTAS CLIENTE -->
			<query>"SELECT a.*,
			(SELECT GROUP_CONCAT(".make_extra_query_with_login("uu.")." /*MYSQL SEPARATOR '; ' *//*SQLITE ,'; '*/) FROM tbl_usuarios uu WHERE uu.id IN (SELECT iu.id_usuario FROM tbl_incidencias_u iu WHERE iu.id_incidencia=a.id)) asignadoa,
			'".LANG("incidentopen")."' title,'".page2id("incidencias")."' id_aplicacion,(SELECT nombre FROM tbl_estados WHERE id=a.id_estado) estado,(SELECT nombre FROM tbl_proyectos WHERE id=a.id_proyecto) proyecto,(SELECT nombre FROM tbl_prioridades WHERE id=a.id_prioridad) prioridad FROM tbl_incidencias a WHERE a.id_cliente='".$row["id"]."' AND a.id_estado IN (SELECT id FROM tbl_estados WHERE activo='1') AND '".getParam("incidencias")."'='1' ORDER BY a.id ASC"</query>
			<relatedincidencias include="xml/common/relatedincidenciaspdf.xml" replace="true"/>
			<!-- INCIDENCIAS CERRADAS CLIENTE -->
			<query>"SELECT a.*,
			(SELECT GROUP_CONCAT(".make_extra_query_with_login("uu.")." /*MYSQL SEPARATOR '; ' *//*SQLITE ,'; '*/) FROM tbl_usuarios uu WHERE uu.id IN (SELECT iu.id_usuario FROM tbl_incidencias_u iu WHERE iu.id_incidencia=a.id)) asignadoa,
			'".LANG("incidentclose")."' title,'".page2id("incidencias")."' id_aplicacion,(SELECT nombre FROM tbl_estados WHERE id=a.id_estado) estado,(SELECT nombre FROM tbl_proyectos WHERE id=a.id_proyecto) proyecto,(SELECT nombre FROM tbl_prioridades WHERE id=a.id_prioridad) prioridad FROM tbl_incidencias a WHERE a.id_cliente='".$row["id"]."' AND a.id_estado IN (SELECT id FROM tbl_estados WHERE activo='0') AND '".getParam("incidencias")."'='1' ORDER BY a.id ASC"</query>
			<relatedincidencias include="xml/common/relatedincidenciaspdf.xml" replace="true"/>
			<!-- PROYECTOS ACTIVOS CLIENTE -->
			<query>"SELECT *,'".LANG("projectopen")."' title,'".page2id("proyectos")."' id_aplicacion,(SELECT nombre FROM tbl_estados WHERE id=id_estado) estado FROM tbl_proyectos WHERE id_cliente='".$row["id"]."' AND id_estado IN (SELECT id FROM tbl_estados WHERE activo='1') AND '".getParam("proyectos")."'='1' ORDER BY id ASC"</query>
			<relatedproyectos include="xml/common/relatedproyectospdf.xml" replace="true"/>
			<!-- PROYECTOS CERRADOS CLIENTE -->
			<query>"SELECT *,'".LANG("projectclose")."' title,'".page2id("proyectos")."' id_aplicacion,(SELECT nombre FROM tbl_estados WHERE id=id_estado) estado FROM tbl_proyectos WHERE id_cliente='".$row["id"]."' AND id_estado IN (SELECT id FROM tbl_estados WHERE activo='0') AND '".getParam("proyectos")."'='1' ORDER BY id ASC"</query>
			<relatedproyectos include="xml/common/relatedproyectospdf.xml" replace="true"/>
			<!-- PARTES ABIERTOS CLIENTES -->
			<query>"SELECT *,'".LANG("partesopen")."' title,'".page2id("partes")."' id_aplicacion,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(CASE liquidado WHEN 1 THEN '".LANG("yes")."' ELSE '".LANG("no")."' END) liquidado2 FROM tbl_partes WHERE id_cliente='".$row["id"]."' AND liquidado='0' AND '".getParam("partes")."'='1' ORDER BY fecha ASC"</query>
			<relatedpartes include="xml/common/relatedpartespdf.xml" replace="true"/>
			<!-- PARTES CERRADOS CLIENTES -->
			<query>"SELECT *,'".LANG("partesclose")."' title,'".page2id("partes")."' id_aplicacion,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(CASE liquidado WHEN 1 THEN '".LANG("yes")."' ELSE '".LANG("no")."' END) liquidado2 FROM tbl_partes WHERE id_cliente='".$row["id"]."' AND liquidado='1' AND '".getParam("partes")."'='1' ORDER BY fecha ASC"</query>
			<relatedpartes include="xml/common/relatedpartespdf.xml" replace="true"/>
			<!-- ALBARANES -->
			<query>"SELECT *,'".LANG("albaranes")."' title,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(SELECT /*SQLITE '(' || codigo || ') ' || nombre *//*MYSQL CONCAT('(',codigo,') ',nombre) */ nombre FROM tbl_epigrafes WHERE id=id_epigrafe) epigrafe,(SELECT nombre FROM tbl_cuentas WHERE id=id_cuenta) cuenta FROM tbl_facturas WHERE id_cliente='".$row["id"]."' AND cerrado='0' AND '".getParam("facturas")."'='1' ORDER BY fecha ASC"</query>
			<relatedfacturas include="xml/common/relatedfacturaspdf.xml" replace="true"/>
			<!-- FACTURAS NO COBRADAS -->
			<query>"SELECT *,'".LANG("facturaopen","clientes")."' title,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(SELECT /*SQLITE '(' || codigo || ') ' || nombre *//*MYSQL CONCAT('(',codigo,') ',nombre) */ nombre FROM tbl_epigrafes WHERE id=id_epigrafe) epigrafe,(SELECT nombre FROM tbl_cuentas WHERE id=id_cuenta) cuenta FROM tbl_facturas WHERE id_cliente='".$row["id"]."' AND cerrado='1' AND cobrado='0' AND '".getParam("facturas")."'='1' ORDER BY fecha ASC"</query>
			<relatedfacturas include="xml/common/relatedfacturaspdf.xml" replace="true"/>
			<!-- FACTURAS SI COBRADAS -->
			<query>"SELECT *,'".LANG("facturaclose","clientes")."' title,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(SELECT /*SQLITE '(' || codigo || ') ' || nombre *//*MYSQL CONCAT('(',codigo,') ',nombre) */ nombre FROM tbl_epigrafes WHERE id=id_epigrafe) epigrafe,(SELECT nombre FROM tbl_cuentas WHERE id=id_cuenta) cuenta FROM tbl_facturas WHERE id_cliente='".$row["id"]."' AND cerrado='1' AND cobrado='1' AND '".getParam("facturas")."'='1' ORDER BY fecha ASC"</query>
			<relatedfacturas include="xml/common/relatedfacturaspdf.xml" replace="true"/>
			<!-- GASTOS DEL CLIENTE -->
			<query>"SELECT *,'".LANG("gastosdata","clientes")."' title,(SELECT nombre FROM tbl_proyectos WHERE tbl_proyectos.id=id_proyecto) proyecto,(SELECT /*SQLITE '(' || codigo || ') ' || nombre *//*MYSQL CONCAT('(',codigo,') ',nombre) */ nombre FROM tbl_epigrafes WHERE tbl_epigrafes.id=id_epigrafe) epigrafe,(SELECT nombre FROM tbl_cuentas WHERE tbl_cuentas.id=id_cuenta) cuenta,(SELECT nombre FROM tbl_proveedores WHERE tbl_proveedores.id=id_proveedor) proveedor,(SELECT nombre FROM tbl_formaspago WHERE tbl_formaspago.id=id_formapago) formapago,".make_extra_query_with_login("d.")." pagador,CASE liquidado WHEN '1' THEN '".LANG("yes")."' ELSE '".LANG("no")."' END liquidado2 FROM tbl_gastos a LEFT JOIN tbl_usuarios d ON a.id_pagador=d.id WHERE id_cliente='".$row["id"]."' AND '".getParam("gastos")."'='1' ORDER BY d.id ASC"</query>
			<relatedgastos include="xml/common/relatedgastospdf.xml" replace="true"/>
			<!-- EVENTOS DEL CLIENTE -->
			<query>"SELECT a.*,'".LANG("agendadata","clientes")."' title,'".page2id("agenda")."' id_aplicacion,(SELECT nombre FROM tbl_campanyas WHERE id=a.id_campanya) campanya,(SELECT nombre FROM tbl_proyectos WHERE id=a.id_proyecto) proyecto,(SELECT nombre FROM tbl_presupuestos WHERE id=a.id_presupuesto) presupuesto,(SELECT nombre FROM tbl_tiposevento WHERE id=a.id_tipoevento) tipoevento,(SELECT nombre FROM tbl_estados WHERE id=a.id_estado) estado,
			(SELECT GROUP_CONCAT(".make_extra_query_with_login("uu.")." /*MYSQL SEPARATOR '; ' *//*SQLITE ,'; '*/) FROM tbl_usuarios uu WHERE uu.id IN (SELECT iu.id_usuario FROM tbl_agenda_u iu WHERE iu.id_agenda=a.id)) asignadoa
			FROM tbl_agenda a WHERE a.id_cliente='".$row["id"]."' AND '".getParam("agenda")."'='1' ORDER BY a.dstart ASC"</query>
			<relatedagenda include="xml/common/relatedagendapdf.xml" replace="true"/>
			<!-- PRESUPUESTOS DEL CLIENTE -->
			<query>"SELECT *,'".LANG("presupuestosdata","clientes")."' title,'".page2id("presupuestos")."' id_aplicacion,(SELECT nombre FROM tbl_campanyas WHERE id=id_campanya) campanya,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(SELECT nombre FROM tbl_estados WHERE id=id_estado) estado FROM tbl_presupuestos WHERE id_cliente='".$row["id"]."' AND '".getParam("presupuestos")."'='1' ORDER BY id ASC"</query>
			<relatedpresupuestos include="xml/common/relatedpresupuestospdf.xml" replace="true"/>
			<!-- ACTAS DEL CLIENTE -->
			<query>"SELECT *,'".LANG("actasdata","clientes")."' title,'".page2id("actas")."' id_aplicacion,(SELECT nombre FROM tbl_campanyas WHERE id=id_campanya) campanya,(SELECT nombre FROM tbl_proyectos WHERE id=id_proyecto) proyecto,(SELECT nombre FROM tbl_presupuestos WHERE id=id_presupuesto) presupuesto FROM tbl_actas WHERE id_cliente='".$row["id"]."' AND '".getParam("actas")."'='1' ORDER BY id ASC"</query>
			<relatedactas include="xml/common/relatedactaspdf.xml" replace="true"/>
		</foreach>
		<output>encode_bad_chars(str_replace(".","",strpos(check_ids(getParam("id")),",")===false?execute_query("
		SELECT
			/*MYSQL CONCAT('".LANG("cliente")."',' ',LPAD(id,5,0),' ',nombre) */
			/*SQLITE '".LANG("cliente")."' || ' ' || SUBSTR('00000' || id,-5,5) || ' ' || nombre */ subject
		FROM tbl_clientes WHERE id IN (".check_ids(getParam("id")).")"):LANG("clientes"))).getDefault("exts/pdfext",".pdf")</output>
	</pdf>
</root>
